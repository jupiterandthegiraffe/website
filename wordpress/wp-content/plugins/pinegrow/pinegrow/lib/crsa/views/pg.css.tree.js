$(function(){$("body").one("pinegrow-ready",function(e,t){})});var PgSelectedCSSNodes=function(){var n=[];this.select=function(e){n.indexOf(e)<0&&n.push(e),e.pg_selected=!0},this.deselect=function(e){var t=n.indexOf(e);0<=t&&n.splice(t,1),e.pg_selected=!1},this.clear=function(e){var t=n;n.forEach(function(e){e.pg_selected=!1}),n=[],e&&this.dispatchEvent(t,e)},this.update=function(){var t=[];n.forEach(function(e){e.is_removed||t.push(e)}),n=t},this.toggle=function(e){this.isSelected(e)?this.deselect(e):this.select(e)},this.isSelected=function(e){return e.pg_selected},this.getSelected=function(){return n},this.getLastSelected=function(){return n.length?n[n.length-1]:null},this.dispatchEvent=function(e,t){pinegrow.dispatchEvent("on_css_node_selected_deselected",null,e,t)},this.getListForNode=function(e){return this.isSelected(e)?n.slice(0):[e]},this.getNormalizedListForNode=function(e){function n(e){for(var t=0;e.parent;)t++,e=e.parent;return t}var t=this.getListForNode(e),o=(t.sort(function(e,t){return n(e)-n(t)}),[]);return t.forEach(function(e){for(var t=!1,n=0;n<o.length;n++)if(function(e,t){for(;t;){if(t===e)return!0;t=t.parent||null}return!1}(o[n],e)){t=!0;break}t||o.push(e)}),o}},PgCSSTreeActiveCommandsView=function(){for(var v=this,d=(this.onStateChanged=null,null),l=null,s=null,o=$("<div/>",{class:"pg-css-active-controls"}),n=(this.view=new PgUIView(o),$('<div class="pg-show-properties-name"><span>Styles for</span> <name></name></div>').prependTo(o)),a=n.find("name"),r=["active","hover","focus","visited"],e=$('<div class="pseudo-container"></div>').appendTo(n),c=$('<div class="pg-css-tree-create"></div>').appendTo(o),t=0;t<r.length;t++){var i=r[t],u=(this[i]=!1,$('<div class="pseudo-state" data-css-state="'+i+'"><label>:'+i.substr(0,3)+'</label><input type="checkbox"></div>').appendTo(e));u.click(function(e){e.preventDefault();var t=$(this),n=t.data("cssState"),o=(v[n]?(v[n]=!1,t.removeClass("checked")):(v[n]=!0,t.addClass("checked")),[]);r.forEach(function(e){v[n]&&o.push(e)}),pinegrow.getCollection().forEachElementAsync(function(e,t){pinegrow.devTools.forcePseudoStates(e,o,t),e.get$DOMElements().forEach(function(n){r.forEach(function(e){var t=`pg-state-`+e;v[e]?n.addClass(t):n.removeClass(t)})})},function(e){v.onStateChanged()})}),addTooltip(u,"Show selected element in <b>:"+i+"</b> state.")}function h(p){function t(){var e;n.length&&(e=pinegrow.getCollectionForElement(m),(new PgApi).addClass(e,n)),S(g,f,p.getMediaQuery(),function(e,t,n,o){var i=pinegrow.pgPostCSSHelper.getNodeByIndices(e.getRootNode(),t),l=pinegrow.pgPostCSSHelper.getNodeByIndices(e.getRootNode(),n),s=(o?pinegrow.dispatchEvent("on_css_node_added",null,{node:l,stylesheet:e}):pinegrow.dispatchEvent("on_css_node_added",null,{node:i,stylesheet:e}),null),s="atrule"==i.type?i.nodes[i.nodes.length-1]:i;if(p.getOptions().save_inline_source_rule)try{for(var a=p.getOptions().save_inline_source_rule,r=s,d=pgcssh.getStylesheetForNode(r),c=0,u=0;u<a.nodes.length;u++)"decl"==a.nodes[u].type&&(c=u);for(u=0;u<a.nodes.length;u++)"decl"===a.nodes[u].type&&d.ruleValueChanged(s,a.nodes[u].prop,a.nodes[u].value,null,!1,"gui",u===c,null);var h=pinegrow.getCollectionForElement(m);h.forEachElement(function(e){e.removeAttr("style")}),pinegrow.changeManager.didChange(h,"Remove style attribute")}catch(e){}pinegrow.selectRule(s),v.cssTreeView.scrollToNode(s),w.setSelector(""),pinegrow.showQuickMessage("Rule <b>"+g+"</b> created in <b>"+crsaGetNameFromUrl(f)+"</b>.")})}var g=p.getSelector(),f=p.getStylesheet(),n=(s&&s.url&&(f=s.url),p.getAddClasses()),m=(p.getSaveInline(),p.getOptions().target_pgel||d);f?t():pinegrow.getDefaultStylesheet(m.getPage(),function(e){e?(f=e.url,t()):pinegrow.showQuickError("Please choose or add stylesheet for the new CSS rule.")},!0)}var w,S=function(e,t,n,o){var i,l=pinegrow.getStylesheetByUrl(t),s=!1,a=l.getRootNode(),r=a,d=pinegrow.pgPostCSSHelper.createNode("rule",e),c=[a.nodes.length],u=[a.nodes.length],h=d;n&&((i=a.last)&&i.params&&i.params==n?(c=[a.nodes.length-1],u=[a.nodes.length-1,(r=i).nodes.length],s=!0):(i=pinegrow.pgPostCSSHelper.createNode("atrule","media",n),pinegrow.pgPostCSSHelper.insertNodeInside(d,i),h=i,u.push(0))),pinegrow.pgPostCSSHelper.insertNodeAt(h,r,r.nodes.length),l.setSourceForRules(a,function(){o&&o(l,c,u,s)})},p=(this.openCreateNewRuleDialog=function(e,t,n,o,i,l,s){var a=function(){for(var e=d.getPage().getStylesheets().getAllCrsaStylesheets(),t=[],n=0;n<e.length;n++)t=t.concat(pgStylesheetHelper.getAllStylesheetsFor(e[n]));for(var o=[],n=0;n<t.length;n++)t[n].url&&o.push(t[n].url);return o}(),a=$.extend({},{stylesheets:a,$position:l,selector_value:e,stylesheet_value:n,media_value:t,select_class:o,simple:i,target_pgel:d},s||{}),r=new PgQuickSelectorMaker(a.target_pgel,null,a);a.save_inline_source_rule,r.onCreate=h},this.showCreateCssRule=function(e){w&&(w.setSelector(e),$list_container.scrollTop(0),w.onShown(),addTooltip(w.getInput().$field,"Input the selector and press "+pgShowKbdCombo("Enter"),{trigger:"manual"}))},$('<div class="classes-whithout-rules"><classlist></classlist></div>'));p.on("click","[data-class]",function(e){e.preventDefault();var t=$(this).attr("data-class");v.openCreateNewRuleDialog("."+t,null,null,null,!0,$(e.target))});this.update=function(e){var n,i,t;l=(d=e)?d.getPage():null,e&&(a.get(0).innerHTML=pinegrow.selectedElements.getName({short:!0,num_classes:-1}),(n=e.get$DOMElement())&&r.forEach(function(e){v[e]=n.hasClass(`pg-state-`+e);var t=o.find(`[data-css-state="${e}"]`);v[e]?t.addClass("checked"):t.removeClass("checked")}),pgUIViewManager.destroyViewsInArea(c),c.find(".pg-active-add-rule").remove(),i=$('<div class="pg-active-add-rule"></div>').prependTo(c),t=function(e,t){w=new PgSelectorMakerView(d,null,{simple:!0,labels:!1,media_query:!1,stylesheets:!1,compact:!0,save_inline:!0,default_cs:e}),e||(t=!0),w.view.setAlwaysVisible(!0),w.onCreate=t?function(n){new PgSelectDefaultStylesheet(l,e).show(function(e,t){!t&&e&&h(n)})}:h,w.onCreateWithoutSelector=function(e,t){return v.openCreateNewRuleDialog(w?w.getSelector():null,null,s?s.url:null,null,!1,$(t.target)),!0},i.append(w.view.get$Element());var n=i.find("button.create"),o=e?crsaGetNameFromUrl(e.url):"default stylesheet";addTooltip(n,`Create a new CSS rule:<ul>
<li>Quick mode - enter the selector and click on Create or press ${pgShowKbdCombo("Enter")} to create a new rule in <b>${o}</b></li>
<li>Selector builder mode - leave the selector empty and click on Create to open selector builder and choose media query and stylesheet.</li></ul>`)},s?t(s,!1):pinegrow.getDefaultStylesheet(l,t))},this.setShowActive=function(e,t){s=e,this.update(t||d),e?pg$Hide(n):pg$Show(n,"flex")}},PgCSSTreeItemDialogView=function(){var e=$('<div class="pg-css-tree-dialog-view"></div>'),e=new PgUIView(e);this.view=e;e.onResize=function(){},e.onDestroy=function(){}};class PgCSSTreeItemDialog{constructor(e,t,n){var o=this;this.cell=e,this.data=t,this.dialogView=new PgCSSTreeItemDialogView,this.win=new PgQuickWindow(n,this.dialogView,"quickCSSTree_"+n,480,200),this.win.onDestroy=function(){o.focus_shown&&pinegrow.focusRect.hide()}}show(){var e=this;this.onShow(this.dialogView.view.get$Element(),this.cell.data,this.cell),this.win.showFor$El(this.cell.$element,null,0,"down"),this.win.autoSize(60),pinegrow.focusRect.showFor$El(this.dialogView.view.get$Element(),function(){e.win.close(),e.focus_shown=!1}),this.focus_shown=!0}onShow(e,t,n){}}class PgCSSTreeItemDialogMediaQuery extends PgCSSTreeItemDialog{constructor(e,t){super(e,t,"Edit media query")}onShow(e,t,n){var o=this,i=new PgInputField("mq",{type:"text",show_empty:!1,name:"Media query",without_text:!1,slider_def_unit:""}),l=(i.appendTo(e),t&&i.setValue(`@${t.node.name} `+t.node.params),i.on("input",function(e){}),i.on("change",function(e){o.cell.onSetMediaQuery(i.getValue(),!0)}),new PgMediaQueryHelperView(i.$input,pinegrow.getSelectedPage(),!1,!0));l.showFieldAndSelectors(),l.view.get$Element().appendTo(e)}}class PgCSSTreeCellEditable extends PgTableGridCell{constructor(e,t,n){super(e,t,n),this.edited_field=null,this.edited_field_control=null,this.on("cell","contextmenu",this.onContextMenu.bind(this))}addContextMenuActions(e){}onValueClick(e){}onContextMenu(e){e.preventDefault(),e.stopPropagation();var t=[];if(this.addContextMenuActions(t),0!==t.length)return new CrsaContextMenu(t,this.$element).showForElement(this.$element),!1}getValueHTML(e){return pgCSSTreeValueHTMLMaker.getHTML(e,this.data,this.data.node.prop?pinegrow.devTools.getCSSPropertyValuesRegEx(this.data.node.prop):null)}onValueEditStart(e,t){this.addClass("cell","text-is-edited"),this.edited_field=e,this.edited_field_control=t}onValueEditDone(){this.data.cellWidth=0,this.removeClass("cell","text-is-edited"),this.edited_field=null,this.edited_field_control=null,this.cssTreeView.refreshDisplayOnly()}onPopulate(){super.onPopulate(),this.edited_field=null,this.edited_field_control=null}displayField(e,t){this.edited_field===e?this.edited_field_control.setValue(t):(t=this.data.value_html=this.getValueHTML(t),this.setHtml(e.toLowerCase(),t))}onGetValueOptions(e){return null}onListItemHighlighted(e,t){}canEdit(e,t){var n;return("rule"!==this.data.node.type||!this.data.node.inline)&&("decl"===this.data.node.type&&this.data.node?.parent.inline?canMakeChange(this.data.node.parent.inline_for_pgel,"attr","style",e):!(n=pgcssh.getStylesheetForNode(this.data.node))||n.canEdit(e,t))}}class PgCSSTreeCellWithTools extends PgCSSTreeCellEditable{constructor(e,t,n,o){var i='<div class="tools">';(o=$.extend({comment:!0,delete:!1},o)).comment&&(i+='<input data-element="check" type="checkbox" checked>'),o.delete&&(i+='<i class="icon icon-bin" data-element="delete"></i>'),super(e=e.replace("#TOOLS#",i+="</div>"),t,n),o.comment&&(this.on("check","change",this.onUncheck.bind(this)),this.on("check","click",this.onStopEvent.bind(this))),o.delete&&this.on("delete","click",this.onDelete.bind(this))}addContextMenuActions(e){const t=this;super.addContextMenuActions(e),e.push({label:"Delete",action:function(){t.onDelete()}})}getNode(){return this.data.node}onPopulate(){this.getElement("check").checked="comment"!==this.getNode().type}onStopEvent(e){e.stopPropagation()}onUncheck(e){var t;e.preventDefault(),e.stopPropagation(),this.canEdit()?(t=new PgCSSApi,"comment"===this.getNode().type?t.uncommentNode(this.getNode(),function(){}):t.commentNode(this.getNode(),function(){})):this.getElement("check").checked=!this.getElement("check").checked}onDelete(e){e&&(e.preventDefault(),e.stopPropagation()),this.canEdit()&&(new PgCSSApi).deleteNode(this.getNode(),function(){})}}class PgCSSTreeCellStylesheet extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-css-tree-stylesheet"><i data-element="icon" class="collapse-icon icon-down"></i><name data-element="name"></name>
<i data-element="open" class="icon icon-align-left"></i>
<i data-element="code" class="icon icon-KODA"></i>
<i data-element="ignore" class="icon icon-hide"></i>
<i data-element="lock" class="icon icon-Lock_closed"></i>
</div>`,e,t),this.tooltip("open","Open the stylesheet in a separate panel."),this.tooltip("code","Edit stylesheet code."),this.tooltip("ignore","Ignore the stylesheet in the Active tab."),this.tooltip("lock","Click to lock the stylesheet."),this.on("open","click",this.onOpen.bind(this)),this.on("code","click",this.onCode.bind(this)),this.on("ignore","click",this.onIgnore.bind(this)),this.on("lock","click",this.onLock.bind(this))}getStylesheet(){return this.data.node.pgStylesheet}onPopulate(){var e=this.getStylesheet();e.canEdit(!0)?(this.tooltip("lock","Click to lock the stylesheet."),this.removeClass("lock","pg-css-locked","icon-Lock_open"),this.addClass("lock","icon-Lock_closed")):(this.addClass("lock","pg-css-locked","icon-Lock_open"),this.removeClass("lock","icon-Lock_closed"),this.tooltip("lock",`The stylesheet is locked. ${e.lockedReason||""} Click to unlock.`)),e.ignore?(this.tooltip("ignore","Rules from this stylesheet are not shown in the Active tab. Click to show its rules in the Active tab."),this.addClass("ignore","icon-hide"),this.removeClass("ignore","icon-see")):(this.tooltip("ignore","Rules from this stylesheet are shown in the Active tab. Click to hide its rules in the Active tab."),this.removeClass("ignore","icon-hide"),this.addClass("ignore","icon-see")),this.cssTreeView.isActive()?this.showElement("open","inline"):this.hideElement("open")}onOpen(e){e.preventDefault(),e.stopPropagation(),this.cssTreeView.combinedView.setActiveCs(this.getStylesheet())}onCode(e){e.preventDefault(),e.stopPropagation(),pinegrow.stylesheets.editCode(this.getStylesheet())}onIgnore(e){e.preventDefault(),e.stopPropagation();var t=this.getStylesheet();t.ignore?t.loadAndShowInActive():t.ignoreInActive(),this.cssTreeView.refresh()}onLock(e){e.preventDefault(),e.stopPropagation();var t=this.getStylesheet();t.canEdit(!0)?(t.setLocked(!0,""),pinegrow.selectedElements.reselect(),pinegrow.showQuickMessage("Stylesheet is locked.")):t.unlockWithAsk(),this.update()}destroy(){super.destroy()}}class PgCSSTreeCellProperty extends PgCSSTreeCellWithTools{constructor(e,t){super(`<div class="pg-css-tree-decl pg-css-tree-with-tools" data-element="cell">#TOOLS#
<name data-element="name" class="not-editable"></name> <value data-element="value"></value>
</div>`,e,t)}addContextMenuActions(t){const n=this;super.addContextMenuActions(t),(new PgCSSApi).getContextMenuActionsForRule(this.data.node,this.$element).forEach(function(e){t.push(e)},{on_node_created:function(e){n.cssTreeView.scrollToNode(e)}})}onValueEdited(e,t,n,o){var i,l,s;"VALUE"===e?(s=this.data.node.value,l=t,i=this.data.node.prop):"NAME"===e&&(l=this.data.node.value,s=this.data.node.prop,i=t),"VALUE"===e&&(this.data.value_html=this.getValueHTML(t),n)&&this.setHtml("value",this.data.value_html),(s!==t||n)&&(this.stylePreview&&this.stylePreview.restore(),i.length)&&(new PgCSSApi).setRuleProperty(this.data.node,i,l,function(){},{dispatchEvent:n||!1,edited_by:"scrub"===o?this.cssTreeView:null})}onListItemHighlighted(e,t){"VALUE"===e&&(t?this.stylePreview&&this.stylePreview.setStyle(this.data.node.prop,t.key):this.stylePreview&&this.stylePreview.restore())}onValueClick(e){}onGetValueOptions(e){var t,n;return"NAME"===e?function(){return pinegrow.devTools.getCSSPropertiesOptions()}:"VALUE"===e?(n=this.data.node.prop,!(t=pinegrow.devTools.getCSSPropertyValues(n))||""!==(n=this.data.node.value)&&t.indexOf(n)<0?null:function(){return t?t.map(function(e){return{key:e,name:e}}):null}):void 0}getListOfValues(e){var t=this.data.node.prop;return pinegrow.devTools.getCSSPropertyValues(t)||[]}onValueEditStart(e,t){var n;super.onValueEditStart(e,t),"VALUE"===e&&(n=this.data.target_pgel||pinegrow.selectedElements.getLastSelected())&&(this.stylePreview=new PgFastDOMStylePreviewForPgel(n))}onValueEditDone(){super.onValueEditDone(),this.stylePreview&&(this.stylePreview.destroy(),this.stylePreview=null)}destroy(){super.destroy(),this.stylePreview&&this.stylePreview.destroy()}}class PgCSSTreeCellPropertyComponent extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-css-tree-decl pg-css-tree-with-tools">
<name data-element="name"></name> <value data-element="value"></value>
</div>`,e,t)}getNode(){return this.data.node}onPopulate(){}}class PgCSSTreeCellComment extends PgCSSTreeCellWithTools{constructor(e,t){super(`<div data-element="cell" class="pg-css-tree-comment pg-css-tree-with-tools">#TOOLS#
<name data-element="name"></name>
</div>`,e,t)}}class PgCSSTreeCellAtRule extends PgCSSTreeCellEditable{constructor(e,t){super(`<div class="pg-css-tree-atrule" data-element="cell"><i data-element="icon" class="collapse-icon icon-down"></i>@<name class="not-editable" data-element="name"></name> <span data-element="value"></span></div>`,e,t),this.on("cell","click",this.onClick.bind(this))}onClick(e){e.target.classList.contains("collapse-icon")||new PgCSSTreeItemDialogMediaQuery(this,this.data).show()}getValueHTML(e){if("import"===this.data.node.name||"media"===this.data.node.name)return e;super.getValueHTML(e)}onSetMediaQuery(e,t){this.onValueEdited("VALUE",e,t),e&&this.displayField("VALUE",e)}onValueEdited(e,t,n){var o,i=this;"VALUE"===e&&(o=new PgCSSApi,t?o.changeMediaQuery(this.data.node,t,function(e){i.data.node=e},{dispatchEvent:!!n&&"Set "+this.data.node.name,edited_by:i.cssTreeView}):n&&o.deleteNodeAndKeepChildren(this.data.node))}}class PgCSSTreeCellRule extends PgCSSTreeCellEditable{constructor(e,t){super(`<div data-element="cell" class="pg-css-tree-stylesheet-rule aapg-css-tree-with-tools">
<i data-element="icon" class="collapse-icon icon-down"></i>
<name data-element="name"></name>
<count><span data-element="count"></span></count>
<i class="icon icon-plus-square" data-element="save"></i>
<i class="icon icon-repeat-Y" data-element="more"></i>
</div>`,e,t,{comment:!1}),this.tooltip("count","The number of matched elements on the current page view. Click to select one of the elements."),this.on("save","click",this.onSave.bind(this)),this.tooltip("save","Save inline style as a CSS rule."),this.on("more","click",this.onMore.bind(this)),this.tooltip("more","Show context menu."),this.on("count","click",this.onCount.bind(this))}onCount(e){var t=this.data.node.selector.replace(/::?(hover|focus|active|visited|after|before)/g,"");try{var n=pinegrow.getSelectedPage().getDocument().querySelectorAll(t);new PgCSSCountHandler($(e.target),n)}catch(e){pinegrow.showQuickError("Unable to find elements on the page.")}this.onStopEvent(e)}onMore(e){this.onContextMenu(e)}onSetMediaQuery(e,t){var n=pgcssh.getMediaNode(this.data.node);(new PgCSSApi).changeMediaQueryForRule(this.data.node,e,function(){},{edited_by:n||!t?this.cssTreeView:null})}addContextMenuActions(t){var e=this;super.addContextMenuActions(t),(new PgCSSApi).getContextMenuActionsForRule(this.data.node,this.$element).forEach(function(e){t.push(e)}),pgcssh.getMediaNode(this.data.node)||t.push({label:"Media query",submenu:[{label:"Edit...",action:function(){new PgCSSTreeItemDialogMediaQuery(e,e.data).show()}}]})}onClick(e){new PgCSSTreeItemDialogMediaQuery(this,this.data).show()}getNode(){return this.data.node}onPopulate(){super.onPopulate(),this.data.node.inline&&this.data.node.nodes.length?this.showElement("save","inline"):this.hideElement("save"),this.data.node.inline?this.hideElement("count"):this.showElement("count","inline")}onValueEdited(e,t,n){var o;"NAME"===e&&n&&(o=new PgCSSApi,t)&&o.updateRuleSelector(this.data.node,t,function(){},this.cssTreeView)}onSave(e){e.preventDefault(),e.stopPropagation();function t(){l.cssTreeView.activeControls.openCreateNewRuleDialog(null,null,null,null,!1,o,{title:"Save the inline style into a proper CSS rule",save_inline_source_rule:l.getNode(),target_pgel:s.inline_for_pgel||null})}var n,l=this,o=$(e.target),s=this.getNode(),a=pinegrow.selectedElements.getLastSelected(),i=pinegrow.pgActiveRules.getShownNodes().filter(function(e){var t=pgcssh.getStylesheetForNode(e);return!(t&&!t.canEdit(!0))});0===i.length?t():(n=[{label:"Create new rule...",action:function(){t()}},{type:"divider"},{type:"header",label:"Add to existing rule:"}],i.forEach(function(i){var e=pgcssh.getRuleDisplayName(i);e+=" <small>"+pgcssh.getStylesheetForNode(i).name+"</small>",n.push({label:e,action:function(){for(var e=pgcssh.getStylesheetForNode(i),t=0,n=0;n<s.nodes.length;n++)"decl"===s.nodes[n].type&&(t=n);var o=pinegrow.getCollectionForElement(a);for(o.forEachElement(function(e){e.removeAttr("style")}),n=0;n<s.nodes.length;n++)"decl"===s.nodes[n].type&&e.ruleValueChanged(i,s.nodes[n].prop,s.nodes[n].value,null,!1,"gui",n===t,null);pinegrow.changeManager.didChange(o,"Remove style attribute"),pinegrow.dispatchEvent("on_css_node_updated",null,{node:i,stylesheet:e}),$.fn.crsa("selectRule",i,l.cssTreeView)}})}),new CrsaContextMenu(n,o).showForElement(o))}onStopEvent(e){e.stopPropagation()}}class PgCSSTreeCellAddProp extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-css-tree-add-prop" >
<i data-element="add" class="icon icon-plus"></i>
<div data-element="name"></div>
<div data-element="value"></div>
</div>`,e,t),this.ni=null,this.vi=null,this.tooltip("cell","Click to add a CSS property."),this.on("add","click",this.onClick.bind(this))}areFieldsShown(){return this.data.fields_shown}createFields(){this.ni||this.vi?(this.ni.show(),this.vi.show()):(this.ni=new PgInputField("name",{type:"text",show_empty:!1,name:"Search",without_text:!0,slider_def_unit:"",placeholder:"name",auto_resize:!0,system_field:!0}),this.ni.appendTo($(this.getElement("name"))),this.vi=new PgInputField("value",{type:"text",show_empty:!1,name:"Search",without_text:!0,slider_def_unit:"",placeholder:"value",auto_resize:!0,system_field:!0}),this.vi.appendTo($(this.getElement("value"))),this.onValueBlur_Bind=this.onValueBlur.bind(this),this.vi.on("blur",this.onValueBlur_Bind),this.vi.on("keypress",this.onValueKey.bind(this)),this.vi.on("input",this.onValueInput.bind(this))),this.addClass("add","hide"),this.data.fields_shown=!0,this.tableGrid.cellSizeForDataChanged(this.data),this.tableGrid.showCells()}changeRule(e,t,n){var o,i=this.data.node.target_node;e.length&&t.length&&(o=new PgCSSApi,this.prop_node?o.setRuleProperty(this.prop_node,e,t,function(){},{dispatchEvent:n||!1}):this.prop_node=o.addRuleProperty(i,e,t,function(){},{dispatchEvent:n||!1}))}onAdd(e,t,n){var o=new PgCSSApi;t&&""!==n?this.prop_node=o.addOrSetRuleProperty(e,t,n,function(){}):t&&(this.createFields(),this.ni.setValue(t),this.vi.focus())}onValueBlur(e){this.changeRule(this.ni.getValue(),this.vi.getValue(),!0)}onValueKey(e){if("Enter"===e.key)return this.vi.off("blur",this.onValueBlur_Bind),this.onValueBlur(),!1}onValueInput(e){this.changeRule(this.ni.getValue(),this.vi.getValue(),!1)}onClick(e){e.preventDefault(),e.stopPropagation();const n=this;var t=$(e.currentTarget);const o=this.data.node.target_node;var i=[{type:"html",html:`<p style="margin-bottom:0;padding: 5px 10px 0px;"><span style="color:rgba(255,255,255,0.70);">Set property for</span> <span style="color:rgba(255,255,255,1)">${pgcssh.getRuleDisplayName(o)}</span></p>`},{type:"divider"}],l=null,s=this.data.target_pgel||pinegrow.selectedElements.getLastSelected(),s=(s&&(l=new PgFastDOMStylePreviewForPgel(s)),new PgCSSApi);const a=new CrsaContextMenu(i.concat(s.getInsertCSSPropMenu(function(e,t){l.restore(),n.onAdd(o,e,t),null!==t&&""!==t||a.close()},l)),t);a.showForElement(t,null,4),a.onClosed=function(){l.destroy()},a.keepOpenOnClick=!0}setData(e){null===e&&this.data&&(this.data.fields_shown=!1),this.removeClass("add","hide"),super.setData(e)}onPopulate(){super.onPopulate(),this.prop_node=null,this.ni&&this.ni.hide(),this.vi&&this.vi.hide()}}var PgCSSTreeView=function(I){pinegrow.registerTreeView(this);function F(e){if("Style attribute"===e.selector)for(var t=e.inline_for_pgel||pinegrow.selectedElements.getLastSelected(),n=S.data,o=0;o<n.length;o++)if(n[o].node.inline_for_pgel===t&&"source"===n[o].node.inline)return n[o].node;return e}function R(e,t,n){var o=n.source===v&&n.datas?n.datas:ie(t);j(o)}function G(e,t){t.edited_by!==v&&k&&("gui"!==t.edited_by||oe(t.node)?(k.create(),E(k)):ee(t))}function O(e,t){ee(t)}function B(e,t){t.edited_by!==v&&(o()?L:x)()}function q(e,t){Z(e,t)}var g,d,f,t=$("<div/>",{id:"pg-tree",class:"pg-tree pg-css-tree"+(I?" pg-css-tree-active":"")}),W=(new PgApi,new PgCSSApi),e=new PgSearchBox({toolbar_on:!0}),c=null,o=this.isActive=function(){return null===c},n=this.toolbar=e.getToolbar(),i=(n.addSection("settings").$element,new PgButtonToolbarItem("icon-filter","Select what kind of elements to show in the tree.")),z=(n.addItem("settings",i),{position:{label:"Position",desc:"Show only the elements with inline styles",re:/_(top|right|bottom|left|position|z\-index)_/i},text:{label:"Text",desc:"Show only images",re:/font|line-height|_color_|letter-spacing|text-decoration|text-align|text-transform|white-space|word-break|_direction_|text-indent/i}}),Y={},l=($.each(z,function(e,t){Y[e]=!1}),Y),Q=(i.onClick=function(){var n=new CrsaContextMenu(null,this.$element);n.add({type:"header",label:"Show only:"}),$.each(z,function(t,e){n.add({label:e.label,action:function(){var e=!(!0===l[t]);v.setFilterOption(e?t:null)},check:!0===l[t]})}),n.add({type:"divider"}),n.add({label:"Clear filter",action:function(){v.setFilterOption(null)}}),n.showForElement(this.$element,null,8)},this.setFilterOption=function(e,t){var n;l=$.extend({},Y),e?(n=z[e],l[e]=!0,i.setActive(!0),pinegrow.showMode(n.desc,!0),U(n.label)):(i.setActive(!1),U()),k.setFilterOptions(l),t||k.research(!0)},e.$element.find(".pg-button-toolbar-section.icons")),s=null,a=(this.canHandleDragType=function(e){return"css"===e},e.onSearch=function(e){var t=new CrsaProfile;k&&k.search(e),(s=e).length?pg$Show(Q,"inline-block"):pg$Hide(Q),t.show("SEARCH")},this.search=function(e){s=e,k&&k.search(e)},pg$Hide(Q),$('<div class="pg-tree-filter-msg"><div>Show only: <span></span><i class="close icon icon-close"></i></div></div>').appendTo(t)),U=(pg$Hide(a),a.on("click",function(e){e.preventDefault(),v.setFilterOption(null)}),function(e){e?(a.find("span").html(e),pg$Show(a,"flex"),t.addClass("with-filter-msg")):(pg$Hide(a),t.removeClass("with-filter-msg"))}),n=$("<div/>",{class:"pg-tree-container"}).appendTo(t),r=(t.find(".editor"),this.view=new PgUIView(t,"tree","Tree")),e=`pg_ct${r.getId()}_`,u=e+"ov",h=e+"ninh",p=e+"exp",m=e+"_rel",v=(r.classForContainer="pg-tree-panel-container",this),w=(r.tabIcon="icon-Pin11",I&&((d=this.activeControls=new PgCSSTreeActiveCommandsView).cssTreeView=this,t.prepend(d.view.get$Element()),d.onStateChanged=function(){L()}),r.onShow=function(){},new PgTreeNodeMenu([{icon:"icon-bin",name:"Delete",func:function(e){}},{icon:"icon-duplicate",name:"Duplicate",func:function(e){}},{icon:"icon-hide",name:"Hide / show in Pinegrow",key:"hide",func:function(e,t){}},{icon:'<i class="icon icon-Ins_before"><span class="path1"></span><span class="path2"></span></i>',name:"Insert before",func:function(e){}},{icon:'<i class="icon icon-Ins_after"><span class="path1"></span><span class="path2"></span></i>',name:"Insert after",func:function(e){}},{icon:'<i class="icon icon-Append"><span class="path1"></span><span class="path2"></span></i>',name:"Insert into at beginning (prepend)",func:function(e){}},{icon:'<i class="icon icon-Prepend"><span class="path1"></span><span class="path2"></span></i>',name:"Insert into at end (append)",func:function(e){}}])),S=(w.hide(),new PgTableGrid({highlightLevels:!1})),K=(S.variableHeight=!1,S.draggable=!1,S.getCellWidthForData=function(e){return 0},S.getCellHeightForData=function(e){return S.cellHeight},null),e=(S.onScroll=function(){K&&K.updatePosition(),ke()},n.append(S.$element),w.$element.appendTo(t),S.setTemplate('<div class="pg-css-tree-stylesheet-default"><i data-element="icon" class="collapse-icon icon-down"></i><name data-element="name"></name></div>'),S.setTemplate('<div class="pg-css-tree-inherited">Inherited from <name data-element="name"></name></div>',"inherited_pgel"),S.setTemplate(PgCSSTreeCellRule,"rule"),S.setTemplate(PgCSSTreeCellStylesheet,"stylesheet"),S.setTemplate(PgCSSTreeCellProperty,"decl"),S.setTemplate(PgCSSTreeCellPropertyComponent,"component"),S.setTemplate(PgCSSTreeCellAtRule,"atrule"),S.setTemplate(PgCSSTreeCellComment,"comment"),S.setTemplate(PgCSSTreeCellAddProp,"add_prop"),S.onSetDataToCell=function(e,t){this.data&&(this.data.cell=null),(e.cell=t).cssTreeView=v,k.populateDataItem(e,g);var n=e.node;switch(n.type){case"root":case"stylesheet":t.setHtml("name",n.pgStylesheet.name);break;case"inherited_pgel":t.setHtml("name",n.name);break;case"comment":t.setHtml("name",n.text);break;case"rule":t.setHtml("name",e.node.selector),t.setHtml("count",e.use_count),n[m]?t.addClass("cell","related"):t.removeClass("cell","related");break;case"atrule":t.setHtml("name",e.node.name),t.setHtml("value",e.params_html),n[m]?t.addClass("cell","related"):t.removeClass("cell","related");break;case"decl":t.setHtml("name",n.prop),t.setHtml("value",e.value_html),n.important?t.addClass("important","on"):t.removeClass("important","on"),n[u]?t.addClass("cell","overriden"):t.removeClass("cell","overriden"),n[h]?t.addClass("cell","not-inherited"):t.removeClass("cell","not-inherited"),n[m]?t.addClass("cell","related"):t.removeClass("cell","related");break;case"component":t.setHtml("name",n.prop),t.setHtml("value",e.value_html);break;case"add_prop":break;default:t.setHtml("name",e.node.type)}(n.pg_selected||!1)!==(t.isSelected||!1)&&(n.pg_selected?t.$element.addClass("selected"):t.$element.removeClass("selected"),t.isSelected=n.pg_selected||!1),S.hasChildren(e)?e.collapsed?(t.addClass("icon","icon-right"),t.removeClass("icon","icon-minus","icon-down"),t.$element.addClass("collapsed")):(t.removeClass("icon","icon-minus","icon-right"),t.addClass("icon","icon-down"),t.$element.removeClass("collapsed")):(t.removeClass("icon","icon-down","icon-right"),t.addClass("icon","icon-minus"),t.$element.removeClass("collapsed")),e.focused?t.$element.addClass("focused"):t.$element.removeClass("focused");var o=e.search||0;t.$element.removeClass("search-1 search-2 search-0").addClass("search-"+o),t.onPopulate()},S.onRepaint=function(){w.setBottom(S.getHScrollBarSize()),w.setRight(S.getVScrollBarSize()),ke()},this.scrollToNode=function(e){var t=oe(e);t&&S.scrollTo(t)},null),n=null,y=null,C=null,X=function(e){for(var t="",n=e.closest("value,name").get(0),o=0;o<n.childNodes.length;o++){var i=n.childNodes[o];3===i.nodeType?t+=i.textContent:1===i.nodeType&&("COLOR"===i.tagName?t+=$(i).find("> span").text():t+=i.textContent)}return t},j=function(e){e.forEach(function(e){e.populated=!1}),S&&S.updateItems(e)},J=function(e){nextFrame.do("refreshGrid",function(){S&&(S.refresh(),r.isVisible()?e&&e():r.whenVisible(function(){S.show(),e&&e()}))})},Z=(this.updateLayout=function(){J()},r.on("crsa-rule-selected",function(e,n){r.whenVisible(function(){var e,t;n&&(e=[],n.previous_rule&&((t=F(n.previous_rule)).pg_selected=!1,e.push(t)),n.rule&&(t=F(n.rule),e.push(t),t.pg_selected=!0),t=ie(e),j(t))},void 0,10)}),r.on("crsa-rules-changed",function(e,t){L(),de(g)}),pinegrow.addEventHandler("on_css_node_selected_deselected",R),function(e,t){ee(t)}),ee=function(e){"gui"===e.edited_by?setTimeout(function(){pinegrow.clipboard.isInInput()||(o()?M:x)()},1):e.edited_by!==v&&(o()?M:x)()},te=(pinegrow.addEventHandler("on_css_node_deleted",Z),pinegrow.addEventHandler("on_css_node_updated",G),pinegrow.addEventHandler("on_css_node_added",O),pinegrow.addEventHandler("on_css_attribute_style_changed",function(e,t,n){n&&n.edited_by===v||o()&&L()}),pinegrow.addEventHandler("on_css_source_changed",B),pinegrow.addEventHandler("on_css_rule_changed_in_code_editor",q),function(){return(new PgCSSApi).getInsertCSSPropMenu()}),ne=function(e){var t=$(e.currentTarget).closest("div");return S.visibleData[parseInt(t.attr("data-visible-idx"))]},_=function(e){var t=e.closest("div");return S.visibleData[parseInt(t.attr("data-visible-idx"))]},oe=function(e){for(var t=S.data,n=0;n<t.length;n++)if(t[n].node===e)return t[n];return null},ie=function(e){for(var t=S.data,n=[],o=0;o<t.length;o++)0<=e.indexOf(t[o].node)&&n.push(t[o]);return n};function le(e,t,n){void 0===t&&(t=X(e));var o=_(e);(o?o.node:null)&&o.cell.onValueEdited(e.parent().get(0).tagName,t,n,"scrub")}this.isOverTree=function(e,t){return(!t||"css"===t.dragType)&&r.getWindow()===e.view&&r.isVisible()&&e.pageX>=f.left&&e.pageX<=f.right-(w.isHidden()?0:w.width+S.getVScrollBarSize())&&e.pageY>=f.top&&e.pageY<=f.bottom?{left:e.pageX-f.left,top:e.pageY-f.top}:null},this.getDropPositionInfo=function(e,t,n){var o=S.dragOver(n);return S.showInsertionPoint(o),o},(e=new PgCSSEditableValue(S.$container,"num")).onCanEdit=function(e){return _(e).cell.canEdit()},e.onChange=function(e,t,n){le(e,void 0,n)},(C=new PgCSSEditableListValue(S.$container,"numlist")).onCanEdit=function(e){return _(e).cell.canEdit()},C.onGetList=function(e){return _(e).cell.getListOfValues(e)},C.onStart=function(e){var t=_(e);t&&t.cell.onValueEditStart(e.parent().get(0).tagName)},C.onDone=function(e){_(e)},C.onChange=function(e,t,n){le(e,void 0,n)},C.onListItemHighlighted=function(e,t){_(e).cell.onListItemHighlighted("VALUE",null===t?t:{key:t})},(n=new PgCSSEditableColor(S.$container,"colorbox")).onCanEdit=function(e){return _(e).cell.canEdit()},n.onChange=function(e,t){le(e,void 0,t)},(y=new PgCSSEditableText(S.$container,"name:not(.not-editable),value")).onGetValue=function(e){return e.text()},y.onCanEdit=function(e){return _(e).cell.canEdit()},y.onStart=function(e,t){var n=_(e);n&&n.cell.onValueEditStart(e.get(0).tagName,t)},y.onDone=function(e){var t=_(e);t&&t.cell.onValueEditDone()},y.onChange=function(e,t,n){var o=_(e);(o?o.node:null)&&o.cell.onValueEdited(e.get(0).tagName,n,t,"textedit"),t&&v.refresh()},y.onGetOptions=function(e){var t=_(e);return(t?t.node:null)?t.cell.onGetValueOptions(e.get(0).tagName):null},y.onListItemHighlighted=function(e,t){var n=_(t);if(n?n.node:null)return n.cell.onListItemHighlighted(t.get(0).tagName,e)},S.$container.on("aaacontextmenu",".pg-table-grid-cell",function(e){e.preventDefault(),e.stopPropagation();var t=$(this),n=_(t),o=[],i={insert_prop:{label:"Insert property",submenu:function(){return te()}},insert_rule:{label:"Insert rule",action:function(){}},important:{label:"Important",action:function(){},check:n.node.important||!1},override:{label:"Override",action:function(){}},override_in:{label:"Override in",action:function(){}},duplicate:{label:"Duplicate",action:function(){}},duplicate_in:{label:"Duplicate in",action:function(){}},media_query:{label:"Media query",action:function(){}},supports:{label:"Supports",action:function(){}},div:{type:"divider"}};if(n.node)switch(n.node.type){case"decl":o.push(i.insert_prop),o.push(i.div),o.push(i.important);break;case"rule":o.push(i.insert_prop),o.push(i.div),o.push(i.insert_rule),o.push(i.div),o.push(i.media_query),o.push(i.supports),o.push(i.div),o.push(i.override),o.push(i.override_in),o.push(i.duplicate),o.push(i.duplicate_in)}return o.length&&new CrsaContextMenu(o,t).showForElement(t),!1}).on("mouseover",".pg-table-grid-cell",function(e){S.inScroll||(ne(e),pinegrow.getDragMenu()),e.stopImmediatePropagation()}).on("mouseout",".pg-table-grid-cell",function(e){S.inScroll||pinegrow.getDragMenu(),e.stopImmediatePropagation()}).on("click","i.collapse-icon",function(e){var t=ne(e);t.collapsed=!(t.collapsed||0),e.altKey&&S.forEachVisibleSibling(t,function(e){e.collapsed=t.collapsed}),S.refresh(),e.preventDefault(),e.stopPropagation()}).on("click","i.show-hide",function(e){var t=ne(e);showItem(t),e.preventDefault(),e.stopPropagation()}).on("click",function(e){if(A){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var n=A.data.node,o=("add_prop"===n.type&&(n=n.target_node),pgcssh.getRuleForNode(n)),t=[{type:"html",html:`<p style="margin-bottom:0;padding: 5px 10px 0px;"><span style="color:rgba(255,255,255,0.70);">Set property for</span> <span style="color:rgba(255,255,255,1)">${pgcssh.getRuleDisplayName(o)}</span></p>`},{type:"divider"}],i=null,l=A.data.target_pgel||pinegrow.selectedElements.getLastSelected(),l=(l&&(i=new PgFastDOMStylePreviewForPgel(l)),$(e.currentTarget));const s=new PgCSSApi;t=new CrsaContextMenu(t.concat(s.getInsertCSSPropMenu(function(e,t){i.restore(),s.addRuleProperty(o,e,t||"",function(){v.refresh()},{insertAtIndex:o.nodes.indexOf(n)+1})},i)),l);t.onClosed=function(){i.destroy()},t.keepOpenOnClick=!0,t.showAt(e.pageX,e.pageY,S.$container)}}).on("click",".pg-table-grid-cell",function(e){var t=$(this),t=_(t);return!A&&t&&t.node&&(t=t.node?pgcssh.getRuleForNode(t.node):null)?(pinegrow.isSelectedRule(t)||pinegrow.selectRule(t),void W.highlightNodeInCode(t)):void 0});var b,P=new PgDragHelper(t,".disable---pg-table-grid-cell",null,!0);P.onGetDragImage=function(){return"none"},P.onBefore=function(e){return!_(e).no_sort},P.on("dragStart",function(e,t,n){$.fn.crsapages("showOverlays");for(var o=_(P.movedElement),i=pgCreate("<div>Dummy</div>"),l=((b=new PgDragMenu({name:"Props"},!0,!0,null,i,{dragType:"css"})).draggedNodes=pinegrow.selectedCSSNodes.getNormalizedListForNode(o.node),$('<div class="pg-tree-drag-container with-tree"></div>')),s=S.getNumberOfDescendants(o.idx,S.data)+1,a=o.level,r=0;r<s&&4!=r;r++){var d=S.createCellForData(S.data[o.idx+r]);d.setData(S.data[o.idx+r]),S.onSetDataToCell(S.data[o.idx+r],d),d.showAt((d.data.level-a)*S.levelPadding,r*S.cellHeight,l)}4<s&&$('<div class="pg-table-grid-cell"><name>+ '+(s-4)+" more</name></div>").appendTo(l).css({top:4*S.cellHeight+"px",left:(S.data[o.idx+4].level+1-a)*S.levelPadding+"px"}),l.css("height",Math.min(s,5)*S.cellHeight),b.addElement(l),b.movedPgel=i,b.pgel=i,S.dragStarted(o),b.handleMoveEvent(n,b),w.hide()},this),P.on("drag",function(e,t,n){b.handleMoveEvent(n,b)},this),P.on("dragStop",function(e,t){$.fn.crsapages("showOverlays",!0),S.dragStopped(),console.log(b.treeDropPosition);function n(e){var t=pgcssh.getStylesheetForNode(e);t&&i.indexOf(t)<0&&i.push(t)}function o(e){function s(e,t){if(t.nodes){var n=!1;if(pinegrow.selectedCSSNodes.isSelected(t)){for(var o=0,i=0;i<t.nodes.length;i++)t.nodes[i].pg_selected&&(n=!0,o++);h=h||n&&o<t.length}for(var l,i=0;i<t.nodes.length;i++)n&&!t.nodes[i].pg_selected||(l=pgcssh.copyNode(t.nodes[i]),pgcssh.insertNodeAt(l,e,e.nodes.length),u.push(l),s(l,t.nodes[i]))}}var t=pgcssh.copyNode(e);return pgcssh.getStylesheetForNode(e),u.push(t),r&&s(t,e),a||pinegrow.selectedCSSNodes.isSelected(e)&&(pinegrow.selectedCSSNodes.deselect(e),pinegrow.selectedCSSNodes.select(t)),a||c.push(e),t}var i=[],l=b.treeDropPosition,s=l.data.node,a=b.clone,r=!0,d=b.draggedNodes,c=[],u=[],h=!1;switch(n(s),l.position){case"bottom":for(var p=d.length-1;0<=p;p--)pgcssh.insertNodeAfter(o(d[p]),s);break;case"top":for(p=0;p<d.length;p++)pgcssh.insertNodeBefore(o(d[p]),s);break;case"inside-top":for(p=d.length-1;0<=p;p--)pgcssh.insertNodeAt(o(d[p]),s,0);break;case"inside-bottom":for(p=0;p<d.length;p++)pgcssh.insertNodeAt(o(d[p]),s.nodes.length)}h&&(a=!0,c=[]),c.forEach(function(e){n(e),pgcssh.removeNodeFrom(e)}),u.forEach(function(e){var t=pgcssh.getStylesheetForNode(e);t&&t.addIdsToNodes([e])}),pinegrow.selectedCSSNodes.update(),$("body").trigger("crsa-rules-changed",{list:i}),i.forEach(function(e){pinegrow.stylesheets.applyToPages(e)}),b.destroy(),b=null,crsaFuncs.showInsertionLine(null),pinegrow.highlightElement(null)},this),r.onResize=function(){};const se=new ResizeObserver(function(){T?T=!1:(f=S.$element.get(0).getBoundingClientRect(),S.onRepaint(),S.updateLayout(),S.updateContainerSize(),S.refresh(),w.updateLayout())});se.observe(S.$element.get(0)),f=S.$element.get(0).getBoundingClientRect(),r.onDestroy=function(){se.disconnect(),pinegrow.removeEventHandler("on_css_loaded",re),pinegrow.removeEventHandler("on_selected_elements_changed",L),pinegrow.removeEventHandler("on_css_node_selected_deselected",R),pinegrow.removeEventHandler("on_css_node_deleted",Z),pinegrow.removeEventHandler("on_css_node_updated",G),pinegrow.removeEventHandler("on_css_node_added",O),pinegrow.removeEventHandler("on_css_source_changed",B),pinegrow.removeEventHandler("on_css_rule_changed_in_code_editor",q),pinegrow.removeEventHandler("on_page_changed",ae),pinegrow.removeEventHandler("on_page_loaded",V),pinegrow.removeEventHandler("on_page_refreshed",V),pinegrow.removeEventHandler("on_page_selected",Se),pinegrow.removeEventHandler("on_drag_drop_operation_done",ye),pinegrow.removeEventHandler("on_page_frameworks_changed",ve),pinegrow.removeEventHandler("on_element_isolated",we),pinegrow.removeEventHandler("on_page_view_resized",L),S.$element.off("mousemove",be),S.$element.off("mouseleave",Pe),S.$element.off("mouseenter",Ee)};var ae=function(e,t,n){},E=function(e){S.showInsertionLineAt(-1),S.setEmptyLineAt(-1),S.borderItem(null),e?(e.setFilterOptions(l),e.setTreeView(v),e.setTableGrid(S),e.research()):(N=null,S.setData([]),w.hide()),w.updateLayout()},k=null,T=!1,re=function(e,t){},D=function(e,t){return"decl"===e.type&&(e[h]=!1,e[u]=!1,e[p]=!1),e[m]=!1,!t&&e.nodes&&e.nodes.forEach(function(e){D(e)}),e},de=function(o){I||r.whenVisible(function(){var e,n,t;o&&o===pinegrow.getSelectedPage()&&(e=(g=o).stylesheets,n={rootNode:{type:"root",pgStylesheet:{name:"All"},nodes:[]}},t=new CrsaProfile(!0,"Show ALL rules"),e.getAllCrsaStylesheets().forEach(function(e){var t=(e=e.sourceStylesheet?e.sourceStylesheet:e).rootNode?e.rootNode.nodes:[];e.rootNode&&D(e.rootNode),n.rootNode.nodes.push({type:"root",pgStylesheet:e,nodes:t})}),(k=new PgStylesheetTree(n)).showRoot=!0,k.flag_expanded=p,k.flag_related=m,k.create(),E(k),t.show("Tree updated"))})},x=function(i){r.whenVisible(function(){f=S.$element.get(0).getBoundingClientRect(),T=!0,setTimeout(function(){T=!1},200),d&&d.setShowActive(c,pinegrow.selectedElements.getLastSelected());var e=c,t=(g=pinegrow.getSelectedPage(),new CrsaProfile(!0,"Show ALL rules")),n=(e=e.sourceStylesheet?e.sourceStylesheet:e).rootNode?e.rootNode.nodes:[],o=(e.rootNode&&D(e.rootNode),{rootNode:{type:"root",pgStylesheet:{name:"All"},nodes:[]}});o.rootNode.nodes.push({type:"root",pgStylesheet:e,nodes:n}),(k=new PgStylesheetTree(o)).showRoot=!1,k.inlineImports=!0,k.showRuleParents=!1,k.flag_expanded=p,k.flag_related=m,k.create(),E(k),s&&k.search(s),t.show("Tree updated"),i&&i()})},ce={},ue=(["border-spacing","border-collapse","color-adjust","empty-cells","caret-color","font-variant-ligatures","font","caption-side","font-style","list-style-image","color","object-position","font-family","letter-spacing","line-height","font-stretch","font-variant-numeric","rotate","list-style-position","font-size","font-optical-sizing","font-weight","pointer-events","perspective","text-align","overflow-wrap","text-align-last","quotes","list-style-type","image-rendering","word-wrap","text-indent","visibility","font-variant","mix-blend-mode","transform","word-spacing","scale","text-shadow","transform-style","translate","word-break","font-variant-caps","white-space","text-transform","cursor","hyphens","position","z-index"].forEach(function(e){ce[e]=!0}),function(e){e.forEach(function(e){if(e.node.nodes){e.node.nodes.forEach(function(e){D(e,!0)}),e.node[m]=!1;for(var t=e.node.parent||null;t;)D(t,!0),t=t.parent||null}})}),he=function(e){var t=[];return e.forEach(function(e){e.node.nodes&&e.node.nodes.forEach(function(e){"decl"===e.type&&(e.prop in ce?(e[h]=!1,0):e[h]=!0)}),t.push(e)}),t},pe=function(e){var o={};e.forEach(function(e){e.node.nodes&&e.node.nodes.forEach(function(e){var t,n;"decl"===e.type&&(e.prop in o?(n=o[(t=e).prop],(t.parent===n.parent?n.important&&!t.important:!t.important||n.important)?e[u]=!0:(o[e.prop][u]=!0,(o[e.prop]=e)[u]=!1)):(o[e.prop]=e)[u]=!1)})})},ge=!0,fe=function(g,f){new CrsaProfile(!0,"getMatchedForStack");pinegrow.pgActiveRules.clear(),pinegrow.pgActiveRules.setPgel(g),pinegrow.pgActiveRules.updateMatchedRules(!0,function(e){var t=pinegrow.pgActiveRules.getActiveNodes();if(ge&&!t)ge=!1,setTimeout(function(){fe(g,f)},100);else{var n=[];if(t)for(var o,i,s,l,a,r,d,c,u={pgel:g,rules:t.inline_rules.map(function(e){return{node:e}}).concat(t.nodes_to_show)},h=(1&&(o=g.getDOMElement(),i=function(e,t){if(e.parent&&"rule"===e.parent.type){for(var n=s(e.parent),o=[],i=0;i<t.length;i++)for(var l=0;l<n.length;l++)"&"!==t[i][0]?o.push(n[l]+t[i].substr(1)):o.push(n[l]+" "+t[i]);return o}return t},s=function(e){for(var t=e.selector.split(","),n=0;n<t.length;n++)t[n]=$.trim(t[n].replace("\n","").replace(/\s{2,}/gi," ").replace(/\s*>\s*/,">")).replace(/:.*$/,"");return t=i(e,t)},l={},a=new WeakMap,r=[],t.nodes_to_show.forEach(function(e){"rule"===e.node.type&&(s(e.node).forEach(function(e){e.length&&(l[e]=!0)}),a.set(e.node,!0),r.indexOf(e.pgStylesheet)<0)&&r.push(e.pgStylesheet)}),d=[],c=function(e,t){"rule"===e.type&&t(e),e.nodes&&e.nodes.forEach(function(e){c(e,t)})},r.forEach(function(n){c(n.getRootNode(),function(t){s(t).forEach(function(e){if(e.length&&l[e]&&!a.has(t)){try{if(o&&!o.matches(e))return}catch(e){}t[m]=!0,t.nodes.forEach(function(e){e[m]=!0}),d.unshift({node:t,pgStylesheet:n}),a.set(t,!0)}})})})),n.push(u),ue(u.rules),pe(u.rules),d&&(u.rules=u.rules.concat(d)),t.inherited.forEach(function(e){pe(e.data.nodes_to_show);var t=he(e.data.nodes_to_show);t.length&&n.push({pgel:e.pgel,rules:t})}),{}),p=n.length-1;0<=p;p--)n[p].rules.forEach(function(e){e.node.nodes&&e.node.nodes.forEach(function(e){!e.prop||h[e.prop]&&h[e.prop].important&&!e.important||(h[e.prop]=e)})});f(n)}})},L=(this.show=function(e,t){c=e,(o()?M:x)(t)},this.refresh=function(){this.show(c)},this.refreshWithoutGettingActive=function(e){o()?M(e,!0):this.show(c)},this.refreshDisplayOnly=function(){S.refresh()},function(){o()&&M()}),me=null,M=function(n,o,i){r.whenVisible(function(){f=S.$element.get(0).getBoundingClientRect();var t,a,e,r=pinegrow.selectedElements.getLastSelected();g=pinegrow.getSelectedPage(),r&&(t=new CrsaProfile(!0,"Show active rules"),(e=pinegrow.getSelectedRule())&&(a=e),e=function(e){me=e,T=!0,setTimeout(function(){T=!1},200);var l=[],s=(t.show("Got from devtools"),{rootNode:{type:"root",pgStylesheet:{name:"Active"},nodes:[]}});e.forEach(function(t){var n={rootNode:{type:"inherited_pgel",name:t.pgel.getName(),pgid:t.pgel.getId(),pgel:t.pgel,nodes:[]}},o=null,i=[];t.rules.forEach(function(e){(e.node.inline?n.rootNode.nodes:(e.node.pg_selected=e.node===a,o!==e.pgStylesheet&&(i.length&&n.rootNode.nodes.push({type:"stylesheet",pgStylesheet:o,nodes:i}),i=[],o=e.pgStylesheet),i)).push(e.node),r===t.pgel&&l.push(e.node)}),i.length&&n.rootNode.nodes.push({type:"stylesheet",pgStylesheet:o,nodes:i}),r===t.pgel?s.rootNode.nodes=s.rootNode.nodes.concat(n.rootNode.nodes):s.rootNode.nodes.push(n.rootNode)}),d&&d.setShowActive(c,r),i||pinegrow.autoSelectRule(r,l,!1,!0),(k=new PgStylesheetTree(s)).showRoot=!1,k.showRuleParents=!0,k.flag_expanded=p,k.flag_related=m,k.create(),E(k),t.show("Tree shown"),n&&n()},o&&me?e(me):fe(r,e))})},V=function(e){},ve=function(e){},we=function(e,t){},Se=function(e){},ye=function(e,t){},N=null,Ce=null,_e=new PgMouseSpeed,A=null,H=null,be=function(e){f=S.$element.get(0).getBoundingClientRect();var t={left:e.pageX-f.left,top:e.pageY-f.top-0};if(_e.track(e),N&&w.isHidden()&&w.show(),H&&(clearTimeout(H),H=null),t&&g){var n=S,o=n.getScrollOffset(),i=(t.top+=o.top,t.left+=o.left,3),l=5,o=n.getVisibleDataIndexForY(t.top,!0);if(0<=o)for(var s=n.getYForVisibleDataIndex(o),a=o;a<n.visibleData.length;){var r=n.getYForVisibleDataIndex(a);if(s<r)break;var d=n.visibleData[a].node;if("rule"!==d.type&&"decl"!==d.type&&"add_prop"!==d.type&&("comment"!==d.type||"rule"!==d.parent.type))break;var d=n.getXForVisibleData(n.visibleData[a]),c=n.getCellWidthForData(n.visibleData[a]),u=!0,h=d+c+9999;if(0!==c&&n.visibleData.length>a+1&&n.getYForVisibleDataIndex(a+1)===r&&(u=!1,h=n.getXForVisibleData(n.visibleData[a+1])),d<=t.left&&t.left<=h){var h=!1,p="bottom";if(u?(r+n.getCellHeightForData(n.visibleData[a])-i<=t.top||0!==c&&d+c-l<t.left)&&(h=!0):(p="right",(d+c-l<=t.left||d+c<=t.left)&&(h=!0)),h)return n.quickInsertLine.show(n.visibleData[a],n.visibleData[a].level,p),A||S.$container.addClass("with-insert-position"),void(A={data:n.visibleData[a],pos:p});break}a++}A&&S.$container.removeClass("with-insert-position"),A=null,n.quickInsertLine.show(null)}},Pe=function(e){S.highlightLevel(-1),S.quickInsertLine.hide(),H&&(clearTimeout(H),H=null),w.hide(),Ce&&Ce.$element.removeClass("hovered"),Ce=null},Ee=function(e){N&&w.show()},ke=(S.$element.on("mousemove",be),S.$element.on("mouseleave",Pe),S.$element.on("mouseenter",Ee),pinegrow.addEventHandler("on_css_loaded",re),pinegrow.addEventHandler("on_selected_elements_changed",L),pinegrow.addEventHandler("on_page_changed",ae),pinegrow.addEventHandler("on_page_loaded",V),pinegrow.addEventHandler("on_page_refreshed",V),pinegrow.addEventHandler("on_page_selected",Se),pinegrow.addEventHandler("on_drag_drop_operation_done",ye),pinegrow.addEventHandler("on_element_isolated",we),pinegrow.addEventHandler("on_page_view_resized",L),pinegrow.addEventHandler("on_page_frameworks_changed",ve),function(){var e;N&&(e=S.getScrollOffset(),e=S.getYForVisibleDataIndex(N.visible_idx)-e.top,w.showFor(e,e+S.cellHeight,N.selected||!1,N))});this.onSelected=function(e){N=e;var t=this.getPgel(e);t&&w.find("hide").find("i").removeClass("icon-hide icon-see").addClass(t.isHidden()?"icon-see":"icon-hide"),ke()},this.onDeselected=function(e){pinegrow.selectedElements.hasSelection()||(N=null,w.hide())}},PgQuickCSSActiveTree=function(){var e=new PgCSSTreeView(!0),t=new PgQuickWindow("CSS Tree [Beta]",e,"quickCSSTree",400,700);t.noRightEdge(),t.showAtPosition(800,0),e.show(null),t.onDestroy=function(){}},PgStylesheetTree=function(o){var l,s,m=this,a={styles:!1,images:!1},r=!1,d=[],i={},c=(this.flag_expanded=null,this.flag_related=null,this.setFilterOptions=function(e){var t=r;r=!1,$.each(e,function(e,t){if(t)return r=!0}),a=e,f=t!==r},this.setTreeView=function(e){s=e},null),t=(this.setTableGrid=function(e){c=e,this.$element=c.$element,e.setData(d),f&&this.research()},$("<div/>").addClass("crsa-tree-branch pg-tree-ul"),this.$element=null,this.highlightOnMouseOver=!0,this.destroy=function(){nextFrame.cancelAll(),s=c=null,l&&l.destroy(),m=i=d=l=null},this.getDataFor$Element=function(e){return c.getDataFor$Element(e)},this.updatePgIdMap=function(){var e=new CrsaProfile;i={},d.forEach(function(e){e.pgid&&(i[e.pgid]=e)}),e.show("updatePgIdMap")},function(e){return i[e]||null});this.getTreeDataItemForPgId=function(e){return t(e)};const u=1,h=3,p=2;var g=null,f=(this.research=function(e){var t={selected_ids:{},changed:!1};(g||t.changed||r||e)&&this.search(g,!0,t)},!1),v=(this.search=function(e,t,n){var i,o;s?(f=!1,i=0<(e=null===e?"":e).length?new RegExp(escapeRegExp(e),"i"):null,g=e,(o=n||{selected_ids:{},changed:!1}).selected_ids,o=o.changed,e||o||r?l&&(d.forEach(function(e){e.search=0,e.peek_in&&(e.collapsed=!0,e.peek_in=!1)}),l.forEachWithParents(function(e,t){var n=!1;if(i&&!e.search_string.match(i)||(n=!0),n=r&&a.position?"decl"===e.node.type&&n&&null!==("_"+e.node.prop+"_").match(/_(top|right|bottom|left|position|z\-index)_/i):n){e.search=u;for(var o=t.length-1;0<=o&&t[o].search===h;o--)t[o].search=p,t[o].collapsed&&(t[o].peek_in=!0),t[o].collapsed=!1}else{e.search=h;for(o=t.length-1;0<=o;o--)if(t[o].search===u){e.search=p;break}}}),c.refresh()):(d.forEach(function(e){e.search=0,e.force_search=!1,e.peek_in&&(e.collapsed=!0,e.peek_in=!1)}),c.refresh())):f=!0},this.scrollToSelected=null,this.handleEvent=function(e){},null),w=(this.create=function(){d=[],i={};0;var e=o.rootNode,t=(v=null,new CrsaProfile(!0));if(this.showRoot)C(d,e,!1);else for(var n=0;n<e.nodes.length;n++)C(d,e.nodes[n],!1,0);t.show("create CSS "+d.length+" tree data items"),(l=new PgTreeDataHelper(d)).reindexData(),this.research()},new PgGetCSSValueHTML),S=(this.populateDataItem=function(t,e){if(!t.populated){var n=t.node;switch(n.type){case"root":case"decl":break;case"rule":if(n.inline)t.use_count=1;else try{var o=n.selector.replace(/::?(hover|focus|active|visited|after|before)/g,"");t.use_count=e.getDocument().querySelectorAll(o).length}catch(e){t.use_count=""}}t.populated=!0}},{}),y=null,C=this.createDataItemForCSSNode=function(t,n,e,o,i){o=o||0;var l="sort",s=!1,a=null,r=m.showRuleParents,d=(r&&0===t.length&&(y=null),{node:n,shown:!0,level:o,tags:"",search_string:""});switch(n.type){case"root":case"stylesheet":l="no-sort",s=!0,a="stylesheet",d.tags="tag-block",n.pgStylesheet&&(d.search_string+=n.pgStylesheet.name);break;case"inherited_pgel":l="no-sort",s=!0,a="inherited_pgel",y=n.pgel,d.search_string+=n.name;break;case"decl":a="decl",d.value_html=w.getHTML(n.value,d,pinegrow.devTools.getCSSPropertyValuesRegEx(n.prop)),d.search_string+=n.prop+":"+n.value;break;case"component":a="component",d.value_html=w.getHTML(n.value,d);break;case"rule":a="rule",d.search_string+=n.selector;break;case"atrule":a="atrule",d.search_string+="@"+n.name+" "+n.params,"import"===n.name||"media"===n.name?d.params_html=n.params:d.params_html=w.getHTML(n.params,d);break;case"comment":a="comment",d.search_string+="/*"+n.text+"*/";break;case"add_prop":a="add_prop"}var c=!1,u=!1;if(v&&(n===v?(l="no-sort",u=s=!0):_(v)&&(c=!0)),d.classes=l,d.collapsed=b(n)||c,d.no_sort=s,d.focused=u,d.template_type=a,r&&(d.target_pgel=y),m.showRuleParents&&"rule"===n.type&&!i){var h=[];let e=n.parent;for(;e&&"root"!==e.type;)n[m.flag_related]?e[m.flag_related]=!0:e[m.flag_related]=!1,h.unshift(e),e=e.parent;var p=!1;h.forEach(function(e){S[o]===e?(p=!0,o++):p||C(t,S[o]=e,!1,o++,!0)}),S[d.level=o]=n}if(t.push(d),m.inlineImports&&"atrule"===n.type&&"import"===n.name&&(c=pgcssh.getStylesheetForNode(n))&&(u=c.getImportedStylesheetFromRelativeUrl(n.params))&&C(t,u.getRootNode(),!0,o+1,!1),!i){0&&"decl"===n.type&&"border-top"===n.prop&&([{prop:"border-top-color",value:"red"},{prop:"border-top-style",value:"solid"},{prop:"border-top-width",value:"10px"}].forEach(function(e){C(t,{type:"component",prop:e.prop,value:e.value},!1,o+1)}),n[m.flag_expanded]=!0),"inherited_pgel"===n.type&&o--;var g="rule"===n.type;if(n.nodes){for(var f=0;f<n.nodes.length;f++)r&&g&&"decl"!==n.nodes[f].type&&"comment"!==n.nodes[f].type||C(t,n.nodes[f],!1,o+1);g&&C(t,{type:"add_prop",target_node:n},!1,o+1)}m.showRoot&&"root"===n.type&&n.pgStylesheet&&n.pgStylesheet.importedFiles&&n.pgStylesheet.importedFiles.forEach(function(e){e.rootNode&&C(t,e.rootNode,!1,o+1)})}},_=function(e,t){for(;e;){if(e.parent===t)return!0;e=e.parent||null}return!1},b=function(e){return!1}},PgCSSEditableText=function(e,t){var s=this;this.onChange=null,this.onChangeDone=null,this.onGetOptions=null,this.onStart=null,this.onDone=null,this.onCanEdit=null,this.onListItemHighlighted=null,e.on("click",t,function(e){e.preventDefault();var t,n,o,i,l=$(this);return 0<l.find(".pg-css-tree-edit-box").length||s.onCanEdit(l)&&(t=s.onGetValue(l),l.empty(),(n=new PgInputField("size",{type:"slider",name:"dummy",slider_def_unit:"px",slider_min:0,without_text:!0,auto_resize:!0,options:s.onGetOptions?s.onGetOptions(l):null,fill_list_on_open:!0,open_list_on_focus:!0,on_list_item_highlighted:function(e){s.onListItemHighlighted&&s.onListItemHighlighted(e,l)}})).$field.addClass("pg-css-tree-edit-box"),o=n.$input,l.addClass("in-edit"),n.appendTo(l),n.setValue(t),o.get(0),o.get(0).focus(),o.get(0).select(),i=function(){var e=o.val();l.empty(),l.removeClass("in-edit"),l.text(e),s.onDone&&s.onDone(l),s.onChange(l,!0,e)},n.on("blur",function(e){i&&i()}),n.on("input",function(e){var t=o.val();s.onChange(l,!1,t),o.get(0)}),n.on("change",function(e){i&&i(),i=!1}),n.on("keydown",function(e){switch(e.key){case"Enter":return i(),!1;case"Escape":return l.empty(),l.text(t),l.removeClass("in-edit"),s.onChange(l,!0,t),!1}}),s.onStart)&&s.onStart(l,n),!1})},PgCSSEditableColor=function(e,t){var d=this;this.onChange=null,this.onChangeDone=null,this.onCanEdit=null,e.on("click",t,function(e){e.preventDefault();var t,n,o,i,l=$(this),s=l,a=l.closest("color"),r=a.find("> span");return d.onCanEdit(a)&&(t=$("<input/>",{type:"hidden"}).appendTo(s),n=!1,o=function(e,t){var n="string"==typeof e?e:colorToString(e);r.text(n),s.css("background-color",n),d.onChange&&d.onChange(a,t)},i=a.attr("data-color")||"rgba(0, 0, 0, 0)",t.spectrum({showAlpha:!0,clickoutFiresChange:!0,showInitial:!0,showInput:!0,allowEmpty:!0,preferredFormat:"hex",appendTo:t.closest("body"),palette:[],beforeShow:function(e){return!0},move:function(e){o(e)},show:function(e){},change:function(e){o(e,!0),n=!0},hide:function(e){n||(o(i),d.onCancel&&d.onCancel()),t.remove()}}),t.spectrum("set",i),new PgSpectrumHelper(t,{"mouse-moved":function(e){var t=e.spectrum("get");o(t)},"color-picked":function(e){var t=e.spectrum("get");o(t),0}}),t.spectrum("show")),!1})},PgCSSEditableListValue=function(e,t){this.onChange=null,this.onCanEdit=null;var d,c,u=this,h=1,p=0,g=1;e.on("click",t,function(e){pgCloseContextMenus();var t,n,o,i=$(this),l=u.onGetList(i);if(u.onCanEdit(i)&&0!==l.length)return u.onStart&&u.onStart(i),t=function(){i.text(this.key),u.onChange(i,this.key,!0)},n=function(){u.onListItemHighlighted&&u.onListItemHighlighted(i,this.key)},o=function(){u.onListItemHighlighted&&u.onListItemHighlighted(i,null)},l=l.map(function(e){return{label:e,key:e,action:t,on_mouseenter:n,on_mouseleave:o}}),(l=new CrsaContextMenu(l,i)).showForElement(i),l.onClosed=function(){u.onDone&&u.onDone(i)},e.preventDefault(),e.stopPropagation(),!1}),e.on("dblclick",t,function(e){return $(this).parent().trigger("click"),!1}),e.on("aaamousedown",t,function(e){var t,n,o,i=$(this),l=u.onGetList(i),s=(d=l.length-1,(new Date).getTime()),a=(c=e.clientY,e=l,a=i.text(),{val:0<=(a=e.indexOf(a))?a:0}),r=i;if(!0&&u.onCanEdit(i))return n=t=a.val,isNaN(t)&&(t=0),(o=$('<div style="position:fixed;width:100%;height:100%;top:0;left:0;opacity:0;cursor:row-resize;z-index:999;">').appendTo(r.closest("body"))).get(0).addEventListener("mousemove",function(e){return s=null,n=t+(c-e.clientY)/g*h,d<(n=n<p?p:n)&&(n=d),i.text(l[n]),u.onChange&&u.onChange(i,l[n]),!1},!0),o.get(0).addEventListener("mouseup",function(e){return o.remove(),null!==s&&(new Date).getTime()-s<1e3?i.parent().trigger("click"):u.onChange&&u.onChange(i,l[n],!0),!1},!0),!1})},PgCSSEditableValue=function(e,t){this.onChange=null,this.onCanEdit=null;var p,g=this,n={},f="slider_def_unit"in n?n.slider_def_unit:"px",m="slider_step"in n?n.slider_step:1,v="slider_min"in n?n.slider_min:-99999999,w="slider_max"in n?n.slider_max:99999999,S=1/m;e.on("mousedown",t,function(e){pgCloseContextMenus();var t,n,o,i,l,s,a,r,d=(new Date).getTime(),c=(p=e.clientY,$(this)),u={val:c.text()},h=c;if(!0&&g.onCanEdit(c))return u=u.val||"0"+f,s=parseFloat(u),t=a=f,n=s,o=f,isNaN(s)?s=0:0===(t=a=u.replace(/[\+\-]?([0-9]*\.?[0-9]*)/,"")).length&&"0"!==u?(a=f,o=""):"0"===u&&(o=a,a=f),i="",l=u.startsWith("+"),0<=(u=s.toString()).indexOf(".")&&(1<=m&&(m=.1),u.match(/\.[0-9][0-9]/))&&(S=u.endsWith("5")?(m=.05,10):(m=.01,2)),g.onFilterInfo&&(u={val:s,unit:a,def_step:m,step_f:S,$num:c,prefix:i,plus_sign:l,given_unit:t},s=(u=g.onFilterInfo(u)).val,a=u.unit,m=u.def_step,S=u.step_f,i=u.prefix,l=u.plus_sign,t=u.given_unit),(r=$('<div style="position:fixed;width:100%;height:100%;top:0;left:0;opacity:0;cursor:row-resize;z-index:999;">').appendTo(h.closest("body"))).get(0).addEventListener("mousemove",function(e){d=null,n=s+Math.round((p-e.clientY)/S)*m,n=parseFloat(n.toFixed(2)),w<(n=n<v?v:n)&&(n=w),Math.floor(n);var t=i+(l&&0<=n?"+":"")+n+(0===n?o:a);return c.text(t),g.onChange&&g.onChange(c,t),!1},!0),r.get(0).addEventListener("mouseup",function(e){var t;return r.remove(),null!==d&&(new Date).getTime()-d<1e3?c.parent().trigger("click"):g.onChange&&(t=n+(0===n?o:a),g.onChange(c,t,!0)),!1},!0),!1})},PgGetCSSValueHTML=function(){new RegExp("AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGray|DarkGreen|DarkGrey|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGray|DarkSlateGrey|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGray|DimGrey|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|Goldenrod|Gray|Green|GreenYellow|Grey|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGray|LightGreen|LightGrey|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGray|LightSlateGrey|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGray|SlateGrey|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen","gi");var a=/([\-\+]*[0-9\.]?[0-9\.]+(|px|rem|em|%|pt|pc|in|cm|mm|Q|ex|ch|lh|rlh|vw|vh|vmin|vmax|vb|vi|svw|svh|lvh|lvw|dvw|dvh|fr|deg)?)|((^|[^\w\-\_\/])(AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGray|DarkGreen|DarkGrey|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGray|DarkSlateGrey|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGray|DimGrey|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|Goldenrod|Gray|Green|GreenYellow|Grey|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGray|LightGreen|LightGrey|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGray|LightSlateGrey|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGray|SlateGrey|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen|\#[0-9a-fA-F]*|rgb\(\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)|rgba\(\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*[0-1]?(?:\.[0-9]+)*\s*\)))/gi;this.getColor=function(e){return e.replace(colorRe,function(e){return`<color data-color="${e}"><colorbox style="background-color:${e};"></colorbox>${e}</color>`})},this.getNumeric=function(e){return e.replace(/[\-\+]*[0-9\.]+[a-z\%]*/gi,function(e){return`<num>${e}</num>`})},this.getHTML=function(e,t,n,o){let i=0,l=0;var s=0<=e.indexOf("-gradient")&&!o?`<color data-color="${e}"><colorbox class="gradient" style="background-image: ${e}"></colorbox><span>${e.trim().replace(/\, /g,",")}</span>`:e.replace(a,function(e,t,n,o){return void 0!==t&&t.length?(i++,`<num>${e}</num>`):void 0!==o&&o.length?(l++,`<color data-color="${o}"><colorbox style="background-color:${o};"></colorbox><span>${o.trim().replace(/\, /g,",")}</span></color>`):void 0});return n&&(s=s.replace(n,function(e,t,n,o){return t+"<numlist>"+n+"</numlist>"})),t&&(t.html_val_count_nums=i,t.html_val_count_colors=l),s}},PgCSSCountHandler=function(e,t){function n(e){pinegrow.selectElement(e),e.scrollTo(),pinegrow.showQuickMessage(`Selected ${e.getName()}.`)}if(1===t.length){var o=getElementPgNode($(t[0]));o&&n(o)}else if(1<t.length){for(var i=new CrsaContextMenu(null,e),l=(i.add({type:"header",label:"Select element:"}),10),s=0;s<t.length&&s!==l;s++)!function(e){var t=getElementPgNode($(e));t&&i.add({label:t.getName(),action:function(){n(t)},check:pinegrow.selectedElements.isSelectedElement(t)})}(t[s]);t.length>l&&i.add({type:"header",label:t.length-l+` more elements not shown.`}),i.showForElement(e,null,8)}},pgCSSTreeValueHTMLMaker=new PgGetCSSValueHTML;class PgFastDOMStylePreviewForElement{constructor(e){this.el=e,this.original=this.el.getAttribute("style")}setStyle(e,t){this.restore(),null!==t&&this.el.style.setProperty(e,t.replace("!important","").trim(),"important")}restore(){this.el.setAttribute("style",this.original)}remember(){this.original=this.el.getAttribute("style")}}class PgFastDOMStylePreviewForPgel{constructor(e){this.pgel=e,this.page=e.getPage(),this.$elements=e.get$DOMElements(),this.list=this.$elements.map(function(e){return new PgFastDOMStylePreviewForElement(e.get(0))}),this.destroyed=!1,this.hidden_menus=!1}setStyle(t,n){this.destroyed||(this.hidden_menus||(pinegrow.selectedElements.temporaryHideMenus(!0),this.hidden_menus=!0),this.list.forEach(function(e){e.setStyle(t,n)}))}remember(){this.destroyed||this.list.forEach(function(e){e.remember()})}restore(){this.destroyed||(this.list.forEach(function(e){e.restore()}),this.hidden_menus&&(pinegrow.selectedElements.restoreShowMenus(!0),this.hidden_menus=!1))}destroy(){this.destroyed||(this.restore(),this.destroyed=!0)}}