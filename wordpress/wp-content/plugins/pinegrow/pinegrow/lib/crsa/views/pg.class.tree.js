class PgActiveClassesForPgel_Abstract{constructor(){this.level_offset=1,this.user_selected=!1}toggleUserSelect(){this.user_selected=!this.user_selected}getTreeChildren(){return null}populateTreeFata(e){}populateDataItem(e){}getCellWidth(){return 0}getPgelObj(){}refreshTree(){this.getClassTreeView().refresh()}getClassTreeView(){return this.getPgelObj().tree_view}}class PgActiveClassesForPgel extends PgActiveClassesForPgel_Abstract{constructor(e,t){super();var s=this,n=(this.pgel=e,this.tree_view=t,this.device_sizes_and_states={},e.getPage().activeView.getDeviceSizes(this.device_sizes_and_states),this.inline=new PgActiveClassesForPgel_ClassStyle(null,this),this.styles=[this.inline],this.styles_map={},{done:!1,show_class_styles:!1,sizes:!0,list:[]}),a=(pinegrow.dispatchEvent("on_get_active_classes_for_pgel",e.getPage(),e,n),this.show_class_styles=n.show_class_styles,this.inline.show_in_tree=this.show_class_styles,[]);n.list.forEach(function(e){var t;e.classStyle?(t=s.getStyleContainer(e.classStyle),a.indexOf(e.classStyle)<0&&a.push(e.classStyle)):t=s.inline,t.addClass(e.state||"all",e.class,e)}),a.forEach(function(e){var t=s.getStyleContainer(e);e.getForcedStates().forEach(function(e){t.addState(e)})}),this.parent=e.parent&&e.parent.isElement?new PgActiveClassesForPgel(e.parent,t):null}getAvailableStates(){return this.device_sizes_and_states.states}getStyleContainer(e){var t;return this.styles_map[e.key]||(t=new PgActiveClassesForPgel_ClassStyle(e,this),this.styles_map[e.key]=t,this.styles.push(t),t)}toString(){var t=`Active classes for ${this.pgel.tagName}:`;return this.styles.forEach(function(e){t+="\n    "+e.toString()}),this.parent&&(t+="\n"+this.parent.toString()),t}populateTreeFata(e){e.node=this,e.template_type="pgel"}getTreeChildren(){return this.show_class_styles?this.styles:this.inline.getTreeChildren()}getParents(){for(var e=[],t=this.parent;t;)e.push(t),t=t.parent;return e}getPgel(){return this.pgel}}class PgActiveClassesForPgel_ClassStyle extends PgActiveClassesForPgel_Abstract{constructor(e,t){super(),this.sizes=[],this.sizes_map={},this.classStyle=e,this.parent_pgel_obj=t,this.show_in_tree=!0,this.selected=!1,this.matched=!1,this.states=[],this.subelements=[],this.states_map={},this.add_state=new PgActiveClassesForPgel_AddState(this),this.add_class=new PgActiveClassesForPgel_AddClass(this);this.addState("all")}addClass(e,t,s){this.getState(e).addClass(t,s)}addState(e){var t=new PgActiveClassesForPgel_State(e,this),s=!1;return t.containsSubelement()?(t.state.substring(0,t.state.length-1),s||this.subelements.push(t)):s||this.states.push(t),this.states_map[e]=t}getState(e){return this.states_map[e]||this.addState(e)}toString(){var t=``+(this.classStyle?this.classStyle.key:"(inline)");return this.states.forEach(function(e){t+="\n            "+e.toString()}),this.subelements.forEach(function(e){t+="\n            "+e.toString()}),t}populateTreeFata(e){e.node=this,e.template_type="classstyle",this.classStyle&&(e.search_string+=this.classStyle.key)}getTreeChildren(){var t=[];return this.states.forEach(function(e){"all"===e.state?t=t.concat(e.getTreeChildren()):t.push(e)}),this.subelements.forEach(function(e){t.push(e)}),t.push(this.add_state),t}getClassWithSizeAndState(e){return e}getPgelObj(){return this.parent_pgel_obj}getPgel(){return this.parent_pgel_obj.pgel}getStyle(){return this.classStyle}getClassPrefix(){return this.getClassWithSizeAndState("")}getAllClassNodes(){var t=[];return this.states.forEach(function(e){t=t.concat(e.getAllClassNodes())}),this.subelements.forEach(function(e){t=t.concat(e.getAllClassNodes())}),t}getAllUserSelectedClasses(){return this.getAllClassNodes().filter(function(e){return e.user_selected}).map(function(e){return e.getClassWithSizeAndState()})}}class PgActiveClassesForPgel_Size extends PgActiveClassesForPgel_Abstract{constructor(e,t){super(),this.size=e,this.states=[],this.states_map={},this.parent_class_style=t,this.add_state=new PgActiveClassesForPgel_AddState(this),this.add_class=new PgActiveClassesForPgel_AddClass(this)}toString(){return``+this.size}populateTreeFata(e){e.node=this,e.template_type="size"}getTreeChildren(){return this.states.concat([this.add_class,this.add_state])}getClassWithSizeAndState(e){return"all"!==this.size?this.size+":"+e:e}getPgel(){return this.parent_class_style.parent_pgel_obj.pgel}getStyle(){return this.parent_class_style.classStyle}getClassPrefix(){return this.getClassWithSizeAndState("")}}class PgActiveClassesForPgel_State extends PgActiveClassesForPgel_Abstract{constructor(e,t){super(),this.state=e,this.classes=[],this.classes_map={},this.parent_class_style=t,this.add_class=new PgActiveClassesForPgel_AddClass(this),this.level_offset=1}addClass(e,t,s){const n=this;t||(l={},pinegrow.dispatchEvent("on_get_class_info",this.getPgel()?.getPage()||pinegrow.getSelectedPage(),e,l),t=l.info||{}),t&&t.values&&Array.isArray(t.values[0])&&(a=[],t.values.forEach(function(e){a=a.concat(e)}),t.values=a);var a,l=new PgActiveClassesForPgel_Class(e,t,this);s&&t.values&&t.values.forEach(function(e){var t;n.classes_map[e.key]&&(0<=(t=n.classes.indexOf(n.classes_map[e.key]))&&n.classes.splice(t,1),delete n.classes_map[e.key])}),this.classes.push(l),this.classes_map[t.class]=l}getAllClassNodes(){return this.classes}toString(){var t=``+this.state;return this.classes.forEach(function(e){t+="\n            - "+e.toString()}),t}isSubelement(e){var t=this.state.match(/^\[(\&.+)\]$/);return!!t&&t[1]}containsSubelement(e){var t=this.state.match(/\[(\&.+)\]/);return!!t&&t[1]}getSubelementSelector(e,t){return e=(e=e.replace(/^\[\&(.*)\]$/,"$1")).replace(/\\\_/g,"-###-").replace(/_/g," ").replace(/\-\#\#\#\-/g,"_"),e=t?splitBracketsAware(e,":")[0]:e}putSubelementToTheEnd(e){var t=this.state;return t=(e=(e=e||this.containsSubelement())&&this.makeSureSubelementStateHasBrackets(e))&&e!==t&&!t.endsWith(e)?(t=t.replace(e+":",""))+":"+e:t}makeSureSubelementStateHasBrackets(e){return e=e.startsWith("[")?e:`[${e}]`}hasNonSubelementStates(e){return(e=e||this.containsSubelement())?(e=this.makeSureSubelementStateHasBrackets(e),this.state.endsWith(e)||(e+=":"),this.state.replace(e,"")):this.state}formatStateWithSubelementForDisplay(e){if(!e){var t=pinegrow.classNamedStates.getNameForState(this.state);if(t!==this.state)return t}var s;return(e=e||this.containsSubelement())?(t=this.putSubelementToTheEnd(e),s=this.getSubelementSelector(e),t.replace("["+e+"]",`<span class="pg-class-tree-state-subelement">${escapeHtmlCode(s)}</span>`)):this.state}moveRelevantStatesToSubelementStateForClass(e){this.state=e;var t,s,n,a,l,i,o=splitBracketsAware(e,":");return!(o.length<=1)&&(t=["active","after","before","checked","disabled","empty","enabled","first","first-letter","first-line","focus","focus-visible","focus-within","hover","in-range","indeterminate","invalid","last","only-of-type","optional","out-of-range","placeholder-shown","read-only","required","root","target","valid","visited"],s=this.containsSubelement())?(n=this.makeSureSubelementStateHasBrackets(s),a=o.pop(),l=[],i=[],o.forEach(function(e){e!==n&&(0<=t.indexOf(e)?i:l).push(e)}),o="",l.length&&(o+=l.join(":")+":"),o+="["+s,i.length&&(o+=":"+i.join(":")),(o+="]:")+a):e}moveClassFromSubElementToDirectElement(e,t){var s,n,a,l,i=e.match(/(\[[^\]]*\])/);return i?(i=e.replace(i[1]+":",""),(s=e.match(/\[[^\:]*\:([^\]]*)\]/))&&(n=t||["active","after","before","checked","disabled","empty","enabled","first","first-letter","first-line","focus","focus-visible","focus-within","hover","in-range","indeterminate","invalid","last","only-of-type","optional","out-of-range","placeholder-shown","read-only","required","root","target","valid","visited"],l=(a=splitBracketsAware(i,":")).pop(),splitBracketsAware(s[1],":").forEach(function(e){a.indexOf(e)<0&&0<=n.indexOf(e)&&a.push(e)}),a.push(l),i=a.join(":")),i):e}changeState(e){var t,s,n,a;(e=e||"all")!==this.state&&(s=(t=this).getClassWithSizeAndState(""),n=[],this.classes.forEach(function(e){n.push(t.getClassWithSizeAndState(e.class))}),this.state=e,a=[],this.classes.forEach(function(e){a.push(t.getClassWithSizeAndState(e.class))}),this.parent_class_style.classStyle&&(this.parent_class_style.classStyle.addForcedState(e),this.parent_class_style.classStyle.removeForcedState(s)),(new PgApi).addClass(this.getPgel(),a,{source:t.getClassTreeView()},n,this.getStyle()))}populateTreeFata(e){e.node=this,e.template_type="state","all"!==this.state&&(e.search_string+=this.state)}getTreeChildren(){return this.classes.concat([this.add_class])}getClassWithSizeAndState(e){return"all"!==this.state?this.state+":"+e:e}getPgel(){return this.parent_class_style.parent_pgel_obj.pgel}getStyle(){return this.parent_class_style.classStyle}getClassPrefix(){return this.getClassWithSizeAndState("")}getPgelObj(){return this.parent_class_style.getPgelObj()}}class PgActiveClassesForPgel_Class extends PgActiveClassesForPgel_Abstract{constructor(e,t,s){super(),this.class=e,this.info=t,this.parent_state=s}toString(){return this.class}populateTreeFata(e){e.node=this,e.template_type="class",e.search_string+=this.class}getTreeChildren(){return null}getCellWidth(){return pgMeasureTextWidth(this.class)+30}getPgelObj(){return this.parent_state.parent_class_style.parent_pgel_obj}getPgel(){return this.getPgelObj()?.pgel}getClassWithSizeAndState(e){return void 0===e&&(e=this.class),this.info.important&&(e="!"+e),e=this.parent_state.getClassWithSizeAndState(e)}getClassPrefix(){return this.getClassWithSizeAndState("")}getState(){return this.parent_state}getClassStyle(){return this.parent_state.parent_class_style}getClassDisplay(){return this.info.important?"!"+this.class:this.class}getFullClass(e,t){return this.info.combo?t?this.info.combo[1].class?e+"/"+this.info.combo[1].class.replace(this.info.combo[1].prefix,""):e:this.info.combo[0].class+"/"+e.replace(this.info.combo[1].prefix,""):e}toggleImportant(e){var t=!this.info.important,s=this.getClassWithSizeAndState(this.class);this.info.important=t,this.changeClassTo(this.class,e,s)}changeClassTo(e,t,s){var n=this.getPgel(),a=(s=s||this.getClassWithSizeAndState(this.class),this.getClassWithSizeAndState(e)),l=this.getClassStyle(),i={source:this.getClassTreeView()};if(l.classStyle){if(l.classStyle.locked)return pinegrow.showQuickError("The style is locked."),void(t&&t(!1));pinegrow.makeChanges(n||pinegrow.getSelectedPage(),"Set "+e,function(){pinegrow.classStyles.addClassToStyle(n,l.classStyle,a,s,i)},i),pinegrow.dispatchEventDelayed("on_element_classes_changed",null,pinegrow.getCollectionForElement(n),i)}else pinegrow.classStyles.getStylesForPgel(n).length?(pinegrow.makeChanges(n,"Set "+e,function(){pinegrow.classStyles.addClassToStyle(n,null,a,s,i)},i),pinegrow.dispatchEventDelayed("on_element_classes_changed",null,pinegrow.getCollectionForElement(n),i)):(new PgApi).addClass(pinegrow.getCollectionForElement(n),[a],i,[s],"inline");this.class=e;var o=pinegrow.findFrameworkByType("tailwind");this.info=o.twGetClassInfoWithValues(a,!0),t&&t(!0)}removeClass(e){var t=this.getPgel(),s=this.getClassWithSizeAndState(this.class),n=this.getClassStyle(),a={source:this.getClassTreeView()};if(n.classStyle){if(n.classStyle.locked)return pinegrow.showQuickError("The style is locked."),void(e&&e(!1));pinegrow.makeChanges(t||pinegrow.getSelectedPage(),"Remove "+s,function(){pinegrow.classStyles.removeClassFromStyle(t,n.classStyle,s,a)},a)}else pinegrow.classStyles.getStylesForPgel(t).length?pinegrow.makeChanges(t,"Remove "+s,function(){pinegrow.classStyles.removeClassFromStyle(t,null,s,a)},a):(new PgApi).removeClass(pinegrow.getCollectionForElement(t),[s],a,"inline");e&&e(!0)}hasCustomValue(e){var t=(e||this.class).match(/\[(.+)\]/);return!!t&&t[1]}getColorValue(){var e,t=this.class;if(this.info.values&&this.info.values.length?e=this.info.values:this.info.combo&&1<this.info.combo.length&&(e=this.info.combo[0]?.values,t=this.info.combo[0].class,e=e||pinegrow.twf.twGetClassBaseAndOptions(this.info.combo[0].class)?.values)&&Array.isArray(e[0])&&(e=pinegrow.twf.twFlattenColors(e)),e&&e.length&&e[0].color)for(var s=0;s<e.length;s++)if(e[s].key===t)return e[s].color;return null}}class PgActiveClassesForPgel_AddClass extends PgActiveClassesForPgel_Abstract{constructor(e){super(),this.parent=e}populateTreeFata(e){e.node=this,e.template_type="add_class"}getTreeChildren(){return null}getCellWidth(){return pgMeasureTextWidth("Add class")+30}getPgel(){return this.parent.getPgel()}getStyle(){return this.parent.getStyle()}addClass(e){this.parent.addClass(e,null,!0)}}class PgActiveClassesForPgel_AddState extends PgActiveClassesForPgel_Abstract{constructor(e){super(),this.parent=e,this.level_offset=1}populateTreeFata(e){e.node=this,e.template_type="add_state"}getTreeChildren(){return null}getCellWidth(){return 0}getPgelObj(){return this.parent.parent_pgel_obj}getAvailableStates(){return this.getPgelObj().getAvailableStates()}addState(e){this.parent.addState(e)}getStyle(){return this.parent.classStyle}}var PgQuickClassTree=function(){var e=new PgClassTreeView(!1,!0),t=new PgQuickWindow("Class tree",e,"quickClassTree",400,700);t.noRightEdge(),t.showAtPosition(800,0),e.show(),t.onDestroy=function(){}},PgQuickStyleClassTree=function(){var e=new PgClassTreeView(!0),t=new PgQuickWindow("Class tree",e,"quickStyleClassTree",400,700);t.noRightEdge(),t.showAtPosition(800,0),e.show(),t.onDestroy=function(){}};class PgClassTreeCellPgel extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-pgel"><!--<i data-element="icon" class="icon-KODA"></i>--><name data-element="name"></name>
</div>`,e,t),this.tooltip("cell","Click to select the element. Right-click for more."),this.on("cell","click",this.onClick.bind(this)),this.on("cell","mouseenter",this.onMouseEnter.bind(this)),this.on("cell","mouseleave",this.onMouseLeave.bind(this)),this.on("cell","contextmenu",this.onMenu.bind(this))}onPopulate(){var e=this.data.node.pgel,e=(this.setHtml("name",e.getName({short:!1,num_classes:-1})),pinegrow.selectedElements.isSelectedElement(e));e?this.addClass("cell","selected"):this.removeClass("cell","selected")}onMenu(e){e.preventDefault(),e.stopPropagation();const n=this;var t,s=[];pinegrow.selectedElements.isSelectedElement(this.data.node.pgel)||s.push({label:"Select element",action:function(){pinegrow.selectElement(n.data.node.pgel,null,null,null,e,{source:n.classTreeView})}}),0===pinegrow.classStyles.getStylesForPgel(this.data.node.pgel).length&&(s.push({type:"divider"}),t=new PgApi,s=s.concat(t.twGetMenuActionsFor(this.data.node.pgel,null,null,""))),s.push({type:"divider"}),s.push({label:"Create a new style",helptext:"Create a new style with all (or just selected) classes.",action:function(){var e=n.data.node.getPgel(),t=new PgClassStyleCreator(null,null,!0),s=n.classTreeView.getAllUserSelectedClasses();t.createWithDialog(e,s.length?s:null)}}),new CrsaContextMenu(s,$(e.target)).showAt(e.pageX,e.pageY)}onClick(e){e.preventDefault(),e.stopPropagation();pinegrow.selectedElements.isSelectedElement(this.data.node.pgel)?this.onMenu(e):(pinegrow.selectElement(this.data.node.pgel,null,null,null,e,{source:this.classTreeView}),pinegrow.showQuickMessage(this.data.node.pgel.getName({short:!0})+" selected."))}onMouseEnter(e){pinegrow.highlightElement(this.data.node.pgel.get$DOMElement())}onMouseLeave(e){pinegrow.highlightElement(null)}}class PgClassTreeCellClassStyle extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-classstyle"><i data-element="icon" class="collapse-icon icon-down"></i><name data-element="name"></name>
    <span class="tools-after-name">
        <span class="usage-count" data-element="count">0</span>
        <i class="lock icon icon-Lock_open" data-element="lock-open" style="opacity:1;"></i>
        <i class="lock icon icon-Lock_closed" data-element="lock-closed"></i>
        <i class="icon icon-Pin6" data-element="drag"></i>
</span>
</div>`,e,t),this.tooltip("count","How many times the style is used in the project. Click to select an element or update count."),this.tooltip("lock-open","Unlock the style so that it can be edited."),this.tooltip("lock-closed","Lock the style so that it can not be edited."),this.tooltip("name","Click for actions..."),this.tooltip("drag","Drag to reorder component styles.");const r=this;this.on("cell","contextmenu",this.onClick.bind(this)),this.on("cell","click",function(e){e.target===r.getElement("cell")&&r.onClick(e)}),this.on("lock-open","click",function(e){e.preventDefault(),pinegrow.classStyles.lockStyle(r.data.node.classStyle,!1,{source:r.classTreeView}),r.onPopulate()}),this.on("lock-closed","click",function(e){e.preventDefault(),pinegrow.classStyles.lockStyle(r.data.node.classStyle,!0,{source:r.classTreeView}),r.onPopulate()}),this.on("name","click",this.onClick.bind(this)),this.on("count","click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();function t(){var e=this.pgel;pinegrow.selectElement(e),e.scrollTo(),pinegrow.showQuickMessage(`Selected ${e.getName()}.`)}var s=[{label:"Update usage counts",action:function(){pinegrow.classStyles.updateUsageCounts(function(){r.classTreeView.show(null,!0)})}},{type:"divider"}],n=pinegrow.classStyles.getPgelsWithStyleOnPage(r.data.node.classStyle);if(n.length){s.push({type:"header",label:"Select an element on this page:"});for(var a=40,l=0;l<n.length;l++){if(l===a){s.push({type:"header",label:n.length-a+` more elements not shown.`});break}var i=n[l];s.push({label:i.getName(),pgel:i,check:pinegrow.selectedElements.isSelectedElement(i),action:t})}}else s.push({type:"header",label:"There are no elements with this style on this page."});var o=$(e.target);new CrsaContextMenu(s,o).showForElement(o)})}onPopulate(){var e;this.data.node.classStyle?(e=this.data.node.classStyle,this.setHtml("name",e.getDisplayName()),e.locked?(this.showElement("lock-open"),this.hideElement("lock-closed")):(this.hideElement("lock-open"),this.showElement("lock-closed")),this.setText("count",e.count),e.component?(this.addClass("cell","component"),this.showElement("drag")):(this.removeClass("cell","component"),this.hideElement("drag"))):(this.setHtml("name","(inline)"),this.hideElement("count"),this.hideElement("lock-open"),this.hideElement("lock-closed"),this.addClass("cell","component")),this.data.node.selected?this.addClass("cell","selected"):this.removeClass("cell","selected"),this.data.node.matched?this.addClass("cell","matched"):this.removeClass("cell","matched")}onClick(e){e.preventDefault(),e.stopPropagation();const t=this;var s;t.data.node.classStyle?pinegrow.classStyles.showStyleContextMenu(t.data.node.classStyle,$(e.target),e,{source:t.classTreeView},function(){var e;t.data&&((e=pinegrow.selectedElements.getLastSelected())&&t.data.node&&t.data.node.classStyle.component&&(t.data.node.matched=pinegrow.classStyles.isStyleOnPgel(e,t.data.node.classStyle)),t.onPopulate())}):((s=(new PgApi).twGetMenuActionsFor(this.data.node.getPgel(),"inline",null,"")).push({type:"divider"}),s.push({label:"Create a new style",helptext:"Switch to visual controls to create a style based on these classes.",action:function(){var e=t.data.node.getPgel();pinegrow.showVisualControlsInPropsPanel(e),pinegrow.classStyles.setCurrentStyle(null,!0)}}),new CrsaContextMenu(s,$(e.target)).showForElement($(e.target)))}}class PgClassTreeCellSize extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-size"><i data-element="icon" class="collapse-icon icon-down"></i><name data-element="name"></name>
</div>`,e,t),this.on("cell","click",this.onClick.bind(this))}onPopulate(){this.setHtml("name",this.data.node.size)}onClick(e){e.preventDefault(),e.stopPropagation()}}class PgClassTreeCellState extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-state"><!--<i data-element="icon" class="collapse-icon icon-down"></i>--><name data-element="name"></name>
</div>`,e,t),this.on("cell","click",this.onClick.bind(this)),this.on("cell","contextmenu",this.onMenu.bind(this))}onMenu(e){e.preventDefault(),e.stopPropagation();(s=[]).push({type:"divider"});var t=new PgApi,s=s.concat(t.twGetMenuActionsFor(this.data.node.getPgel(),this.data.node.getStyle(),null,this.data.node.state));new CrsaContextMenu(s,$(e.target)).showAt(e.pageX,e.pageY)}onPopulate(){var e=pinegrow.classNamedStates.getNameForState(this.data.node.state);e!==this.data.node.state?this.setHtml("name",e):(e=this.data.node.containsSubelement())?(e=this.data.node.formatStateWithSubelementForDisplay(e),this.setHtml("name",e)):this.setHtml("name",escapeHtmlCode(this.data.node.state))}onClick(e){const t=this;this.data.node.getStyle();var s=new PgClassStateComposerDropdown;return s.onChanged=function(){var e=s.getValue();t.data.node.changeState(e),t.data.node.getStyle()||!e||"all"===e?t.classTreeView.show(null,!0):t.onPopulate()},s.setValue(this.data.node.state),s.show(e),e.preventDefault(),e.stopPropagation(),!1}}class PgClassTreeCellClass extends PgTableGridCell{constructor(e,t){super();const n=this;function a(e,t){var s=n.getClassFromNameAfterEdit();o(t),l||(l=n.getClassPreview(),(i=[]).push({key:n.class})),l&&(l.setClass(s,i),i.push({key:s})),e&&(l&&(l.destroy(),l=null),n.data.node.changeClassTo(s,function(){n.onPopulate()}))}this.init(`<div data-element="cell" class="pg-class-tree-class"><input data-element="check" type="checkbox" checked><value data-element="name" data-will-handle-esc="true"></value>
        <div class="tools-after-name tools-after-name-hover" style="margin-left:5px;">
        <i data-element="edit" class="icon icon-Editable"></i>
        <i data-element="grid" class="icon icon-grid"></i>
        </div>
</div>`,e,t),this.tooltip("name",`Click to change the value. <br>${pgShowKbd("CMD")} + Click to select. <br>Right-click for more.`),this.in_editing=!1,this.on("cell","click",this.onUserSelect.bind(this)),this.on("name","click",this.onClick.bind(this)),this.on("cell","contextmenu",this.onMenu.bind(this)),this.on("check","change",this.onCheck.bind(this)),this.on("check","click",this.onStopEvent.bind(this)),this.on("name","blur",this.onEditTextDone.bind(this)),this.on("name","keydown",this.onEditTextKeypress.bind(this)),this.on("edit","click",this.onEditText.bind(this)),this.on("grid","click",function(e){pinegrow.showCSSGridControl(n.data.node.getPgel()||pinegrow.selectedElements.getLastSelected(),n.$element)}),this.tooltip("edit","Edit the class name directly."),this.tooltip("grid","Open grid editor.");var l,i=[],o=(this.colorValue=new PgCSSEditableColor(this.$element,"colorbox"),this.colorValue.onCanEdit=function(e){return!0},this.colorValue.onChange=function(e,t){a(t,e)},this.colorValue.onCancel=function(){l&&(l.destroy(),l=null)},this.scrubValue=new PgCSSEditableValue(this.$element,"num"),this.scrubValue.onCanEdit=function(e){return!0},this.scrubValue.onChange=function(e,t,s){a(s,e)},function(e){var t=e.get(0);return t.previousSibling&&3===t.previousSibling.nodeType?t.previousSibling.wholeText.trim().toLowerCase():null});this.scrubValue.onFilterInfo=function(e){var t=o(e.$num);return t&&(t.match(/[a-z]$/i)?(e.prefix=".",e.val=parseFloat(e.val.toString().replace(".","")),e.def_step=1,e.unit=""):e.val<0&&!t.match(/[ \+\-\*\,]$/)&&(e.plus_sign=!0)),e.given_unit||(e.unit=""),e}}getClassPreview(){var e,t,s=null,n=this.data.node.getPgel();return n||(e=this.data.node.getClassStyle())&&(e.classStyle.component?s=new PgFastDOMClassPreviewForSelector(e.classStyle.getSelector(),this.data.node.getClassPrefix()):(t=pinegrow.selectedElements.getLastSelected())&&e.classStyle.doesPgelHasThisStyle(t)&&(n=t)),s=n?new PgFastDOMClassPreviewForPgel(n,this.data.node.getClassPrefix()):s}onMenu(e){e.preventDefault(),e.stopPropagation();var t=[],s=(t.push({type:"divider"}),new PgApi),n=[this.data.node.getClassWithSizeAndState()];this.data.node.user_selected&&(n=this.classTreeView.getAllUserSelectedClasses()),t=t.concat(s.twGetMenuActionsFor(this.data.node.getPgel(),this.data.node.parent_state.getStyle(),n,"")),new CrsaContextMenu(t,$(e.target)).showAt(e.pageX,e.pageY)}onUserSelect(e){crsaIsCmdPressed(e)?(e.preventDefault(),e.stopPropagation(),this.data.node.toggleUserSelect(),this.onPopulate()):e.target===this.$element.get(0)&&(e.preventDefault(),e.stopPropagation(),this.classTreeView.deselectAllClasses(),this.data.node.toggleUserSelect(),this.onPopulate())}onEditText(e){var t=this.getElement("name"),s=(t.setAttribute("contenteditable","true"),t.focus(),document.createRange()),t=(s.selectNodeContents(t),window.getSelection());t.removeAllRanges(),t.addRange(s),this.in_editing=!0}getClassFromNameAfterEdit(){var e=this.getElement("name"),e=(e.removeAttribute("contenteditable"),this.invalidateHtml("name"),$(e.outerHTML));return e.find(".sp-replacer").remove(),e.text().trim()}async onEditTextDone(e,t){if(this.in_editing){this.in_editing=!1;var s=this.getClassFromNameAfterEdit();if(t)this.onPopulate();else if(await pinegrow.classStyles.canAddClass(null,s,this.data.node.parent_state.getStyle())){const n=this;this.data.node.changeClassTo(s,function(){n.onPopulate()})}else this.onPopulate()}}onEditTextKeypress(e){if(this.in_editing)return"Enter"===e.key?(this.onEditTextDone(e),!1):"Escape"===e.key?(this.onEditTextDone(e,!0),!1):void 0}onPopulate(){var e=this.data.node.getColorValue(),e=e?` <colorswatch style="background-color:${e}"></colorswatch>`:"";this.setHtml("name",this.getValueHTML(this.data.node.getClassDisplay())+e),this.getElement("check").checked=!0!==this.data.node.disabled,this.data.node.disabled?this.addClass("cell","unchecked"):this.removeClass("cell","unchecked"),this.data.node.user_selected?this.addClass("cell","selected"):this.removeClass("cell","selected"),this.data.node.class.startsWith("grid")?this.showElement("grid"):this.hideElement("grid")}onCheck(e){e.preventDefault(),e.stopPropagation();var t=this.getElement("check").checked;const s=this;t?s.data.node.changeClassTo(s.data.node.class,function(){s.data.node.disabled=!1,s.onPopulate()}):s.data.node.removeClass(function(){s.data.node.disabled=!0,s.onPopulate()})}onStopEvent(e){e.stopPropagation()}onClick(e){if(!this.in_editing&&!crsaIsCmdPressed(e)&&!this.isInlineEditTarget(e)){var t=pinegrow.findFrameworkByType("tailwind");if(t){e.preventDefault(),e.stopPropagation();var s,n=this,o=function(){r&&r.destroy(),n.data.node.changeClassTo(this.class,function(){n.onPopulate()})},r=this.getClassPreview(),a=[],l=t.twGetClassBaseAndOptions(this.data.node.class).values,c=null,i=function(n,a,l,i){return{type:"html",html:"",onShow:function(e){var t=$(`<div style="position:absolute;top:-1000px;left:0px;display:none;"><input type="hidden" value="${n}"/></div>`).appendTo(e),s=t.find("input");c=new PgColorPicker(s,a,"",function(){return{}},{inline:!0,no_color_button:!1,on_color_highlighted:function(e){(e=i?i(e):e)?r&&r.setClass(e,l):r&&r.restore()},on_show:function(){},on_value_set:function(e){i&&(e=i(e)),o.call({class:e}),g.close()},on_hide:function(){r&&r.destroy(),t.remove()}}),s.on("change",function(e){}),c.show(e),c.close_on_mouseleave=!1}}},d=new PgActiveClassesForPgel_Class;if(this.data.node.info.combo){var h=t.twGetClassInfo(this.data.node.info.combo[0].class,null,!0);if(h.values=t.twGetClassBaseAndOptions(this.data.node.info.combo[0].class).values,h?.values){const p=this.data.node.info.combo[0],m=this.data.node.info.combo[1],f=function(e,t){return n.data.node.getFullClass(e,0===t)};var u=[],h=(Array.isArray(h.values[0])?(h.values.forEach(function(e){u=u.concat(e)}),a.push(i(p.class,h.values,u,function(e){return f(e,0)}))):(u=h.values.slice(0),h.values.forEach(function(e){const t=f(e.key,0);u.push({key:t}),a.push({label:e.name,class:t,action:o,check:e.key===p.class,on_mouseenter:function(){r&&r.setClass(t,u)},on_mouseleave:function(){r&&r.restore()}})})),t.twGetValuesForFieldKey(m.field_key).slice(0));const v=[];h&&(m.class&&!1!==(t=d.hasCustomValue(m.class))&&h.push({key:m.class,name:t,custom:!0}),h.forEach(function(e){const t=f(e.key,1);u.push({key:t}),e.custom&&v.push({type:"divider"}),v.push({label:e.name,class:t,action:o,check:e.key===m.class,on_mouseenter:function(){r&&r.setClass(t,u)},on_mouseleave:function(){r&&r.restore()}})}),v.push({type:"divider"}),v.push({label:"None",class:n.data.node.info.combo[0].class,action:o,on_mouseenter:function(){r&&r.setClass(n.data.node.info.combo[0].class,u)},on_mouseleave:function(){r&&r.restore()}}),a.push({type:"divider"}),a.push({label:m.label,submenu:v}))}}else this.data.node.info.values&&(l&&Array.isArray(l[0])?(s=[],l.forEach(function(e){s=s.concat(e)}),a.push(i(n.data.node.class,l,s))):this.data.node.info.values.forEach(function(e){a.push({label:e.name,class:e.key,action:o,check:e.key===n.data.node.class,on_mouseenter:function(){r&&r.setClass(e.key,n.data.node.info.values)},on_mouseleave:function(){r&&r.restore()}})}));a.push({type:"divider"}),a.push({label:"!important",check:this.data.node.info.important,action:function(){n.data.node.toggleImportant(function(){n.onPopulate()})}}),a.push({type:"divider"}),a.push({label:"Edit",action:function(){n.onEditText()}}),a.push({type:"divider"}),a.push({label:'<i class="icon icon-close" style="color:white;margin-right:8px;"></i> Remove',action:function(){r&&r.destroy(),n.data.node.removeClass(function(){n.classTreeView.show()})},on_mouseenter:function(){r&&r.setClass(null,n.data.node.info.values)},on_mouseleave:function(){r&&r.restore()}});var d=$(e.target),g=new CrsaContextMenu(a,d);g.class_key="menu_item_class",g.pos_checked_at_mouse=!0,g.showAt(e.pageX,e.pageY,$(e.target).closest(".pg-tree-container")),g.onClosed=function(){r&&r.destroy(),c&&c.close()}}}}isInlineEditTarget(e){return"COLORBOX"===e.target.nodeName||"NUM"===e.target.nodeName}getValueHTML(e){const n=this;return e.replace(/\[(.+)\]/,function(e,t,s){return"["+pgCSSTreeValueHTMLMaker.getHTML(t,n.data,null,!0)+"]"})}}class PgTreeCellButton{constructor(e){this.cell=e}getHTML(){}addHandlers(){}}class PgClassTreeAddClassButton extends PgTreeCellButton{constructor(e){super(e)}getHTML(){return`<span data-element="add-button">
<i class="icon icon-plus"></i> Add class</span>`}addHandlers(){this.cell.on("add-button","click",this.onClick.bind(this))}onClick(e){var t=this,s=(e.preventDefault(),e.stopPropagation(),new PgAddClassContextMenu(this.cell.data.node.getPgel(),this.cell.data.node.getStyle(),this.cell.data.node.parent.getClassPrefix()));s.source=this.classTreeView,s.onClassSet=function(e){t.cell.data.node.addClass(e),t.cell.classTreeView.refresh()},s.showForEvent(e)}}class PgClassTreeCellAddClass extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-add-class" ><span data-element="add">
<i class="icon icon-plus"></i> Add class</span>
</div>`,e,t),this.tooltip("cell","Click to add a class."),this.on("cell","click",this.onClick.bind(this))}onClick(e){var t=this,s=(e.preventDefault(),e.stopPropagation(),new PgAddClassContextMenu(this.data.node.getPgel(),this.data.node.getStyle(),this.data.node.parent.getClassPrefix()));s.source=this.classTreeView,s.onClassSet=function(e){t.data.node.addClass(e),t.classTreeView.refresh()},s.showForEvent(e)}}class PgClassTreeCellAddState extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-add-state" ><span data-element="add">
<i class="icon icon-plus"></i></span>
</div>`,e,t),this.tooltip("add","Click to add a variant."),this.on("cell","click",this.onClick.bind(this))}onClick(e){var s=this,n=(e.preventDefault(),e.stopPropagation(),new PgClassStateComposerDropdown);n.onChanged=function(){var e=n.getValue(),t=(s.data.node.addState(e),s.data.node.getStyle());t&&t.addForcedState(e),s.data.node.refreshTree()},n.setValue(""),n.show(e)}}var PgClassTreeView=function(n,O){pinegrow.registerTreeView(this);function d(e){var t=e.closest("div");return v.visibleData[parseInt(t.attr("data-visible-idx"))]}var z,h,t=$("<div/>",{id:"pg-tree",class:"pg-tree pg-css-tree pg-class-tree"}),e=(new PgApi,new PgSearchBox({toolbar_on:!0,placeholder_active:null,placeholder:"Search"})),s=this.toolbar=e.getToolbar(),a=(s.addSection("settings").$element,n||O||(c=new PgButtonToolbarItem("icon-Pin22","Show visual controls."),s.addItem("settings",c),c.onClick=function(){pinegrow.showVisualControlsInPropsPanel()}),n&&(c=new PgButtonToolbarItem('<span class="tw-color-swap"><span class="span1" style="background: transparent;border: 1px solid var(--pg-ui-gray);"></span><span class="span2" style="background: var(--pg-ui-light);"></span></span>',"Swap colors..."),s.addItem("settings",c),c.onClick=function(){var e=pinegrow.findFrameworkByType("tailwind"),t=pinegrow.classStyles.getDBNodeForAllStyles(),e=e.twGetMenuActionsForColorChange(t);return new CrsaContextMenu(e,this.$element).showForElement(this.$element),!1}),n&&0&&(c=new PgButtonToolbarItem("icon-KODA","Override a CSS rule with a component style"),s.addItem("settings",c),c.onClick=function(){pinegrow.showPrompt(`<p>Enter the CSS selector that you wish to override with a component style (for example, <code>p.lead</code>):</p>`,"Override CSS selector","","p",null,async function(e){var t;e&&((t=pinegrow.selectedElements.getLastSelected())&&t.hasClass(e)&&(e="."+e),t=await pinegrow.classStyles.overrideCSSRuleWithComponentStyle(e))&&pinegrow.classStyle.setCurrentStyle(t)})}),new PgButtonToolbarItem("icon-tools",n?"Style manager settings.":"Switch to the visual editing mode and other settings.")),L=(s.addItem("settings",a),{position:{label:"Position",desc:"Show only the elements with inline styles",re:/_(top|right|bottom|left|position|z\-index)_/i},text:{label:"Text",desc:"Show only images",re:/font|line-height|_color_|letter-spacing|text-decoration|text-align|text-transform|white-space|word-break|_direction_|text-indent/i}}),l={},i=($.each(L,function(e,t){l[e]=!1}),l),o=(a.onClick=function(){var e;if(n)return new CrsaContextMenu([{type:"header",label:"Expand / collapse styles"},{label:"Expand all",action:function(){pinegrow.classStyles.expandAll(!0),m.show(null,!0)}},{label:"Collapse all",action:function(){pinegrow.classStyles.expandAll(!1),m.show(null,!0)}},{type:"divider"},{type:"header",label:"Lock / unlock styles"},{label:"Lock all",action:function(){pinegrow.classStyles.lockAll(!0),m.show(null,!0)}},{label:"Unlock all",action:function(){pinegrow.classStyles.lockAll(!1),m.show(null,!0)}},{type:"divider"},{type:"header",label:"Update"},{label:"Update usage counts",action:function(){pinegrow.classStyles.updateUsageCounts(function(){m.show(null,!0)})}},{label:"Update whole project & save changes",action:function(){pinegrow.classStyles.updateProject(function(){m.show(null,!0)})}}],this.$element).showForElement(this.$element),!1;e=[],pinegrow.getSelectedPage()&&pinegrow.getSelectedPage().callFrameworkHandler("on_device_size_selector_settings",e),new CrsaContextMenu(e,this.$element).showForElement(this.$element,null,8)},this.getAllUserSelectedClasses=function(){return A?.getAllUserSelectedClasses()||[]},this.deselectAllClasses=function(){A.deselectAllClasses()},this.setFilterOption=function(e,t){var s;i=$.extend({},l),e?(s=L[e],i[e]=!0,a.setActive(!0),pinegrow.showMode(s.desc,!0),N(s.label)):(a.setActive(!1),N()),A.setFilterOptions(i),t||A.research(!0)},e.$element.appendTo(t),e.$element.find(".pg-button-toolbar-section.icons")),u=(new PgSearchBoxSpacer,null),r=(e.onSearch=function(e){var t=new CrsaProfile;u=e,A&&A.search(e),e.length?pg$Show(o,"inline-block"):pg$Hide(o),t.show("SEARCH")},pg$Hide(o),$('<div class="pg-tree-filter-msg"><div>Show only: <span></span><i class="close icon icon-close"></i></div></div>').appendTo(t)),N=(pg$Hide(r),r.on("click",function(e){e.preventDefault(),m.setFilterOption(null)}),function(e){e?(r.find("span").html(e),pg$Show(r,"flex"),t.addClass("with-filter-msg")):(pg$Hide(r),t.removeClass("with-filter-msg"))}),g=null,c=(n&&((g=new PgPanelNotice).$element.appendTo(t).css({marginTop:0,marginBottom:0}),crsaHandleExternalLinks(g.$element)),$("<div/>",{class:"pg-tree-container"}).appendTo(t)),p=this.view=new PgUIView(t,n?"classstyles":"tree","Class Tree"),m=(p.getId(),p.classForContainer="pg-tree-panel-container",this),f=(p.tabIcon=n?"icon-classes":"icon-Pin11",p.onShow=function(){},new PgTreeNodeMenu([{icon:"icon-bin",name:"Delete",func:function(e){}},{icon:"icon-duplicate",name:"Duplicate",func:function(e){}},{icon:"icon-hide",name:"Hide / show in Pinegrow",key:"hide",func:function(e,t){}},{icon:'<i class="icon icon-Ins_before"><span class="path1"></span><span class="path2"></span></i>',name:"Insert before",func:function(e){}},{icon:'<i class="icon icon-Ins_after"><span class="path1"></span><span class="path2"></span></i>',name:"Insert after",func:function(e){}},{icon:'<i class="icon icon-Append"><span class="path1"></span><span class="path2"></span></i>',name:"Insert into at beginning (prepend)",func:function(e){}},{icon:'<i class="icon icon-Prepend"><span class="path1"></span><span class="path2"></span></i>',name:"Insert into at end (append)",func:function(e){}}])),v=(f.hide(),new PgTableGrid({highlightLevels:!1})),W=(v.variableHeight=!1,v.draggable=n,v.getCellWidthForData=function(e){return 0},v.getCellHeightForData=function(e){return v.cellHeight},null),B=(v.onScroll=function(){W&&W.updatePosition(),I()},c.append(v.$element),f.$element.appendTo(t),v.setTemplate(PgClassTreeCellPgel,"pgel"),v.setTemplate(PgClassTreeCellClassStyle,"classstyle"),v.setTemplate(PgClassTreeCellSize,"size"),v.setTemplate(PgClassTreeCellState,"state"),v.setTemplate(PgClassTreeCellClass,"class"),v.setTemplate(PgClassTreeCellAddClass,"add_class"),v.setTemplate(PgClassTreeCellAddState,"add_state"),v.onSetDataToCell=function(e,t){this.data&&(this.data.cell=null),(e.cell=t).classTreeView=m,A.populateDataItem(e);e.node;v.hasChildren(e)?e.collapsed?(t.addClass("icon","icon-right"),t.removeClass("icon","icon-minus","icon-down"),t.$element.addClass("collapsed")):(t.removeClass("icon","icon-minus","icon-right"),t.addClass("icon","icon-down"),t.$element.removeClass("collapsed")):(t.removeClass("icon","icon-down","icon-right"),t.addClass("icon","icon-minus"),t.$element.removeClass("collapsed"));var s=e.search||0;t.$element.removeClass("search-1 search-2 search-0").addClass("search-"+s),t.onPopulate()},v.onRepaint=function(){f.setBottom(v.getHScrollBarSize()),f.setRight(v.getVScrollBarSize()),I()},this.scrollToNode=function(e){var t=G(e);t&&v.scrollTo(t)},this.setSelectedForClassStyle=function(e,t){var s=A?.getTreeDataItemForClassStyle(e);s&&(s.node.selected=t,B(s))},this.setMatchedForClassStyle=function(e,t){var s=A?.getTreeDataItemForClassStyle(e);s&&(s.node.matched=t,B(s))},function(e){e&&(e.populated=!1,v)&&v.updateItem(e)}),R=(this.updateLayout=function(){var e;nextFrame.do("refreshGrid",function(){v&&(v.refresh(),p.isVisible()?e&&e():p.whenVisible(function(){v.show(),e&&e()}))})},function(e){var t=$(e.currentTarget).closest("div");return v.visibleData[parseInt(t.attr("data-visible-idx"))]}),G=function(e){for(var t=v.data,s=0;s<t.length;s++)if(t[s].node===e)return t[s];return null},w=(this.isOverTree=function(e,t){return(!t||"class_styles"===t.dragType)&&p.getWindow()===e.view&&p.isVisible()&&e.pageX>=E.left&&e.pageX<=E.right-(f.isHidden()?0:f.width+v.getVScrollBarSize())&&e.pageY>=E.top&&e.pageY<=E.bottom?{left:e.pageX-E.left,top:e.pageY-E.top}:null},this.getDropPositionInfo=function(e,t,s){var n=v.dragOver(s);return n&&("classstyle"===n.data.template_type?n.position=n.position.replace("inside-",""):n=null),v.showInsertionPoint(n),n},v.$container.on("mouseover",".pg-table-grid-cell",function(e){v.inScroll||(R(e),pinegrow.getDragMenu()),e.stopImmediatePropagation()}).on("mouseout",".pg-table-grid-cell",function(e){v.inScroll||pinegrow.getDragMenu(),e.stopImmediatePropagation()}).on("click","i.collapse-icon",function(e){var t=R(e);t.collapsed=!(t.collapsed||0),e.altKey?(v.forEachVisibleSibling(t,function(e){e.collapsed=t.collapsed}),pinegrow.classStyles.expandAll(!t.collapsed,{source:m})):t.node.classStyle&&pinegrow.classStyles.expandStyle(t.node.classStyle,!t.collapsed,{source:m}),v.refresh(),e.preventDefault(),e.stopPropagation()}).on("click",function(e){if(H){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var s=H.data.node,n=("add_prop"===s.type&&(s=s.target_node),pgcssh.getRuleForNode(s)),t=$(e.currentTarget);const a=new PgCSSApi;new CrsaContextMenu(a.getInsertCSSPropMenu(function(e,t){a.addRuleProperty(n,e,t||"",function(){m.refresh()},{insertAtIndex:n.nodes.indexOf(s)+1})}),t).showAt(e.pageX,e.pageY,v.$container)}}),this.canHandleDragType=function(e){return"class_styles"===e},this.getSelectedClasses=function(){var t=[],s=pinegrow.findFrameworkByType("tailwind");return v?.visibleData&&v.visibleData.forEach(function(e){e.node instanceof PgActiveClassesForPgel_Class&&e.node.user_selected&&t.push((s?s.twGetClassInfo(e.node.class,null,!0):e.node).class)}),t},this.markInsertPositionInTree=function(e,t,s){var n,a,l,i=e;i&&!i.hidden?(l=0,"insertBefore"==t||"top"==t?(n=i.visible_idx,a=i.level):"insertAfter"==t||"bottom"==t?(n=i.visible_idx+1+v.getNumberOfDescendants(i.visible_idx,v.visibleData),a=i.level):"prepend"==t?(n=i.visible_idx+1,a=i.level+1,l=1):"append"==t&&(n=i.visible_idx+1+v.getNumberOfDescendants(i.visible_idx,v.visibleData),a=i.level+1,l=1),"self"===t?(v.showInsertionLineAt(-1),v.setEmptyLineAt(-1)):(v.showInsertionLineAt(n,a),v.setEmptyLineAt(n)),v.borderItem(i,l),s||v.scrollTo(i)):(v.showInsertionLineAt(-1),v.setEmptyLineAt(-1),v.borderItem(null))},new PgDragHelper(t,n?".pg-table-grid-cell":".disable---pg-table-grid-cell",null,!0));w.onGetDragImage=function(){return"none"},w.onBefore=function(e){return!!d(e).node?.classStyle},w.on("dragStart",function(e,t,s){$.fn.crsapages("showOverlays");for(var n=d(w.movedElement),a=pgCreate("<div>Dummy</div>"),l=((h=new PgDragMenu({name:"Props"},!0,!0,null,a,{dragType:"class_styles"})).draggedNode=n.node,$('<div class="pg-tree-drag-container with-tree"></div>')),i=1,o=n.level,r=0;r<i;r++){var c=v.createCellForData(v.data[n.idx+r]);c.setData(v.data[n.idx+r]),v.onSetDataToCell(v.data[n.idx+r],c),c.showAt((c.data.level-o)*v.levelPadding,r*v.cellHeight,l)}4<i&&$('<div class="pg-table-grid-cell"><name>+ '+(i-4)+" more</name></div>").appendTo(l).css({top:4*v.cellHeight+"px",left:(v.data[n.idx+4].level+1-o)*v.levelPadding+"px"}),l.css("height",Math.min(i,5)*v.cellHeight),h.addElement(l),h.movedPgel=a,h.pgel=a,v.dragStarted(n),h.handleMoveEvent(s,h),f.hide()},this),w.on("drag",function(e,t,s){h.handleMoveEvent(s,h)},this),w.on("dragStop",function(e,t){$.fn.crsapages("showOverlays",!0),v.dragStopped(),console.log(h.treeDropPosition);var s=h.treeDropPosition,n=h.draggedNode,a=s.data.node;h.clone;n?.classStyle&&a?.classStyle&&pinegrow.classStyles.moveStyleRelativeToStyle(n.classStyle,a.classStyle,s.position),h.destroy(),h=null,crsaFuncs.showInsertionLine(null),pinegrow.highlightElement(null)},this),p.onResize=function(){};const j=new ResizeObserver(function(){ae?ae=!1:(E=v.$element.get(0).getBoundingClientRect(),v.onRepaint(),v.updateLayout(),v.updateContainerSize(),v.refresh(),f.updateLayout())});j.observe(v.$element.get(0));function U(e,t,s){n||s&&s.source===m||m.show()}function Y(e,t,s){n||(s&&s?.source===m?m.refresh():ie())}function C(e){}function Q(e){m.show()}function X(e,t){}function q(e){}function K(e,t){}function J(e){E=v.$element.get(0).getBoundingClientRect();var t={left:e.pageX-E.left,top:e.pageY-E.top-0};if(re.track(e),D&&f.isHidden()&&f.show(),M&&(clearTimeout(M),M=null),t&&z){var s=v,n=s.getScrollOffset(),a=(t.top+=n.top,t.left+=n.left,3),l=5,n=s.getVisibleDataIndexForY(t.top,!0);if(0<=n)for(var i=s.getYForVisibleDataIndex(n),o=n;o<s.visibleData.length;){var r=s.getYForVisibleDataIndex(o);if(i<r)break;var c=s.visibleData[o].node;if("rule"!==c.type&&"decl"!==c.type&&"add_prop"!==c.type&&("comment"!==c.type||"rule"!==c.parent.type))break;var c=s.getXForVisibleData(s.visibleData[o]),d=s.getCellWidthForData(s.visibleData[o]),h=!0,u=c+d+9999;if(0!==d&&s.visibleData.length>o+1&&s.getYForVisibleDataIndex(o+1)===r&&(h=!1,u=s.getXForVisibleData(s.visibleData[o+1])),c<=t.left&&t.left<=u){var u=!1,g="bottom";if(h?(r+s.getCellHeightForData(s.visibleData[o])-a<=t.top||0!==d&&c+d-l<t.left)&&(u=!0):(g="right",(c+d-l<=t.left||c+d<=t.left)&&(u=!0)),u)return s.quickInsertLine.show(s.visibleData[o],s.visibleData[o].level,g),H||v.$container.addClass("with-insert-position"),void(H={data:s.visibleData[o],pos:g});break}o++}H&&v.$container.removeClass("with-insert-position"),H=null,s.quickInsertLine.show(null)}}function Z(e){v.highlightLevel(-1),v.quickInsertLine.hide(),M&&(clearTimeout(M),M=null),f.hide(),V&&V.$element.removeClass("hovered"),V=null}function ee(e){D&&f.show()}function te(e,t,s){n&&s?.source!==m&&m.show(null,!0)}var _,S,y,P,b,se,ne,k,E=v.$element.get(0).getBoundingClientRect(),T=function(e){v.showInsertionLineAt(-1),v.setEmptyLineAt(-1),v.borderItem(null),e?(e.setFilterOptions(i),u&&e.search(u),e.setTreeView(m),e.setTableGrid(v)):(D=null,v.setData([]),f.hide()),f.updateLayout()},A=null,ae=!1,x=(this.show=function(e,t){n?oe(e,t):ie(e)},this.refresh=function(){n?F?(A.create(F),T(A)):this.show(null,!0):(A.create(x),T(A))},null),le=null,F=null,ie=function(s){p.whenVisible(function(){E=v.$element.get(0).getBoundingClientRect();var e,t=pinegrow.selectedElements.getLastSelected();z=pinegrow.getSelectedPage(),t&&t.getPage()&&(e=new CrsaProfile(!0,"Show active classes"),x=new PgActiveClassesForPgel(t,m),A=new PgClassTree,u&&A.search(u),A.create(x),T(A),le!==t&&v.$element.scrollTop(0),le=t,e.show("Tree shown"),s)&&s()})},oe=function(s,n){p.clearWhenVisible(),p.whenVisible(function(){var e,i,o,r,t=new CrsaProfile(!0,"Show style class tree"),c=(E=v.$element.get(0).getBoundingClientRect(),[]),d=pinegrow.findFrameworkByKey("tw");d&&(e=pinegrow.selectedElements.getLastSelected(),i=null,e&&0===(i=pinegrow.classStyles.getStylesForPgel(e)).length&&(i=null),o={tree_view:m},b=[],P=[],r=pinegrow.classStyles.getCurrentStyle(),pinegrow.classStyles.getStyles().forEach(function(e){var t=new PgActiveClassesForPgel_ClassStyle(e,o),s=e.getClasses(),s=d.twSortClasses(s);i&&0<=i.indexOf(e)&&(P.push(e),t.matched=!0),r===e&&(P.push(e),t.selected=!0);for(var n={},a=0;a<s.length;a++){var l=d.twGetClassInfo(s[a],null,!0);l.values=d.twGetClassBaseAndOptions(l.class).values,t.addClass(l.state||"all",l.class,l),n[l.state||"all"]=!0}e.getForcedStates().forEach(function(e){n[e]||t.addState(e)}),c.push(t)})),A=new PgClassTree,u&&A.search(u),F=c,A.create(c),c.length?(g.show(null),T(A),n||v.$element.scrollTop(0),t.show("Tree shown")):(g.show(`<p>No styles are defined.</p><p class="buttons"><a class="btn pg-button external" href="https://pinegrow.com/docs/tailwind/class-styles/" target="_blank">Learn about styles</a></p>`),T(A)),s&&s()})},D=null,V=null,re=new PgMouseSpeed,H=null,M=null,I=(v.$element.on("mousemove",J),v.$element.on("mouseleave",Z),v.$element.on("mouseenter",ee),function(){var e;D&&(e=v.getScrollOffset(),e=v.getYForVisibleDataIndex(D.visible_idx)-e.top,f.showFor(e,e+v.cellHeight,D.selected||!1,D))});this.onSelected=function(e){D=e;var t=this.getPgel(e);t&&f.find("hide").find("i").removeClass("icon-hide icon-see").addClass(t.isHidden()?"icon-see":"icon-hide"),I()},this.onDeselected=function(e){pinegrow.selectedElements.hasSelection()||(D=null,f.hide())},pinegrow.addEventHandler("on_selected_elements_changed",Y),pinegrow.addEventHandler("on_page_changed",U),pinegrow.addEventHandler("on_page_loaded",C),pinegrow.addEventHandler("on_page_refreshed",C),pinegrow.addEventHandler("on_page_selected",q),pinegrow.addEventHandler("on_drag_drop_operation_done",K),pinegrow.addEventHandler("on_element_isolated",X),pinegrow.addEventHandler("on_page_frameworks_changed",Q),n&&(this.show(),_=function(e,t){p.whenVisible(function(){se(t?[t]:[])},"updateUsed",10)},S=function(e){},y=function(e,t){m.show(null)},b=P=null,se=function(e){var t;P&&(P.forEach(function(e){m.setSelectedForClassStyle(e,!1)}),P=null),e.forEach(function(e){m.setSelectedForClassStyle(e,!0)}),(P=e).length&&(t=A.getTreeDataItemForClassStyle(e[0]))&&v.scrollTo(t)},ne=function(e){b&&(b.forEach(function(e){m.setMatchedForClassStyle(e,!1)}),b=null),e.forEach(function(e){m.setMatchedForClassStyle(e,!0)}),b=e},k=function(e){p.whenVisible(function(){var e=pinegrow.selectedElements.getLastSelected(),e=e?pinegrow.classStyles.getStylesForPgel(e):[];ne(e)},"updateUsed")},pinegrow.addEventHandler("on_current_class_style_changed",_),pinegrow.addEventHandler("on_class_styles_changed",te),pinegrow.addEventHandler("on_page_frameworks_changed",S),pinegrow.addEventHandler("on_class_styles_updated_from_db",y),pinegrow.addEventHandler("on_selected_elements_changed",k)),p.onDestroy=function(){j.disconnect(),pinegrow.removeEventHandler("on_selected_elements_changed",Y),pinegrow.removeEventHandler("on_page_changed",U),pinegrow.removeEventHandler("on_page_loaded",C),pinegrow.removeEventHandler("on_page_refreshed",C),pinegrow.removeEventHandler("on_page_selected",q),pinegrow.removeEventHandler("on_drag_drop_operation_done",K),pinegrow.removeEventHandler("on_page_frameworks_changed",Q),pinegrow.removeEventHandler("on_element_isolated",X),pinegrow.removeEventHandler("on_class_styles_changed",te),v.$element.off("mousemove",J),v.$element.off("mouseleave",Z),v.$element.off("mouseenter",ee),n&&(pinegrow.removeEventHandler("on_current_class_style_changed",_),pinegrow.removeEventHandler("on_page_frameworks_changed",S),pinegrow.removeEventHandler("on_class_styles_updated_from_db",y),pinegrow.removeEventHandler("on_selected_elements_changed",k))}},PgClassTree=function(){var l,i,o={styles:!1,images:!1},r=!1,c=[],a={},d=(this.flag_expanded=null,this.flag_related=null,this.setFilterOptions=function(e){var t=r;r=!1,$.each(e,function(e,t){if(t)return r=!0}),o=e,m=t!==r},this.setTreeView=function(e){i=e},null),t=(this.setTableGrid=function(e){d=e,this.$element=d.$element,e.setData(c),m&&this.research()},$("<div/>").addClass("crsa-tree-branch pg-tree-ul"),this.$element=null,this.highlightOnMouseOver=!0,this.destroy=function(){nextFrame.cancelAll(),i=d=null,l&&l.destroy(),a=c=l=null},this.getDataFor$Element=function(e){return d.getDataFor$Element(e)},this.updatePgIdMap=function(){var e=new CrsaProfile;a={},c.forEach(function(e){e.pgid&&(a[e.pgid]=e)}),e.show("updatePgIdMap")},function(e){return a[e]||null});this.getTreeDataItemForPgId=function(e){return t(e)},this.getTreeDataItemForClassStyle=function(e){for(var t=0;t<c.length;t++)if(c[t].node.classStyle&&c[t].node.classStyle===e)return c[t];return null};const h=1,u=3,g=2;var p=null,m=(this.research=function(e){var t={selected_ids:{},changed:!1};(p||t.changed||r||e)&&this.search(p,!0,t)},!1),f=(this.search=function(e,t,s){var a,n;i?(m=!1,a=0<(e=null===e?"":e).length?new RegExp(escapeRegExp(e),"i"):null,p=e,(n=s||{selected_ids:{},changed:!1}).selected_ids,n=n.changed,e||n||r?l&&(c.forEach(function(e){e.search=0,e.peek_in&&(e.collapsed=!0,e.peek_in=!1)}),l.forEachWithParents(function(e,t){var s=!1;if(a&&!e.search_string.match(a)||(s=!0),s=r&&o.position?"decl"===e.node.type&&s&&null!==("_"+e.node.prop+"_").match(/_(top|right|bottom|left|position|z\-index)_/i):s){e.search=h;for(var n=t.length-1;0<=n&&t[n].search===u;n--)t[n].search=g,t[n].collapsed&&(t[n].peek_in=!0),t[n].collapsed=!1}else{e.search=u;for(n=t.length-1;0<=n&&t[n].search===h;n--)e.search=g}}),d.refresh()):(c.forEach(function(e){e.search=0,e.force_search=!1,e.peek_in&&(e.collapsed=!0,e.peek_in=!1)}),d.refresh())):(m=!0,p=e)},this.scrollToSelected=null,this.create=function(e){c=[],a={};var t=Array.isArray(e)?e:[e],s=t[0],n=new CrsaProfile(!0);t.forEach(function(e){f(c,e)}),1===t.length&&s.getParents&&s.getParents().forEach(function(e){f(c,e)}),n.show("create Class Tree "+c.length+" tree data items"),(l=new PgTreeDataHelper(c)).reindexData(),this.research()},this.getAllUserSelectedClasses=function(){for(var e,t=[],s=0;s<c.length;s++)c[s].node instanceof PgActiveClassesForPgel_Class&&c[s].node.user_selected&&(e=c[s].node.getClassWithSizeAndState(),t.indexOf(e)<0)&&t.push(e);return t},this.deselectAllClasses=function(){for(var e=0;e<c.length;e++)c[e].node instanceof PgActiveClassesForPgel_Class&&c[e].node.user_selected&&(c[e].node.user_selected=!1,c[e].cell)&&c[e].cell.onPopulate()},this.populateDataItem=function(e){e.populated||(e.node.populateDataItem(e),e.populated=!0)},this.createDataItem=function(t,e,s){var n={shown:!0,level:s=s||0,tags:"",search_string:""},n=(e.populateTreeFata(n),n.classes="sort",n.collapsed=v(e),n.no_sort=!1,t.push(n),e.getTreeChildren());n&&n.forEach(function(e){f(t,e,s+e.level_offset)})}),v=function(e){return!!e.classStyle&&!e.classStyle.expanded}};class PgFastDOMClassPreviewForElement{constructor(e,t){this.el=e,this.original=this.el.getAttribute("class"),this.prefix=t||"",this.my_last=this.original}setClass(e,t,s){var n=this;this.my_last,this.el.getAttribute("class"),this.restore(),s?s($(this.el),n.prefix+e):(t&&t.forEach(function(e){n.el.classList.contains(n.prefix+e.key)&&n.el.classList.remove(n.prefix+e.key),n.el.classList.contains("!"+n.prefix+e.key)&&n.el.classList.remove("!"+n.prefix+e.key)}),e&&e.split(/\s+/).forEach(function(e){e&&n.el.classList.add(n.prefix+e)})),this.my_last=this.el.getAttribute("class")}restore(){this.el.setAttribute("class",this.original),this.my_last=this.original}remember(){this.original=this.el.getAttribute("class"),this.my_last=this.original}}var pgActiveFastDOMClassPreviewForPgel=null;class PgFastDOMClassPreviewForPgel{constructor(e,t){this.enabled=!0,this.destroyed=!1,pgActiveFastDOMClassPreviewForPgel?this.enabled=!1:(this.pgel=e,this.page=e.getPage(),this.$elements=e.get$DOMElements(),this.list=this.$elements.map(function(e){return new PgFastDOMClassPreviewForElement(e?.tagName?e:e.get(0),t)}),this.hidden_menus=!1,this.prefix=t||"",pinegrow.dispatchEvent("on_fast_dom_class_preview_start",this.page,this.pgel))}triggerPreviewEvent(e,t){var s,n;this.enabled&&(s=this,n=t.map(function(e){return s.prefix+e.key}),e&&n.push(this.prefix+e),pinegrow.dispatchEvent("on_fast_dom_class_preview",this.page,this.pgel,this.prefix+e,n))}setClass(t,s,n){this.enabled&&!this.destroyed&&(this.hidden_menus||(pinegrow.selectedElements.temporaryHideMenus(!0),this.hidden_menus=!0),this.list.forEach(function(e){e.setClass(t,s,n)}),t)&&this.triggerPreviewEvent(t,s)}remember(){this.destroyed||this.enabled&&this.list.forEach(function(e){e.remember()})}showMenus(){this.enabled&&this.hidden_menus&&(pinegrow.selectedElements.restoreShowMenus(!0),this.hidden_menus=!1)}restore(){this.destroyed||this.enabled&&(this.list.forEach(function(e){e.restore()}),this.showMenus())}destroy(e){this.destroyed||this.enabled&&(e||this.restore(),this.showMenus(),pinegrow.dispatchEvent("on_fast_dom_class_preview_end",this.page,this.pgel),this.destroyed=!0,pgActiveFastDOMClassPreviewForPgel===this)&&(pgActiveFastDOMClassPreviewForPgel=null)}}class PgFastDOMClassPreviewForSelector extends PgFastDOMClassPreviewForPgel{constructor(n,e){super({getPage:function(){return pinegrow.getSelectedPage()},get$DOMElements:function(){for(var e=pinegrow.getSelectedPage().get$Html().get(0).querySelectorAll(n),t=[],s=0;s<e.length&&(t.push(e[s]),!(20<s));s++);return t}},e)}}class PgClassNamedCustomStates{constructor(){const e=this;this.map=null,this.list=null,pinegrow.addEventHandler("on_project_loaded",function(){e.map=null,e.list=null}),pinegrow.addEventHandler("on_page_frameworks_changed",function(){e.map=null,e.list=null})}getMap(){const t=this;return null===this.map&&(this.map={},this.list=[],pinegrow.dispatchEvent("on_get_class_named_custom_states",pinegrow.getSelectedPage(),this.list),this.list.forEach(function(e){e.states.forEach(function(e){t.map[e.state]=e.name})})),this.map}getNameForState(t){var s=this.getMap();if(0<=t.indexOf(":")){var n=splitBracketsAware(t,":");for(let e=0;e<n.length;e++)n[e]=s[n[e]]||n[e];return n.join(":")}return s[t]||t}isNamed(e){return this.getNameForState(e)!==e}getAsActions(s,n){return this.getMap(),this.list.map(function(e){const t=[];return e.states.forEach(function(e){t.push({label:e.name,key:e.state,check:n&&0<=n.indexOf(e.state),action:function(){s.call(this,e.state)},helptext:e?.helptext})}),{label:e.name,submenu:t}})}}class PgClassStateComposerDropdown{constructor(e,s){this.handle_building=!0,this.states=[],this.custom=null,this.order=[],this.all_states=["hover","focus","active","visited","disabled","group-hover","group-focus","group-active","group-visited","first","last","odd","even","dark","sm","md","lg","xl","2xl"],this.order=["dark","sm","md","lg","xl","2xl","hover","focus","active","visited","disabled","group-hover","group-focus","group-active","group-visited","first","last","odd","even"],this.screens=["sm","md","lg","xl","2xl"],this.popular_states=["hover","focus","active"],this.no_size=s,this.used_states=[],this.return_actions=!1;var n=pinegrow.findFrameworkByType("tailwind"),a=this;n&&e&&e.forEach(function(e){var t=n.twGetClassInfo(e,null,!0),t=s?t.whole_without_size:t.state;t&&a.used_states.indexOf(t)<0&&a.used_states.push(t)})}onChanged(){}isCustom(e,t){return!!this.handle_building&&!pinegrow.classNamedStates.isNamed(e)&&(0<=e.indexOf("[")||!(t.length<2)&&e!==this.getOrderedValue(t))}setValue(e){this.custom=null,this.handle_building?this.states=""===e?[]:splitBracketsAware(e,":"):this.states=""===e?[]:[e],this.isCustom(e,this.states)&&(this.custom=e)}getValue(){return this.custom||this.getOrderedValue(this.states)}getOrderedValue(e){return e.join(":")}editCustom(){var t=this,e="";this.custom&&(e=`<p>This is a custom variant. You can only edit it in text mode.</p>`),pinegrow.showPrompt(e+`<p>Variant:</p>`,"Edit custom variant",this.getValue(),"md:hover",null,function(e){t.setValue(e),t.onChanged()})}async edit(){return new Promise(function(e){pinegrow.showQuickDialog("Edit variant","","",{variant:{name:""}})})}show(e){var a=this;if(this.custom)this.editCustom();else{var t=[],s=function(){var e,s,n=this.key;return a.handle_building?0<=(e=a.states.indexOf(n))?a.states.splice(e,1):0<=a.screens.indexOf(n)?(s=!1,a.screens.forEach(function(e){var t;e!==n&&0<=(t=a.states.indexOf(e))&&(n&&"all"!==n?a.states[t]=n:a.states.splice(t,1),s=!0)}),s||a.states.unshift(n)):a.states.push(n):this.key?a.states=[this.key]:a.states=[],a.onChanged(),!1},n={},l=this.screens,i=this.all_states;var o=pinegrow.getSelectedPage(),o=(o&&(r={screens:this.screens,states:i},o.callFrameworkHandler("on_get_pseudo_states_for_pseudo_control",[],r),l=r.screens,i=r.states),this.handle_building||(t.push({label:"None",key:"",check:0===a.states.length,action:s}),t.push({type:"divider"})),this.used_states.length&&(t.push({type:"header",label:"Used variants"}),this.used_states.forEach(function(e){t.push({label:pinegrow.classNamedStates.getNameForState(e),action:s,key:e,check:0<=a.states.indexOf(e)})}),t.push({type:"divider"})),l&&!this.no_size&&(t.push({type:"header",label:"Screen sizes"}),l.forEach(function(e){t.push({label:e,action:s,key:e,check:0<=a.states.indexOf(e)}),n[e]=!0})),pinegrow.classNamedStates.getAsActions(s,a.states));if(o.length&&(t.push({type:"divider"}),o.forEach(function(e){t.push(e)})),t.push({type:"divider"}),t.push({label:"Custom variant...",action:function(){pinegrow.showPrompt(`<p>Enter the selector for targeted sub-elements (for example, <code>p</code> will target all <code>&lt;p&gt;</code> elements within the element that has this style).</p><p>If you wish to enter a non-sub-element custom variant, include brackets <code>[...]</code>.</p>`,"Enter sub-element selector or a full custom variant","","p",null,function(e){e&&(e.startsWith("[")||(e=pinegrow.classStyles.getCustomVariantForSelector(e)),a.setValue(e),a.onChanged())})}}),this.popular_states.length&&(t.push({type:"divider"}),t.push({type:"header",label:"Frequently used"}),this.popular_states.forEach(function(e){t.push({label:e,action:s,key:e,check:0<=a.states.indexOf(e)})})),i.length&&(t.push({type:"divider"}),t.push({type:"header",label:"All variants"}),i.forEach(function(e){n[e]||t.push({label:e,action:s,key:e,check:0<=a.states.indexOf(e)})})),t.push({type:"divider"}),t.push({label:"Edit...",action:function(){a.editCustom()}}),this.return_actions)return t;var r=new CrsaContextMenu(t,$(e.target)),l=r.addSmartInput();l.allow_custom_value=!0,l.onCustomValueSelected=function(e){s.call({key:e})},r.showAt(e.pageX,e.pageY)}}getActions(){this.return_actions=!0;var e=this.show();return this.return_actions=!1,e}}class PgClassStateComposerView{constructor(){this.$element=$(`<div class="pg-class-state-composer">
<div class="list"></div>
<div class="selected"></div>
</div>`),this.view=new PgUIView(this.$element),this.list_el=this.$element.find(".list")[0],this.selected_el=this.$element.find(".selected")[0];new PgDraggableReorder($(this.selected_el),"[data-item]",function(e,t,s){},function(e){return"move"})}setValue(e){const t=this;var s=e.split(":"),n="";s.forEach(function(e){n+=t.getPill(e)}),this.selected_el.innerHTML=n}getValue(){this.selected_el.querySelectorAll("[data-item]")}getPill(e){return`<div class="state_item" data-item="${e}" draggable="true">${e}</div>`}show(e){var t,s=pinegrow.getSelectedPage();s&&(t={screens:[],states:[]},s.callFrameworkHandler("on_get_pseudo_states_for_pseudo_control",list,t),this.setValue(e))}}var PgQuickStateComposer=function(){var e=new PgClassStateComposerView,t=new PgQuickWindow("Variant composer",e,"quickStateComposer",400,700);t.noRightEdge(),t.showAtPosition(800,0),e.show("md:hover:[&_h2]"),t.onDestroy=function(){}};$("body").one("pinegrow-ready",function(){var s;pinegrow.addEventHandler("on_key_pressed",function(e,t,s){"s"!==s.key||s.input||s.edit||!t.originalEvent.shiftKey?"s"!==s.key||s.input||s.edit||(new PgQuickClassTree,s.done=!0):(new PgQuickStyleClassTree,s.done=!0)}),pgIsDev()&&(s=new PgActiveClassesForPgel_State,[{i:"text-xl",o:"text-xl"},{i:"hover:text-xl",o:"hover:text-xl"},{i:"[&_h1]:text-xl",o:"text-xl"},{i:"[&_h1:hover]:text-xl",o:"hover:text-xl"},{i:"md:[&_h1:hover]:text-xl",o:"md:hover:text-xl"},{i:"md:[&_h1:hover:active:special]:text-xl",o:"md:hover:active:text-xl"}].forEach(function(e){var t=s.moveClassFromSubElementToDirectElement(e.i);t!==e.o&&console.error(`moveClassFromSubElementToDirectElement TEST: ${e.i} -> ${t} != `+e.o)}))});