var PgAttributesEditorView=function(e){function t(e,t,n){!t||t!=s||n&&n.source&&n.source==i||l(null,s)}var r=new PgApi,a=$('<div class="attributes-panel"></div>'),n=($('<div class="alert alert-info">This element has no attributes</div>').prependTo(a),new PgUIView(a)),i=(this.view=n,this),o={"add-new-placeholder-text":"Add attribute","item-length-to-add-placeholder":100},u=new PgFastEditor(a,o),s=(new CrsaSelectBox(a,{itemClass:"crsa-node-item"}),o.isAllowedToShow=function(e,t){return"data-pg-collapsed"!=e.trim()},o.onItemChanged=function(e,t,n,o){return"prop"==n&&r.removeAttribute(null,o,{source:i}),r.setAttribute(null,e,t=""===t?null:t,{source:i}),pinegrow.dispatchEventDelayedForObject(s,"on_prop_field_changed",null,s,{source:i}),!0},o.onItemAdded=function(e,t){return pinegrow.getSelectedElement()&&(r.setAttribute(null,e,t=""===t?null:t,{source:i}),pinegrow.dispatchEventDelayedForObject(s,"on_prop_field_changed",null,s,{source:i})),!0},o.onItemRemoved=function(e,t){return pinegrow.getSelectedElement()&&(r.removeAttribute(null,e,{source:i}),pinegrow.dispatchEventDelayedForObject(s,"on_prop_field_changed",null,s,{source:i})),!0},o.parseCodeAndGetArray=function(e){var t=pinegrow.getSelectedElement(),n=[];return t&&t.getAttrList().forEach(function(e){var t={prop:e.name,value:e.value||""};n.push(t)}),n},null),l=function(e,l){s=l,n.whenVisible(function(){if(l){for(var e=[],t=l.getAttrList(),n=[],o=0;o<t.length;o++){var r=t[o],i={prop:r.name,value:r.value||""};r.value&&(0<=r.value.indexOf(">")||0<=r.value.indexOf("<"))?e.push(r.name):n.push(i)}u.setList(n),u.show(),a.show(),e.length&&$('<div class="alert alert-info">Can\'t edit attributes with special characters: <span>'+e.join(", ")+"</span>. Please use element code edit.</div>").appendTo(a).prependTo(a)}else a.hide()})};this.show=function(e){l(null,e)};pinegrow.addEventHandler("on_page_changed",t),e&&n.on("crsa-element-selected",l),n.onDestroy=function(){pinegrow.removeEventHandler("on_page_changed",t)}},pgCreateAttributesEditorControl=function(){var e=new PgAttributesEditorView(!1),t=(e.view.alwaysVisible=!0,e.view.updateVisibility(),new PgCustomPropertyControl("pg-attribute-editor"));return t.onDefine=function(){},t.onShow=function(){return e.view.get$Element()},t.onSetValues=function(){e.show(t.obj)},t.onHasData=function(){return 0<t.obj.getAttrList().length},t};