var PgInfoPanelView=function(){var r=$('<div class="pg-info-viewer">\x3c!--<div class="pg-info-viewer-toolbar"></div>--\x3e<div class="pg-info-viewer-content"></div></div>'),l=r.find(".pg-info-viewer-content"),t=new PgUIView(r,"info"),g=(this.view=t,pgf.kids||(t.tabIcon="icon-274"),this.setContent=function(t,e,n){function i(t){0==$(t).closest(".gif_wrap,.full").length&&(t.style.width=t.naturalWidth/2+"px")}var a=pinegrow.findFrameworkByKey("pg.info.editor"),o=`<h1>__title__</h1><div>__content__</div>`,r=($.each(e,function(t,e){o=o.replace(`__${t}__`,e)}),o=o.replace(/([A-Za-z\+0-9]+)\_KEY([^\w])/g,function(t,e,n){return pgShowKbdCombo(e)+n}),o=pinegrow.tutorialsManager.addInteractiveElementsToHTML(o),l.html(o),l.find("[data-pginfo-tooltip]").each(function(t,e){var n=$(e),i=n.attr("data-pginfo-tooltip"),a=pgInfoPanelgetTooltipInfo(i);a&&(n.addClass("has-tooltip"),n.attr("title",a.text),n.attr("data-tooltip-key",i),n.attr("data-html","true"),n.attr("data-tooltip-action",""),a.icon)&&n.prepend($(`<i class="icon ${a.icon}" style="margin-right:4px;"></i>`))}),a&&l.find("[data-pginfo-selectui]").each(function(t,e){var n=$(e),i=a.ieGetSelectorForShowField(n);i&&(n.addClass("has-tooltip"),n.attr("title","Click to reveal on screen."),n.attr("data-tooltip-key",""),n.attr("data-tooltip-action","field"),n.attr("data-tooltip-action-param",i))}),addTooltip(l.find("[title]"),"title",{}),addTooltip(l.find("[data-pginfo-select]:not([data-pginfo-animation])"),"Click to select the element on the page."),addTooltip(l.find("[data-pginfo-animation]"),"Click to open the interaction."),l.find("img").not(".no-retina"));r.on("load",function(){i(this)}),r.each(function(t,e){e.naturalWidth&&i(e)}),n||l.scrollTop(0),crsaHandleExternalLinks(l)},this.get$Content=function(){return l},r.on("click","ol li",function(t){var e=$(this);e.closest("ol").find("> li.highlighted").removeClass("highlighted"),e.addClass("highlighted")}),r.on("click","[data-tooltip-key]",function(t){pinegrow.dispatchEvent("on_info_panel_tooltip_clicked",null,this,t)}),r.on("click","[data-pginfo-ai]",function(t){var e=$(this),n=(t.preventDefault(),e.attr("data-pginfo-ai")||e.html()),i=e.attr("data-pginfo-ai-action")||"transform";if(e.get(0).hasAttribute("data-pginfo-ai-followup"))pinegrow.pineCone.followUp(n);else{var a=new PgPineConeStoredCommand("Command",n,i),o=a.getMenuAction();if(o&&a.has_ref)return new CrsaContextMenu(o.submenu(),e).showAt(t.pageX,t.pageY),!1;a=pinegrow.pineCone.getCommand(null,n,i);a&&pinegrow.pineCone.run(a)}}),r.on("click","[data-pginfo-animation]",function(t){t.preventDefault();var i=$(this),a=i.attr("data-pginfo-animation");a&&setTimeout(function(){var t,e,n;t="animations",e=function(t){var e=t.get$Element().find(".pg-actions-assigned").find(`[data-action="${a}"]`),n=i.attr("data-pginfo-animation-index");(e=n?e.find(`[data-repeat-item="${n}"]`):e).length?pgScrollToItemInContainer(e,e.closest(".pg-grid"),!1,!0,function(){var t=i.attr("data-pginfo-animation-edit");if(n)switch(t){case"edit":e=e.find(".pg-button.edit");break;case"play":e=e.find(".pg-button.play");break;case"options":e=e.find(".pg-action-section > h6");break;case"enable_on":e=e.find(`.crsa-field-data-pg-md-`+n);break;case"trigger":e=e.find(`.crsa-field-data-pg-tr-`+n)}pgRevealElement(e)},-50):pinegrow.showQuickError("The action is not defined on the selected element")},n=pgUIViewManager.getView(t),pinegrow.showUIPanel(t,!1,!1,!1),setTimeout(function(){e(n)},50)},100)}),r.on("click","[data-pginfo-animation-timeline]",function(t){t.preventDefault();var e=$(this),n=pinegrow.findFrameworkByKey("pg.ia"),i=e.attr("data-pginfo-animation-timeline");if(i){var a,o,r=e.attr("data-pginfo-animation-timeline-param"),l=e.attr("data-pginfo-animation-timeline-extra");if(n.isTimelineEditorShown()){switch(i){case"track":a=`.pg-ae-tv-el-actors-list .pg-ae-tv-el-actor:nth-child(${r})`,o="The track is not displayed.";break;case"transform":a=`.pg-ae-tv-el-timelines .pg-ae-el-tl:nth-child(${r}) .pg-ae-timeline-visual-kf:eq(${parseInt(l)-1})`,o="The transform is not displayed.";break;case"edit_transform":a=`.pg-ae-t-view`,o="The Edit transform dialog is not displayed";break;case"edit_transform_add":a=`.pg-ae-t-view .props > .pg-button`,o="The Edit transform dialog is not displayed"}0===(e=$(a)).length?pinegrow.showQuickError(o):pgRevealElement(e)}else pinegrow.showQuickError("The Timeline editor is not open. Click on Edit animation to open it.")}}),r.on("click","[data-select],[data-pginfo-select]",function(t){t.preventDefault();function e(){pinegrow.getShowDisplayHelpers()||pinegrow.setShowDisplayHelpers(!0,!1);var t,e=pinegrow.getSelectedPage(),n=e.activeView.get$Html().find(i);(t=(t=n.length?getElementPgNode(n,!0):t)||e.sourceNode.findOne(i))?(t.scrollTo(),pinegrow.selectElement(t),a||setTimeout(function(){pgRevealElement(e.$page.find(".pg-hl-select.crsa-hl-size-sel:visible"))},50)):pinegrow.showQuickError(`Can't find this element on the page.`)}var i=this.getAttribute("data-pginfo-select")||this.getAttribute("href"),n=this.getAttribute("data-pginfo-select-page")||this.getAttribute("data-page"),a="true"===this.getAttribute("data-pginfo-select-no-reveal");this.getAttribute("data-select-multiple");n?pinegrow.openOrShowPage(pinegrow.getCurrentProject().getAbsoluteUrl(n),function(){e()},!0):e()}),null),s=new PgDragHelper(l,".pg-info-panel-lib-button-code,.pg-info-panel-draggable",null,!0);s.on("dragStart",function(t,e,n){$.fn.crsapages("showOverlays");var i=s.dragTarget,i=pgDecodeAttribute(i.attr("data-code")),i=pgCreate(i),a=null,o=pinegrow.getSelectedPage();o&&(a=o.getMainType(null,i)),(g=new PgDragMenu(a,!1,!0)).pgel=i,g.selectNew=!0,g.handleMoveEvent(n,g),r.trigger("pg-drag-start")},this),s.on("drag",function(t,e,n){g.handleMoveEvent(n,g)},this),s.on("dragStop",async function(t,e){$.fn.crsapages("showOverlays",!0);var n=await g.insertAsync(),i=s.dragTarget.attr("data-target-selector"),a=s.dragTarget.attr("data-place-error");i&&n&&g.inserted_elements.getLength()&&g.inserted_elements.forEachElement(function(t){t.is(i)||(a=a||"The element was dropped in the wrong location.",pinegrow.showAlert(`<p>${a}</p><p>To fix the issue rearrange elements in the <b>Structure panel</b> or use <b>Undo</b> and drag the element again.</p>`,"Oops... The element is not in the right place!",null,"Got it!"))}),g.destroy(),g=null,crsaFuncs.showInsertionLine(null),pinegrow.highlightElement(null),r.trigger("pg-drag-stop")},this),t.onResize=function(){},t.onDestroy=function(){}};