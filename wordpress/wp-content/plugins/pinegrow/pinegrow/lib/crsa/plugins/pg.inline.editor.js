var PgSpecialChars=function(){var t=[{name:"Space",chars:[" ","&nbsp;"]},{name:"Quotes",chars:['&quot;|"',"&apos;|'","&ldquo;|‚Äú","&rdquo;|‚Äù","&bdquo;|‚Äû","&lsquo;|‚Äò","&rsquo;|‚Äô","&sbquo;|‚Äö","&laquo;|¬´","&raquo;|¬ª","&lsaquo;|‚Äπ","&rsaquo;|‚Ä∫","&lang;|‚ü®","&rang;|‚ü©"]},{name:"Arrows",chars:["&uarr;|‚Üë","&darr;|‚Üì","&larr;|‚Üê","&rarr;|‚Üí","&harr;|‚Üî","&larr;|‚áê","&rarr;|‚áí","&harr;|‚áî"]},{name:"Symbols",chars:["&ndash;|‚Äì","&mdash;|‚Äî","&hellip;|‚Ä¶","&amp;","&copy;|¬©","&reg;|¬Æ","&bigstar;|‚òÖ","&euro;|‚Ç¨","&cent;|¬¢","&pound;|¬£","&yen;|¬•","&para;|¬∂","&permil;|‚Ä∞"]},{name:"Bullets",chars:["&bull;|‚Ä¢","&middot;|¬∑","&sdot;|‚ãÖ"]},{name:"Emojis",chars:["&#128522;|üòä","&#128512;|üòÄ","&#128513;|üòÅ","&#128514;|üòÇ","&#128521;|üòâ","&#128528;|üòê","&#128533;|üòï","&#127794;|üå≤"]}],i=!1,o={},r=null;this.getChars=function(){var n,e;return i||(i=!0,n=[],t.forEach(function(e){e.chars=e.chars.map(function(e){var t;return 0<=e.indexOf("|")?(t=e.split("|"),o[t[1]]=t[0],n.push(escapeRegExp(t[1])),t[0]):e})}),e=`(${n.join("|")})`,r=new RegExp(e,"g")),t},this.replaceCharsWithEntities=function(e){return i||this.getChars(),e.replace(r,function(e,t){return o[e]})}},pgSpecialChars=new PgSpecialChars,PgQuickTextEdit=function(e){var t=new PgTextEditView,n=new PgQuickWindow("Edit text for "+e.getName({short:!0}),t,"quickTextEdit",640,320);n.showForPgel(e),t.show(e),n.onDestroy=function(){}},PgTextEditView=function(){function e(e,t,n){}function t(e,t,n){t!=i||n.source&&n.source}var i,n,o=$('<div class="pg-text-edit"></div>'),r=$('<div class="pg-text-edit-editor"></div>').appendTo(o),o=new PgUIView(o);this.view=o,this.show=function(e){n=e.getPage(),i=e,r.html(n.getViewInnerHTMLForElement(e,!0)),r.editor({iframe:!0,toolbarButtons:["undo","redo","|","bold","italic","underline","strikeThrough","subscript","superscript","outdent","indent","clearFormatting","insertTable","html","insertImage","insertLink"]})};o.onResize=function(){},pinegrow.addEventHandler("on_element_selected",e),pinegrow.addEventHandler("on_page_changed",t),o.onDestroy=function(){pinegrow.removeEventHandler("on_element_selected",e),pinegrow.removeEventHandler("on_page_changed",t)}},PgInlineEditorManager=function(){var o=this,h=null,g=null,p=null,m=null,e=0,r=!1,b=(this.domHtmlToSource=function(e,t,n){void 0===n&&(n=!1);var i=new pgParser;return i.assignIds=n,i.replaceExistingIds=!0,i.parse(e),i.rootNode.find(".pinegrow-ui-helper").forEach(function(e){e.remove()}),i.rootNode.walkSelfAndChildren(function(e){if(e.isElement){if(e.removeAttribute("data-pg-id"),e.removeAttribute("data-pg-tree-id"),e.removeClass("crsa-selected"),e.removeAttrIfStartsWith("data-pg-temp-id-"),"_pg_blank"==e.getAttribute("target")&&e.removeAttribute("target"),"pinegrow/disabled"==e.getAttribute("type")&&e.removeAttribute("type"),e.hasAttribute("data-pg-inline-edit-remove"))return e.remove(),!0;for(var t=e.getAttrList(),n=0;n<t.length;n++)t[n].name.startsWith("pg-disabled-")&&(t[n].name=t[n].name.replace(/^pg\-disabled\-/,""),e.attrListChanged=!0);for(var i=null,o=null,r=["src","href","action"],n=0;n<r.length;n++){var a=e.getAttribute(r[n]);if(null!==a&&a.length){i=a,o=r[n];break}}o&&e.setAttribute(o,pinegrow.getOriginalUrl(i))}else e.textNode&&e.content&&(e.content=pgSpecialChars.replaceCharsWithEntities(e.content));return!0}),t&&(t.rootNode=i.rootNode),n?i.rootNode.toStringWithIds(!0,pinegrow.getFormatHtmlOptions()):i.rootNode.toStringOriginal(!0,pinegrow.getFormatHtmlOptions())},this.isTextMode=function(){return r},this.setTextMode=function(e,t,n){var i;r=e,n||(e?(i=pinegrow.selectedElements.getLastSelected())&&this.edit(i.get$DOMElement()):this.stop()),t!=this.textButton&&this.textButton.setActive(r),pinegrow.selectedElements.setShowMenus(!r)},pinegrow.addEventHandler("on_element_selected",function(e,t,n){var i;r&&pgf.auto_text_edit_done&&m!==t?o.stop():r&&(t?n&&n.sourceType&&"undo"==n.sourceType&&t==m||(canMakeChange(t,"edit_content",null,!0)?!(i=n&&n.clicked_element?n.clicked_element:t.get$DOMElement())||o.is$ElementInsideEdited(i)&&0||o.edit(i,!1,n&&n.source,n&&n.event?n.event:null):(pinegrow.showQuickError("This element is not editable in Text editing mode."),o.stop())):o.stop())}),this.is$ElementEdited=function(e){return e.is('[contentEditable="true"]')},this.is$ElementInsideEdited=function(e){return 0<e.closest('[contentEditable="true"]').length&&!e.is('[contentEditable="true"]')},this.getEditorId=function(){return"pgte_"+e++},!0);this.edit=function(e,t,n,i,o){var r=getElementPgNode(e);if(t&&e.closest('[contentEditable="true"]').length)return!0;this.stop(),this.setTextMode(!0,null,!0);try{var a=e.get(0),s=(a.parentNode||(a=a.ownerDocument.documentElement.querySelector('[data-pg-id="'+r.getId()+'"]'),e=$(a)),p=(m=r).getPage()),l=g=s.getPageViewOf$DOMElement(e),d={allowed:!0,msg:""};if(s.callFrameworkHandler("on_before_inline_edit",e,d),!d.allowed)return pinegrow.showQuickError(d.msg),this.stop(),this.setTextMode(!1,null,!0),null;var u=new PgInlineEditor(r,l,e,b),c=u.startEdit(n,i,o);if(!0===c)h=u,b=!1;else{if("object"==typeof c)return this.edit(c,t,n);if("code"===c)return u.destroy(),this.stop(),this.setTextMode(!1,null,!0),pinegrow.editElementCode(r),c;if("exit"===c)return this.stop(),this.setTextMode(!1,null,!0),null}return c}catch(e){}},this.stop=function(e){var t=void 0===e;e&&(e instanceof PgPageView?t=e===g:e instanceof CrsaPage&&(t=e===p)),h&&t&&(h.destroy(),pinegrow.dispatchEvent("on_inline_editing_done",p,m),pinegrow.selectedElements.isSelectedElement(m)&&pinegrow.selectedElements.updateMenuForPgel(m),m=h=null,pinegrow.inlineEditManager.textButton)&&pinegrow.inlineEditManager.textButton.setActive(!1)},this.isInEdit=function(){return null!=h},this.getPage=function(){return m?m.getPage():null},this.getEditedPgel=function(){return m}},PgInlineEditor=function(h,g,p,m){function b(e){C=null,e||_.find("br").each(function(e,t){var n=$(t);t.hasAttribute("data-pg-id")||0===n.next().length&&n.attr("data-pg-inline-edit-remove","true")});var t=E.getContent();n(t),pinegrow.highlightElement(null)}var f,w,E,i=this,v=null,o=h.html(null,!0),_=null,x=h.getPage(),y=p.closest("html"),k=null,P="##PGSPLITHERE_DO_UNDO_ONE_MORE_TIME##",v=$('<div class="pg-inline-edit-toolbar"></div>').appendTo(g.getPageParent$Body()),n=function(e){var t={},n=(e=pinegrow.inlineEditManager.domHtmlToSource(e,t,!0),pinegrow.undoManager.getHistoryForPage(x).ignore(function(){h.withEmitEvent(function(){for(;h.children.length;)h.children[0].remove();for(var e=0;e<t.rootNode.children.length;e++)h.addChild(t.rootNode.children[e]);var n=_.get(0);h.mapIdsToDomElement(n);["href","target"].forEach(function(e){var t=n.getAttribute(e);"target"===e&&"_pg_blank"===t&&(t=null),h.getAttribute(e)!==t&&(n.hasAttribute(e)?h.setAttribute(e,t):h.removeAttribute(e))})},"html",{html:e,sourcePageView:g})}),new PgNodeEvent(h,"updateInner",null,{oldValue:o.replace(P,"")},x)),n=new PgUndoEvent(n);pinegrow.undoManager.getHistoryForPage(x).addEvent(n),h.hasClass("pg-empty-placeholder")&&h.removeClass("pg-empty-placeholder"),pgf.empty_ph_attribute&&h.hasAttribute(pgf.empty_ph_attribute)&&h.removeAttribute(pgf.empty_ph_attribute),pinegrow.changeManager.didChange(h,"Inline text edit",{source:i,undoCombineKey:"inline_edit"}),o=h.html(null,!0)},C=null,M=!1,I=(this.startEdit=function(e,t,n){if(pinegrow.stats.using("edit.inlinetext"),!canMakeChange(h,"edit_content"))return!1;if(h.containsServerSideScripts(!0))return pinegrow.showQuickMessage("The element contains Server side code. Using <b>Edit code</b>...",3e3,!1),"code";_=p.closest("div,body,label,section,table,[data-pgc-field],[data-pgc-edit]"),0==(_=p).length&&(_=p);var i=!1;_.parents("p").length&&(i=!0);_.closest("span,b,strong,em,i").length&&(i=!0);if(_.closest("h1,h2,h3,h4,h5,h6").length&&0,(_=_.is("img")&&!_.is("[data-pgc-field],[data-pgc-edit]")?_.parent():_).find("php").length){for(var o=p;o.get(0)!=_.get(0)&&0==o.parent().find("php").length;)o=o.parent();_=o}var r,l,a,s,d,u,c=getElementPgNode(_);if(!(0<=["html","head","aaabody"].indexOf(c.tagName))){if((pgNodeContainsDynamic(_)||!c)&&!n)if(_=p,c=getElementPgNode(_),pgNodeContainsDynamic(_)||!c)return r=showAlert('<p>Editing this element is not recommended because:</p><ul><li>The element contains dynamic elements that were created by JavaScript code.</li><li>The HTML code is not valid (for example, a tag is not closed or a H1 is nested inside a P element).</li></ul><p>You can use Page -&gt; Edit code to edit the code of the whole page.</p><p>Or, chose "Edit anyway" option, but note that it can lead to unintended results. Use Undo if things go wrong.</p>',"Can not edit this element",null,"OK, Do not edit"),$('<button type="button" class="btn btn-default btn-sm">Edit anyway</button>').insertBefore(r.find("button.ok")).on("click",function(e){e.preventDefault(),r.modal("hide"),pinegrow.inlineEditManager.edit(_,!1,!1,t,!0)}),"exit";return _.get(0)!=p.get(0)?_:((x.javascriptEnabled||_.find(".pinegrow-ui-helper").length)&&(d=function(e){return e=(e=e.replace(/[\s\n\r]/g,"")).replace(/data\-pg\-[a-z\-]*\="[^"]*"/g,"")})(u=x.getViewInnerHTMLForElement(c,!0))!=d(_.html())&&_.html(u),_.is("button")&&_.on("keydown.inlineedit",function(e){" "==e.key&&(MediumEditor.util.insertHTMLCommand(e.target.ownerDocument," "),e.preventDefault())}),k=new PgPositionNextToPage$El(g,v,_,null,12,!0,!0),d=g.get$Page(),w=pinegrow.inlineEditManager.getEditorId(),d.attr("id",w),f=$("<style></style>").appendTo(d),g.addViewChangeHandler(I,!0),["phraseBold","phraseItalic","phraseUnderline","phraseSpan","pgAnchor","pgInsertSpecialChar","pgInsert","pgExitEdit"],u=[],0==_.closest("b,strong").length&&u.push("phraseBold"),0==_.closest("em,i").length&&u.push("phraseItalic"),u.push("phraseUnderline"),u.push("phraseSpan"),u.push("phraseCode"),0!=_.closest("a").length&&!_.is("a")||u.push("pgAnchor"),u.push("pgInsertSpecialChar"),u.push("pgExitEdit"),m&&u.push("pgInstructionsEdit"),d={elementsContainer:d.get(0),contentWindow:g.getWindow(),ownerDocument:g.getDocument(),spellcheck:!1,toolbar:{buttons:u,static:!0,relativeContainer:v.get(0),sticky:!0,updateOnEmptySelection:!0},paste:{cleanPastedHTML:!0,forcePlainText:!0},anchorPreview:!1,extensions:{pgExitEdit:new PgInlineEditExitButton,pgInsert:new PgInlineEditInsertButton,pgInsertSpecialChar:new PgInlineEditInsertSpecialCharButton,pgAnchor:new PgInlineEditAnchor,pgInstructionsEdit:new PgInlineEditInstructionsButton,phraseSpan:new MediumEditorPhrase({name:"phraseSpan",phraseTagName:"span",aria:"span",contentDefault:"span",phraseClassList:[]}),phraseCode:new MediumEditorPhrase({name:"phraseCode",phraseTagName:"code",aria:"code",contentDefault:"code",phraseClassList:[]}),phraseBold:new MediumEditorPhrase({name:"phraseBold",phraseTagName:"b",aria:"b",contentDefault:"<b>B</b>",phraseClassList:[]}),phraseItalic:new MediumEditorPhrase({name:"phraseItalic",phraseTagName:"i",aria:"i",contentDefault:"<b><i>I</i></b>",phraseClassList:[]}),phraseUnderline:new MediumEditorPhrase({name:"phraseUnderline",phraseTagName:"u",aria:"u",contentDefault:"<b><u>U</u></b>",phraseClassList:[]})}},u=!1,s=0<=(_.css("display")||"").indexOf("inline"),a="p,a,span,button,h1,h2,h3,h4,h5,h6",d.paste.unwrapTags=["div","code"],(i||_.is(a)||_.closest(a).length||s)&&(u=!0,d.paste.unwrapTags.push(_.get(0).tagName)),E=new MediumEditor(_.get(0),d),v.find(".medium-editor-instructions").parent().addClass("medium-editor-instructions-parent"),pinegrow.dispatchEvent("on_inline_edit_started",x,h,_),l=M=!1,(u||i)&&E.subscribe("editableKeydownEnter",(function(e,t){e.shiftKey?l=!0:(i||(pgf.auto_text_edit_done&&0?E.options.ownerDocument.execCommand.apply(E.options.ownerDocument,["insertHTML",!1,"<br>"]):(MediumEditor.selection.getSelectionStart(E.options.ownerDocument),M=!0,MediumEditor.util.insertHTMLCommand(E.options.ownerDocument,P))),e.preventDefault())}).bind(E)),e||(a=pg_app_win_ignore_focus_blur,pg_app_win_ignore_focus_blur=!0,E.events.focusElement(_.get(0)),pg_app_win_ignore_focus_blur=a),E.subscribe("editableInput",(function(e,t){MediumEditor.selection.getSelectionStart(E.options.ownerDocument);C&&(clearTimeout(C),C=null);var n,i,o,r,a,s=l;l=!1,M?(b(s),n=P,pinegrow.inlineEditManager.stop(),i=c.html(null,!0),1<(o=i.split(n)).length&&(c.withoutEvents(function(){c.html(i.replace(n,""))}),c.html(o[0])),r=new PgApi,a=null,r.duplicateElements(c,function(e){var t;e.forEachElement(function(e,t){e.html(o[1]),a=a||e}),a&&(t=a.get$DOMElement(y))&&(pinegrow.selectElement(a,null,!1,t),pgf.auto_text_edit_done)&&pinegrow.inlineEditManager.edit(t)})):C=setTimeout(function(){b(s)},50)}).bind(E)),t&&0&&(s=g.getDocument(),d={left:t.clientX,top:t.clientY},s.elementFromPoint(d.left,d.top))&&(u=s.caretRangeFromPoint(d.left,d.top))&&((sel=g.getWindow().getSelection()).removeAllRanges(),sel.addRange(u)),!0)}pinegrow.showQuickError("Text editing mode is on. Can't edit text of "+c.tagName.toUpperCase()+" element."+("body"==c.tagName?" Select a sub-element.":""))},function(e,t,n){k&&(e instanceof PgPageView&&(e.isVisible()?pg$Show:pg$Hide)(v),k.reposition())});pinegrow.addEventHandler("on_page_changes_done",I),this.destroy=function(){C&&(clearTimeout(C),C=null,b()),E&&(E.destroy(),_.removeAttr("contenteditable"),k.destroy(),f.remove(),v.remove(),_.off("keydown.inlineedit")),g.removeViewChangeHandler(I),pinegrow.removeEventHandler("on_page_changes_done",I)}},PgInlineEditExitButton=MediumEditor.Extension.extend({name:"pgExitEdit",init:function(){this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.classList.add("pg-text-edit-menu-done"),this.button.innerHTML=`<b>Done <input type="checkbox" ${pgf.auto_text_edit_done?"checked":""} style="position: relative;top: 2px;margin-left: 4px;margin-top:0;"></b>`,this.checkbox=this.button.querySelector("input"),this.on(this.checkbox,"click",function(e){e.stopPropagation()});var t=this;this.on(this.checkbox,"change",function(e){e.stopPropagation(),pgf.auto_text_edit_done=t.checkbox.checked,pinegrow.setSetting("auto-text-edit-done",pgf.auto_text_edit_done?"1":"0"),pinegrow.showMode("Exit text editing when selecting another element",pgf.auto_text_edit_done)}),this.on(this.button,"click",this.handleClick.bind(this)),addTooltip($(this.button),"Exit the text editing mode.<br>Check the checkbox to auto-exit when selecting another element. Uncheck it to keep the text editing mode active when moving between elements.")},getButton:function(){return this.button},handleClick:function(e){pinegrow.inlineEditManager.setTextMode(!1)}}),PgInlineEditInsertButton=MediumEditor.Extension.extend({name:"pgInsert",init:function(){this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.innerHTML="<b>Insert</b>",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},handleClick:function(e){pinegrow.showQuickInsert(pinegrow.inlineEditManager.getEditedPgel(),$(this.button))}}),PgInlineEditInsertSpecialCharButton=MediumEditor.Extension.extend({name:"pgInsertSpecialChar",init:function(){this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.classList.add("pg-insert-char-menu-link"),this.button.innerHTML="<b>&bigstar;</b>",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},handleClick:function(e){function n(){MediumEditor.util.insertHTMLCommand(t.document,this.char)}var t=this,i=$(this.button),o=pgSpecialChars.getChars(),r=[],a={" ":"Regular","&nbsp;":"Non-breaking"};o.forEach(function(e){var t=e.chars.map(function(e){return{label:a[e]||`<span style="font-size:16px;">${e}</span>`,char:e,action:n}});r.push({label:e.name,submenu:[{buttons:t}]})}),new CrsaContextMenu(r,i).showForElement(i,null,12),e.stopImmediatePropagation(),e.stopPropagation()}}),PgInlineEditInstructionsButton=MediumEditor.Extension.extend({name:"pgInstructionsEdit",init:function(){this.button=this.document.createElement("div"),this.button.classList.add("medium-editor-action"),this.button.classList.add("medium-editor-instructions"),this.button.innerHTML=pgShowKbdCombo("SHIFT + ENTER")+" to insert &lt;br&gt; line break. "+pgShowKbdCombo("ESC")+" to exit text mode.",this.on(this.button,"click",function(e){e.preventDefault()});var e=this;setTimeout(function(){e.button&&e.button.parentNode&&e.button.parentNode.classList.add("animated")},5e3)},getButton:function(){return this.button}}),pgCreateAnchorControl=function(){var t=new PgCustomPropertyControl("html-anchor-control"),n={type:"text",name:"Href",placeholder:"http://example.com",action:"element_attribute",attribute:"href"},i={type:"text",name:"Label",placeholder:"Link name",action:"element_html"},o={type:"select",name:"Open in",action:"element_attribute",attribute:"target",show_empty:!0,options:[{key:"_blank",name:"New window"}]};return t.keyHref="html-anchor-control-href",t.keyLabel="html-anchor-control-label",t.keyTarget="html-anchor-control-target",t.onDefine=function(){this.registerInputField(t.keyHref,n),this.registerInputField(t.keyLabel,i),this.registerInputField(t.keyTarget,o)},t.onShow=function(){var e=$("<div></div>");return this.showInputField(e,t.keyHref,n),this.showInputField(e,t.keyLabel,i),this.showInputField(e,t.keyTarget,o),e},t.onSetValues=function(){},t},PgAnchorView=function(s,e){function t(e,t){o.whenVisible(function(){}),0}function n(e){var t,n,i,o,r,a;e&&e.preventDefault(),s&&(t=u.getValue(t),n=c.getValue(n),i=h.getValue(i),t.length)&&(o="#pgtempurl_"+Math.random(),d?d.setAttribute("href",o):(r={value:o},(a=MediumEditor.selection.getSelectionStart(s.document))&&(a===s.base.elements[0]||s.base.elements[0].contains(a))||MediumEditor.selection.selectNode(s.base.elements[0],s.document),s.execAction("createLink",r),d=MediumEditor.selection.getSelectionStart(s.document)),a=d,(a=s.base.elements[0].getAttribute("href")===o?s.base.elements[0]:s.base.elements[0].querySelector(`a[href="${o}"]`))&&(a.setAttribute("href",t),i?a.setAttribute("target",i):a.removeAttribute("target"),n.length)&&(a.innerHTML=n),s.base.events.triggerCustomEvent("editableInput",{},MediumEditor.selection.getSelectionElement(s.window))),l.win&&l.win.destroy()}var i=$('<div class="pg-anchor"></div>'),o=new PgUIView(i),l=(this.view=o,this),d=(this.win=null,null),r=pinegrow.inlineEditManager.getPage(),u=new PgInputField("href",{type:"text",name:"Href",file_picker:!0,file_picker_parent_url:r?r.url:null,placeholder:"http://example.com"}),c=(u.appendTo(i),new PgInputField("linklabel",{type:"text",name:"Label"})),h=(c.appendTo(i),new PgInputField("target",{type:"select",show_empty:!0,name:"Open in",options:[{key:"_blank",name:"New window"}]})),r=(h.appendTo(i),this.show=function(e){var t,n,i="",o="",r="";d=null,s&&("a"===(t=MediumEditor.selection.getSelectionRange(s.document)).startContainer.nodeName.toLowerCase()?d=t.startContainer:"a"===t.endContainer.nodeName.toLowerCase()?d=t.endContainer:(n=MediumEditor.util.getClosestTag(MediumEditor.selection.getSelectedParentElement(t),"a"))&&(d=n),d?(i=(n=getElementPgNode($(d))).html(),r=n.getAttribute("href"),o=n.getAttribute("target"),g.show(),a.text("Save changes")):t.collapsed||(i=MediumEditor.selection.getSelectionHtml(s.document),i=pinegrow.inlineEditManager.domHtmlToSource(i),g.hide())),u.setValue(r),c.setValue(i),h.setValue(o),u.focus()},$('<div class="pg-field-buttons"></div>').appendTo(i)),a=$('<button class="pg-button pg-button-primary">Create link</button>').appendTo(r),g=(a.on("click",n),this.onEnter=function(){return n(),!1},$('<button class="pg-button">Remove the link</button>').appendTo(r));g.on("click",function(e){var t;e&&e.preventDefault(),s&&(MediumEditor.selection.getSelectionRange(s.document).collapsed?s.base.elements[0]===d?(t=getElementPgNode($(d)),pinegrow.inlineEditManager.stop(),crsaFuncs.detagElement(t)):((t=$(d)).contents().insertBefore(t),t.remove(),s.base.checkContentChanged()):s.execAction("unlink")),l.win&&l.win.destroy()}),o.onResize=function(){},pinegrow.addEventHandler("on_element_selected",t),o.onDestroy=function(){pinegrow.removeEventHandler("on_element_selected",t),l.win=null}},PgQuickAnchor=function(e,t,n){var i=new PgAnchorView(t),o=new PgQuickWindow("Edit link",i,"quickAnchor",400,190);this.win=o,(i.win=o).onEnter=function(){return i.onEnter()},o.showFor$El(n),i.show(e)},PgInlineEditAnchor=MediumEditor.Extension.extend({name:"pgAnchor",init:function(){this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.classList.add("pg-text-edit-menu-link"),this.button.innerHTML="<b>Link</b>",this.on(this.button,"click",this.handleClick.bind(this)),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},getButton:function(){return this.button},handleClick:function(e){e.preventDefault(),e.stopPropagation();MediumEditor.selection.getSelectionRange(this.document);return this.aqw=new PgQuickAnchor(null,this,$(this.button)),this.aqw.win.onDestroy=(function(){this.aqw=null}).bind(this),!1},handleKeydown:function(e){MediumEditor.util.isKey(e,MediumEditor.util.keyCode.K)&&MediumEditor.util.isMetaCtrlKey(e)&&!e.shiftKey&&this.handleClick(e)},destroy:function(){this.aqw&&this.aqw.win.destroy()},isAlreadyApplied:function(e){return"a"===e.nodeName.toLowerCase()},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}});