var PgResourceEditor=function(c){function l(){var e=c.getProjectInfo().getSetting("project_resources");return e||[]}function r(e){e.preventDefault();var t=$(this).parents("tr");g(parseInt(t.attr("data-index")))&&m()}function n(e){e.preventDefault();var t=$(this).parents("tr"),t=y[parseInt(t.attr("data-index"))];$(this).is(":checked")?t.footer=!0:t.footer=!1}function o(e){e.preventDefault();var t=$(this).parents("tr"),a=y[parseInt(t.attr("data-index"))],t=(a.type=$(this).val(),t.find('input[type="checkbox"]'));a.type==v["Javascript"]?t.removeAttr("disabled"):t.attr("disabled","disabled")}function i(e,t){for(var a="",r=e.url,n=e.footer,o=e.type||"auto",l=((l=crsaGetExtFromUrl(r))&&"js"==l.toLowerCase()||(a+=' disabled="disabled"'),n&&(a+=' checked="checked"'),crsaMakeFileFromUrl(r)),i=(crsaIsAbsoluteUrl(r)||(l=c.getAbsolutePath(crsaMakeFileFromUrl(r))),r=crsaGetSummaryStr(r,60),"dir"==crsaIsFileOrDir(l)&&(r+=" [Folder]"),""),d=0;d<b.length;d++){var s=b[d];i+='<option value="'+s.key+'"'+(s.key==o?"selected":"")+">"+s.name+"</option>"}n=$('<tr data-index="'+t+'"></tr>').appendTo(p),$("<td><label>"+r+"</label></td>").appendTo(n),$('<td><select class="url-type">'+i+"</select></td>").appendTo(n),$('<td style="text-align:center;"><input type="checkbox" value="1" '+a+"/></td>").appendTo(n),$('<td><a href="#" class="remove-url icon-bin"></a></td>').appendTo(n),$('<td><a href="javascript:void(0);" class="icon-align-full"></a></td>').appendTo(n)}function d(e){crsaChooseFile(function(e){f.requireFileFromUrl(e)},!1,!1,!1,e)}function a(e){e&&u(),y=[],c=null,h=!1,s&&s.remove()}var p,s,u=function(){var e=c.getProjectInfo();e.setSetting("project_resources",y),e.save()},f=(this.getResources=l,this.getProject=function(){return c},this),h=!1,v={Auto:"auto",CSS:"text/css",Javascript:"application/javascript","Page Library":"pinegrow/pagelib"},b=[{key:v["Auto"],name:"Auto"},{key:v["CSS"],name:"CSS"},{key:v["Javascript"],name:"Javascript"},{key:v["Page Library"],name:"Page Library"}],y=l(),g=function(e){return-1<e&&e<y.length&&(y.splice(e,1),!0)},m=function(){if(p.html(""),0==y.length){var e=$("<tr></tr>").appendTo(p);$("<td><b>No files/folders added yet</b></td><td></td><td></td><td></td><td></td>").appendTo(e)}else for(var t=0;t<y.length;t++){var a=y[t];i(a,t)}p.find(".remove-url").click(r),p.find('input[type="checkbox"]').change(n),p.find("select.url-type").change(o),p.sortable({update:function(e,t){var a=$(this).find("tr"),r=[];a.each(function(e,t){r[e]=y[parseInt($(t).attr("data-index"))]}),y=r}})};this.show=function(){h=!0;var e="Resources of project "+c.getName(),t=$("<div><p>Resources are CSS, JavaScript and media files required by the components from the project, when used as a project library. Individual files and folders can be added to the list:</p></div>"),a=$('<table class="file-chooser table table-striped table-condensed table-hover"><thead><tr><td style="width:65%;"><label>File/Folder name</label></td><td><label>Type</label></td><td style="text-align:center;width:130px;"><label>Include in footer</label></td><td style="width:30px;"></td><td style="width:30px;"></td></tr></thead><tbody></tbody></table>').appendTo(t),a=(p=a.find("tbody"),m(),$('<form class="form-inline load-files-folders" role="form"></form>').appendTo(t)),r=($("<h5>Add url, file or folder as a resource:</h5>").appendTo(a),$('<div class="form-group" style="width:65%;"></div>').appendTo(a)),r=$('<div class="input-group" style="width:98%;"></div>').appendTo(r),n=$('<input type="url" class="form-control url" placeholder="External url">').appendTo(r),r=$('<span class="input-group-addon"><i class="icon-plus"></i></span>').appendTo(r),o=$('<button type="submit" class="btn btn-default select-file">Select File</button>').appendTo(a),a=$('<button type="submit" class="btn btn-default select-folder">Select Folder</button>').appendTo(a);r.click(function(e){e.preventDefault(),n.val()&&(f.requireFileFromUrl(n.val()),n.val(""))}),o.click(function(e){e.preventDefault(),d(!1)}),a.click(function(e){e.preventDefault(),d(!0)}),s=makeAndShowDialog(e,"Close","Save",t,function(){y=l(),h=!1},function(){u(),h=!1})},this.isShown=function(){return h},this.requireFileFromUrl=function(e){h||this.show();var t,a,r=crsaGetUrlParameters(e);e=crsaCleanUpUrl(e),t=c.getFileForUrl(e)?c.getRelativeUrl(e):e,a=t+=r,0<y.filter(function(e){return e.url==a}).length?pinegrow.showQuickMessage("File already added"):(y.push(r={url:t,footer:!1,type:"auto"}),i(r,y.length-1),m())};$("body").on("crsa-project-closed",function(e,t){h?makeAndShowDialog("Save cahnges","No","Yes","Do you want to save changes?",function(){a(!1)},function(){a(!0)}):a(!1)})};