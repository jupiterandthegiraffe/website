var PgResourceEditor=function(c){function l(){var e=c.getProjectInfo().getSetting("project_resources");return e||[]}function r(e){e.preventDefault();var t=$(this).parents("tr");y(parseInt(t.attr("data-index")))&&g()}function n(e){e.preventDefault();var t=$(this).parents("tr"),t=b[parseInt(t.attr("data-index"))];$(this).is(":checked")?t.footer=!0:t.footer=!1}function o(e){e.preventDefault();var t=$(this).parents("tr");b[parseInt(t.attr("data-index"))].type=$(this).val()}function s(e,t){for(var a="",r=e.url,n=e.footer,o=e.type||"auto",l=((l=crsaGetExtFromUrl(r))&&"js"==l.toLowerCase()||(a+=' disabled="disabled"'),n&&(a+=' checked="checked"'),crsaMakeFileFromUrl(r)),s=(crsaIsAbsoluteUrl(r)||(l=c.getAbsolutePath(crsaMakeFileFromUrl(r))),"dir"==crsaIsFileOrDir(l)&&(r+=" [Folder]"),""),i=0;i<v.length;i++){var d=v[i];s+='<option value="'+d.key+'"'+(d.key==o?"selected":"")+">"+d.name+"</option>"}n=$('<tr data-index="'+t+'"></tr>').appendTo(u),$("<td><label>"+r+"</label></td>").appendTo(n),$('<td><select class="url-type">'+s+"</select></td>").appendTo(n),$('<td style="text-align:center;"><input type="checkbox" value="1" '+a+"/></td>").appendTo(n),$('<td><a href="#" class="remove-url fa fa-fw fa-trash"></a></td>').appendTo(n),$('<td><a href="#" class="fa fa-fw fa-reorder"></a></td>').appendTo(n)}function i(e){crsaChooseFile(function(e){f.requireFileFromUrl(e)},!1,!1,!1,e)}function a(e){e&&p(),b=[],c=null,h=!1,d&&d.remove()}var u,d,p=function(){var e=c.getProjectInfo();e.setSetting("project_resources",b),e.save()},f=(this.getResources=l,this.getProject=function(){return c},this),h=!1,v=[{key:"auto",name:"Auto"},{key:"css",name:"CSS"},{key:"js",name:"Javascript"}],b=l(),y=function(e){return-1<e&&e<b.length&&(b.splice(e,1),!0)},g=function(){if(u.html(""),0==b.length){var e=$("<tr></tr>").appendTo(u);$("<td><b>No files/folders added yet</b></td><td></td>").appendTo(e)}else for(var t=0;t<b.length;t++){var a=b[t];s(a,t)}u.find(".remove-url").click(r),u.find('input[type="checkbox"]').change(n),u.find("select.url-type").change(o),u.sortable({update:function(e,t){var a=$(this).find("tr"),r=[];a.each(function(e,t){r[e]=b[parseInt($(t).attr("data-index"))]}),b=r}})};this.show=function(){h=!0;var e="Resources of project "+c.getName(),t=$("<div><p>Resources are CSS, JavaScript and media files required by the components from the project library. Individual files and folders can be added to the list:</p></div>"),a=$('<table class="file-chooser table table-striped table-condensed table-hover"><thead><tr><td style="width:65%;"><label>File/Folder name</label></td><td><label>Type</label></td><td style="text-align:center;width:130px;"><label>Include in footer</label></td><td style="width:30px;"></td><td style="width:30px;"></td></tr></thead><tbody></tbody></table>').appendTo(t),a=(u=a.find("tbody"),g(),$('<form class="form-inline load-files-folders" role="form"></form>').appendTo(t)),r=($("<h5>Add url, file or folder as a resource:</h5>").appendTo(a),$('<div class="form-group" style="width:65%;"></div>').appendTo(a)),r=$('<div class="input-group" style="width:98%;"></div>').appendTo(r),n=$('<input type="url" class="form-control url" placeholder="External url">').appendTo(r),r=$('<span class="input-group-addon"><i class="fa fa-plus"></i></span>').appendTo(r),o=$('<button type="submit" class="btn btn-default select-file">Select File</button>').appendTo(a),a=$('<button type="submit" class="btn btn-default select-folder">Select Folder</button>').appendTo(a);r.click(function(e){e.preventDefault(),n.val()&&(f.requireFileFromUrl(n.val()),n.val(""))}),o.click(function(e){e.preventDefault(),i(!1)}),a.click(function(e){e.preventDefault(),i(!0)}),d=makeAndShowDialog(e,"Close","Save",t,function(){b=l(),h=!1},function(){p(),h=!1})},this.isShown=function(){return h},this.requireFileFromUrl=function(e){h||this.show();var t,a,r=crsaGetUrlParameters(e);e=crsaCleanUpUrl(e),t=c.getFileForUrl(e)?c.getRelativeUrl(e):e,a=t+=r,0<b.filter(function(e){return e.url==a}).length?pinegrow.showQuickMessage("File already added"):(b.push(r={url:t,footer:!1,type:"auto"}),s(r,b.length-1),g())};$("body").on("crsa-project-closed",function(e,t){h?makeAndShowDialog("Save cahnges","No","Yes","Do you want to save changes?",function(){a(!1)},function(){a(!0)}):a(!1)})};