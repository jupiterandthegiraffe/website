var PgBrowserSync=function(){function n(e){var r;s&&(r=pinegrow.getCurrentProject())&&(e=r.getRelativeUrl(e),o.indexOf(e)<0)&&(o.push(e),i.run("reload",async function(){if(o.length){var r=t+"/__browser_sync__?method=reload";o.forEach(function(e){r+=`&args=`+e}),o=[];try{await pgFetchRemoteContent(r)}catch(e){console.log(`BrowserSync is not running on `+t);var n=(new Date).getTime();6e4<n-a&&(pinegrow.showQuickError(`BrowserSync is not running on ${t}. Start it or switch off the sync in the top toolbar with <i class="icon icon-27"></i>.`),a=n)}}},250))}var t=pinegrow.getSetting("browsersync-url","http://localhost:3000"),o=[],i=new PgDelayedTasks,s="1"===pinegrow.getSetting("browsersync-enabled","0"),a=0;pinegrow.addEventHandler("on_page_changes_done",function(e){n(e.url)}),pinegrow.addEventHandler("on_css_stylesheet_changed",function(e,r){r.url&&n(r.url)}),pinegrow.addEventHandler("on_preview_dropdown_actions",function(e,r){[{type:"divider"},{type:"header",label:"BrowserSync"},{label:"Use BrowserSync",check:s,action:function(){s=!s,pinegrow.setSetting("browsersync-enabled",s?"1":"0"),pinegrow.showMode("BrowserSync",s)}},{label:"How to start BrowserSync",action:function(){pinegrow.showAlert(`<p>BrowserSync must be running for this feature to work.</p><p>To start BrowserSync:</p><ul>
<li>Open the terminal / command prompt</li>
<li>Run <code>browser-sync start --proxy "${pinegrow.getApiUrl()}"</code></li>
</ul>
<p><a href="https://pinegrow.com/docs/master-pinegrow/using-external-code-editors/live-preview-on-any-device-or-browser-with-browsersync/" class="external">Learn more about using BrowserSync in Pinegrow.</a></p>`,"How to start BrowserSync")}},{label:"Settings...",action:function(){var e={url:{name:"BrowserSync url",type:"text",value:t}};pinegrow.showQuickDialog(`BrowserSync Settings`,"Settings",`<p>BrowserSync is an external and free tool that lets you preview pages on multiple browsers / devices while you edit them in Pinegrow. All changes will be shown in the browser, without having to save them first.</p><p><a href="https://pinegrow.com/docs/master-pinegrow/using-external-code-editors/live-preview-on-any-device-or-browser-with-browsersync/" class="external">Learn more about using BrowserSync in Pinegrow.</a></p>`,e,"Cancel","Save",null,function(e){t=e.url||"http://localhost:3000",pinegrow.setSetting("browsersync-url",t)})}}].forEach(function(e){r.push(e)})}),pinegrow.addEventHandler("on_preview_page_in_browser",function(e,r){var n,o;r.done=!0,s?(o=pinegrow.getCurrentProject())?o.isUrlInProject(e.url)?(o=o.getRelativeUrl(e.url),n=require("nw.gui"),o=t+"/"+o,n.Shell.openExternal(o)):(pinegrow.showQuickError("The page is not part of the current project. Opening in the browser instead..."),e.openInBrowser(!0)):pinegrow.showQuickError("This feature requires projects. Open the page as Project first."):e.openInBrowser(!0)})};