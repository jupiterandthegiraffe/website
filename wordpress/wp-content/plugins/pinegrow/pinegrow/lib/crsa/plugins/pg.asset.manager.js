$(function(){pgf.edit_html&&$("body").one("pinegrow-ready",function(e,u){var i=new PgFramework("pg.asset.manager","Asset manager");u.addFramework(i),i.default=!0,i.show_in_manager=!1;u.assetManager=new function(){function f(e){for(var t=e.map(function(e){return{url:e.url,type:"CSS",from:"Google font",info:e.name,action:e.action}}),n=[],o=0;o<g.length;o++){for(var a,l=!1,r=0;r<t.length;r++)if(g[o].info==t[r].info){l=!0,a=t[r],t.splice(r,1);break}l?(p.push(g[o]),n.push(a)):n.push(g[o])}g=$.merge(n,t)}var l="Manage Google Fonts",g=[],p=[],c=function(e,t){for(var n=0;n<g.length;n++)"CSS"==g[n].type&&g[n].url==e&&(g[n].url=t)};this.show=function(){function e(){g=[];var e=s();d(!0,e)}var t=$("<div></div>"),n=$('<table class="assets-manager file-chooser table table-striped table-condensed table-hover"><thead><tr><td style="width:60%;"><label>Asset name</label></td><td><label>Type</label></td><td style="width:100px;"><label>Family name</label></td><td style="width:30px;"></td><td style="width:30px;"></td></tr></thead><tbody></tbody></table>').appendTo(t),r=n.find("tbody"),d=function(n,e){function t(){if(!n){var e=u.getSelectedPage();if(e){var t=e.sourceNode.findOne("head");if(t){for(var o=!1,a=0;a<p.length;a++)"CSS"==p[a].type&&t.findWithAttrValue("href",p[a].url).forEach(function(e){var t=e.getAttr("href"),n=getNewFontsUrl(t,p[a].info,"remove");n?(c(t,n),e.setAttr("href",n)):e.remove(),o=!0});for(a=0;a<g.length;a++)"CSS"==g[a].type&&e.addStylesheet(g[a].url)&&(o=!0);o&&u.changeManager.didChange(t,"Update Google Fonts",null,e)}}else u.showAlert("Please open a page first.")}}function i(e){var t=crsaGetSummaryStr(e,60);return $("<label>"+t+"</label>")}e?(f(e),t()):(t(),g=[],e=s(),f(e)),r.html("");for(var o=0;o<g.length;o++){var a=$('<tr data-index="'+o+'"></tr>').appendTo(r),l=("Google font"==g[o].from&&a.data("fontUrl",g[o].url),$('<td class="elm-url"></td>').appendTo(a));i(g[o].url).appendTo(l),l=$('<td class="elm-type">'+g[o].type+(g[o].from?"/"+g[o].from:"")+"</td>").appendTo(a),l=$('<td class="more-info">'+g[o].info+"</td>").appendTo(a),(l=$('<td class="elm-settings" style="vertical-align: middle;"><i class="glyphicon glyphicon-cog" style="position:relative;top:2px;"></i></td>').appendTo(a)).find("> .glyphicon").click(function(e){e.preventDefault();var r=$(this).closest("tr"),d=r.data("fontUrl"),t=u.pgGoogleFontManager.getFont(d),n=getFontNameAndOptions(d)[0];u.pgGoogleFontManager.openSettingsFor(t,n,function(){},function(e,t){var n,o,a=t.url,l=(r.data("fontUrl",a),r.find(".elm-url"));l.html(""),i(a).appendTo(l),t=d,n=a,(l=u.getSelectedPage())?(a=l.sourceNode.findOne("head"))&&(o=new PgCollection,a.findWithAttrValue("href",t).forEach(function(e){e.setAttr("href",n),o.add(e)}),o.getLength())&&u.changeManager.didChange(o,"Update Google Font",null,l):u.showAlert("Please open a page first.")})}),addTooltip(l.find("i"),"Font settings..."),l=$('<td class="elm-action" style="vertical-align: middle;"></td>').appendTo(a),g[o].action&&(g[o].action(g[o],l),addTooltip(l.find("i"),"Copy family name to clipboard.")),l=$('<td class="elm-delete" style="vertical-align: middle;"><i class="glyphicon glyphicon-trash"></i></td>').appendTo(a),addTooltip(l.find("i"),"Remove font from the selected page."),l.find("> .glyphicon").click(function(e){e.preventDefault(),a=$(this).closest("tr"),-1<(e=parseInt(a.attr("data-index")))&&e<g.length&&(p.push(g[e]),g.splice(e,1),!0)&&d(!1)})}},o=$('<p class="assets-notes"></p>').appendTo(t),a=$('<form class="form-inline load-files-folders" role="form"></form>').appendTo(t),a=$('<button type="submit" class="btn btn-primary add-google-font">Add Google font</button>').appendTo(a),s=(u.pgGoogleFontManager.loadFonts(function(e){e||n.addClass("fonts-loaded")}),u.pgGoogleFontManager.addNotes&&u.pgGoogleFontManager.addNotes(o),a.click(function(e){e.preventDefault(),u.pgGoogleFontManager.show(function(e){d(!1,e)})}),function(){var e=u.getSelectedPage();return e?u.pgGoogleFontManager.checkForLinks(e):[]});e(),i.on_page_refreshed=e,makeAndShowDialog(l,"Close",null,t,function(){},null,null,!0)}},u.isContributorMode()||(i.on_page_menu=function(e,t){t.push({label:"Manage Google Fonts...",kbd:null,action:function(){u.assetManager.show()}})})})});