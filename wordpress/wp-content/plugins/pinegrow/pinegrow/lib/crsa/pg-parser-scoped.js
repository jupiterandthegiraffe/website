"use strict";!function(){var t,e,n,F=0,x=0,T=new RegExp('\\s*data\\-pg\\-id="([0-9]+)"',"i"),S=new RegExp('\\s*data\\-pg\\-id="[0-9]+"',"ig"),L=new RegExp("^[\\s\\n]*$"),f={},_=["a","p","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6","br","textarea"],M=["a","span","em","strong","code","kbd","var","cite","abbr","acronym","sub","sup","i","b","big","small","u","s","strike","font","ins","del","br"],H=["a","td","th"],a={html:[],head:["body"],body:[],p:["p","address","article","aside","blockquote","div","dl","fieldset","footer","form","h1","h2","h3","h4","h5","h6","header","hr","menu","nav","ol","pre","section","table","ul"],dd:["dd"],dt:["dt"],option:["option","optgroup"],optgroup:["optgroup"],thead:["tbody","tfoot"],th:["td","th"],tbody:["tfoot"],tr:["tr"],td:["td","th"],tfoot:["tbody"],colgroup:[],li:["li"]},D=window.pgSingleTags=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr","!","!doctype"],u={"<?php":{type:"php",name:"PHP",close:"?>",name_tag:"&lt;?php"},"<?xml":{type:"xml",name:"XML",close:"?>",name_tag:"&lt;?xml"},"<?=":{type:"php",name:"PHP",close:"?>",name_tag:"&lt;?="},"<?":{type:"php",name:"PHP",close:"?>",name_tag:"&lt;?"},"<%":{type:"asp",name:"ASP &amp; ERB",close:"%>",name_tag:"&lt;%"}},j={},i=[],r=null,s=null,l=[],o=window.pgParserEscapeRegExp=function(t){return(t="string"!=typeof t?String(t):t).replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},h="",d="",c="^",g="^";for(t in u)u.hasOwnProperty(t)&&((e=u[t]).open=t,i.push(e),n=e.open.replace("<",""),j[n]=e,_.push(n),D.push(n),h+=(h.length?"|":"")+"("+o(e.open)+")",d+=(d.length?"|":"")+"("+o(n)+")",c+=(1!==c.length?"|":"")+"("+o(e.open)+")",g+=(1!==g.length?"|":"")+"("+o(e.close)+")",l.push([t,e.close]));r=new RegExp(h,"i"),s=new RegExp(d,"i"),new RegExp(c,"ig"),new RegExp(g,"ig");function p(t){return t.match(r)}function W(t){return t.match(s)}function I(t,e){for(var n=0;n<i.length;n++)if(N(i[n].open,t,e))return i[n];return null}var P=/"/g,O=/&quot;/g,m=window.pgEncodeAttribute=function(t){return null===t?null:0<=t.indexOf("<?")?t:t.replace(P,"&quot;")},V=window.pgDecodeAttribute=function(t){return"string"!=typeof t?t:t.replace(O,'"')},v=window.pgParserException=function(t,e){this.message=t,this.name="pgParserException",this.reference=e,this.toString=function(){return this.message+" - "+escapeHtmlCode(this.reference)}},b=(window.pgParserSourceProblem=function(t,e,n){this.message="Can not edit source node.",this.name="pgParserSourceProblem",this.node=t,this.$el=e;var i,s=[];this.add=function(t,e,n,i,r){i=i||"dynamic",s.push({obj_type:t,obj:e instanceof U?e.getName():e,action:n,reason:i,msg:r})},t&&!n&&(i=pinegrow.isElementLocked(t))&&this.add("element",e?getElementName(e):"node","change","custom",i),this.ok=function(){return 0===s.length},this.toString=function(){if(0===s.length)return null;for(var t="<ul>",e=0;e<s.length;e++){var n,i="",r=s[e];switch(r.obj_type){case"class":i="Class <b>"+r.obj+"</b>";break;case"element":i="Element <b>"+r.obj+"</b>"}switch(r.reason,n="because it was either: <b>added by a script</b>, <b>removed from the page</b> or <b>changed in the code editor without refreshing the page</b>",r.msg&&(n=r.msg),r.action){case"remove":i+=" can't be <b>removed</b>";break;case"add":i+=" can't be <b>added</b>";break;case"change":i+=" can't be <b>changed</b>";break;case"find":i+=" does't <b>exist in source</b>";break;case"duplicate":i+=" cant't be <b>duplicated</b>"}t+="<li>"+(i+=" "+n+".")+"</li>"}return t+="</ul>"}},window.pgParserNodeCatalogueInstance=new function(){var n={};this.clear=function(){n={}},this.add=function(t){var e=t.getId();e&&(n[e]=t)},this.get=function(t){return t in n?n[t]:null},this.remove=function(t){var e=t.getId();e&&e in n&&t.objectCount===n[e].objectCount&&delete n[e]},this.logStat=function(){var t,e=0;for(t in n)n.hasOwnProperty(t)&&++e;console.log("pgParserNodeCatalogue - # objects: "+e)}}),q=window.pgGetAttributesStringFilterOutPgIds=function(t,e,n,i){return"data-pg-id"===e?null:null===n?e:e+"="+i+n+i},R=window.pgCreateNodeFromHtml=function(t,e,n){var i=[],r=(void 0===e&&(e=!0),new E);if(r.assignIds=!1,r.parse(t),!n&&1!==r.rootNode.children.length||0===r.rootNode.children.length)throw new v("Create node from html failed. Only one node can be created.",t);for(;0<r.rootNode.children.length;){var s=r.rootNode.children[0];if(e&&(s.assignIdAndAddToCatalog(!0),s.removePgIdAttributes()),s.detach(),s.emitEvent("nodeCreated",{html:t}),!n)return s;i.push(s)}return i},N=(window.pgCreateNodeSimple=function(t,e){if((e=e||new E).assignIds=!1,e.parse(t),1!==e.rootNode.children.length||0===e.rootNode.children.length)throw new v("Create node from html failed. Only one node can be created.",t);return e.rootNode.children[0]},window.pgCreate=R,function(t,e,n){for(var i=e.length,r=0;r<t.length;r++)if(i<=n+r||t.charAt(r)!==e.charAt(n+r).toLowerCase())return!1;return!0});const k="data-pg-id";function B(t,e,n){for(var i=l,r=t.length,s=-1,o=n||0;o<r;){if("<"===t.charAt(o))for(var a=0;a<i.length;a++)if(N(i[a][0],t,o)){var h=t.indexOf(i[a][1],o+i[a][0].length);if(h<0)return s;o=h+i[a][1].length}if(t.startsWith(e,o))return o;o++}return s}var U=window.pgParserNode=function(t){this.tagName=null,this.tagNameOriginal=null,this.textNode=!1,this.rootNode=!1,this.attributes="",this.closingTag=null,this.closed=!1,this.selfClosed=!1,this.content=null,this.singleTag=!1,this.script=!1,this.isElementOrScript=!1,this.script_info=null,this.scriptClosed=!1,this.children=[],this.parent=null,this.comment=!1,this.isElement=!1,this.pgId=null,this.hasPgIdAttr=!1,this.objectCount=++x,this.data={},this.isDeleted=!1,this.formatHtml=!1,this.attrList=null,this.attrListChanged=!1,this.nodeCatalogue=b,this.document=null,this.clonedFromPgId=null,this.$el=null,this.startStringIndex=-1,this.endStringIndex=-1,this.outputOnly=null,this.dynamic=!1},G=(U.prototype.setDocument=function(e){this.walkSelfAndChildren(function(t){return t.document=e,t.catchedPage=null,!0})},U.prototype.getPage=function(){var t;return this.document&&this.document.emulatedPage?this.document.emulatedPage:(this.catchedPage||(!(t="undefined"!=typeof pinegrow?pinegrow.getCrsaPageOfPgParserNode(this):null)&&this.removedFromPage&&(t=this.removedFromPage),this.catchedPage=t),this.catchedPage)},U.prototype.getParent=function(){return this.parent},U.prototype.getParentsBySelector=function(e){var n=[];return this.withParents(function(t){t.isSelector(e)&&n.push(t)}),n},U.prototype.shouldHaveId=function(){return!(!this.script||!W(this.tagName))||this.isElement&&!this.script&&!this.textNode&&!this.comment},U.prototype.getByPgId=function(t){var e=this.nodeCatalogue||(this.document?this.document.nodeCatalogue:null);return e?e.get(t):null},U.prototype.withParents=function(t){for(var e=this.parent;e;)t(e),e=e.parent},U.prototype.withSelfAndParents=function(t){t(this),this.withParents(t)},U.prototype.walk=function(t,e){e=e||0;for(var n=this.children.length,i=0;i<n;i++){var r,s=this.children[i],o=t(s,e);if(n!==this.children.length&&(0<=(r=this.children.indexOf(s))?i=r:i--,n=this.children.length),!o)return;"skip_children"!==o&&s.walk(t,e+1)}},U.prototype.walkSelfAndChildren=function(t){t(this,0)&&this.walk(t,1)},U.prototype.makeListByWalkingSelfAndChildren=function(){var e=[];return this.walkSelfAndChildren(function(t){return t.isElementOrScript&&e.push(t),!0}),e},U.prototype.updatePositionInformation=function(){var e=0;this.document.walkSelfAndChildren(function(t){return e++,t.positionInDocument=e,!0})},U.prototype.getPositionInDocument=function(t){var e,n;return t&&this.hasOwnProperty("positionInDocument")?this.positionInDocument:(e=0,(n=this).document.walkSelfAndChildren(function(t){return e++,t!==n}),this.positionInDocument=e)},U.prototype.findOne=function(t,e){var n=this.find(t,!0,!1,e);return n.length?n[0]:null},U.prototype.findMaxItems=function(t,e,n,i){return this.find(t,!1,!1,n,e,i)},0),J=(U.prototype.find=function(t,e,n,i,r,s){100<++G&&(f={},G=0),r=r||9999999999;for(var o,a=t.split(","),h=[],l=0;l<a.length;l++){for(var d=(d=a[l].replace(/\s*\>\s*/g," >")).split(" "),c=[],u=0;u<d.length;u++)0<d[u].length&&c.push(d[u]);var g,p=this;1===(d=c).length&&"self"===$.trim(d[0])?h.push(this):(g=0,this.walk(function(t){if(t.positionInDocument=g++,i&&i(t))return"skip_children";if(t.isElementOrScript&&t.isTo(d,p)){if(h.indexOf(t)<0&&(h.push(t),r<=h.length))return!1;if(e)return!1}return!n||"skip_children"}))}return 1<a.length&&((o=new PgCollection).setList(h),o.orderByDocumentPosition(!0),h=o.getList(),o.setList(null)),h},U.prototype.findIncludingSelf=function(t,e,n){var i;return e?this.isSelector(t)?this:this.findOne(t,n):(i=this.find(t,!1,!1,n),this.isSelector(t)&&i.unshift(this),i)},U.prototype.findOneIncludingSelf=function(t){return this.findIncludingSelf(t,!0)},U.prototype.findOneWithAttrValue=function(t,e,n){for(var i=this.find((n=n||"")+"["+t+"]"),r=0;r<i.length;r++)if(i[r].getAttr(t)===e)return i[r];return null},U.prototype.findWithAttrValue=function(t,e,n){for(var i=[],r=this.find((n=n||"")+"["+t+"]"),s=0;s<r.length;s++)r[s].getAttr(t)===e&&i.push(r[s]);return i},U.prototype.findWithMultipleAttrValues=function(n){var i=[];return this.walkSelfAndChildren(function(t){if(t.isElement){for(var e=0;e<n.length;e++)if(null!==n[e].value){if(t.getAttribute(n[e].name)!==n[e].value)return!0}else if(!t.hasAttribute(n[e].name))return!0;i.push(t)}return!0}),i},U.prototype.goThroughAllUrls=function(r,t){function e(i){i.isElement&&n.forEach(function(e){var t=i.getAttr(e),n=null;t&&(n="srcset"===e?pgTransformSrcsetUrls(t,function(t){return r(t,e,i)}):r(t,e,i))!==t&&i.setAttr(e,n)})}var n=["src","href","action","data-src","srcset"];t?e(this):this.walkSelfAndChildren(function(t){return e(t),!0})},U.prototype.rebaseAllUrls=function(n,i){this.goThroughAllUrls(function(t){var e;if(!i||(e=i(t))===t){e=t;try{e=new URL(t,n).href}catch(t){}}return e})},U.prototype.mapLinksToNewLocation=function(s,o,a){var h;return crsaGetBaseForUrl(s)!==crsaGetBaseForUrl(o)&&(h=!1,this.goThroughAllUrls(function(t,e,n){var i,r;return!t||crsaIsAbsoluteUrl(t)||t.startsWith("/")||t.startsWith("#")?t:(i=crsaGetAbsoluteUrlForRelativeUrlAndParentUrl(t,s),r=crsaMakeLinkRelativeTo(i,o,!0),a&&r!==t&&!crsaIsFileExist(crsaMakeFileFromUrl(i))&&(r=t),h=h||r!==t,r)},!0),h)},U.prototype.validateTree=function(e){var n=[];return this.walkSelfAndChildren(function(t){return t.validate(e)||n.push(t),!0}),n},">".charCodeAt(0)),X=(U.prototype.isTo=function(t,e){for(var n,i=this,r=t.length-1,s=!0;i&&i!==e;){var o=!1;if(0<=r){var a=t[r],h=(a.charCodeAt(0)===J&&(o=!0,a=a.substr(1)),h=void 0,!((n=a).indexOf(":")<0)&&1<(h=n.split(":")).length&&[!0,h[0],h[1]]),l=null;if(!1!==h&&(a=h[1],l=h[2]),i.isSelector(a)){if(l&&!function(t,e,n,i){if(0===(o=t.children.filter(function(t){return"text"!==t.tagName})).length)return!1;if("first-child"===n){if(o[0]!==e)return!1}else if("last-child"===n){if(o[o.length-1]!==e)return!1}else{var r=n.match(/nth-child\(([0-9]*)\)/);if(r){if((s=parseInt(r[1]))>o.length)return!1;if(o[s-1]!==e)return!1}else if(r=n.match(/nth-of-type\(([0-9]*)\)/)){var s,o=t.find(">"+i);if((s=parseInt(r[1]))>o.length)return!1;if(o[s-1]!==e)return!1}}return!0}(i.parent,i,l,a))return!1;r--}else if(s)return!1}else if(s)return!1;s=o,i=i.parent}return!(0<=r||!i)},U.prototype.is=function(t){for(var e=t.split(","),n=0;n<e.length;n++){var i=e[n].trim().replace(/\s*\>\s*/g," >").split(" ");if(this.isTo(i,this.document))return!0}return!1},U.prototype.parseSelector=function(t){var e,n,i,r,s=t;return f[s]||(e=n=null,(i=t.match(/\[([^\]]+)\]/))&&(n=i[1],t=t.replace(i[0],""),n=(i=n.split("="))[0],1<i.length)&&(e=i[1].replace(/(\"|\')/g,"")),i=t.match(/#[^\s\.]+/),r=t.match(/^[^\s\.#]+/),f[s]={id:i?i[0].replace("#",""):null,tag:r?r[0]:null,classes:t.match(/\.[^\s\.#]+/g),attr:n,attrValue:e}),f[s]},U.prototype.isSelector=function(t,e){if(!e&&0<=t.indexOf(",")){for(var n=crsaSplitAndTrimList(t),i=0;i<n.length;i++)if(this.isSelector(n[i]))return!0;return!1}if((e=e||this.parseSelector(t)).id&&this.getElementId()!==e.id)return!1;if(e.tag&&0<e.tag.length&&"*"!==e.tag&&e.tag!==this.tagName)return!1;if(e.classes)for(i=0;i<e.classes.length;i++)if(!this.hasClass(e.classes[i].replace(".","")))return!1;if(e.attr){if(!this.hasAttr(e.attr))return!1;if(null!==e.attrValue&&this.getAttr(e.attr)!==e.attrValue)return!1}return!0},U.prototype.closest=function(t,e){for(var n=this,i=crsaSplitAndTrimList(t),r=i.map(function(t){return n.parseSelector(t)}),s=this;!function(){for(var t=0;t<i.length;t++)if(s.isSelector(i[t],r[t]))return!0;return!1}();){if(!s.parent)return null;if(e&&e===s)return null;s=s.parent}return s},U.prototype.addChild=function(t){this.children.push(t),t.parent=this,t.setDocument(this.document)},U.prototype.removeChild=function(e){this.withEmitEvent(function(){var t=this.getChildPos(e);0<=t&&this.children.splice(t,1),e.parent=null,e.setDocument(null)},"removeChild",e)},U.prototype.removeChildWithoutEvent=function(t){var e=this.getChildPos(t);0<=e&&this.children.splice(e,1),t.parent=null,t.setDocument(null)},U.prototype.replaceTag=function(t){var e=null,n=this.getEmitEvents()?this.toStringWithIds():null,i=this.getId();return this.withoutEvents(function(){this.tagName=t,this.tagNameOriginal=t,this.closingTag&&(this.closingTag=t),e=this.clone(null,!1),this.replaceWith(e)}),e.update(n,i),e},U.prototype.replaceWith=function(t,e){var n;return this.parent?(n=this.getPage(),this.withEmitEvent(function(){t.insertBefore(this),this.replacedWith=t,this.replacedWithChain||(this.replacedWithChain=[]),this.replacedWithChain.push(t),t.data=this.data,e?this.detach():this.remove()},"replaceWith",t,{detach:e,objectHtml:t.toStringWithIds(),objectDomHtml:t.getViewHtml(n),oldValue:function(){return this.toStringWithIds(!0)}},n)):(this.replacedWith=t,this.replacedWithChain||(this.replacedWithChain=[]),this.replacedWithChain.push(t)),this},U.prototype.replaceContentWithContentOf=function(t,e){this.withEmitEvent(function(){for(;this.children.length;)e?this.children[0].detach():this.children[0].remove();for(;t.children.length;)this.append(t.children[0])},"replaceContentWithContentOf",t,{detach:e})},U.prototype.replaceContentWithElement=function(t,e){this.withEmitEvent(function(){for(;this.children.length;)e?this.children[0].detach():this.children[0].remove();this.append(t)},"replaceContentWithElement",t,{detach:e})},U.prototype.replaceWithContentOf=function(t,e){this.withEmitEvent(function(){for(;t.children.length;)t.children[0].insertBefore(this);e?this.detach():this.remove()},"replaceWithContentOf",t,{detach:e})},U.prototype.detag=function(){this.withEmitEvent(function(){if(this.parent){for(;this.children.length;)this.children[0].insertBefore(this);this.remove()}},"detag",null,{oldValue:function(){return{parentHtml:this.parent?this.parent.html(null,!0):null,parentId:this.parent?this.parent.getId():null}}},this.getPage())},U.prototype.getHeadingLevel=function(){if(this.tagName){var t=this.tagName.match(/^h([0-9])+$/i);if(t)return parseInt(t[1])}return 0},U.prototype.getHeadingLevelOfSection=function(){for(var t=this;1;){var e=t.getHeadingLevel();if(0<e)return e;e=t.prev();if(!(t=e||t.parent))return 0}},U.prototype.rebaseHeadingLevel=function(n){this.walkSelfAndChildren(function(t){var e=t.getHeadingLevel();return 0<e&&(t.tagName=e="h"+(e+n),t.tagNameOriginal=e,t.closingTag)&&(t.closingTag=e),!0})},U.prototype.callDefHandlers=function(e,n,i,r,s,t){var o;if(t=t||this.getPage())return(o=t.getAllTypes(null,this)).forEach(function(t){e in t&&t[e](n,i,r,s)}),o},U.prototype.callDefHandlersOnParents=function(e,n,i,r,s,t){(t=t||this.getPage())&&this.withParents(function(t){t.callDefHandlers(e,-1===n?t:n,i,r,s)})},U.prototype.getUniqueIdAttribute=function(t,e){return getUniqueId(t,this.getPage(),e)},U.prototype.clone=function(t,e,n){var i=new U;if(i.tagName=this.tagName,i.tagNameOriginal=this.tagNameOriginal,i.textNode=this.textNode,i.rootNode=this.rootNode,i.attributes=this.getAttributesString(),i.closingTag=this.closingTag,i.closed=this.closed,i.selfClosed=this.selfClosed,i.content=this.content,i.singleTag=this.singleTag,i.script=this.script,i.isElementOrScript=this.isElementOrScript,i.script_info=this.script_info,i.scriptClosed=this.scriptClosed,i.comment=this.comment,i.outputOnly=this.outputOnly,i.formatHtml=this.formatHtml,i.document=t?i:this.document,i.nodeCatalogue=this.nodeCatalogue||b,i.isElement=this.isElement,i.attrList=null,i.hasPgIdAttr=this.hasPgIdAttr,i.data=this.data,!t&&i.shouldHaveId()&&(i.assignId(),i.nodeCatalogue.add(i)),i.clonedFromPgId=this.getId(),this.dynamic&&(i.page=this.page||null,i.dynamic=!0),e&&(i.pgId=i.clonedFromPgId),!n)for(var r=0;r<this.children.length;r++)i.addChild(this.children[r].clone(t,e));return i},U.prototype.setData=function(t,e){this.data[t]=e},U.prototype.getData=function(t,e){return this.data[t]||e||null},U.prototype.getClonedFromPgEl=function(){return this.clonedFromPgId?getPgNodeByPgId(this.clonedFromPgId):null},U.prototype.removeAllChildren=function(){this.withEmitEvent(function(){for(;this.children.length;)this.children[0].remove()},"removeAllChildren")},U.prototype.html=function(n,t,e,i){if(null==n){if(this.script||this.textNode)return this.content;if(this.comment)return this.attributes;if("script"===this.tagName||"php"===this.tagName||"style"===this.tagName)return this.content;for(var r="",s=0;s<this.children.length;s++)r+=this.children[s].toString("",!0,t,null,!!e,e);return r}var o=null;return this.getEmitEvents()&&(o=this.html(null,!0)),this.withoutEvents(function(){if(this.script)this.content=n;else if("script"===this.tagName||"php"===this.tagName||this.textNode||"style"===this.tagName)this.content=n;else if(this.comment)this.attributes=n;else{var t=new E;for(i&&(t.assignIds=!1),t.parse(n);this.children.length;)this.children[0].remove();for(var e=0;e<t.rootNode.children.length;e++)this.addChild(t.rootNode.children[e])}}),this.getEmitEvents()&&this.updateInner(o),this},U.prototype.text=function(t,e){if(null==t){for(var n="",i=0;i<this.children.length;i++)"text"===this.children[i].tagName?n+=this.children[i].toString("",!0,!1):e||(n+=this.children[i].text());return n}this.html(t)},U.prototype.indentText=function(t,e,n,i){null===e&&(i=i||pinegrow.getFormatHtmlOptions(),null===n&&(n=this.getNestingLevel()),e=pinegrow.getHtmlIndentForLevel(n,i));for(var r=t.split("\n"),s="",o=0;o<r.length;o++)0<o&&(s+="\n"),s+=0===o?r[o]:e+r[o];return s},U.prototype.isDescendantOf=function(t){for(var e=this.parent;null!=e;){if(e===t)return!0;e=e.parent}return!1},U.prototype.contains=function(t){return t.isDescendantOf(this)},U.prototype.getChildPos=function(t,e){if(!e)return this.children.indexOf(t);for(var n=-1,i=0;i<this.children.length;i++)if(this.children[i].isElementOrScript&&(n++,this.children[i]===t))return n;return-1},U.prototype.index=function(){return this.parent?this.parent.getChildPos(this,!0):0},U.prototype.getChildAtPos=function(t,e){for(var n=-1,i=0;i<this.children.length;i++)if(e&&!this.children[i].isElementOrScript||n++,n===t)return this.children[i];return null},U.prototype.getFirstChild=function(t){return this.getChildAtPos(0,!(t=void 0===t?!1:t))},U.prototype.isChildOf=function(t){return this.parent===t},U.prototype.isEmpty=function(){if(0===this.children.length)return!0;for(var t=0;t<this.children.length;t++)if(this.children[t].isElementOrScript)return!1;return 0===this.text().trim().length},U.prototype.isTextContentEmpty=function(){return this.textNode&&this.content.match(L)},U.prototype.hasChildren=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].isElementOrScript||t)return!0;return!1},U.prototype.getChildren=function(t){for(var e=[],n=0;n<this.children.length;n++)(this.children[n].isElementOrScript||t)&&e.push(this.children[n]);return e},U.prototype.getLinkElement=function(){var t;return"a"===this.tagName?this:1===(t=this.getChildren()).length&&"a"===t[0].tagName?t[0]:this.parent&&"a"===this.parent.tagName?this.parent:null},U.prototype.hasTextOnly=function(t){for(var e=0;e<this.children.length;e++)if(!this.children[e].textNode)return!1;return 0<this.children.length},U.prototype.findElementWithTextOnly=function(){var e=null;return this.walkSelfAndChildren(function(t){return!t.hasTextOnly()||(e=t,!1)}),e},U.prototype.isTheOnlyChild=function(t){return this.parent&&1===this.parent.getChildren(t).length},U.prototype.next=function(t){if(!this.parent)return null;for(var e=this.parent.getChildPos(this)+1,n=null;e<this.parent.children.length&&!n;){if(this.parent.children[e].isElementOrScript||t){n=this.parent.children[e];break}e++}return n},U.prototype.prev=function(t){if(!this.parent)return null;for(var e=this.parent.getChildPos(this)-1,n=null;0<=e&&!n;){if(this.parent.children[e].isElementOrScript||t){n=this.parent.children[e];break}e--}return n},U.prototype.prevWithSelector=function(t){for(var e=this.prev();e;){if(e.isSelector(t))return e;e=e.prev()}return e},U.prototype.nextWithSelector=function(t){for(var e=this.next();e;){if(e.isSelector(t))return e;e=e.next()}return e},U.prototype.first=function(t){for(var e=0;e<this.children.length;){if(this.children[e].isElementOrScript||t)return this.children[e];e++}return null},U.prototype.last=function(t){for(var e=this.children-1;0<=e;){if(this.children[e].isElementOrScript||t)return this.children[e];e--}return null},U.prototype.indexToElementIndex=function(t){for(var e=-1,n=0;n<this.children.length;n++)if(this.children[n].shouldHaveId()){if(e++,t===n)break}else if(t===n){e++;break}return-1===e?0:e},U.prototype.insertAtIndex=function(r,s,o){return this.withEmitEvent(function(){var t=s;if(r!==this.parent||o||0<=(i=this.parent.children.indexOf(this))&&i<s&&t--,this.detach(),o&&0<t){for(var e=0,n=t,i=0;i<r.children.length;i++)if(r.children[i].shouldHaveId()){if(t===++e)break}else n++;t=n}t>=r.children.length?r.children.push(this):r.children.splice(t,0,this),this.parent=r,this.setDocument(this.parent.document)},"insertAtIndex",r,{index:s,element_index:r.indexToElementIndex(s),skip_text:o},r.getPage()),this},U.prototype.insert=function(t,e){if(t.parent){var n=t.parent.getChildPos(t);if(n<0)throw new v("Node is not in parent child list",t);return this.withEmitEvent(function(){e?this.insertAtIndex(t.parent,n):this.insertAtIndex(t.parent,n+1)},"insert",t,{before:e},t.getPage()),this}},U.prototype.detach=function(){this.withEmitEvent(function(){this.parent&&this.parent.removeChild(this)},"detach",null,{},this.getPage())},U.prototype.moveChildrenToElement=function(i,r,s){var t,e,o;this===i||i.isDescendantOf(this)||(this.getEmitEvents()&&(t=i.html(null,!0),e=this.html(null,!0)),o=this,i.withoutEvents(function(){if(s){for(;o.children.length&&o.children[0].textNode&&0===o.children[0].content.trim().length;)o.children[0].remove();for(var t=o.children.length-1;0<=t&&(o.children[t].textNode&&0===o.children[t].content.trim().length);t--)o.children[t].remove();o.children.length&&o.children[0].textNode&&(o.children[0].content=o.children[0].content.trimLeft()),o.children.length&&o.children[o.children.length-1].textNode&&(o.children[o.children.length-1].content=o.children[o.children.length-1].content.trimRight())}if(r)for(var e=null;o.children.length;){var n=o.children[0];e?n.insertAfter(e):i.prepend(n),e=n}else for(;o.children.length;){n=o.children[0];i.append(n)}}),this.getEmitEvents()&&(i.updateInner(t),this.updateInner(e)))},U.prototype.getPositionInfo=function(){var t,e=null;return this.parent&&!this.parent.rootNode&&this.parent.getId()&&(e={parent:this.parent.getId(),pos:this.parent.getChildPos(this)},(t=this.prev(!0))&&(e.afterId=t.getId()),t=this.next(!0))&&(e.beforeId=t.getId()),e},U.prototype.placeAtPositionInfo=function(t){if(t){var e=b.get(t.parent);if(e){if(t.afterId){var n=b.get(t.afterId);if(n&&e===n.parent)return void this.insertAfter(n)}if(t.beforeId){n=b.get(t.beforeId);if(n&&e===n.parent)return void this.insertBefore(n)}this.insertAtIndex(e,t.pos)}}},U.prototype.removeWithoutEvents=function(t,e){var n;for(e=e||[],t||(this.removedFromPage=this.getPage()),e&&(n=this.getId())&&e.push(n),this.parent&&this.parent.removeChildWithoutEvent(this),this.nodeCatalogue&&this.nodeCatalogue.remove(this),this.isDeleted=!0;this.children.length;)this.children[0].removeWithoutEvents(!0,e)},U.prototype.remove=function(t,e){e=e||[],this.nonElementChangesContainer(this.parent,function(){this.removeWithoutEvents(t,e)})||this.withEmitEvent(function(){this.removeWithoutEvents(t,e)},"remove",null,{removedIds:e,oldValue:function(){return{position:this.parent?this.parent.getChildPos(this):null,html:this.toStringWithIds(),parentId:this.parent?this.parent.getId():null,positionInfo:this.getPositionInfo()}}},this.getPage())},U.prototype.insertBefore=function(t){return this.nonElementChangesContainer(t.parent,function(){this.insert(t,!0)})||this.withEmitEvent(function(){this.insert(t,!0)},"insertBefore",t,{oldValue:function(){return{position:this.getPositionInfo()}}},t.getPage()),this},U.prototype.insertAfter=function(e){return this.nonElementChangesContainer(e.parent,function(){this.insert(e,!1)})||this.withEmitEvent(function(){this.insert(e,!1)},"insertAfter",e,{oldValue:function(){var t={position:this.getPositionInfo()};return this.isElement||(t.destHtml=e.parent?e.parent.html(null,!0):null,t.parentHtml=this.parent?this.parent.html(null,!0):null),t}},e.getPage()),this},U.prototype.nonElementChangesContainer=function(t,e){var n;return!(this.isElement||!this.getEmitEvents()||!t||(n=t.html(null,!0),this.withoutEvents(function(){e.call(this)}),t.updateInner(n),0))},U.prototype.appendPrependWithoutEvent=function(t,e){this.detach(),e?t.children.unshift(this):t.children.push(this),this.parent=t,this.setDocument(this.parent.document)},U.prototype.appendPrepend=function(e,t){return this.nonElementChangesContainer(e,function(){this.appendPrependWithoutEvent(e,t)})||this.withEmitEvent(function(){this.appendPrependWithoutEvent(e,t)},"appendPrepend",e,{prepend:t,oldValue:function(){var t={position:this.getPositionInfo()};return this.isElement||(t.destHtml=e.html(null,!0),t.parentHtml=this.parent?this.parent.html(null,!0):null),t}},e.getPage()),this},U.prototype.indent=function(){var t=this.prev();return!(!t||!t.canHaveChildren()||(this.appendTo(t),0))},U.prototype.outdent=function(){this.prev();return!(this.next()||!this.parent||(this.insertAfter(this.parent),0))},U.prototype.canHaveChildren=function(){return this.isElement&&!this.singleTag&&"script"!==this.tagName},U.prototype.canDuplicate=U.prototype.canDelete=function(){return this.canHaveSiblings()},U.prototype.canHaveSiblings=function(){return["html","body","head"].indexOf(this.tagName)<0},U.prototype.canMove=function(){return this.canHaveSiblings()},U.prototype.canDelete=function(){return this.canHaveSiblings()},U.prototype.isCollapsed=function(){var t;return"head"==this.tagName?!this.getPage().show_head_in_tree:-1!==(t=this.getAttribute("data-pg-collapsed",-1))?"false"!==t:"svg"===this.tagName},U.prototype.appendTo=function(t){return this.appendPrepend(t,!1)},U.prototype.prependTo=function(t){return this.appendPrepend(t,!0)},U.prototype.append=function(t){t.appendTo(this)},U.prototype.prepend=function(t){t.prependTo(this)},U.prototype.getClasses=function(){var e,n,t=this.getAttr("class");return t?(t=X(t," "),e={},n=[],t.forEach(function(t){t.length&&!e[t]&&(n.push(t),e[t]=!0)}),n):[]},U.prototype.hasClass=function(t){return 0<=this.getClasses().indexOf(t)},U.prototype.addClass=function(e,n){this.withEmitEvent(function(){var t=this.getClasses();t.indexOf(e)<0&&(t.push(e),n?t=n(t):t.sort(),this.setAttr("class",t.join(" ")))},"addClass",{class:e})},U.prototype.removeClass=function(i,r){this.withEmitEvent(function(){for(var t=this.getClasses(),e=[],n=0;n<t.length;n++)t[n]!==i&&e.push(t[n]);e.length?(r?t=r(t):t.sort(),this.setAttr("class",e.join(" "))):this.removeAttr("class")},"removeClass",{class:i,hadClass:this.hasClass(i)})},U.prototype.removeClassesStartingWith=function(t){for(var e=this.getClasses(),n=[],i=0;i<e.length;i++)e[i].startsWith(t)&&n.push(e[i]);var r=this;n.forEach(function(t){r.removeClass(t)})},U.prototype.canAddClass=function(t){return!0},U.prototype.canRemoveClass=function(t){return this.hasClass(t)},function(t,e){for(var n=[],i=0;i<t.length;){var r,s=B(t,e,i);0<(s=s<0?t.length:s)-i&&(r=t.substr(i,s-i)).length&&n.push(r),i=s+e.length}return n});U.prototype.getAttrList=function(){if(!this.attrList){var r=this;if(this.attrList=[],this.attrListChanged=!1,!this.script&&!this.comment&&this.attributes&&0!==this.attributes.length){for(var t,s=0,e="",n=null,i=function(t,e){var n,i=o?B(r.attributes,t,s):r.attributes.indexOf(t,s);do{return i<0?(s=r.attributes.length,null):(n=r.attributes.substr(s,i-s),s=i+t.length,n)}while(s<r.attributes.length);return""},o=0<=this.attributes.indexOf("<");s<this.attributes.length;){var a=this.attributes.charAt(s);if(" "===a||"\t"===a||"\n"===a||"\r"===a||"/"===a||">"===a||"="===a){if(0<e.length){var h=!1;if(s<this.attributes.length-1)for(;s<this.attributes.length&&(" "===a||"="===a);)"="===a&&(h=!0),s++,a=this.attributes.charAt(s);if(h){var l='"',d=('"'===a||"'"===a?l=n=a:n=null,"");if(n)s++,d=i(n);else if(s<this.attributes.length-1)for(;d+=a,s++,a=this.attributes.charAt(s),s<this.attributes.length&&" "!==a&&">"!==a&&("/"!==a||s+1<this.attributes.length););this.attrList.push({name:e,value:d,quote:l,name_lc:e.toLowerCase()})}else s--,this.attrList.push({name:e,value:null,name_lc:e.toLowerCase()});e=""}}else{var c,l="<"==(t=e+=a)[0]&&u[t]||null;l&&(s++,e+=(c=i(l.close))+l.close,c.length)&&s--}s++}e.length&&this.attrList.push({name:e,value:null,name_lc:e.toLowerCase()})}}return this.attrList},U.prototype.hasAttr=U.prototype.hasAttribute=function(t){var e=this.getAttrList();return e?!!this.findAttrsInList(t,e).length:null},U.prototype.attr=function(t,e){return void 0===e?this.getAttr(t):this.setAttr(t,e)},U.prototype.findAttributesStartingWith=function(t){var e=this.getAttrList();if(!e)return[];t=t.toLowerCase();for(var n=[],i=0;i<e.length;i++)e[i].name_lc.startsWith(t)&&n.push(e[i]);return n},U.prototype.findAttrsInList=function(t,e,n){var i=[];t=t.toLowerCase();for(var r=0;r<e.length;r++)t===e[r].name_lc&&i.push(e[r]);return i},U.prototype.appendToAttribute=function(t,e,n){var i=this.getAttr(t);"string"==typeof i?i+=``+n+e:i=e,this.setAttr(t,i)},U.prototype.setAttr=U.prototype.setAttribute=function(i,r,s,o,t){return this.withEmitEvent(function(){if(null!==r)switch(typeof r){case"undefined":r=null;break;case"string":case"null":break;default:r=r.toString()}var t,e=this.getAttrList(),n=this.findAttrsInList(i,e);n.length?(t=o||n[n.length-1].quote||'"',s||'"'!==t||(r=m(r)),n[n.length-1].value=r,n[n.length-1].quote=t,n[n.length-1].name=i,n[n.length-1].name_lc=i.toLowerCase()):(s||o===`'`||(r=m(r)),e.push({name:i,value:r,quote:o||null,name_lc:i.toLowerCase()})),this.attrListChanged=!0,"data-pg-id"===i&&r==this.getId()&&(this.hasPgIdAttr=!0)},"setAttr",null,{attr:i,value:r,quote:o,domValue:pgAddProxyLinksToAttr(i,r),oldValue:function(){var t=this.findAttrsInList(i,this.getAttrList());return t.length?cloneObject(t[t.length-1]):null},info:t}),r},U.prototype.getAttr=U.prototype.getAttribute=function(t,e){void 0===e&&(e=null);var n=this.getAttrList();return n&&(n=this.findAttrsInList(t,n)).length?'"'===(n[n.length-1].quote||'"')?V(n[n.length-1].value):n[n.length-1].value:e},U.prototype.removeAttr=U.prototype.removeAttribute=function(n){this.withEmitEvent(function(){var t=this.getAttrList();n=n.toLowerCase(),this.attrList=[];for(var e=0;e<t.length;e++)t[e].name_lc!==n&&this.attrList.push(t[e]);t.length!==this.attrList.length&&(this.attrListChanged=!0),"data-pg-id"===n&&(this.hasPgIdAttr=!1)},"removeAttr",null,{attr:n,oldValue:function(){var t=this.findAttrsInList(n,this.getAttrList());return t.length?cloneObject(t[t.length-1]):null}})},U.prototype.siblings=function(t){var e=[],n=(e=t&&0<t.length?this.parent.find(t):this.parent.children).indexOf(this);return-1<n&&e.splice(n,1),e},U.prototype.siblingOne=function(t){var e=this.siblings(t);return e.length?e[0]:null},U.prototype.removeAttrIfStartsWith=function(e,t,n,i){if(this.isElement){var r="string"==typeof e?[e]:e,s=-1,o=!1;if(this.attrListChanged)this.getAttrList().length&&(o=!0);else if(this.attributes.length)for(var a=0;a<r.length;a++)if(0<=this.attributes.indexOf(r[a])){o=!0;break}if(o){for(var h=this.getAttrList(),l=0;l<h.length;l++){for(a=0;a<r.length;a++)if(h[l].name.startsWith(r[a])&&(!i||!h[l].name.match(i))){s=l;break}if(0<=s)break}if(0<=s){this.attrList.splice(s,1);for(l=s;l<this.attrList.length;l++)for(a=0;a<r.length;a++)if(h[l].name.startsWith(r[a])&&(!i||!h[l].name.match(i))){this.attrList.splice(l,1),l--;break}this.attrListChanged=!0}}}t&&this.walk(function(t){return t.isElement&&t.removeAttrIfStartsWith(e,!1,!0,i),!0}),n||this.emitEvent("removeAttrIfStartsWith",{starts_with:e,in_children:t})},U.prototype.removeAttrIfStartsWithStringWithEvents=function(e){var n=this;this.getAttrList().slice(0).forEach(function(t){t.name.startsWith(e)&&n.removeAttribute(t.name)})},U.prototype.removePinegrowAttributes=function(){this.removeAttrIfStartsWith("data-pg-",!1,!1,/^data\-pg\-ia/)},U.prototype.getAttributesString=function(t){if(!this.attrListChanged&&!t)return this.attributes;var e=[],n=this.getAttrList();if(t)for(var i=0;i<n.length;i++){var r=t(this,n[i].name,n[i].value,n[i].quote||'"');r&&r.length&&e.push(r)}else for(var s,i=0;i<n.length;i++)null===n[i].value?e.push(n[i].name):(s=n[i].quote||'"',e.push(n[i].name+"="+s+n[i].value+s));return 0<e.length?" "+e.join(" "):""},U.prototype.getInlineStylePropertyValue=function(t,e){var n=crsaGetInlineStylePropertyValue(this.getAttr("style"),t,e);return n=e?pinegrow.getOriginalUrl(n):n},U.prototype.setInlineStylePropertyValue=function(t,e,n,i,r){var s=crsaSetInlineStylePropertyValue(this.getAttr("style"),t,e,n,i,r);s?this.setAttr("style",s):this.removeAttr("style")},U.prototype.transformSrcsetUrls=function(t){var e=this.getAttr("srcset");null!==e&&this.setAttr("srcset",pgTransformSrcsetUrls(e,t))},U.prototype.getElementId=function(){return this.getAttr("id")},U.prototype.getId=function(){var t;return null===this.pgId&&this.attributes&&((t=this.attributes.match(T))?(this.pgId=t[1],this.hasPgIdAttr=!0):(this.pgId=0,this.hasPgIdAttr=!1)),0!==this.pgId?this.pgId:null},U.prototype.assignId=function(t){return this.hasPgIdAttr&&(this.attributes=this.attributes.replace(S,""),this.hasPgIdAttr=!1),this.pgId=t?t+"_"+ ++F:++F,this.pgId},U.prototype.getOrAssignId=function(){return this.getId()||this.assignId()},U.prototype.removePgIdAttributes=function(){this.walkSelfAndChildren(function(t){t.isElementOrScript&&t.removeAttribute("data-pg-id")})},U.prototype.assignIdAndAddToCatalog=function(t){var e=this;t?this.walkSelfAndChildren(function(t){return t.shouldHaveId()&&(t.getOrAssignId(),e.nodeCatalogue.add(t)),!0}):this.shouldHaveId()&&(this.getOrAssignId(),e.nodeCatalogue.add(this))},U.prototype.get$DOMElement=function(t){if(this.$el)return this.$el;if(t||(e=pinegrow.getCrsaPageOfPgParserNode(this))&&(t=e.get$Html()),t){var e=this.getId(),n=t.get(0);if(n.getAttribute("data-pg-id")==e)return t;n=n.querySelector('[data-pg-id="'+e+'"]');if(n)return $(n)}return null},U.prototype.getDOMElement=function(t){var e=this.get$DOMElement(t);return e?e.get(0):null},U.prototype.get$DOMElements=function(t,n){var i,r=this;return(t=t||this.getPage())?(i=[],t.getPageViews().forEach(function(t){var e;n&&n===t||(e=r.get$DOMElement(t.get$Html()))&&(e.pgPageView=t,i.push(e))}),i):[]},U.prototype.mapIdsToDomElement=function(t){var e=this.getId(),n=(e&&t.setAttribute("data-pg-id",e),0);if(t.hasChildNodes())for(var i=0;i<this.children.length;i++)if(this.children[i].shouldHaveId()){for(;n<t.childNodes.length&&1!==t.childNodes[n].nodeType;)n++;n<t.childNodes.length&&this.children[i].mapIdsToDomElement(t.childNodes[n]),n++}},U.prototype.isAutoClosedTag=function(){return!!a[this.tagName]};let y=new Map;!function t(e){try{for(const o in e){var n,i,r=parseInt(o),s="string"==typeof e;switch(o.constructor){case Object:t(o);break;case Array:y.has(o)||(y.set(o,o),t(e[o]));break;case String:Number.isInteger(r)||(n=o.replace("<",""),y.set(n,n))}e[o]&&!s&&("string"==typeof e[o]?(i=e[o].replace("<",""),y.set(i,i)):t(e[o]))}}catch(t){console.log(t)}}([...D,...H,..._,a,...D]);let z=[...y.values(),"path","!--","button","svg","canvas","title","script"];U.prototype.isValidTag=function(t=null){return z.includes(t?this.closingTag:this.tagName)},U.prototype.isSingleTag=function(){return 0<=D.indexOf(this.tagName)},U.prototype.isProperlyClosed=function(){return this.validate()},U.prototype.validate=function(t){if(!this.rootNode&&"text"!==this.tagName&&(!this.closed&&!a[this.tagName]||this.closingTag&&this.tagName!==this.closingTag.toLowerCase()))return!1;if(t&&this.attrList)for(var e=0;e<this.attrList.length;e++)if(this.attrList[e].name.startsWith("<")&&!p(this.attrList[e].name))return!1;return!0},U.prototype.getNestingLevel=function(){for(var t=0,e=this;e.parent;)t++,e=e.parent;return t},U.prototype.getOpeningTag=function(){return this.isElement?"<"+this.tagName+this.getAttributesString(q)+">":null},U.prototype.getClosingTag=function(){return this.isElement?"</"+(this.closingTag||this.tagName)+">":null},U.prototype.findChildNodeAtSourceIndex=function(t){for(var e=0;e<this.children.length;e++)if(t>=this.children[e].startStringIndex&&(e===this.children.length-1||t<this.children[e+1].startStringIndex))return this.children[e];return null},U.prototype.findNodeAtSourceIndex=function(t){var e=this.findChildNodeAtSourceIndex(t);if(e)for(var n=e.findChildNodeAtSourceIndex(t);n&&!n.textNode;)n=(e=n).findChildNodeAtSourceIndex(t);return e},U.prototype.getPath=function(t){void 0===t&&(t=!1);for(var e=this,n="";e.parent;)n=e.parent.getChildPos(e,!(e===this&&t))+(n.length?",":"")+n,e=e.parent;return n},U.prototype.getRelativePath=function(t,e){var n=this.getPath(e=void 0===e?!1:e),i=t.getPath();return n.startsWith(i)?n.replace(i+",",""):null},U.prototype.getNodeFromPath=function(t,e){if(""===t||","===t)return this;for(var n=t.split(","),i=this,r=0;r<n.length;r++)if(!(i=i.getChildAtPos(parseInt(n[r]),!0)))return e?i:null;return i},U.prototype.insertAtPath=function(t,e,n){void 0===n&&(n=!1);var i=e.split(","),r=parseInt(i.pop()),i=this.getNodeFromPath(i.join(","));return!!i&&(t.insertAtIndex(i,r,!n),!0)},U.prototype.getUniqueSelectors=function(t,e,n,i){function r(t){var e=n.find(t);return 1===e.length&&a===e[0]}var s=!1,o=(t=t||0,null),a=(void 0===e&&(e=2),void 0===s&&(s=!1),n=n||this.document,this),h=[],l=this.getAttr("data-pg");if(l){var d=`[data-pg="${l}"]`;if(r(d)&&(h.push(d),i))return h}l=this.getAttribute("id");if(!l||!r("#"+l)||l.match(/^[0-9]/)||(h.push("#"+l),!i)){var c="",u=[],g=["h1","html","body","head","header","main","footer","article","nav"],l=g.concat(["h2","h3","h4","h5","h6","section"]),p=!1;if(!(0<=l.indexOf(this.tagName)&&(u.push(this.tagName),p=!0,r(this.tagName))&&(h.push(this.tagName),i))){if(o&&this.hasClass(o)){if(u.push("."+o),r("."+o)&&(h.push("."+o),i))return h;if(c&&(u.push(c+"."+o),r(c+"."+o))&&(h.push(c+"."+o),i))return h}else{var f=this.getClasses();if(f.length<=3)for(var m=0;m<f.length;m++){var v=f[m];if(u.push(c+"."+v),r(c+"."+v)&&(h.push(c+"."+v),i))return h}}if(p||(u.push(this.tagName),!r(this.tagName))||(h.push(this.tagName),!i)){if(t<e&&0===h.length){l=null;if(this.parent){var y=(l=this.parent)===n?[""]:this.parent.getUniqueSelectors(t+1,e,n,!0);if(y.length){for(var C=0;C<y.length;C++)for(var I=y[C],b=0;b<u.length;b++){var N=(I+` > `+(d=u[b])).trim();if(r(N)&&(h.push(N),i))return h}if(0===h.length){var E=9999,A=null,d=(this.getClasses().forEach(function(t){var e=a.parent.find(">."+t);(null===A||e<E)&&(E=e,A=t)}),a.tagName),w=l.find(">"+d),x=w.indexOf(this);if(0<=x){x++;for(C=0;C<y.length;C++){I=y[C];if(r(N=(1===w.length?I+` > `+d:I+` > ${d}:nth-of-type(${x})`).trim())){if(h.push(N),i)return h}else s&&console.error("Should be unique: ",N,a)}}}}}}h.length&&h[0].indexOf(" ")<0&&(0<=(d=h[0]).indexOf("#")||0<=d.indexOf("data-pg=")||(o=!1,d.indexOf(".")<0&&g.indexOf(this.tagName)<0&&(o=!0),p=function(t){return t.hasAttr("id")||t.hasAttr("data-pg")||0<=g.indexOf(t.tagName)},this.parent&&(o||p(this.parent))?h.unshift(this.parent.getUniqueSelectors(0,5,null,!0)+" > "+d):this.parent&&this.parent.parent&&p(this.parent.parent)&&h.unshift(this.parent.parent.getUniqueSelectors(0,5,null,!0)+" "+d)))}}}return h},U.prototype.getUniqueSelector=function(t){var e=this.getUniqueSelectors(0,9999,t,!0);return e.length?e[0]:null},U.prototype.getPositionInSource=function(){var t={start:this.startStringIndex,end:-1},e=this.next(!0);return e?t.end=e.startStringIndex:this.parent&&(t.end=this.parent.getPositionInSource().end,e=this.parent.getClosingTag())&&(t.end-=e.length),t},U.prototype.getScriptIndent=function(){if(!this.script||!this.content)return 0;if(this.content.match(/^\s(if|while|foreach|for)/)&&0<this.content.indexOf(":"))return 1;if(this.content.match(/^\s(endif|endwhile|endforeach|endfor)/))return-1;if(this.content.match(/^\selse/))return-2;for(var t=0,e=0,n=0;n<this.content.length;n++){var i=this.content.charCodeAt(n);123===i?t++:125===i&&e++}return t===e?0:e<t?1:-1},U.prototype.changeToPhp=function(t){this.tagName="?php",this.tagNameOriginal="?php",this.script=!0,this.script_info=u["<?php"],this.isElement=!1,this.isElementOrScript=!0,this.textNode=!1,this.singleTag=!0,this.closed=!0,this.scriptClosed=!0,this.closingTag=null,this.content=t,this.selfClosed=!1},U.prototype.toString=U.prototype.toStringNEW=function(t,e,s,o,n,a,i,r){n=n||this.formatHtml,void 0===i&&(i=n);var h,l="",d=t=t||"",c="",u="",g="",p=!("assign_missing_ids"in(a=a||{indent:"    ",php_ids:!1,assign_missing_ids:!0,remove_collapsed:!1,remove_hidden:!1}))||a.assign_missing_ids,f=a.indent,m=(this.attrListChanged=this.isElement,this.attrListChanged&&(this.attributes=this.getAttributesString(function(t,e,n,i){var r;return!s&&"data-pg-id"===e||"data-pg-collapsed"===e&&a.remove_collapsed||"data-pg-hidden"===e&&a.remove_hidden?null:(r=null===n?e:e+"="+i+n+i,o?o(t,r,"attribute",e,n,i):r)}),this.attrListChanged=!1),this.attributes);if(this.script&&(m=this.indent_text?pgReindentText(this.content,t+f,t):this.content),h=this.getId(),(v=n&&_.indexOf(this.tagName)<0&&!this.selfClosed)&&(0<=H.indexOf(this.tagName)||0<=D.indexOf(this.tagName)))for(var v=!1,y=0;y<this.children.length;y++)if(!this.children[y].textNode&&_.indexOf(this.children[y].tagName)<0){v=!0;break}a.last_format=v;var C=a.php_ids||!1;if(v&&(l="\n"),t.length&&(l="\n"),this.rootNode&&(f=""),h&&(s?this.hasPgIdAttr||(u=" "+k+'="'+h+'"'):m=m.replace(T,"")),null===h&&s&&this.isElement&&p&&(h=this.assignId(),u=" "+k+'="'+h+'"'),u&&W(this.tagName)&&(C&&(g=" /*"+u+"*/"),u=""),e&&this.textNode)return v&&this.content.match(L)?0===(p=this.content.indexOf("\n"))&&1<this.content.length&&!a.parent_format||!(0<=p)&&this.content.length?" ":"":this.content;for(var I,b,N,E,A,w="",x=!0,S=!1,P=!1,O=!1,y=0;y<this.children.length;y++)!e&&this.children[y].textNode||(x=x&&this.children[y].textNode,-1!==(I=this.children[y].getScriptIndent())&&-2!==I||(t=t.substr(0,t.length-a.indent.length)),b=a.parent_format=v,O=P,P=this.children[y].textNode,O&&!P&&0<=M.indexOf(this.children[y].tagName)&&(b=!1),E=this.children[y].toStringNEW(t+f,e,s,o,"pre"!==this.tagName&&n,a,b),N=a.last_format,s&&W(this.children[y].tagName)&&C&&(E=t+f+"\x3c!--[start-pg-id:"+(A=this.children[y].getId())+"]--\x3e\n"+E+"\n"+t+f+"\x3c!--[end-pg-id:"+A+"]--\x3e"),1!==I&&-2!==I||(t+=a.indent),v&&(E.length?(P?E.length&&(A="","\n"===E.charAt(0)&&(E=E.replace(/^\n\s*/,""),S=!0,A="\n"),S)&&(E=A+t+f+E,!(y+1<this.children.length)||!this.children[y+1].textNode&&_.indexOf(this.children[y+1].tagName)<0)&&(E+="\n"):this.rootNode&&!w.length||!b||(E="\n"+E),S=N):y+1===this.children.length&&(E="\n"+E)),w+=E);return v&&this.children.length&&!x&&w.length&&!this.rootNode&&"\n"!==w.charAt(w.length-1)&&(w+="\n"),r?w:(v&&x&&(d=""),l="",a.last_format=v,o&&(m=o(this,m,"attrs")),this.rootNode?c+w:(null!==this.outputOnly&&"opening"!==this.outputOnly||(c+=(i?t:"")+"<"+(this.tagNameOriginal||this.tagName)+g+m+u+(this.selfClosed?"/":""),this.script&&this.script_info?this.scriptClosed&&(c+=this.script_info.close):c+=">"),this.content&&!this.script&&("php"===this.tagName?w+=pgReindentText(this.content,t):w+=this.content),c+=w=o?o(this,w,"content"):w,this.singleTag||!this.closingTag||null!==this.outputOnly&&"closing"!==this.outputOnly?c+=l:c+=(v?d:"")+"</"+this.closingTag+">"+l,o?o(this,c,"node"):c))},U.prototype.toStringOriginal=function(t,e,n,i){return"undefined"!=typeof pinegrow&&t&&"force"!==t&&(t=pinegrow.autoFormatHtml),this.toString(null,!0,!1,n,t,e,null,i)},U.prototype.toStringWithIds=function(t,e,n,i){return"undefined"!=typeof pinegrow&&t&&"force"!==t&&(t=pinegrow.autoFormatHtml),this.toString(null,!0,!0,n,t,e,null,i)},U.prototype.toStringContent=function(t,e){var n="",n="style"===this.tagName||"script"===this.tagName?this.content:this.toStringOriginal(t,e,null,!0);return n=pgReindentText(n),n=$.trim(n)},U.prototype.toDebug=function(){var t="";if(this.textNode?t="[TEXT] |"+this.content.replace(/\n/g,"\\n").replace(/ /g,"_")+"|":this.rootNode||(t=this.tagNameOriginal||this.tagName,this.closed&&(t+=" /"+this.closingTag)),this.children.length){t+="<ul>";for(var e=0;e<this.children.length;e++)t+=this.children[e].toDebug();t+="</ul>"}return this.rootNode?t:"<li>"+t+"</li>"},U.prototype.getTextContent=function(){return this.content.replace(/^\n\s*/,"")},U.prototype.containsServerSideScripts=function(i){var r=!1;return this.walkSelfAndChildren(function(t){if(i)for(var e=t.getAttrList(),n=0;n<e.length;n++)if(e[n].value&&p(e[n].value))return r=!0,!1;return!t.script_info&&"php"!==t.tagName||(r=!0,!1)}),r},U.prototype.canConvertToJade=function(){var e=!0;return this.walkSelfAndChildren(function(t){return!(t.script&&t.script_info||t.comment&&0<=t.attributes.indexOf("[if")||"style"===t.tagName&&t.content&&0<t.content.length||"script"===t.tagName&&t.content&&0<t.content.length)||(e=!1)}),e},U.prototype.toJade=function(t){t=t||"";var e="",n=pinegrow.getFormatHtmlOptions().indent;if(this.textNode){var i=this.getTextContent();if(0==i.length)return null;e="| "+i}else if(this.comment)(s=$.trim(this.attributes.replace(/\-\-$/,""))).startsWith("[if")?e=pgReindentText(this.toStringOriginal(!0),t,""):e+="//"+s;else if(this.rootNode)for(o=0;o<this.children.length;o++)null!==(a=this.children[o].toJade(t))&&(e+="\n"+a);else{var e=this.tagName,i=this.getAttr("id"),i=(i&&(e+="#"+i),this.getClasses()),r=(i.length&&(e+="."+i.join(".")),this.getAttrList());if(r.length){for(var s="",o=0;o<r.length;o++)"id"===r[o].name||"class"===r[o].name||0<=["data-pg-collapsed","data-pg-hidden","data-pg-id"].indexOf(r[o].name)||(0<s.length&&(s+=", "),s+=r[o].name,null!==r[o].value&&(s+='="'+r[o].value+'"'));s.length&&(e+="("+s+")")}if("script"!==this.tagName&&"style"!==this.tagName||!this.content.length)if(1===this.children.length&&this.children[0].textNode)e+=" "+this.children[0].getTextContent();else for(var a,o=0;o<this.children.length;o++)null!==(a=this.children[o].toJade(t+n))&&(e+="\n"+a);else e+="."+pgReindentText(this.content,t+n)}return t+e},U.prototype.findLastNonScriptChild=function(){for(var t=null,e=this.children.length-1;0<=e;e--)if(this.children[e].isElement){if("script"!==this.children[e].tagName)break;t=this.children[e]}return t?t.prev():null};function C(t){this.pgel=t,this.$el=null,this.$els=null,this.page=null,this.def=null,this.defs=null}var K=["src","url","href"],E=(U.prototype.getPlainTextName=function(t){return this.getName(t).replace(/<[^><]+>/g,"")},U.prototype.getName=function(t){if(this.isElementOrScript){var e=t&&t.max_text_len?t.max_text_len:20,n=!1,i=null,r=null,s=1,o=(t&&(s=t.num_classes||s,n=t.short||n,i=t.action_tag||null,r=t.classes_filter||null),""),a="",h=null;if(this.isElement?g=this.tagName:this.script_info&&(g=this.script_info.name_tag),t&&(t.name?(o+="<namedef>"+t.name+"&nbsp;</namedef>",a=t.name+":"):t.def&&(h=t.def.name,t.def.display_name&&(h="tag"===t.def.display_name?this.tagName:t.def.display_name(this,t.def)),o+=(t.def.namedef_class?`<namedef class="${t.def.namedef_class}">`:"<namedef>")+h+"&nbsp;</namedef>",a=h+":")),this.script_info)o="<namedef>"+g+"</namedef>",a+=g,o+="<nametext> | "+escapeHtmlCode(crsaGetSummaryStr(this.content,20))+"</nametext>",a+=this.content;else{a+=this.tagName,null===h?o+="<nametag>"+g+"</nametag>":h===g?o="<nametag>"+g+"</nametag>":g!==h.toLowerCase()&&(o+="<nametag>"+g+"</nametag>");var h=this.getAttr("id"),l=(h&&(15<h.length?o+=`<nameid title="#${h}">#${shortenString(h,15)}</nameid>`:o+="<nameid>#"+h+"</nameid>",a+="-#"+h),this.getClasses()),d=-1,c="",u=!1;if(r){var g=r(this);o+=g.html,a+=g.search_str,g.all_classes&&(o+='<nameclass title="'+g.all_classes+'">...</nameclass>')}else if(0<s){for(var p=0;p<l.length;p++)"pg-empty-placeholder"===l[p]||0<=l[p].indexOf("<")||(++d<s?o+="<nameclass>."+l[p]+"</nameclass>":d===s&&l.length>s&&(u=!0),a+=":."+l[p],c+=c.length?"."+l[p]:l[p]);u&&(o+='<nameclass title="'+c+'">...</nameclass>')}if(i&&(o+=" <action>"+i+"</action>"),!n){var f="";if("meta"===this.tagName){h=this.getAttr("name"),r=this.getAttr("content");h?f=h+'="'+(r||"")+'"':(g=this.getAttrList()).length&&(f=g[0].name+'="'+g[0].value+'"'),f.length&&(o+="<nametext> | "+f+"</nametext>"),a+=":"+f}else if(this.singleTag||("script"===this.tagName||"style"===this.tagName)&&!this.content)for(var m=0;m<K.length;m++){var v=this.getAttr(K[m]);if(v){o+="<nametext> | "+(f=shortenString(v,e,"...",!0))+"</nametext>",a+=":"+v;break}}else"script"===this.tagName||"style"===this.tagName?(f=$.trim(this.content)).length&&(o+="<nametext> | "+(f=(f=f.length>e?f.substr(0,e)+"...":f).replace(/\n/g," "))+"</nametext>",a+=":"+f):"a"===this.tagName?(i="",n=this.getAttribute("href"),h=2*e,(f=$.trim(this.text(null,!0).replace(/\n/g," "))).length&&f.length>e&&(f=f.substr(0,e)+"..."),n&&(i=crsaGetSummaryStr(n,h)+" | ",a+=":"+n),f.length&&(i+=f,a+=":"+f),o+="<nametext> | "+i+"</nametext>"):(f=$.trim(this.text(null,!0).replace(/\n/g," "))).length&&(o+="<nametext> | "+(f=f.length>e?f.substr(0,e)+"...":f)+"</nametext>",a+=":"+f)}t&&(t.search_string=a),this.dynamic&&(o+='<namedyn title="This element is created by Javascript code. Any changes done to the element will not be saved to the source code.">dyn</namedyn>')}return o}return this.textNode?(f=this.content.substr(0,e),t&&(t.search_string=f),"[TEXT] "+f):"Element"},U.prototype.getViewHtml=function(t){return(t=t||pinegrow.getCrsaPageOfPgParserNode(this))?t.getViewHTMLForElement(this):this.toStringWithIds()},U.prototype.getViewInnerHtml=function(t){return(t=t||pinegrow.getCrsaPageOfPgParserNode(this))?t.getViewInnerHTMLForElement(this):this.html()},U.prototype.toIncrementalDOM=function(){var n=IncrementalDOM.elementOpenStart,i=IncrementalDOM.elementOpenEnd,r=(IncrementalDOM.elementVoid,IncrementalDOM.elementClose),s=IncrementalDOM.attr,o=IncrementalDOM.text,a=this;return function(){if(a.isElement){var t=a.getAttrList();n(a.tagName,null,null,[]);for(var e=0;e<t.length;e++)s(t[e].name,t[e].value||"");i();for(e=0;e<a.children.length;e++)a.children[e].toIncrementalDOM()();r(a.tagName)}else a.textNode&&o(a.content,pgDecodeHtml)}},U.prototype.toIncrementalDOMInner=function(){var e=this;return function(){for(var t=0;t<e.children.length;t++)e.children[t].toIncrementalDOM()()}},U.prototype.patchDOMElementWithIncrementalDOM=function(e){var t=e.get(0);if(t.nodeName.toLowerCase()!==this.tagName)e.replaceWith(this.toStringWithIds());else{for(var n=[],i=(this.getAttrList().forEach(function(t){e.attr(t.name)!==t.value&&e.attr(t.name,t.value),n.push(t.name.toLowerCase())}),[]),r=0;r<t.attributes.length;r++){var s=t.attributes[r];s.specified&&n.indexOf(s.name.toLowerCase())<0&&i.push(s.name)}i.forEach(function(t){e.removeAttr(t)}),IncrementalDOM.patch(t,this.toIncrementalDOMInner())}},U.prototype.isHidden=function(){return this.hasAttr("data-pg-hidden")},U.prototype.hide=function(){this.isHidden()||this.withEmitEvent(function(){this.setAttr("data-pg-hidden")},"hide",null,{domOnly:!1})},U.prototype.show=function(){this.isHidden()&&this.withEmitEvent(function(){this.removeAttr("data-pg-hidden")},"show",null,{domOnly:!1})},U.prototype.update=function(t,e){this.withEmitEvent(function(){},"update",null,{domHtml:this.getViewHtml(),domPgId:e,oldValue:t})},U.prototype.updateInner=function(t){this.withEmitEvent(function(){},"updateInner",null,{domHtml:this.getViewInnerHtml(),oldValue:t})},U.prototype.executeScript=function(t){this.withEmitEvent(function(){},"executeScript",null,{domOnly:!0,code:t})},U.prototype.scrollTo=function(){this.withEmitEvent(function(){},"scrollTo",null,{domOnly:!0})},U.prototype.selected=function(){this.withEmitEvent(function(){},"selected",null,{domOnly:!0})},U.prototype.deselected=function(){"none"===this.getData("selectedCssRule")&&this.setData("selectedCssRule",null),this.withEmitEvent(function(){},"deselected",null,{domOnly:!0})},U.prototype.removeFromDOM=function(){this.withEmitEvent(function(){},"removeFromDOM",null,{domOnly:!0})},window.pgParser=function(){function W(t,e,n){if(0===e.length&&(i=0,n===V))return!0;if(2===i)return!1;if(0===i)if(n===M)i=1;else if(n===s||n===o)return i=2,!0;return(1!==i||"!--"!==e)&&t.match(r)}function k(t,e,n){return n!==m}var $=null,i=(this.singleTags=D,this.closingTags=a,this.assignIds=!0,this.idPrefix=null,0),r=/[a-z0-9\?!:\-\=\%\_\.]/i,M="!".charCodeAt(0),V="/".charCodeAt(0),m=">".charCodeAt(0),v="<".charCodeAt(0),y='"'.charCodeAt(0),C="'".charCodeAt(0),s="=".charCodeAt(0),o="%".charCodeAt(0);this.replaceExistingIds=!1,this.replaceExistingExternalIds=!1,this.nodeCatalogue=b,this.rootNode=null,this.getNode=function(t){return this.nodeCatalogue?this.nodeCatalogue.get(t):null},this.parse=function(t,A,w){$=t;var x=this,S=[],P=(this.rootNode=new U,this.rootNode.tagName="document",this.rootNode.rootNode=!0,this.rootNode.nodeCatalogue=this.nodeCatalogue,this.rootNode.document=this.rootNode,this.assignIds&&(this.rootNode.assignId(),this.nodeCatalogue)&&this.nodeCatalogue.add(this.rootNode),this.replacedIds=[],$.length),O=this.rootNode,T=0,L=function(t,e,n){var i="",r="?>",s=!1;do{var o=I($,T);if(o)s=!0,r=o.close;else if(N(r,$,T)){if(s=!1,i+=$.substr(T,r.length),T+=r.length,P<=T)break;continue}var a=$.charAt(T),h=$.charCodeAt(T);if(s)i+=a;else{if(!t(a,i,h))return i;i+=a;var l=!1;if(e&&(h===y||h===C)){var d=a,c=h,u=!1;for(T++;T<P;){if(a=$.charAt(T),(h=$.charCodeAt(T))===c&&!u){i+=a;break}if(n&&h===v){var l=!0,g=I($,T);if(g){var p=$.indexOf(g.close,T);if(T<=p){i+=$.substr(T,p-T+g.close.length),T=p+g.close.length,l=!1;continue}}}else if(n&&h===m&&!l){var f,p=!0,g=$.indexOf(d,T);if(0<=g&&((f=$.substr(g,2))!==d+`>`&&f!==d+` `&&f!==d+`/`||(p=!1)),p)return i+d}i+=a,T++}}}T++}while(T<P);return i},_=function(t){var e=null,n=$.indexOf(t,T);return T=n<0?(e=$.substr(T,P-T),P-1):(e=$.substr(T,n-T+t.length-1),n+t.length-1),e},H=function(t){var e;return"string"==typeof t&&!(48<=(e=t.charCodeAt(0))&&e<=57)},D=function(){for(var t=(new Date).getTime(),e=50,n=0,i=0,r=function(){if(++i%100==0&&(5e3<(new Date).getTime()-t||1e3<S.length))throw x.rootNode.remove(),x.rootNode=null,"Parsing the HTML source if taking too much time. Either it is too large, it includes too many syntax errors or it is a messy legacy HTML.";return!1};T<P;){if(r())return;if((I=$.indexOf("<",T))<0)(s=new U).tagName="text",s.content=$.substr(T),s.closingTag=s.tagName,s.textNode=!0,s.document=x.rootNode,s.content.length&&O.addChild(s),s.startStringIndex=T,T=P;else{if(T<I)for(var s,o=$.substr(T,I-T).split("\n"),a=T,h=0;h<o.length;h++)(s=new U).tagName="text",s.content=(0<h?"\n":"")+o[h],s.closingTag=s.tagName,s.textNode=!0,s.document=x.rootNode,s.startStringIndex=a,a+=s.content.length,s.content.length&&O.addChild(s);T=I+1;var l,d=L(W),c=d.toLowerCase(),u=T-d.length-1,g=!1,p=!1,f=null,m=(d.charCodeAt(0)===M&&0==d.indexOf("!--")?(l=_("--\x3e"),g=!0):(f=j[c]||null)?(l=_(f.close)).length&&l.endsWith(f.close[0])&&(l=l.substr(0,l.length-1),p=!0):l=L(k,!0,!0),!1),v=(l.length&&l.charCodeAt(l.length-1)===V&&(m=!0,l=l.substr(0,l.length-1)),0<=x.singleTags.indexOf(d.toLowerCase())||m);if(g&&(v=!0),T++,d.charCodeAt(0)!==V){(b=new U).tagName=c,b.tagNameOriginal=d,f?(b.script=!0,b.script_info=f,b.isElementOrScript=!0,b.content=l,l=null,b.scriptClosed=p):b.script=!1,b.attributes=l,b.comment=g,b.document=x.rootNode,b.selfClosed=m,b.isElement=!b.script&&!b.comment&&b.tagName.charCodeAt(0)!==M,b.isElementOrScript=b.isElement||b.script,b.startStringIndex=u,O.addChild(b),v?(b.singleTag=!0,b.closed=!0,b.endStringIndex=T):(S.push(O),O=b),"script"!==c&&"style"!==c&&"php"!==c&&"textarea"!==c||(b.content=_("</"+d+">"),b.closingTag=d,b.content.length>=d.length+2&&(b.content=b.content.substr(0,b.content.length-d.length-2)),b.closed=!0,O=S.length?S.pop():O,T++);f=b.getId();x.assignIds&&b.shouldHaveId()&&(f?x.replaceExistingIds?!x.replaceExistingExternalIds&&H(f)||(f=b.assignId(x.idPrefix)):(p=parseInt(f),!isNaN(p)&&F<p&&(F=p)):f=b.assignId(x.idPrefix),x.nodeCatalogue)&&x.nodeCatalogue.add(b),b.getAttrList()}else{var y=d.replace("/","").toLowerCase();if(O.tagName===y)O.closingTag=d.replace("/",""),O.closed=!0,O.endStringIndex=T,O=S.length?S.pop():O;else if(b&&b.singleTag&&y===b.tagName)b.closingTag=d.replace("/",""),b.closed=!0,b.endStringIndex=T,b.singleTag=!1;else{for(var C=-1,I=S.length-1;0<=I;I--)if(S[I].tagName===y){S[C=I].closingTag=d.replace("/",""),S[I].closed=!0;break}if(0<=C)for(;S.length>C+0;){if(r())return;var b=S.pop();if(b.closed=!0,x.closingTags[b.tagName]&&b.children.length)for(var N=0,E=b;N<b.children.length;){if(r())return;0<=x.closingTags[b.tagName].indexOf(b.children[N].tagName)?E=b.children[N].insertAfter(E):N++}}else O.closingTag=d.replace("/",""),O.closed=!0;O=S.length?S.pop():O}}}if(++n%10==0&&A)if(e<=(new Date).getTime()-t){w&&w(),setTimeout(D,10);break}}P<=T&&A&&A()};D()},this.find=function(t){return this.rootNode.find(t)},this.toStringOriginal=function(t,e,n){return this.rootNode.toStringOriginal(t,e,n)},this.toStringWithIds=function(t,e,n){return this.rootNode.toStringWithIds(t,e,n)},this.validate=function(t){return this.rootNode.validateTree(t)}}),A=window.PgNodeEvent=function(t,e,n,i,r){this.pgId=t.getId(),t.textNode?this.text=t.content:!this.pgId&&t.shouldHaveId()&&pgIsDev()&&console.error("PgNodeEvent: no pgId"),this.operation=e,this.data=null,this.objectId=null,this.eventType="PgNodeEvent",this.page=r,n&&(n instanceof U?this.objectId=n.getId():this.data=n),i&&(this.data=i),this.data||(this.data={})},w=(A.prototype.toDebugString=function(){var n=this.eventType+' "'+this.operation+'" ('+this.pgId+", "+this.objectId+", {";return this.data&&$.each(this.data,function(t,e){n+=t+': "'+e+'", '}),n+="})"},A.prototype.getPgel=function(){return getPgNodeByPgId(this.pgId)},!0);U.prototype.emitEvent=function(t,e,n,i){var r;return w&&(!(e&&e instanceof U)||e.getId())&&(i=i||this.getPage())?(r=new A(this,t,e,n,i),pinegrow.event_conductor&&pinegrow.event_conductor.emit(r),r):null},U.prototype.getEmitEvents=function(){return w},U.prototype.withEmitEvent=function(t,e,n,i,r){var s=w;return w=!1,s&&i&&"function"==typeof i.oldValue&&(i.oldValue=i.oldValue.call(this)),t.call(this),w=s,this.emitEvent(e,n,i,r)},U.prototype.withoutEvents=function(t){var e=w;w=!1,t.call(this),w=e},window.PgEventConductor=function(){var n=0,i=!1,r=[];this.emit=function(t){t.eventId=n++,i&&console.log("Emitted: "+t.toDebugString());for(var e=0;e<r.length;e++)r[e](t)},this.addLocalSubscriber=function(t,e){r.indexOf(t)<0&&(e<r.length?r.splice(e,0,t):r.push(t))},this.removeLocalSubscriber=function(t){var e=r.indexOf(t);0<=e&&r.splice(e,1)}},window.PgEventHandler=function(t,e){function n(t){i&&console.log("Received: "+t.toDebugString()),!r.on_event||!r.handle_dom_events&&t.data.domOnly||r.on_event(t)}var i=!1,r=this;this.handle_dom_events=!0,void 0===t&&(t=0),void 0===e&&(e=9999),this.on_event=null;this.start=function(){0===t&&pinegrow.event_conductor.addLocalSubscriber(n,e)},this.stop=function(){0===t&&pinegrow.event_conductor.removeLocalSubscriber(n)},this.destroy=function(){this.stop()}},window.PgNodeEventDOMPlayer=function(i,o){function r(t,e){var n,i,r;return!t&&e.text?$(document.createTextNode(e.text)):(i='[data-pg-id="'+t+'"]',a.getAttribute("data-pg-id")==t?$(a):(i=a.querySelector(i))?$(i):(i=b.get(t))?(n=pinegrow.getCrsaPageOfPgParserNode(i).getViewHTMLForElement(i),0<=["svg"].indexOf(i.tagName)?(n=n.replace(/\sdata\-pg\-collapsed(=\"[^\"]\")?/g,""),i=a.ownerDocument,r=(new DOMParser).parseFromString(n,"text/xml"),$(i.adoptNode(r.documentElement))):$(n)):null)}var s={},a=null,h=(this.play=function(t,e){if(!t.data.sourcePageView||t.data.sourcePageView!==o)try{a=e;var n=r(t.data.domPgId||t.pgId,t),i=t.data.objectHtml||t.data.objectDomHtml?$(t.data.objectDomHtml||t.data.objectHtml):t.objectId?r(t.objectId):null;if(n&&0!==n.length){if(!(t.operation in s))throw"PgNodeEventDOMPlayer: operation "+t.operation+" not implemented!";s[t.operation](t,n,i),h()}}catch(t){console.log("domPlayerError",t)}},this.destroy=function(){},function(){}),l=(s.update=function(t,e){var n=new E,n=(n.assignIds=!1,n.parse(t.data.domHtml||t.data.html||""),n.rootNode.children[0].toStringWithIds()),n=o.emulateCSSFeaturesInHTML(n);e.replaceWith(n)},s.updateInner=function(t,e){var n=t.data.domHtml||t.data.html||"",n=o.emulateCSSFeaturesInHTML(n);e.html(n)},s.addClass=function(t,e){e.addClass(t.data.class)},s.removeClass=function(t,e){e.removeClass(t.data.class)},s.setAttr=function(t,e,n){var i,r=t.data.domValue||t.data.value||"";"style"===t.data.attr&&(r=o.emulateCSSFeatures(r)),"src"===t.data.attr&&r&&r.startsWith("/")&&(i=pinegrow.getCurrentProject())&&!pgf.root_urls&&(r=i.getUrl()+r,r=pinegrow.getProxyUrl(r)),e.attr(t.data.attr,r),"src"===t.data.attr&&"IMG"===e.get(0).nodeName&&e.off(".pg").one("load.pg",function(t){pinegrow.selectedElements.repositionMenusDelayed()})},s.removeAttr=function(t,e,n){e.removeAttr(t.data.attr)},s.replaceTag=function(t,e,n){var i={};$.each(e.get(0).attributes,function(t,e){i[e.nodeName]=e.nodeValue}),e.replaceWith(function(){return $("<"+t.data.tag+"/>",i).append(e.contents())})},s.replaceWith=function(t,e,n){var i,r,s;e.is("body")?(r=t.data.objectDomHtml||t.data.objectHtml,r=o.emulateCSSFeaturesInHTML(r),(i=new E).assignIds=!1,i.nodeCatalogue=null,i.parse(r),r=i.rootNode.children[0],s=[],$.each(e.prop("attributes"),function(){s.push(this.name)}),s.forEach(function(t){e.removeAttr(t)}),r.getAttrList().forEach(function(t){e.attr(t.name,t.value||"")}),e.get(0).innerHTML=r.html(null,!0),t.data.detach&&console.log("player.replaceWith WARNING: Can not handle detach for body")):(n.insertBefore(e),t.data.detach?e.detach():e.remove())},s.replaceContentWithContentOf=function(t,e,n){t.data.detach?e.contents().detach():e.contents().remove(),e.append(n.contents())},s.replaceContentWithElement=function(t,e,n){t.data.detach?e.contents().detach():e.contents().remove(),e.append(n)},s.detag=function(t,e,n){e.contents().insertBefore(e),e.remove()},s.removeAllChildren=function(t,e,n){e.contents().remove()},s.html=function(t,e,n){e.html(t.data.domHtml||t.data.html)},s.remove=function(t,e,n){e.remove()},s.removeFromDOM=function(t,e,n){e.remove()},s.detach=function(t,e,n){e.detach()},s.appendPrepend=function(t,e,n){t.data.prepend?n.prepend(e):n.append(e)},s.insertBefore=function(t,e,n){e.insertBefore(n)},s.insertAfter=function(t,e,n){e.insertAfter(n)},s.insertAtIndex=function(t,e,n){n.get(0);var i=n.children(),i=t.data.element_index<i.length?$(i.get(t.data.element_index)):null;i?e.insertBefore(i):n.append(e)},0);s.executeScript=function(t,e,n){var i=a.ownerDocument.createElement("script"),r=(i.async=!1,t.data.code),s=null,o=/__THIS_ELEMENT__/g;r.match(o)&&(s=`data-pg-temp-id-`+l++,e.attr(s,""),r=r.replace(o,`document.querySelector('[${s}]')`)),i.text=r,a.ownerDocument.body.appendChild(i),setTimeout(function(){i.parentNode.removeChild(i),s&&e.removeAttr(s)},500)},s.scrollTo=function(t,e,n){crsaScrollToElementInIframe(i,e)},s.selected=function(t,e,n){},s.deselected=function(t,e,n){},s.hide=function(t,e,n){e.attr("data-pg-hidden","")},s.show=function(t,e,n){e.removeAttr("data-pg-hidden","")},s.removeAttrIfStartsWith=function(){}};C.prototype.get$El=function(){return this.$el||(this.$el=this.pgel.get$DOMElement(this.getPage().get$Html())),this.$el},C.prototype.get$Els=function(){return this.$els||(this.$els=this.pgel.get$DOMElements(this.getPage())),this.$els},C.prototype.getPage=function(){return this.page||(this.page=this.pgel.getPage()),this.page},C.prototype.getMainType=function(){return this.def||(this.def=this.getPage().getMainType(this.get$El(),this.pgel)),this.def},C.prototype.getAllTypes=function(){return this.defs||(this.$el=this.getPage().getAllTypes(this.get$El(),this.pgel)),this.defs},U.prototype.getInfo=function(){return new C(this)},"undefined"!=typeof module&&(module.exports={pgParser:E,pgParserNode:U})}();