"use strict";var pgIdCount=0,pgObjectCount=0,pgIdRegExp=new RegExp('\\s*data\\-pg\\-id="([0-9]+)"',"i"),pgIdRegExpReplace=new RegExp('\\s*data\\-pg\\-id="[0-9]+"',"ig"),pgWhiteSpaceRegExp=new RegExp("^[\\s\\n]*$"),pgSelectorCache={},pgDontFormat=["a","p","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6","br","textarea"],pgInlineTags=["a","span","em","strong","code","kbd","var","cite","abbr","acronym","sub","sup","i","b","big","small","u","s","strike","font","ins","del","br"],pgDontFormatIfAllChildrenNonFormat=["a","td","th"],pgAutoClosedTags={html:[],head:["body"],body:[],p:["p","address","article","aside","blockquote","div","dl","fieldset","footer","form","h1","h2","h3","h4","h5","h6","header","hr","menu","nav","ol","pre","section","table","ul"],dd:["dd"],dt:["dt"],option:["option","optgroup"],optgroup:["optgroup"],thead:["tbody","tfoot"],th:["td","th"],tbody:["tfoot"],tr:["tr"],td:["td","th"],tfoot:["tbody"],colgroup:[],li:["li"]},pgSingleTags=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr","!","!doctype"],pgScripts={"<?php":{type:"php",name:"PHP",close:"?>",name_tag:"&lt;?php"},"<?xml":{type:"xml",name:"XML",close:"?>",name_tag:"&lt;?xml"},"<?=":{type:"php",name:"PHP",close:"?>",name_tag:"&lt;?="},"<?":{type:"php",name:"PHP",close:"?>",name_tag:"&lt;?"},"<%":{type:"asp",name:"ASP &amp; ERB",close:"%>",name_tag:"&lt;%"}},pgScriptsByTag={},pgScriptsList=[],pgScriptsRegExp=null,pgScriptsTagsRegExp=null,pgScriptsStartsWithRegExp=null,pgScriptsStartsWithCloseRegExp=null,pgAttrScripts=[],pgParserEscapeRegExp=function(t){return(t="string"!=typeof t?String(t):t).replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},pgPrepareScripts=function(){var t,e,n,r="",i="",s="^",o="^";for(t in pgScripts)pgScripts.hasOwnProperty(t)&&((e=pgScripts[t]).open=t,pgScriptsList.push(e),n=e.open.replace("<",""),pgScriptsByTag[n]=e,pgDontFormat.push(n),pgSingleTags.push(n),r+=(r.length?"|":"")+"("+pgParserEscapeRegExp(e.open)+")",i+=(i.length?"|":"")+"("+pgParserEscapeRegExp(n)+")",s+=(1!==s.length?"|":"")+"("+pgParserEscapeRegExp(e.open)+")",o+=(1!==o.length?"|":"")+"("+pgParserEscapeRegExp(e.close)+")",pgAttrScripts.push([t,e.close]));pgScriptsRegExp=new RegExp(r,"i"),pgScriptsTagsRegExp=new RegExp(i,"i"),pgScriptsStartsWithRegExp=new RegExp(s,"ig"),pgScriptsStartsWithCloseRegExp=new RegExp(o,"ig")},pgHasScript=(pgPrepareScripts(),function(t){return t.match(pgScriptsRegExp)}),pgIsScriptTag=function(t){return t.match(pgScriptsTagsRegExp)},pgGetScriptInfo=function(t){return"<"==t[0]&&pgScripts[t]||null},pgGetScriptInfoByTag=function(t){return pgScriptsByTag[t]||null},pgTestAtIndex=function(t,e,n){return e.lastIndex=n,e.test(t)},pgMatchAtIndex=function(t,e,n){return e.lastIndex=n,e.exec(t)},pgAttributeEncode_re=/"/g,pgAttributeDecode_re=/&quot;/g,catchDisplayBug=function(t){},pgEncodeAttribute=function(t){return null===t?null:0<=t.indexOf("<?")?t:t.replace(pgAttributeEncode_re,"&quot;")},pgDecodeAttribute=function(t){return"string"!=typeof t?t:t.replace(pgAttributeDecode_re,'"')},pgParserException=function(t,e){this.message=t,this.name="pgParserException",this.reference=e,this.toString=function(){return this.message+" - "+escapeHtmlCode(this.reference)}},pgParserSourceProblem=function(t,e,n){this.message="Can not edit source node.",this.name="pgParserSourceProblem",this.node=t,this.$el=e;var r,s=[];this.add=function(t,e,n,r,i){r=r||"dynamic",s.push({obj_type:t,obj:e instanceof pgParserNode?e.getName():e,action:n,reason:r,msg:i})},t&&!n&&(r=pinegrow.isElementLocked(t))&&this.add("element",e?getElementName(e):"node","change","custom",r),this.ok=function(){return 0===s.length},this.toString=function(){if(0===s.length)return null;for(var t="<ul>",e=0;e<s.length;e++){var n,r="",i=s[e];switch(i.obj_type){case"class":r="Class <b>"+i.obj+"</b>";break;case"element":r="Element <b>"+i.obj+"</b>"}switch(i.reason,n="because it was either: <b>added by a script</b>, <b>removed from the page</b> or <b>changed in the code editor without refreshing the page</b>",i.msg&&(n=i.msg),i.action){case"remove":r+=" can't be <b>removed</b>";break;case"add":r+=" can't be <b>added</b>";break;case"change":r+=" can't be <b>changed</b>";break;case"find":r+=" does't <b>exist in source</b>";break;case"duplicate":r+=" cant't be <b>duplicated</b>"}t+="<li>"+(r+=" "+n+".")+"</li>"}return t+="</ul>"}},pgParserNodeCatalogue=function(){var n={};this.clear=function(){n={}},this.add=function(t){var e=t.getId();e&&(n[e]=t)},this.get=function(t){return t in n?n[t]:null},this.remove=function(t){var e=t.getId();e&&e in n&&t.objectCount===n[e].objectCount&&delete n[e]},this.logStat=function(){var t,e=0;for(t in n)n.hasOwnProperty(t)&&++e;console.log("pgParserNodeCatalogue - # objects: "+e)}},pgParserNodeCatalogueInstance=new pgParserNodeCatalogue,pgGetAttributesStringFilterOutPgIds=function(t,e,n,r){return"data-pg-id"===e?null:null===n?e:e+"="+r+n+r},pgCreateNodeFromHtml=function(t,e,n){var r=[],i=(void 0===e&&(e=!0),new pgParser);if(i.assignIds=!1,i.parse(t),!n&&1!==i.rootNode.children.length||0===i.rootNode.children.length)throw new pgParserException("Create node from html failed. Only one node can be created.",t);for(;0<i.rootNode.children.length;){var s=i.rootNode.children[0];if(e&&(s.assignIdAndAddToCatalog(!0),s.removePgIdAttributes()),s.detach(),s.emitEvent("nodeCreated",{html:t}),!n)return s;r.push(s)}return r},pgCreateNodeSimple=function(t,e){if((e=e||new pgParser).assignIds=!1,e.parse(t),1!==e.rootNode.children.length||0===e.rootNode.children.length)throw new pgParserException("Create node from html failed. Only one node can be created.",t);return e.rootNode.children[0]},pgCreate=pgCreateNodeFromHtml,pgCreateDocumentNode=function(t){var e=new pgParserNode;return e.tagName="document",e.rootNode=!0,e.nodeCatalogue=t||pgParserNodeCatalogueInstance,e.document=e},startsWithCaseInsensitive=function(t,e,n){for(var r=e.length,i=0;i<t.length;i++)if(r<=n+i||t.charAt(i)!==e.charAt(n+i).toLowerCase())return!1;return!0},startsWithCaseInsensitiveScript=function(t,e){for(var n=0;n<pgScriptsList.length;n++)if(startsWithCaseInsensitive(pgScriptsList[n].open,t,e))return pgScriptsList[n];return null};const pgAttr="data-pg-id";var pgParserNode=function(t){this.tagName=null,this.tagNameOriginal=null,this.textNode=!1,this.rootNode=!1,this.attributes="",this.closingTag=null,this.closed=!1,this.selfClosed=!1,this.content=null,this.singleTag=!1,this.script=!1,this.isElementOrScript=!1,this.script_info=null,this.scriptClosed=!1,this.children=[],this.parent=null,this.comment=!1,this.isElement=!1,this.pgId=null,this.hasPgIdAttr=!1,this.objectCount=++pgObjectCount,this.data={},this.dataUncloned=null,this.isDeleted=!1,this.formatHtml=!1,this.attrList=null,this.attrListChanged=!1,this.nodeCatalogue=pgParserNodeCatalogueInstance,this.document=null,this.clonedFromPgId=null,this.$el=null,this.startStringIndex=-1,this.endStringIndex=-1,this.outputOnly=null,this.dynamic=!1},pgSelectorCacheCounter=(pgParserNode.prototype.setDocument=function(e){this.walkSelfAndChildren(function(t){return t.document=e,t.catchedPage=null,!0})},pgParserNode.prototype.getPage=function(){var t;return this.document&&this.document.emulatedPage?this.document.emulatedPage:(this.catchedPage||(!(t="undefined"!=typeof pinegrow?pinegrow.getCrsaPageOfPgParserNode(this):null)&&this.removedFromPage&&(t=this.removedFromPage),this.catchedPage=t),this.catchedPage)},pgParserNode.prototype.getParent=function(){return this.parent},pgParserNode.prototype.getParentsBySelector=function(e){var n=[];return this.withParents(function(t){t.isSelector(e)&&n.push(t)}),n},pgParserNode.prototype.shouldHaveId=function(){return!(!this.script||!pgIsScriptTag(this.tagName))||this.isElement&&!this.script&&!this.textNode&&!this.comment},pgParserNode.prototype.getByPgId=function(t){var e=this.nodeCatalogue||(this.document?this.document.nodeCatalogue:null);return e?e.get(t):null},pgParserNode.prototype.withParents=function(t){for(var e=this.parent;e;){if(!1===t(e))return;e=e.parent}},pgParserNode.prototype.withSelfAndParents=function(t){!1!==t(this)&&this.withParents(t)},pgParserNode.prototype.walk=function(t,e){e=e||0;for(var n=this.children.length,r=0;r<n;r++){var i,s=this.children[r],o=t(s,e);if(n!==this.children.length&&(0<=(i=this.children.indexOf(s))?r=i:r--,n=this.children.length),!o)return;"skip_children"!==o&&s.walk(t,e+1)}},pgParserNode.prototype.walkSelfAndChildren=function(t){t(this,0)&&this.walk(t,1)},pgParserNode.prototype.makeListByWalkingSelfAndChildren=function(){var e=[];return this.walkSelfAndChildren(function(t){return t.isElementOrScript&&e.push(t),!0}),e},pgParserNode.prototype.updatePositionInformation=function(){var e=0;this.document.walkSelfAndChildren(function(t){return e++,t.positionInDocument=e,!0})},pgParserNode.prototype.getPositionInDocument=function(t){var e,n;return t&&this.hasOwnProperty("positionInDocument")?this.positionInDocument:(e=0,(n=this).document&&this.document.walkSelfAndChildren(function(t){return e++,t!==n}),this.positionInDocument=e)},pgParserNode.prototype.findOne=function(t,e){var n=this.find(t,!0,!1,e);return n.length?n[0]:null},pgParserNode.prototype.findOneKeepFindOrder=function(t){var e=this.find(t,!0,!1,null,null,null,!0);return e.length?e[0]:null},pgParserNode.prototype.findMaxItems=function(t,e,n,r){return this.find(t,!1,!1,n,e,r)},0),PG_CHAR_GREATER=(pgParserNode.prototype.find=function(t,e,n,r,i,s,o){100<++pgSelectorCacheCounter&&(pgSelectorCache={},pgSelectorCacheCounter=0),i=i||9999999999;for(var a,h=t.split(","),l=[],p=0;p<h.length;p++){for(var d=h[p].replace(/\s*\>\s*/g," >"),d=splitQuotesAware(d," "),g=[],c=0;c<d.length;c++)0<d[c].length&&g.push(d[c]);var u,f=this;1===(d=g).length&&"self"===$.trim(d[0])?l.push(this):(u=0,this.walk(function(t){if(t.positionInDocument=u++,r&&r(t))return"skip_children";if(t.isElementOrScript&&t.isTo(d,f)){if(l.indexOf(t)<0&&(l.push(t),i<=l.length))return!1;if(e)return!1}return!n||"skip_children"}))}return 1<h.length&&!o&&((a=new PgCollection).setList(l),a.orderByDocumentPosition(!0),l=a.getList(),a.setList(null)),l},pgParserNode.prototype.findIncludingSelf=function(t,e,n){var r;return e?this.isSelector(t)?this:this.findOne(t,n):(r=this.find(t,!1,!1,n),this.isSelector(t)&&r.unshift(this),r)},pgParserNode.prototype.findOneIncludingSelf=function(t){return this.findIncludingSelf(t,!0)},pgParserNode.prototype.findOneWithAttrValue=function(t,e,n){for(var r=this.find((n=n||"")+"["+t+"]"),i=0;i<r.length;i++)if(r[i].getAttr(t)===e)return r[i];return null},pgParserNode.prototype.findWithAttrValue=function(t,e,n){for(var r=[],i=this.find((n=n||"")+"["+t+"]"),s=0;s<i.length;s++)i[s].getAttr(t)===e&&r.push(i[s]);return r},pgParserNode.prototype.findWithMultipleAttrValues=function(n){var r=[];return this.walkSelfAndChildren(function(t){if(t.isElement){for(var e=0;e<n.length;e++)if(null!==n[e].value){if(t.getAttribute(n[e].name)!==n[e].value)return!0}else if(!t.hasAttribute(n[e].name))return!0;r.push(t)}return!0}),r},pgParserNode.prototype.goThroughAllUrls=function(i,t,e){function n(r){var t;r.isElement&&(s.forEach(function(e){var t=r.getAttr(e),n=null;t&&(n="srcset"===e?pgTransformSrcsetUrls(t,function(t){return i(t,e,r)}):i(t,e,r))!==t&&r.setAttr(e,n)}),e)&&(t=r.getInlineBackgroundImage())&&t!==(t=i(t,"style",r))&&r.setInlineBackgroundImage(t)}var s=["src","href","action","data-src","srcset","poster"];t?n(this):this.walkSelfAndChildren(function(t){return n(t),!0})},pgParserNode.prototype.rebaseAllUrls=function(n,r){this.goThroughAllUrls(function(t){var e;if(!r||(e=r(t))===t){e=t;try{e=new URL(t,n).href}catch(t){}}return e})},pgParserNode.prototype.mapLinksToNewLocation=function(s,o,a,t){var h;return crsaGetBaseForUrl(s)!==crsaGetBaseForUrl(o)&&(h=!1,this.goThroughAllUrls(function(t,e,n){var r,i;return!t||crsaIsAbsoluteUrl(t)||t.startsWith("/")||t.startsWith("#")?t:(r=crsaGetAbsoluteUrlForRelativeUrlAndParentUrl(t,s),i=crsaMakeLinkRelativeTo(r,o,!0),a&&isApp()&&i!==t&&(crsaIsFileExist(crsaMakeFileFromUrl(r))||(i=t)),h=h||i!==t,i)},!t),h)},pgParserNode.prototype.validateTree=function(e){var n=[];return this.walkSelfAndChildren(function(t){return t.validate(e)||n.push(t),!0}),n},">".charCodeAt(0)),pgNodeIsToHelperIsChildOf=function(t,e,n,r){if(0===(o=t.children.filter(function(t){return"text"!==t.tagName})).length)return!1;if("first-child"===n){if(o[0]!==e)return!1}else if("last-child"===n){if(o[o.length-1]!==e)return!1}else{var i=n.match(/nth-child\(([0-9]*)\)/);if(i){if((s=parseInt(i[1]))>o.length)return!1;if(o[s-1]!==e)return!1}else if(i=n.match(/nth-of-type\(([0-9]*)\)/)){var s,o=t.find(">"+r);if((s=parseInt(i[1]))>o.length)return!1;if(o[s-1]!==e)return!1}}return!0},pgNodeIsToHelperGetSepArray=function(t){var e;return!(t.indexOf(":")<0)&&1<(e=0<=t.indexOf('"')?splitQuotesAware(t,":"):t.split(":")).length&&[!0,e[0],e[1]]},pgParserNode_illegalParentsMap=(pgParserNode.prototype.isTo=function(t,e){for(var n=this,r=t.length-1,i=!0;n&&n!==e;){var s=!1;if(0<=r){var o=t[r],a=(o.charCodeAt(0)===PG_CHAR_GREATER&&(s=!0,o=o.substr(1)),pgNodeIsToHelperGetSepArray(o)),h=null;if(!1!==a&&(o=a[1],h=a[2]),n.isSelector(o)){if(h&&!pgNodeIsToHelperIsChildOf(n.parent,n,h,o))return!1;r--}else if(i)return!1}else if(i)return!1;i=s,n=n.parent}return!(0<=r||!n)},pgParserNode.prototype.is=function(t,e){for(var n=splitQuotesAware(t,","),r=0;r<n.length;r++){var i=(i=n[r].trim()).replace(/\s*\>\s*/g," >"),i=splitQuotesAware(i," ");if(this.isTo(i,e||this.document))return!0}return!1},pgParserNode.prototype.parseSelector=function(t){var e,n,r,i,s=t;return pgSelectorCache[s]||(e=n=null,(r=t.match(/\[([^\]]+)\]/))&&(n=r[1],t=t.replace(r[0],""),n=(r=n.split("="))[0],1<r.length)&&(e=r[1].replace(/(\"|\')/g,"")),r=t.match(/#[^\s\.]+/),i=t.match(/^[^\s\.#]+/),pgSelectorCache[s]={id:r?r[0].replace("#",""):null,tag:i?i[0]:null,classes:t.match(/\.[^\s\.#]+/g),attr:n,attrValue:e}),pgSelectorCache[s]},pgParserNode.prototype.isSelector=function(t,e){if(!e&&0<=t.indexOf(",")){for(var n=crsaSplitAndTrimList(t),r=0;r<n.length;r++)if(this.isSelector(n[r]))return!0;return!1}if((e=e||this.parseSelector(t)).id&&this.getElementId()!==e.id)return!1;if(e.tag&&0<e.tag.length&&"*"!==e.tag&&e.tag!==this.tagName)return!1;if(e.classes)for(r=0;r<e.classes.length;r++)if(!this.hasClass(e.classes[r].replace(".","")))return!1;if(e.attr){if(!this.hasAttr(e.attr))return!1;if(null!==e.attrValue&&this.getAttr(e.attr)!==e.attrValue)return!1}return!0},pgParserNode.prototype.closest=function(e,n){var r;if("function"==typeof e)return r=null,this.withSelfAndParents(function(t){return e(t)?(r=t,!1):(!n||t!==n)&&void 0}),r;for(var i=this,s=crsaSplitAndTrimList(e),o=s.map(function(t){return i.parseSelector(t)}),a=this;!function(){for(var t=0;t<s.length;t++)if(a.isSelector(s[t],o[t]))return!0;return!1}();){if(!a.parent)return null;if(n&&n===a)return null;a=a.parent}return a},pgParserNode.prototype.addChild=function(t){this.children.push(t),t.parent=this,t.setDocument(this.document)},pgParserNode.prototype.removeChild=function(e){this.withEmitEvent(function(){var t=this.getChildPos(e);0<=t&&this.children.splice(t,1),e.parent=null,e.setDocument(null)},"removeChild",e)},pgParserNode.prototype.removeChildWithoutEvent=function(t){var e=this.getChildPos(t);0<=e&&this.children.splice(e,1),t.parent=null,t.setDocument(null)},pgParserNode.prototype.setTagNameQuick=function(t){this.tagName=t,this.tagNameOriginal=t,0<=pgSingleTags.indexOf(t)?(this.closingTag=null,this.singleTag=!0):(this.selfClosed=!1,this.closingTag=t,this.singleTag=!1)},pgParserNode.prototype.replaceTag=function(t){var e=null,n=this.getEmitEvents()?this.toStringWithIds():null,r=this.getId();return this.withoutEvents(function(){this.tagName=t,this.tagNameOriginal=t,0<=pgSingleTags.indexOf(t)?(this.closingTag=null,this.singleTag=!0):(this.selfClosed=!1,this.closingTag=t,this.singleTag=!1),e=this.clone(null,!1),this.replaceWith(e)}),e.update(n,r),e},pgParserNode.prototype.makeSurePgelIsOK=function(){var t=this;for(this.getId()&&(t=getPgNodeByPgId(this.getId())||t);t.replacedWith;)t=t.replacedWith;return t},pgParserNode.prototype.isSameOrReplacedWith=function(t){for(var e=this;e;){if(e===t)return!0;e=e?.replacedWith}return!1},pgParserNode.prototype.replaceWith=function(t,e){var n;return this.parent?(n=this.getPage(),this.withEmitEvent(function(){t.insertBefore(this),this.replacedWith=t,this.replacedWithChain||(this.replacedWithChain=[]),this.replacedWithChain.push(t),t.data=this.data,e?this.detach():this.remove()},"replaceWith",t,{detach:e,objectHtml:t.toStringWithIds(),objectDomHtml:t.getViewHtml(n),oldValue:function(){return this.toStringWithIds(!0)}},n)):(this.replacedWith=t,this.replacedWithChain||(this.replacedWithChain=[]),this.replacedWithChain.push(t)),this},pgParserNode.prototype.replaceContentWithContentOf=function(t,e){this.withEmitEvent(function(){for(;this.children.length;)e?this.children[0].detach():this.children[0].remove();for(;t.children.length;)this.append(t.children[0])},"replaceContentWithContentOf",t,{detach:e})},pgParserNode.prototype.replaceContentWithElement=function(t,e){this.withEmitEvent(function(){for(;this.children.length;)e?this.children[0].detach():this.children[0].remove();this.append(t)},"replaceContentWithElement",t,{detach:e})},pgParserNode.prototype.replaceWithContentOf=function(t,e){this.withEmitEvent(function(){for(;t.children.length;)t.children[0].insertBefore(this);e?this.detach():this.remove()},"replaceWithContentOf",t,{detach:e})},pgParserNode.prototype.detag=function(){this.withEmitEvent(function(){if(this.parent){for(;this.children.length;)this.children[0].insertBefore(this);this.remove()}},"detag",null,{oldValue:function(){return{parentHtml:this.parent?this.parent.html(null,!0):null,parentId:this.parent?this.parent.getId():null}}},this.getPage())},pgParserNode.prototype.getHeadingLevel=function(){if(this.tagName){var t=this.tagName.match(/^h([0-9])+$/i);if(t)return parseInt(t[1])}return 0},pgParserNode.prototype.getHeadingLevelOfSection=function(){for(var t=this;1;){var e=t.getHeadingLevel();if(0<e)return e;e=t.prev();if(!(t=e||t.parent))return 0}},pgParserNode.prototype.rebaseHeadingLevel=function(n){this.walkSelfAndChildren(function(t){var e=t.getHeadingLevel();return 0<e&&(t.tagName=e="h"+(e+n),t.tagNameOriginal=e,t.closingTag)&&(t.closingTag=e),!0})},pgParserNode.prototype.callDefHandlers=function(e,n,r,i,s,t){var o;if(t=t||this.getPage())return(o=t.getAllTypes(null,this)).forEach(function(t){e in t&&t[e](n,r,i,s)}),o},pgParserNode.prototype.callDefHandlersOnParents=function(e,n,r,i,s,t){(t=t||this.getPage())&&this.withParents(function(t){t.callDefHandlers(e,-1===n?t:n,r,i,s)})},pgParserNode.prototype.getUniqueIdAttribute=function(t,e){return getUniqueId(t,this.getPage(),e)},pgParserNode.prototype.clone=function(t,e,n){var r=new pgParserNode;if(r.tagName=this.tagName,r.tagNameOriginal=this.tagNameOriginal,r.textNode=this.textNode,r.rootNode=this.rootNode,r.attributes=this.getAttributesString(),r.closingTag=this.closingTag,r.closed=this.closed,r.selfClosed=this.selfClosed,r.content=this.content,r.singleTag=this.singleTag,r.script=this.script,r.isElementOrScript=this.isElementOrScript,r.script_info=this.script_info,r.scriptClosed=this.scriptClosed,r.comment=this.comment,r.outputOnly=this.outputOnly,r.formatHtml=this.formatHtml,r.document=t?r:this.document,r.nodeCatalogue=this.nodeCatalogue||pgParserNodeCatalogueInstance,r.isElement=this.isElement,r.attrList=null,r.hasPgIdAttr=this.hasPgIdAttr,r.data=this.data,!t&&r.shouldHaveId()&&(r.assignId(),r.nodeCatalogue.add(r)),r.clonedFromPgId=this.getId()||this.clonedFromPgId,this.dynamic&&(r.page=this.page||null,r.dynamic=!0),e&&(r.pgId=r.clonedFromPgId),!n)for(var i=0;i<this.children.length;i++)r.addChild(this.children[i].clone(t,e));return r},pgParserNode.prototype.clearData=function(){null!==this.data&&(this.data={})},pgParserNode.prototype.setData=function(t,e){this.data[t]=e},pgParserNode.prototype.getData=function(t,e){return this.data[t]||e||null},pgParserNode.prototype.setDataUncloned=function(t,e){this.dataUncloned||(this.dataUncloned={}),this.dataUncloned[t]=e},pgParserNode.prototype.getDataUncloned=function(t,e){return this.dataUncloned?this.dataUncloned[t]||e||null:e||null},pgParserNode.prototype.getClonedFromPgEl=function(){return this.clonedFromPgId?getPgNodeByPgId(this.clonedFromPgId):null},pgParserNode.prototype.removeAllChildren=function(){this.withEmitEvent(function(){for(;this.children.length;)this.children[0].remove()},"removeAllChildren",null,{oldValue:function(){return this.html(null,!0)}})},pgParserNode.prototype.removeAllChildrenExcept=function(e){this.children.slice(0).forEach(function(t){t!==e&&t.remove()})},pgParserNode.prototype.html=function(n,t,e,r){if(null==n){if(this.script||this.textNode)return this.content;if(this.comment)return this.attributes;if("script"===this.tagName||"php"===this.tagName||"style"===this.tagName)return this.content;for(var i="",s=0;s<this.children.length;s++)i+=this.children[s].toString("",!0,t,null,!!e,e);return i}var o=null;return this.getEmitEvents()&&(o=this.html(null,!0)),this.withoutEvents(function(){if(this.script)this.content=n;else if("script"===this.tagName||"php"===this.tagName||this.textNode||"style"===this.tagName)this.content=n;else if(this.comment)this.attributes=n;else{var t=new pgParser;for(r&&(t.assignIds=!1),t.parse(n);this.children.length;)this.children[0].remove();for(var e=0;e<t.rootNode.children.length;e++)this.addChild(t.rootNode.children[e])}}),this.getEmitEvents()&&this.updateInner(o),this},pgParserNode.prototype.text=function(t,e){if(null==t){for(var n="",r=0;r<this.children.length;r++)"text"===this.children[r].tagName?n+=this.children[r].toString("",!0,!1):e||(n+=this.children[r].text());return n}this.html(t)},pgParserNode.prototype.replaceText=function(t,e,n){var r=!1,i=this.html(),s=new RegExp(pgParserEscapeRegExp(t),n?"g":"gi");if("style"===this.tagName||"script"===this.tagName)(o=this.content.replace(s,e))!==this.content&&(this.content=o,r=!0);else for(var o,a=0;a<this.children.length;a++)this.children[a].textNode&&(o=this.children[a].content.replace(s,e))!==this.children[a].content&&(this.children[a].content=o,r=!0);return r&&this.updateInner(i),r},pgParserNode.prototype.indentText=function(t,e,n,r){null===e&&(r=r||pinegrow.getFormatHtmlOptions(),null===n&&(n=this.getNestingLevel()),e=pinegrow.getHtmlIndentForLevel(n,r));for(var i=t.split("\n"),s="",o=0;o<i.length;o++)0<o&&(s+="\n"),s+=0===o?i[o]:e+i[o];return s},pgParserNode.prototype.isDescendantOf=function(t){for(var e=this.parent;null!=e;){if(e===t)return!0;e=e.parent}return!1},pgParserNode.prototype.contains=function(t){return t.isDescendantOf(this)},pgParserNode.prototype.getChildPos=function(t,e){if(!e)return this.children.indexOf(t);for(var n=-1,r=0;r<this.children.length;r++)if(this.children[r].isElementOrScript&&(n++,this.children[r]===t))return n;return-1},pgParserNode.prototype.index=function(){return this.parent?this.parent.getChildPos(this,!0):0},pgParserNode.prototype.getChildAtPos=function(t,e){for(var n=-1,r=0;r<this.children.length;r++)if(e&&!this.children[r].isElementOrScript||n++,n===t)return this.children[r];return null},pgParserNode.prototype.getFirstChild=function(t){return this.getChildAtPos(0,!(t=void 0===t?!1:t))},pgParserNode.prototype.isChildOf=function(t){return this.parent===t},pgParserNode.prototype.isEmpty=function(){if(0===this.children.length)return!0;for(var t=0;t<this.children.length;t++)if(this.children[t].isElementOrScript)return!1;return 0===this.text().trim().length},pgParserNode.prototype.isTextContentEmpty=function(){return this.textNode&&this.content.match(pgWhiteSpaceRegExp)},pgParserNode.prototype.hasChildren=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].isElementOrScript||t)return!0;return!1},pgParserNode.prototype.hasChildrenNotIncludingScripts=function(){for(var t=0;t<this.children.length;t++)if(this.children[t].isElement)return!0;return!1},pgParserNode.prototype.getChildren=function(t){for(var e=[],n=0;n<this.children.length;n++)(this.children[n].isElementOrScript||t)&&e.push(this.children[n]);return e},pgParserNode.prototype.getLinkElement=function(){var t;return"a"===this.tagName?this:1===(t=this.getChildren()).length&&"a"===t[0].tagName?t[0]:this.parent&&"a"===this.parent.tagName?this.parent:null},pgParserNode.prototype.hasTextOnly=function(t){for(var e=0;e<this.children.length;e++)if(!this.children[e].textNode)return!1;return 0<this.children.length},pgParserNode.prototype.findElementWithTextOnly=function(){var e=null;return this.walkSelfAndChildren(function(t){return!t.hasTextOnly()||(e=t,!1)}),e},pgParserNode.prototype.isTheOnlyChild=function(t){return this.parent&&1===this.parent.getChildren(t).length},pgParserNode.prototype.next=function(t){if(!this.parent)return null;for(var e=this.parent.getChildPos(this)+1,n=null;e<this.parent.children.length&&!n;){if(this.parent.children[e].isElementOrScript||t){n=this.parent.children[e];break}e++}return n},pgParserNode.prototype.prev=function(t){if(!this.parent)return null;for(var e=this.parent.getChildPos(this)-1,n=null;0<=e&&!n;){if(this.parent.children[e].isElementOrScript||t){n=this.parent.children[e];break}e--}return n},pgParserNode.prototype.prevWithSelector=function(t){for(var e=this.prev();e;){if(e.isSelector(t))return e;e=e.prev()}return e},pgParserNode.prototype.nextWithSelector=function(t){for(var e=this.next();e;){if(e.isSelector(t))return e;e=e.next()}return e},pgParserNode.prototype.first=function(t){for(var e=0;e<this.children.length;){if(this.children[e].isElementOrScript||t)return this.children[e];e++}return null},pgParserNode.prototype.last=function(t){for(var e=this.children.length-1;0<=e;){if(this.children[e].isElementOrScript||t)return this.children[e];e--}return null},pgParserNode.prototype.indexToElementIndex=function(t){for(var e=-1,n=0;n<this.children.length;n++)if(this.children[n].shouldHaveId()){if(e++,t===n)break}else if(t===n){e++;break}return-1===e?0:e},pgParserNode.prototype.insertAtIndex=function(i,s,o){return this.withEmitEvent(function(){var t=s;if(i!==this.parent||o||0<=(r=this.parent.children.indexOf(this))&&r<s&&t--,this.detach(),o&&0<t){for(var e=0,n=t,r=0;r<i.children.length;r++)if(i.children[r].shouldHaveId()){if(t===++e)break}else n++;t=n}t>=i.children.length?i.children.push(this):i.children.splice(t,0,this),this.parent=i,this.setDocument(this.parent.document)},"insertAtIndex",i,{index:s,element_index:i.indexToElementIndex(s),skip_text:o},i.getPage()),this},pgParserNode.prototype.insert=function(t,e){if(t.parent){var n=t.parent.getChildPos(t);if(n<0)throw new pgParserException("Node is not in parent child list",t);return this.withEmitEvent(function(){e?this.insertAtIndex(t.parent,n):this.insertAtIndex(t.parent,n+1)},"insert",t,{before:e},t.getPage()),this}},pgParserNode.prototype.detach=function(){this.withEmitEvent(function(){this.parent&&this.parent.removeChild(this)},"detach",null,{},this.getPage())},pgParserNode.prototype.detachAllChildren=function(e){for(var t=e?this.children.filter(function(t){return t!==e}):this.children;t.length;)t.pop().detach()},pgParserNode.prototype.moveChildrenToElement=function(r,i,s){var t,e,o;this===r||r.isDescendantOf(this)||(this.getEmitEvents()&&(t=r.html(null,!0),e=this.html(null,!0)),o=this,r.withoutEvents(function(){if(s){for(;o.children.length&&o.children[0].textNode&&0===o.children[0].content.trim().length;)o.children[0].remove();for(var t=o.children.length-1;0<=t&&(o.children[t].textNode&&0===o.children[t].content.trim().length);t--)o.children[t].remove();o.children.length&&o.children[0].textNode&&(o.children[0].content=o.children[0].content.trimLeft()),o.children.length&&o.children[o.children.length-1].textNode&&(o.children[o.children.length-1].content=o.children[o.children.length-1].content.trimRight())}if(i)for(var e=null;o.children.length;){var n=o.children[0];e?n.insertAfter(e):r.prepend(n),e=n}else for(;o.children.length;){n=o.children[0];r.append(n)}}),this.getEmitEvents()&&(r.updateInner(t),this.updateInner(e)))},pgParserNode.prototype.getPositionInfo=function(){var t,e=null;return this.parent&&!this.parent.rootNode&&this.parent.getId()&&(e={parent:this.parent.getId(),pos:this.parent.getChildPos(this)},(t=this.prev(!0))&&(e.afterId=t.getId()),t=this.next(!0))&&(e.beforeId=t.getId()),e},pgParserNode.prototype.placeAtPositionInfo=function(t){if(t){var e=pgParserNodeCatalogueInstance.get(t.parent);if(e){if(t.afterId){var n=pgParserNodeCatalogueInstance.get(t.afterId);if(n&&e===n.parent)return void this.insertAfter(n)}if(t.beforeId){n=pgParserNodeCatalogueInstance.get(t.beforeId);if(n&&e===n.parent)return void this.insertBefore(n)}this.insertAtIndex(e,t.pos)}}},pgParserNode.prototype.removeWithoutEvents=function(t,e){var n;for(e=e||[],t||(this.removedFromPage=this.getPage(),this.removedFromPgelWithId=this.parent?this.parent.getId():null),e&&(n=this.getId())&&e.push(n),this.parent&&this.parent.removeChildWithoutEvent(this),this.nodeCatalogue&&this.nodeCatalogue.remove(this),this.isDeleted=!0;this.children.length;)this.children[0].removeWithoutEvents(!0,e)},pgParserNode.prototype.getRemovedFromPgel=function(){return this.removedFromPgelWithId?this.nodeCatalogue.get(this.removedFromPgelWithId):null},pgParserNode.prototype.remove=function(t,e){e=e||[],this.nonElementChangesContainer(this.parent,function(){this.removeWithoutEvents(t,e)})||this.withEmitEvent(function(){this.removeWithoutEvents(t,e)},"remove",null,{removedIds:e,oldValue:function(){return{position:this.parent?this.parent.getChildPos(this):null,html:this.toStringWithIds(),parentId:this.parent?this.parent.getId():null,positionInfo:this.getPositionInfo()}}},this.getPage())},pgParserNode.prototype.insertBefore=function(t){return this.nonElementChangesContainer(t.parent,function(){this.insert(t,!0)})||this.withEmitEvent(function(){this.insert(t,!0)},"insertBefore",t,{oldValue:function(){return{position:this.getPositionInfo()}}},t.getPage()),this},pgParserNode.prototype.insertAfter=function(e){return this.nonElementChangesContainer(e.parent,function(){this.insert(e,!1)})||this.withEmitEvent(function(){this.insert(e,!1)},"insertAfter",e,{oldValue:function(){var t={position:this.getPositionInfo()};return this.isElement||(t.destHtml=e.parent?e.parent.html(null,!0):null,t.parentHtml=this.parent?this.parent.html(null,!0):null),t}},e.getPage()),this},pgParserNode.prototype.nonElementChangesContainer=function(t,e){var n;return!(this.isElement||!this.getEmitEvents()||!t||(n=t.html(null,!0),this.withoutEvents(function(){e.call(this)}),t.updateInner(n),0))},pgParserNode.prototype.appendPrependWithoutEvent=function(t,e){this.detach(),e?t.children.unshift(this):t.children.push(this),this.parent=t,this.setDocument(this.parent.document)},pgParserNode.prototype.appendPrepend=function(e,t){return this.nonElementChangesContainer(e,function(){this.appendPrependWithoutEvent(e,t)})||this.withEmitEvent(function(){this.appendPrependWithoutEvent(e,t)},"appendPrepend",e,{prepend:t,oldValue:function(){var t={position:this.getPositionInfo()};return this.isElement||(t.destHtml=e.html(null,!0),t.parentHtml=this.parent?this.parent.html(null,!0):null),t}},e.getPage()),this},pgParserNode.prototype.indent=function(){var t=this.prev();return!(!t||!t.canHaveChildren()||(this.appendTo(t),0))},pgParserNode.prototype.outdent=function(){this.prev();return!(this.next()||!this.parent||(this.insertAfter(this.parent),0))},pgParserNode.prototype.canHaveChildren=function(){return this.isElement&&!this.singleTag&&"script"!==this.tagName},pgParserNode.prototype.canDuplicate=pgParserNode.prototype.canDelete=function(){return this.canHaveSiblings()},pgParserNode.prototype.canHaveSiblings=function(){return["html","body","head"].indexOf(this.tagName)<0},pgParserNode.prototype.canMove=function(){return this.canHaveSiblings()},pgParserNode.prototype.canDelete=function(){return this.canHaveSiblings()},pgParserNode.prototype.isCollapsed=function(){var t;return"head"==this.tagName?!this.getPage().show_head_in_tree:-1!==(t=this.getAttribute("data-pg-collapsed",-1))?"false"!==t:"svg"===this.tagName},pgParserNode.prototype.fixSVGIfNeeded=function(){let e=!1;const n=this;return"svg"===this.tagName&&(this.getAttribute("version")||(this.setAttribute("version","1.1"),e=!0),this.getAttribute("xmlns")||(this.setAttribute("xmlns","http://www.w3.org/2000/svg"),e=!0),["fill","stroke","xml:space"].forEach(function(t){n.hasAttribute(t)&&null===n.getAttribute(t)&&(n.removeAttribute(t),e=!0)})),e},{p:"h1,h2,h3,h4,h5,h6,p,span",h1:"h1,h2,h3,h4,h5,h6,p,span",h2:"h1,h2,h3,h4,h5,h6,p,span",h3:"h1,h2,h3,h4,h5,h6,p,span",h4:"h1,h2,h3,h4,h5,h6,p,span",h5:"h1,h2,h3,h4,h5,h6,p,span",h6:"h1,h2,h3,h4,h5,h6,p,span"}),indexOfCodeAware=(pgParserNode.prototype.canInsertElement=function(t){return!!this.canHaveChildren()&&!(pgParserNode_illegalParentsMap[t.tagName]&&this.closest(pgParserNode_illegalParentsMap[t.tagName])||0<=["div","section","header","footer","main","nav","article"].indexOf(t.tagName)&&this.closest("h1,h2,h3,h4,h5,h6,p,span"))},pgParserNode.prototype.appendTo=function(t){return this.appendPrepend(t,!1)},pgParserNode.prototype.prependTo=function(t){return this.appendPrepend(t,!0)},pgParserNode.prototype.append=function(t){t.appendTo(this)},pgParserNode.prototype.prepend=function(t){t.prependTo(this)},pgParserNode.prototype.getClasses=function(t){var e,n,r=this.getAttr(t||"class");return r?(r=splitCodeAndBracketsAware(r," "),e={},n=[],r.forEach(function(t){t.length&&!e[t]&&(n.push(t),e[t]=!0)}),n):[]},pgParserNode.prototype.hasClass=function(t){return 0<=this.getClasses().indexOf(t)},pgParserNode.prototype.addClass=function(t,e,n){var r=this.getClasses();r.indexOf(t)<0&&this.withEmitEvent(function(){r.push(t),n||(e?r=e(r):r.sort()),this.setAttr("class",r.join(" "))},"addClass",{class:t})},pgParserNode.prototype.removeClass=function(n,r){var i=this.getClasses();0<=i.indexOf(n)&&this.withEmitEvent(function(){for(var t=[],e=0;e<i.length;e++)i[e]!==n&&t.push(i[e]);t.length?(r?i=r(i):i.sort(),this.setAttr("class",t.join(" "))):this.removeAttr("class")},"removeClass",{class:n,hadClass:this.hasClass(n)})},pgParserNode.prototype.removeClassesStartingWith=function(t){for(var e=this.getClasses(),n=[],r=0;r<e.length;r++)e[r].startsWith(t)&&n.push(e[r]);var i=this;n.forEach(function(t){i.removeClass(t)})},pgParserNode.prototype.canAddClass=function(t){return!0},pgParserNode.prototype.canRemoveClass=function(t){return this.hasClass(t)},function(t,e,n,r,i){var s=r||pgAttrScripts,o=i||"<",a=o instanceof RegExp,h=t.length,l=-1,p=n||0;if(a)for(;p<h;){if(t.charAt(p).match(o))for(var d=0;d<s.length;d++)if(startsWithCaseInsensitive(s[d][0],t,p)){if((g=t.indexOf(s[d][1],p+s[d][0].length))<0)return l;p=g+s[d][1].length}if(t.startsWith(e,p))return p;p++}else for(;p<h;){if(t.charAt(p)===o)for(var g,d=0;d<s.length;d++)if(startsWithCaseInsensitive(s[d][0],t,p)){if((g=t.indexOf(s[d][1],p+s[d][0].length))<0)return l;p=g+s[d][1].length}if(t.startsWith(e,p))return p;p++}return l}),splitCodeAware=function(t,e,n,r){for(var i=[],s=0;s<t.length;){var o,a=indexOfCodeAware(t,e,s,n,r);0<(a=a<0?t.length:a)-s&&(o=t.substr(s,a-s)).length&&i.push(o),s=a+e.length}return i};const pgSplitQuotesAware_Info=[['"','"'],["'","'"]];var splitQuotesAware=function(t,e){return splitCodeAware(t,e,pgSplitQuotesAware_Info,'"')};const pgSplitBracketAware_Info=[["[","]"],["(",")"]];var splitBracketsAware=function(t,e){return splitCodeAware(t,e,pgSplitBracketAware_Info,/[\[\(]/)};let pgSplitCodeAndBracketsAware_Info=pgAttrScripts.concat(pgSplitBracketAware_Info);var splitCodeAndBracketsAware=function(t,e){return splitCodeAware(t,e,pgSplitCodeAndBracketsAware_Info,/[\[\(\<]/)};pgParserNode.prototype.getAttrList=function(){if(!this.attrList){var i=this;if(this.attrList=[],this.attrListChanged=!1,!this.script&&!this.comment&&this.attributes&&0!==this.attributes.length){for(var s=0,t="",e=null,n=function(t,e){var n,r=o?indexOfCodeAware(i.attributes,t,s):i.attributes.indexOf(t,s);do{return r<0?(s=i.attributes.length,null):(n=i.attributes.substr(s,r-s),s=r+t.length,n)}while(s<i.attributes.length);return""},o=0<=this.attributes.indexOf("<");s<this.attributes.length;){var r=this.attributes.charAt(s);if(" "===r||"\t"===r||"\n"===r||"\r"===r||"/"===r||">"===r||"="===r){if(0<t.length){var a=!1;if(s<this.attributes.length-1)for(;s<this.attributes.length&&(" "===r||"="===r);)"="===r&&(a=!0),s++,r=this.attributes.charAt(s);if(a){var h='"',l=('"'===r||"'"===r?h=e=r:e=null,"");if(e)s++,l=n(e);else if(s<this.attributes.length-1)for(;l+=r,s++,r=this.attributes.charAt(s),s<this.attributes.length&&" "!==r&&">"!==r&&("/"!==r||s+1<this.attributes.length););this.attrList.push({name:t,value:l,quote:h,name_lc:t.toLowerCase()})}else s--,this.attrList.push({name:t,value:null,name_lc:t.toLowerCase()});t=""}}else{var p,h=pgGetScriptInfo(t+=r);h&&(s++,t+=(p=n(h.close))+h.close,p.length)&&s--}s++}t.length&&this.attrList.push({name:t,value:null,name_lc:t.toLowerCase()})}}return this.attrList},pgParserNode.prototype.hasAttr=pgParserNode.prototype.hasAttribute=function(t){var e=this.getAttrList();return e?!!this.findAttrsInList(t,e).length:null},pgParserNode.prototype.attr=function(t,e){return void 0===e?this.getAttr(t):this.setAttr(t,e)},pgParserNode.prototype.findAttributesStartingWith=function(t){var e=this.getAttrList();if(!e)return[];t=t.toLowerCase();for(var n=[],r=0;r<e.length;r++)e[r].name_lc.startsWith(t)&&n.push(e[r]);return n},pgParserNode.prototype.findAttrsInList=function(t,e,n){var r=[];t=t.toLowerCase();for(var i=0;i<e.length;i++)t===e[i].name_lc&&r.push(e[i]);return r},pgParserNode.prototype.appendToAttribute=function(t,e,n){var r=this.getAttr(t);"string"==typeof r?r+=``+n+e:r=e,this.setAttr(t,r)},pgParserNode.prototype.setAttr=pgParserNode.prototype.setAttribute=function(r,i,s,o,t){return this.withEmitEvent(function(){if(null!==i)switch(typeof i){case"undefined":i=null;break;case"string":case"null":break;default:i=i.toString()}var t,e=this.getAttrList(),n=this.findAttrsInList(r,e);n.length?(t=o||n[n.length-1].quote||'"',s||'"'!==t||(i=pgEncodeAttribute(i)),n[n.length-1].value=i,n[n.length-1].quote=t,n[n.length-1].name=r,n[n.length-1].name_lc=r.toLowerCase()):(s||o===`'`||(i=pgEncodeAttribute(i)),e.push({name:r,value:i,quote:o||null,name_lc:r.toLowerCase()})),this.attrListChanged=!0,"data-pg-id"===r&&i==this.getId()&&(this.hasPgIdAttr=!0),catchDisplayBug(i)},"setAttr",null,{attr:r,value:i,quote:o,domValue:pgAddProxyLinksToAttr(r,i),oldValue:function(){var t=this.findAttrsInList(r,this.getAttrList());return t.length?cloneObject(t[t.length-1]):null},info:t}),i},pgParserNode.prototype.getAttr=pgParserNode.prototype.getAttribute=function(t,e){void 0===e&&(e=null);var n=this.getAttrList();return n&&(n=this.findAttrsInList(t,n)).length?'"'===(n[n.length-1].quote||'"')?pgDecodeAttribute(n[n.length-1].value):n[n.length-1].value:e},pgParserNode.prototype.removeAttr=pgParserNode.prototype.removeAttribute=function(n){this.withEmitEvent(function(){var t=this.getAttrList();n=n.toLowerCase(),this.attrList=[];for(var e=0;e<t.length;e++)t[e].name_lc!==n&&this.attrList.push(t[e]);t.length!==this.attrList.length&&(this.attrListChanged=!0),"data-pg-id"===n&&(this.hasPgIdAttr=!1)},"removeAttr",null,{attr:n,oldValue:function(){var t=this.findAttrsInList(n,this.getAttrList());return t.length?cloneObject(t[t.length-1]):null}})},pgParserNode.prototype.siblings=function(t){var e=[],n=(e=t&&0<t.length?this.parent.find(t):this.parent.children).indexOf(this);return-1<n&&e.splice(n,1),e},pgParserNode.prototype.siblingOne=function(t){var e=this.siblings(t);return e.length?e[0]:null},pgParserNode.prototype.removeAttrIfStartsWith=function(e,t,n,r){if(this.isElement){var i="string"==typeof e?[e]:e,s=-1,o=!1;if(this.attrListChanged)this.getAttrList().length&&(o=!0);else if(this.attributes.length)for(var a=0;a<i.length;a++)if(0<=this.attributes.indexOf(i[a])){o=!0;break}if(o){for(var h=this.getAttrList(),l=0;l<h.length;l++){for(a=0;a<i.length;a++)if(h[l].name.startsWith(i[a])&&(!r||!h[l].name.match(r))){s=l;break}if(0<=s)break}if(0<=s){this.attrList.splice(s,1);for(l=s;l<this.attrList.length;l++)for(a=0;a<i.length;a++)if(h[l].name.startsWith(i[a])&&(!r||!h[l].name.match(r))){this.attrList.splice(l,1),l--;break}this.attrListChanged=!0}}}t&&this.walk(function(t){return t.isElement&&t.removeAttrIfStartsWith(e,!1,!0,r),!0}),n||this.emitEvent("removeAttrIfStartsWith",{starts_with:e,in_children:t})},pgParserNode.prototype.removeAttrIfStartsWithStringWithEvents=function(e){var n=this;this.getAttrList().slice(0).forEach(function(t){t.name.startsWith(e)&&n.removeAttribute(t.name)})},pgParserNode.prototype.removePinegrowAttributes=function(){this.removeAttrIfStartsWith("data-pg-",!1,!1,/^data\-pg\-ia/)},pgParserNode.prototype.getAttributesString=function(t){if(!this.attrListChanged&&!t)return this.attributes;var e=[],n=this.getAttrList();if(t)for(var r=0;r<n.length;r++){var i=t(this,n[r].name,n[r].value,n[r].quote||'"');i&&i.length&&e.push(i)}else for(var s,r=0;r<n.length;r++)null===n[r].value?e.push(n[r].name):(s=n[r].quote||'"',e.push(n[r].name+"="+s+n[r].value+s));return 0<e.length?" "+e.join(" "):""},pgParserNode.prototype.getInlineStylePropertyValue=function(t,e){var n=crsaGetInlineStylePropertyValue(this.getAttr("style"),t,e);return n=e?pinegrow.getOriginalUrl(n):n},pgParserNode.prototype.setInlineStylePropertyValue=function(t,e,n,r,i){var s=crsaSetInlineStylePropertyValue(this.getAttr("style"),t,e,n,r,i);s?this.setAttr("style",s):this.removeAttr("style")},pgParserNode.prototype.getInlineBackgroundImageFromBackground=function(){var t=this.getInlineStylePropertyValue("background");if(t){t=t.match(/url\(([^\)]+)\)/);if(t)return t[1].replace(/['"]/g,"")}return null},pgParserNode.prototype.getInlineBackgroundImage=function(){var t=this.getInlineStylePropertyValue("background-image",!0);return t||this.getInlineBackgroundImageFromBackground()},pgParserNode.prototype.setInlineBackgroundImage=function(t){var e;this.getInlineBackgroundImageFromBackground()?(e=(e=this.getInlineStylePropertyValue("background")).replace(/(url\(['"]?)([^\)'"]+)(['"]?\))/,`$1${t}$3`),this.setInlineStylePropertyValue("background",e)):this.setInlineStylePropertyValue("background-image",t,!0)},pgParserNode.prototype.transformSrcsetUrls=function(t){var e=this.getAttr("srcset");null!==e&&this.setAttr("srcset",pgTransformSrcsetUrls(e,t))},pgParserNode.prototype.getElementId=function(){return this.getAttr("id")},pgParserNode.prototype.getId=function(){var t;return null===this.pgId&&this.attributes&&((t=this.attributes.match(pgIdRegExp))?(this.pgId=t[1],this.hasPgIdAttr=!0):(this.pgId=0,this.hasPgIdAttr=!1)),0!==this.pgId?this.pgId:null},pgParserNode.prototype.assignId=function(t){return this.hasPgIdAttr&&(this.attributes=this.attributes.replace(pgIdRegExpReplace,""),this.hasPgIdAttr=!1),this.pgId=t?t+"_"+ ++pgIdCount:++pgIdCount,this.pgId},pgParserNode.prototype.getOrAssignId=function(){return this.getId()||this.assignId()},pgParserNode.prototype.removePgIdAttributes=function(){this.walkSelfAndChildren(function(t){t.isElementOrScript&&t.removeAttribute("data-pg-id")})},pgParserNode.prototype.assignIdAndAddToCatalog=function(t){var e=this;t?this.walkSelfAndChildren(function(t){return t.shouldHaveId()&&(t.getOrAssignId(),e.nodeCatalogue.add(t)),!0}):this.shouldHaveId()&&(this.getOrAssignId(),e.nodeCatalogue.add(this))},pgParserNode.prototype.get$DOMElement=function(t){if(this.$el)return this.$el;if(t||(e=pinegrow.getCrsaPageOfPgParserNode(this))&&(t=e.get$Html()),t){var e=this.getId(),n=t.get(0);if(n.getAttribute("data-pg-id")==e)return t;n=n.querySelector('[data-pg-id="'+e+'"]');if(n)return $(n)}return null},pgParserNode.prototype.getDOMElement=function(t){var e=this.get$DOMElement(t);return e?e.get(0):null},pgParserNode.prototype.get$DOMElements=function(t,n){var r,i=this;return(t=t||this.getPage())?(r=[],t.getPageViews().forEach(function(t){var e;n&&n===t||(e=i.get$DOMElement(t.get$Html()))&&(e.pgPageView=t,r.push(e))}),r):[]},pgParserNode.prototype.mapIdsToDomElement=function(t){var e=this.getId(),n=(e&&t.setAttribute("data-pg-id",e),0);if(t.hasChildNodes())for(var r=0;r<this.children.length;r++)if(this.children[r].shouldHaveId()){for(;n<t.childNodes.length&&1!==t.childNodes[n].nodeType;)n++;n<t.childNodes.length&&this.children[r].mapIdsToDomElement(t.childNodes[n]),n++}},pgParserNode.prototype.isAutoClosedTag=function(){return!!pgAutoClosedTags[this.tagName]};let _allTags=new Map;function setupHtmlTags(t){try{for(const s in t){var e,n,r=parseInt(s),i="string"==typeof t;switch(s.constructor){case Object:setupHtmlTags(s);break;case Array:_allTags.has(s)||(_allTags.set(s,s),setupHtmlTags(t[s]));break;case String:Number.isInteger(r)||(e=s.replace("<",""),_allTags.set(e,e))}t[s]&&!i&&("string"==typeof t[s]?(n=t[s].replace("<",""),_allTags.set(n,n)):setupHtmlTags(t[s]))}}catch(t){console.log(t)}}setupHtmlTags([...pgSingleTags,...pgDontFormatIfAllChildrenNonFormat,...pgDontFormat,pgAutoClosedTags,...pgSingleTags]);let allTags=[..._allTags.values(),"path","!--","button","svg","canvas","title","script"];pgParserNode.prototype.isValidTag=function(t=null){return allTags.includes(t?this.closingTag:this.tagName)},pgParserNode.prototype.isSingleTag=function(){return 0<=pgSingleTags.indexOf(this.tagName)},pgParserNode.prototype.isProperlyClosed=function(){return this.validate()},pgParserNode.prototype.validate=function(t){if(!this.rootNode&&"text"!==this.tagName&&(!this.closed&&!pgAutoClosedTags[this.tagName]||this.closingTag&&this.tagName!==this.closingTag.toLowerCase()))return!1;if(t&&this.attrList)for(var e=0;e<this.attrList.length;e++)if(this.attrList[e].name.startsWith("<")&&!pgHasScript(this.attrList[e].name))return!1;return!0},pgParserNode.prototype.getNestingLevel=function(){for(var t=0,e=this;e.parent;)t++,e=e.parent;return t},pgParserNode.prototype.getOpeningTag=function(){return this.isElement?"<"+this.tagName+this.getAttributesString(pgGetAttributesStringFilterOutPgIds)+">":null},pgParserNode.prototype.getClosingTag=function(){return this.isElement?"</"+(this.closingTag||this.tagName)+">":null},pgParserNode.prototype.findChildNodeAtSourceIndex=function(t){for(var e=0;e<this.children.length;e++)if(t>=this.children[e].startStringIndex&&(e===this.children.length-1||t<this.children[e+1].startStringIndex))return this.children[e];return null},pgParserNode.prototype.findNodeAtSourceIndex=function(t){var e=this.findChildNodeAtSourceIndex(t);if(e)for(var n=e.findChildNodeAtSourceIndex(t);n&&!n.textNode;)n=(e=n).findChildNodeAtSourceIndex(t);return e},pgParserNode.prototype.getPath=function(t){void 0===t&&(t=!1);for(var e=this,n="";e.parent;)n=e.parent.getChildPos(e,!(e===this&&t))+(n.length?",":"")+n,e=e.parent;return n},pgParserNode.prototype.getRelativePath=function(t,e){var n=this.getPath(e=void 0===e?!1:e),r=t.getPath();return n.startsWith(r)?n.replace(r+",",""):null},pgParserNode.prototype.getNodeFromPath=function(t,e){if(""===t||","===t)return this;for(var n=t.split(","),r=this,i=0;i<n.length;i++)if(!(r=r.getChildAtPos(parseInt(n[i]),!0)))return e?r:null;return r},pgParserNode.prototype.insertAtPath=function(t,e,n){void 0===n&&(n=!1);var r=e.split(","),i=parseInt(r.pop()),r=this.getNodeFromPath(r.join(","));return!!r&&(t.insertAtIndex(r,i,!n),!0)},pgParserNode.prototype.getUniqueSelectors=function(t,e,n,r,i){function s(t){var e=n.find(t);return 1===e.length&&h===e[0]}var o=!1,a=(t=t||0,null),h=(void 0===e&&(e=2),void 0===o&&(o=!1),n=n||this.document,this),l=[],p=this.getAttr("data-pg");if(p){var d=`[data-pg="${p}"]`;if(s(d)&&(l.push(d),r))return l}p=this.getAttr("data-pg-name");if(p){d=`[data-pg-name="${p}"]`;if(s(d)&&(l.push(d),r))return l}p=this.getAttribute("id");if(!p||!s("#"+p)||p.match(/^[0-9]/)||(l.push("#"+p),!r)){var g="",c=[],u=["h1","html","body","head","header","main","footer","article","nav"],p=u.concat(["h2","h3","h4","h5","h6","section"]),f=!1;if(!(0<=p.indexOf(this.tagName)&&(c.push(this.tagName),f=!0,s(this.tagName))&&(l.push(this.tagName),r))){if(a&&this.hasClass(a)){if(c.push("."+a),s("."+a)&&(l.push("."+a),r))return l;if(g&&(c.push(g+"."+a),s(g+"."+a))&&(l.push(g+"."+a),r))return l}else{var m=this.getClasses();if((m=i?m.filter(function(t){return i.indexOf(t)<0}):m).length<=3)for(var v=0;v<m.length;v++){var N=m[v];if(c.push(g+"."+N),s(g+"."+N)&&(l.push(g+"."+N),r))return l}}if(f||(c.push(this.tagName),!s(this.tagName))||(l.push(this.tagName),!r)){if(t<e&&0===l.length){p=null;if(this.parent){var P=(p=this.parent)===n?[""]:this.parent.getUniqueSelectors(t+1,e,n,!0);if(P.length){for(var y=0;y<P.length;y++)for(var I=P[y],C=0;C<c.length;C++){var A=(I+` > `+(d=c[C])).trim();if(s(A)&&(l.push(A),r))return l}if(0===l.length){var S=9999,E=null,d=(this.getClasses().forEach(function(t){var e=h.parent.find(">."+t);(null===E||e<S)&&(S=e,E=t)}),h.tagName),b=p.find(">"+d),x=b.indexOf(this);if(0<=x){x++;for(y=0;y<P.length;y++){I=P[y];if(s(A=(1===b.length?I+` > `+d:I+` > ${d}:nth-of-type(${x})`).trim())){if(l.push(A),r)return l}else o&&console.error("Should be unique: ",A,h)}}}}}}l.length&&l[0].indexOf(" ")<0&&(0<=(d=l[0]).indexOf("#")||0<=d.indexOf("data-pg=")||(a=!1,d.indexOf(".")<0&&u.indexOf(this.tagName)<0&&(a=!0),f=function(t){return t.hasAttr("id")||t.hasAttr("data-pg")||0<=u.indexOf(t.tagName)},this.parent&&(a||f(this.parent))?l.unshift(this.parent.getUniqueSelectors(0,5,null,!0)+" > "+d):this.parent&&this.parent.parent&&f(this.parent.parent)&&l.unshift(this.parent.parent.getUniqueSelectors(0,5,null,!0)+" "+d)))}}}return l},pgParserNode.prototype.getUniqueSelector=function(t,e){var n=this.getUniqueSelectors(0,9999,t,!0,e);return n.length?n[0]:null},pgParserNode.prototype.getPositionInSource=function(){var t={start:this.startStringIndex,end:-1},e=this.next(!0);return e?t.end=e.startStringIndex:this.parent&&(t.end=this.parent.getPositionInSource().end,e=this.parent.getClosingTag())&&(t.end-=e.length),t},pgParserNode.prototype.getScriptIndent=function(){if(!this.script||!this.content)return 0;if(this.content.match(/^\s(if|while|foreach|for)/)&&0<this.content.indexOf(":"))return 1;if(this.content.match(/^\s(endif|endwhile|endforeach|endfor)/))return-1;if(this.content.match(/^\selse/))return-2;for(var t=0,e=0,n=0;n<this.content.length;n++){var r=this.content.charCodeAt(n);123===r?t++:125===r&&e++}return t===e?0:e<t?1:-1},pgParserNode.prototype.changeToPhp=function(t){this.tagName="?php",this.tagNameOriginal="?php",this.script=!0,this.script_info=pgScripts["<?php"],this.isElement=!1,this.isElementOrScript=!0,this.textNode=!1,this.singleTag=!0,this.closed=!0,this.scriptClosed=!0,this.closingTag=null,this.content=t,this.selfClosed=!1},pgParserNode.prototype.toString=pgParserNode.prototype.toStringNEW=function(t,e,s,o,n,a,r,i){n=n||this.formatHtml,void 0===r&&(r=n);var h,l="",p=t=t||"",d="",g="",c="",u=!("assign_missing_ids"in(a=a||{indent:"    ",php_ids:!1,assign_missing_ids:!0,remove_collapsed:!1,remove_hidden:!1}))||a.assign_missing_ids,f=a.indent,m=(this.attrListChanged=this.isElement,this.attrListChanged&&(this.attributes=this.getAttributesString(function(t,e,n,r){var i;return!s&&"data-pg-id"===e||"data-pg-collapsed"===e&&a.remove_collapsed||"data-pg-hidden"===e&&a.remove_hidden?null:(i=null===n?e:e+"="+r+n+r,o?o(t,i,"attribute",e,n,r):i)}),this.attrListChanged=!1),this.attributes);if(this.script&&(m=this.indent_text?pgReindentText(this.content,t+f,t):this.content),h=this.getId(),(v=n&&pgDontFormat.indexOf(this.tagName)<0&&!this.selfClosed)&&(0<=pgDontFormatIfAllChildrenNonFormat.indexOf(this.tagName)||0<=pgSingleTags.indexOf(this.tagName)))for(var v=!1,N=0;N<this.children.length;N++)if(!this.children[N].textNode&&pgDontFormat.indexOf(this.children[N].tagName)<0){v=!0;break}a.last_format=v;var P=a.php_ids||!1;if(v&&(l="\n"),t.length&&(l="\n"),this.rootNode&&(f=""),h&&(s?this.hasPgIdAttr||(g=" "+pgAttr+'="'+h+'"'):m=m.replace(pgIdRegExp,"")),null===h&&s&&this.isElement&&u&&(h=this.assignId(),g=" "+pgAttr+'="'+h+'"'),g&&pgIsScriptTag(this.tagName)&&(P&&(c=" /*"+g+"*/"),g=""),e&&this.textNode)return v&&this.content.match(pgWhiteSpaceRegExp)?0===(u=this.content.indexOf("\n"))&&1<this.content.length&&!a.parent_format||!(0<=u)&&this.content.length?" ":"":this.content;for(var y,I,C,A,S,E,b="",x=!0,w=!1,O=!1,T=!1,N=0;N<this.children.length;N++)!e&&this.children[N].textNode||(x=x&&this.children[N].textNode,-1!==(y=this.children[N].getScriptIndent())&&-2!==y||(t=t.substr(0,t.length-a.indent.length)),I=a.parent_format=v,T=O,O=this.children[N].textNode,T&&!O&&0<=pgInlineTags.indexOf(this.children[N].tagName)&&(I=!1),S=this.children[N].toStringNEW(t+f,e,s,o,"pre"!==this.tagName&&n,a,I),C=a.last_format,(A=this.children[N].format_force_inline||!1)&&(S=S.trim()),s&&pgIsScriptTag(this.children[N].tagName)&&P&&(S=t+f+"\x3c!--[start-pg-id:"+(E=this.children[N].getId())+"]--\x3e\n"+S+"\n"+t+f+"\x3c!--[end-pg-id:"+E+"]--\x3e"),1!==y&&-2!==y||(t+=a.indent),v&&!A&&(S.length?(O?S.length&&(E="","\n"===S.charAt(0)&&(S=S.replace(/^\n\s*/,""),w=!0,E="\n"),w)&&(S=E+t+f+S,!(N+1<this.children.length)||!this.children[N+1].textNode&&pgDontFormat.indexOf(this.children[N+1].tagName)<0)&&(S+="\n"):this.rootNode&&!b.length||!I||(S="\n"+S),w=C):N+1===this.children.length&&(S="\n"+S)),b+=S);return v&&this.children.length&&!x&&b.length&&!this.rootNode&&"\n"!==b.charAt(b.length-1)&&(b+="\n"),i?b:(v&&x&&(p=""),l="",a.last_format=v,o&&(m=o(this,m,"attrs")),this.rootNode?d+b:(null!==this.outputOnly&&"opening"!==this.outputOnly||(d+=(r?t:"")+"<"+(this.tagNameOriginal||this.tagName)+c+m+g+(this.selfClosed?"/":""),this.script?this.script_info?this.scriptClosed&&(d+=this.script_info.close):d+=">":d+=(this.isElement&&this.singleTag&&"!"!==this.tagName&&"!doctype"!==this.tagName&&d.endsWith("/"),">")),this.content&&!this.script&&("php"===this.tagName?b+=pgReindentText(this.content,t):b+=this.content),d+=b=o?o(this,b,"content"):b,this.singleTag||!this.closingTag||null!==this.outputOnly&&"closing"!==this.outputOnly?d+=l:d+=(v?p:"")+"</"+this.closingTag+">"+l,o?o(this,d,"node"):d))},pgParserNode.prototype.toStringOriginal=function(t,e,n,r){return"undefined"!=typeof pinegrow&&t&&"force"!==t&&(t=pinegrow.autoFormatHtml),this.toString(null,!0,!1,n,t,e,null,r)},pgParserNode.prototype.toStringWithIds=function(t,e,n,r){return"undefined"!=typeof pinegrow&&t&&"force"!==t&&(t=pinegrow.autoFormatHtml),this.toString(null,!0,!0,n,t,e,null,r)},pgParserNode.prototype.toStringContent=function(t,e){var n="",n="style"===this.tagName||"script"===this.tagName?this.content:this.toStringOriginal(t,e,null,!0);return n=pgReindentText(n),n=$.trim(n)},pgParserNode.prototype.toStringForCodeEditorOrSave=function(t,e,n,r){var i,s=/ data\-pg\-collapsed(="[^"]*")?/g,o=/ data\-pg\-hidden(="[^"]*")?/g,a=null,h=null,l=(pinegrow.httpServer&&(a=pinegrow.httpServer.url+"/",h=new RegExp(escapeRegExp(a),"g")),n&&(o=s=null),this);return e&&(r||(l=l.clone(!0)),i="1"!==pinegrow.getSetting("show-placeholders","1"),l.withoutEvents(function(){l.walk(function(t){return t.isElement&&(!t.hasClass("pg-empty-placeholder")||!i&&t.isEmpty()||t.removeClass("pg-empty-placeholder"),pgf.empty_ph_attribute)&&t.hasAttribute(pgf.empty_ph_attribute)&&"always"!==t.getAttribute(pgf.empty_ph_attribute)&&(!i&&t.isEmpty()||t.removeAttribute(pgf.empty_ph_attribute)),!0})}),t)&&t.callFrameworkHandler("on_filter_page_before_save",l),l.toStringOriginal(!0,pinegrow.getFormatHtmlOptions(),function(t,e,n){var r;return"attrs"==n?(h&&(e=e.replace(h,"")),s&&(e=e.replace(s,"")),o&&(e=e.replace(o,""))):"content"==n&&"style"==t.tagName&&(r=pinegrow.stylesheets.findCrsaInlineStylesheet(t))&&(e=r.filterSource(e)),e})},pgParserNode.prototype.toDebug=function(){var t="";if(this.textNode?t="[TEXT] |"+this.content.replace(/\n/g,"\\n").replace(/ /g,"_")+"|":this.rootNode||(t=this.tagNameOriginal||this.tagName,this.closed&&(t+=" /"+this.closingTag)),this.children.length){t+="<ul>";for(var e=0;e<this.children.length;e++)t+=this.children[e].toDebug();t+="</ul>"}return this.rootNode?t:"<li>"+t+"</li>"},pgParserNode.prototype.getTextContent=function(){return this.content.replace(/^\n\s*/,"")},pgParserNode.prototype.containsServerSideScripts=function(r){var i=!1;return this.walkSelfAndChildren(function(t){if(r)for(var e=t.getAttrList(),n=0;n<e.length;n++)if(e[n].value&&pgHasScript(e[n].value))return i=!0,!1;return!t.script_info&&"php"!==t.tagName||(i=!0,!1)}),i},pgParserNode.prototype.canConvertToJade=function(){var e=!0;return this.walkSelfAndChildren(function(t){return!(t.script&&t.script_info||t.comment&&0<=t.attributes.indexOf("[if")||"style"===t.tagName&&t.content&&0<t.content.length||"script"===t.tagName&&t.content&&0<t.content.length)||(e=!1)}),e},pgParserNode.prototype.toJade=function(t){t=t||"";var e="",n=pinegrow.getFormatHtmlOptions().indent;if(this.textNode){var r=this.getTextContent();if(0==r.length)return null;e="| "+r}else if(this.comment)(s=$.trim(this.attributes.replace(/\-\-$/,""))).startsWith("[if")?e=pgReindentText(this.toStringOriginal(!0),t,""):e+="//"+s;else if(this.rootNode)for(o=0;o<this.children.length;o++)null!==(a=this.children[o].toJade(t))&&(e+="\n"+a);else{var e=this.tagName,r=this.getAttr("id"),r=(r&&(e+="#"+r),this.getClasses()),i=(r.length&&(e+="."+r.join(".")),this.getAttrList());if(i.length){for(var s="",o=0;o<i.length;o++)"id"===i[o].name||"class"===i[o].name||0<=["data-pg-collapsed","data-pg-hidden","data-pg-id"].indexOf(i[o].name)||(0<s.length&&(s+=", "),s+=i[o].name,null!==i[o].value&&(s+='="'+i[o].value+'"'));s.length&&(e+="("+s+")")}if("script"!==this.tagName&&"style"!==this.tagName||!this.content.length)if(1===this.children.length&&this.children[0].textNode)e+=" "+this.children[0].getTextContent();else for(var a,o=0;o<this.children.length;o++)null!==(a=this.children[o].toJade(t+n))&&(e+="\n"+a);else e+="."+pgReindentText(this.content,t+n)}return t+e},pgParserNode.prototype.findLastNonScriptChild=function(){for(var t=null,e=this.children.length-1;0<=e;e--)if(this.children[e].isElement){if("script"!==this.children[e].tagName)break;t=this.children[e]}return t?t.prev():null};var pgParserNodeGetNameAttrs=["src","url","href","srcset","name"],pgParser=(pgParserNode.prototype.getPlainTextName=function(t){return this.getName(t).replace(/<[^><]+>/g,"")},pgParserNode.prototype.getName=function(t){if(this.isElementOrScript){var e=t&&t.max_text_len?t.max_text_len:20,n=!1,r=null,i=null,s=1,o=(t&&(s=t.num_classes||s,n=t.short||n,r=t.action_tag||null,i=t.classes_filter||null),""),a="",h=null;if(this.isElement?c=this.tagName:this.script_info&&(c=this.script_info.name_tag),t&&(t.name?(o+="<namedef>"+t.name+"&nbsp;</namedef>",a=t.name+":"):t.def&&(h=t.def.name,t.def.display_name&&(h="tag"===t.def.display_name?this.tagName:t.def.display_name(this,t.def)),o+=(t.def.namedef_class?`<namedef class="${t.def.namedef_class}">`:"<namedef>")+h+"&nbsp;</namedef>",a=h+":")),this.script_info)o="<namedef>"+c+"</namedef>",a+=c,o+="<nametext> | "+escapeHtmlCode(crsaGetSummaryStr(this.content,20))+"</nametext>",a+=this.content;else{a+=this.tagName,null===h?o+="<nametag>"+c+"</nametag>":h===c?o="<nametag>"+c+"</nametag>":c!==h.toLowerCase()&&(o+="<nametag>"+c+"</nametag>"),r&&(o+=" <action>"+r+"</action>");var h=this.getAttr("id"),l=(h&&(15<h.length?o+=`<nameid title="#${h}">#${shortenString(h,15)}</nameid>`:o+="<nameid>#"+h+"</nameid>",a+="-#"+h),this.getClasses()),p=-1,d="",g=!1;if(i){var c=i(this);o+=c.html,a+=c.search_str,c.all_classes&&(o+='<nameclass title="'+c.all_classes+'">...</nameclass>')}else if(0<s){for(var u=0;u<l.length;u++)"pg-empty-placeholder"===l[u]||0<=l[u].indexOf("<")||(++p<s?o+="<nameclass>."+l[u]+"</nameclass>":p===s&&l.length>s&&(g=!0),a+=":."+l[u],d+=d.length?"."+l[u]:l[u]);g&&(o+='<nameclass title="'+d+'">...</nameclass>')}if(!n){var f="";if("meta"===this.tagName){var r=this.getAttr("name"),h=this.getAttr("content");r?f=r+'="'+(h||"")+'"':(i=this.getAttrList()).length&&(f=i[0].name+'="'+i[0].value+'"'),f.length&&(o+="<nametext> | "+f+"</nametext>"),a+=":"+f}else if(this.singleTag||("script"===this.tagName||"style"===this.tagName)&&!this.content)for(var m=0;m<pgParserNodeGetNameAttrs.length;m++){var v=this.getAttr(pgParserNodeGetNameAttrs[m]);if(v){o+="<nametext> | "+(f=shortenString(v,e,"...",!0))+"</nametext>",a+=":"+v;break}}else"script"===this.tagName||"style"===this.tagName?(f=$.trim(this.content)).length&&(o+="<nametext> | "+(f=(f=f.length>e?f.substr(0,e)+"...":f).replace(/\n/g," "))+"</nametext>",a+=":"+f):"a"===this.tagName?(c="",n=this.getAttribute("href"),r=2*e,(f=$.trim(this.text(null,!0).replace(/\n/g," "))).length&&f.length>e&&(f=f.substr(0,e)+"..."),n&&(c=crsaGetSummaryStr(n,r)+" | ",a+=":"+n),f.length&&(c+=f,a+=":"+f),o+="<nametext> | "+c+"</nametext>"):(f=$.trim(this.text(null,!0).replace(/\n/g," "))).length&&(o+="<nametext> | "+(f=f.length>e?f.substr(0,e)+"...":f)+"</nametext>",a+=":"+f)}t&&(t.search_string=a),this.dynamic&&(o+='<namedyn title="This element is created by Javascript code. Any changes done to the element will not be saved to the source code.">dyn</namedyn>')}return o}return this.textNode?(f=this.content.substr(0,e),t&&(t.search_string=f),"[TEXT] "+f):"Element"},pgParserNode.prototype.getViewHtml=function(t){return(t=t||pinegrow.getCrsaPageOfPgParserNode(this))?t.getViewHTMLForElement(this):this.toStringWithIds()},pgParserNode.prototype.getViewInnerHtml=function(t){return(t=t||pinegrow.getCrsaPageOfPgParserNode(this))?t.getViewInnerHTMLForElement(this):this.html()},pgParserNode.prototype.toIncrementalDOM=function(){var n=IncrementalDOM.elementOpenStart,r=IncrementalDOM.elementOpenEnd,i=(IncrementalDOM.elementVoid,IncrementalDOM.elementClose),s=IncrementalDOM.attr,o=IncrementalDOM.text,a=this;return function(){if(a.isElement){var t=a.getAttrList();n(a.tagName,null,null,[]);for(var e=0;e<t.length;e++)s(t[e].name,t[e].value||"");r();for(e=0;e<a.children.length;e++)a.children[e].toIncrementalDOM()();i(a.tagName)}else a.textNode&&o(a.content,pgDecodeHtml)}},pgParserNode.prototype.toIncrementalDOMInner=function(){var e=this;return function(){for(var t=0;t<e.children.length;t++)e.children[t].toIncrementalDOM()()}},pgParserNode.prototype.patchDOMElementWithIncrementalDOM=function(e){var t=e.get(0);if(t.nodeName.toLowerCase()!==this.tagName)e.replaceWith(this.toStringWithIds());else{for(var n=[],r=(this.getAttrList().forEach(function(t){e.attr(t.name)!==t.value&&e.attr(t.name,t.value),n.push(t.name.toLowerCase())}),[]),i=0;i<t.attributes.length;i++){var s=t.attributes[i];s.specified&&n.indexOf(s.name.toLowerCase())<0&&r.push(s.name)}r.forEach(function(t){e.removeAttr(t)}),IncrementalDOM.patch(t,this.toIncrementalDOMInner())}},pgParserNode.prototype.isHidden=function(){return this.hasAttr("data-pg-hidden")},pgParserNode.prototype.hide=function(){this.isHidden()||this.withEmitEvent(function(){this.setAttr("data-pg-hidden")},"hide",null,{domOnly:!1})},pgParserNode.prototype.show=function(){this.isHidden()&&this.withEmitEvent(function(){this.removeAttr("data-pg-hidden")},"show",null,{domOnly:!1})},pgParserNode.prototype.update=function(t,e){this.withEmitEvent(function(){},"update",null,{domHtml:this.getViewHtml(),domPgId:e,oldValue:t})},pgParserNode.prototype.updateInner=function(t){this.withEmitEvent(function(){},"updateInner",null,{domHtml:this.getViewInnerHtml(),oldValue:t})},pgParserNode.prototype.executeScript=function(t){this.withEmitEvent(function(){},"executeScript",null,{domOnly:!0,code:t})},pgParserNode.prototype.scrollTo=function(){this.withEmitEvent(function(){},"scrollTo",null,{domOnly:!0})},pgParserNode.prototype.checkBrokenCode=function(){this.withEmitEvent(function(){},"checkBrokenCode",null,{domOnly:!0})},pgParserNode.prototype.selected=function(){this.withEmitEvent(function(){},"selected",null,{domOnly:!0})},pgParserNode.prototype.deselected=function(){"none"===this.getData("selectedCssRule")&&this.setData("selectedCssRule",null),this.withEmitEvent(function(){},"deselected",null,{domOnly:!0})},pgParserNode.prototype.removeFromDOM=function(){this.withEmitEvent(function(){},"removeFromDOM",null,{domOnly:!0})},function(){function H(t,e,n){if(0===e.length&&(r=0,n===$))return!0;if(2===r)return!1;if(0===r)if(n===R)r=1;else if(n===s||n===o)return r=2,!0;return(1!==r||"!--"!==e)&&t.match(i)}function D(t,e,n){return n!==m}var F=null,r=(this.singleTags=pgSingleTags,this.closingTags=pgAutoClosedTags,this.assignIds=!0,this.idPrefix=null,0),i=/[a-z0-9\?!:\-\=\%\_\.]/i,R="!".charCodeAt(0),$="/".charCodeAt(0),m=">".charCodeAt(0),v="<".charCodeAt(0),N='"'.charCodeAt(0),P="'".charCodeAt(0),s="=".charCodeAt(0),o="%".charCodeAt(0);this.replaceExistingIds=!1,this.replaceExistingExternalIds=!1,this.nodeCatalogue=pgParserNodeCatalogueInstance,this.rootNode=null,this.getNode=function(t){return this.nodeCatalogue?this.nodeCatalogue.get(t):null},this.parse=function(t,S,E){F=t;var b=this,x=[],w=(this.rootNode=new pgParserNode,this.rootNode.tagName="document",this.rootNode.rootNode=!0,this.rootNode.nodeCatalogue=this.nodeCatalogue,this.rootNode.document=this.rootNode,this.assignIds&&(this.rootNode.assignId(),this.nodeCatalogue)&&this.nodeCatalogue.add(this.rootNode),this.replacedIds=[],F.length),O=this.rootNode,T=0,_=function(t,e,n){var r="",i="?>",s=!1;do{var o=startsWithCaseInsensitiveScript(F,T);if(o)s=!0,i=o.close;else if(startsWithCaseInsensitive(i,F,T)){if(s=!1,r+=F.substr(T,i.length),T+=i.length,w<=T)break;continue}var a=F.charAt(T),h=F.charCodeAt(T);if(s)r+=a;else{if(!t(a,r,h))return r;r+=a;var l=!1;if(e&&(h===N||h===P)){var p=a,d=h,g=!1;for(T++;T<w;){if(a=F.charAt(T),(h=F.charCodeAt(T))===d&&!g){r+=a;break}if(n&&h===v){var l=!0,c=startsWithCaseInsensitiveScript(F,T);if(c){var u=F.indexOf(c.close,T);if(T<=u){r+=F.substr(T,u-T+c.close.length),T=u+c.close.length,l=!1;continue}}}else if(n&&h===m&&!l){var f,u=!0,c=F.indexOf(p,T);if(0<=c&&((f=F.substr(c,2))!==p+`>`&&f!==p+` `&&f!==p+`/`&&f!==p+"\n"&&f!==p+"\t"||(u=!1)),u)return r+p}r+=a,T++}}}T++}while(T<w);return r},L=function(t){var e=null,n=F.indexOf(t,T);return T=n<0?(e=F.substr(T,w-T),w-1):(e=F.substr(T,n-T+t.length-1),n+t.length-1),e},k=function(t){var e;return"string"==typeof t&&!(48<=(e=t.charCodeAt(0))&&e<=57)},W=function(){for(var t=(new Date).getTime(),e=50,n=0,r=0,i=function(){if(++r%100==0&&(5e3<(new Date).getTime()-t||1e3<x.length))throw b.rootNode.remove(),b.rootNode=null,"Parsing the HTML source if taking too much time. Either it is too large, it includes too many syntax errors or it is a messy legacy HTML.";return!1};T<w;){if(i())return;if((y=F.indexOf("<",T))<0)(s=new pgParserNode).tagName="text",s.content=F.substr(T),s.closingTag=s.tagName,s.textNode=!0,s.document=b.rootNode,s.content.length&&O.addChild(s),s.startStringIndex=T,T=w;else{if(T<y)for(var s,o=F.substr(T,y-T).split("\n"),a=T,h=0;h<o.length;h++)(s=new pgParserNode).tagName="text",s.content=(0<h?"\n":"")+o[h],s.closingTag=s.tagName,s.textNode=!0,s.document=b.rootNode,s.startStringIndex=a,a+=s.content.length,s.content.length&&O.addChild(s);T=y+1;var l,p=_(H),d=p.toLowerCase(),g=T-p.length-1,c=!1,u=!1,f=null,m=(p.charCodeAt(0)===R&&0==p.indexOf("!--")?(l=L("--\x3e"),c=!0):(f=pgGetScriptInfoByTag(d))?(l=L(f.close)).length&&l.endsWith(f.close[0])&&(l=l.substr(0,l.length-1),u=!0):l=_(D,!0,!0),!1),v=(l.length&&l.charCodeAt(l.length-1)===$&&(m=!0,l=l.substr(0,l.length-1)),0<=b.singleTags.indexOf(p.toLowerCase())||m);if(c&&(v=!0),T++,p.charCodeAt(0)!==$){(I=new pgParserNode).tagName=d,I.tagNameOriginal=p,f?(I.script=!0,I.script_info=f,I.isElementOrScript=!0,I.content=l,l=null,I.scriptClosed=u):I.script=!1,I.attributes=l,I.comment=c,I.document=b.rootNode,I.selfClosed=m,I.isElement=!I.script&&!I.comment&&I.tagName.charCodeAt(0)!==R,I.isElementOrScript=I.isElement||I.script,I.startStringIndex=g,O.addChild(I),v?(I.singleTag=!0,I.closed=!0,I.endStringIndex=T):(x.push(O),O=I),"script"!==d&&"style"!==d&&"php"!==d&&"textarea"!==d||(I.content=L("</"+p+">"),I.closingTag=p,I.content.length>=p.length+2&&(I.content=I.content.substr(0,I.content.length-p.length-2)),I.closed=!0,O=x.length?x.pop():O,T++);f=I.getId();b.assignIds&&I.shouldHaveId()&&(f?b.replaceExistingIds?!b.replaceExistingExternalIds&&k(f)||(f=I.assignId(b.idPrefix)):(u=parseInt(f),!isNaN(u)&&pgIdCount<u&&(pgIdCount=u)):f=I.assignId(b.idPrefix),b.nodeCatalogue)&&b.nodeCatalogue.add(I),I.getAttrList()}else{var N=p.replace("/","").toLowerCase();if(O.tagName===N)O.closingTag=p.replace("/",""),O.closed=!0,O.endStringIndex=T,O=x.length?x.pop():O;else if(I&&I.singleTag&&N===I.tagName)I.closingTag=p.replace("/",""),I.closed=!0,I.endStringIndex=T,I.singleTag=!1;else{for(var P=-1,y=x.length-1;0<=y;y--)if(x[y].tagName===N){x[P=y].closingTag=p.replace("/",""),x[y].closed=!0;break}if(0<=P)for(;x.length>P+0;){if(i())return;var I=x.pop();if(I.closed=!0,b.closingTags[I.tagName]&&I.children.length)for(var C=0,A=I;C<I.children.length;){if(i())return;0<=b.closingTags[I.tagName].indexOf(I.children[C].tagName)?A=I.children[C].insertAfter(A):C++}}else O.closingTag=p.replace("/",""),O.closed=!0;O=x.length?x.pop():O}}}if(++n%10==0&&S)if(e<=(new Date).getTime()-t){E&&E(),setTimeout(W,10);break}}w<=T&&S&&S()};W()},this.find=function(t){return this.rootNode.find(t)},this.toStringOriginal=function(t,e,n){return this.rootNode.toStringOriginal(t,e,n)},this.toStringWithIds=function(t,e,n){return this.rootNode.toStringWithIds(t,e,n)},this.validate=function(t){return this.rootNode.validateTree(t)}}),PgNodeEvent=function(t,e,n,r,i){this.pgId=t.getId(),t.textNode?this.text=t.content:!this.pgId&&t.shouldHaveId()&&pgIsDev()&&console.error("PgNodeEvent: no pgId"),this.operation=e,this.data=null,this.objectId=null,this.eventType="PgNodeEvent",this.page=i,n&&(n instanceof pgParserNode?this.objectId=n.getId():this.data=n),r&&(this.data=r),this.data||(this.data={})},pgParserNode_emit_events=(PgNodeEvent.prototype.toDebugString=function(){var n=this.eventType+' "'+this.operation+'" ('+this.pgId+", "+this.objectId+", {";return this.data&&$.each(this.data,function(t,e){n+=t+': "'+e+'", '}),n+="})"},PgNodeEvent.prototype.getPgel=function(){return getPgNodeByPgId(this.pgId)},!0),PgEventConductor=(pgParserNode.prototype.emitEvent=function(t,e,n,r){var i;return pgParserNode_emit_events&&(!(e&&e instanceof pgParserNode)||e.getId())&&(r=r||this.getPage())?(i=new PgNodeEvent(this,t,e,n,r),pinegrow.event_conductor&&pinegrow.event_conductor.emit(i),i):null},pgParserNode.prototype.getEmitEvents=function(){return pgParserNode_emit_events},pgParserNode.prototype.withEmitEvent=function(t,e,n,r,i){var s=pgParserNode_emit_events;return pgParserNode_emit_events=!1,s&&r&&"function"==typeof r.oldValue&&(r.oldValue=r.oldValue.call(this)),t.call(this),pgParserNode_emit_events=s,this.emitEvent(e,n,r,i)},pgParserNode.prototype.withoutEvents=function(t){var e=pgParserNode_emit_events;pgParserNode_emit_events=!1;try{t.call(this)}catch(t){throw pgParserNode_emit_events=e,console.warn("Exception during pgParserNode.withoutEvents",t),t}pgParserNode_emit_events=e},function(){var n=0,r=!1,i=[];this.emit=function(t){t.eventId=n++,r&&console.log("Emitted: "+t.toDebugString());for(var e=0;e<i.length;e++)i[e](t)},this.addLocalSubscriber=function(t,e){i.indexOf(t)<0&&(e<i.length?i.splice(e,0,t):i.push(t))},this.removeLocalSubscriber=function(t){var e=i.indexOf(t);0<=e&&i.splice(e,1)}}),PgEventHandler=function(t,e){function n(t){r&&console.log("Received: "+t.toDebugString()),!i.on_event||!i.handle_dom_events&&t.data.domOnly||i.on_event(t)}var r=!1,i=this;this.handle_dom_events=!0,void 0===t&&(t=0),void 0===e&&(e=9999),this.on_event=null;this.start=function(){0===t&&pinegrow.event_conductor.addLocalSubscriber(n,e)},this.stop=function(){0===t&&pinegrow.event_conductor.removeLocalSubscriber(n)},this.destroy=function(){this.stop()}},PgNodeEventDOMPlayer=function(r,o){function i(t,e){var n,r,i;return!t&&e.text?$(document.createTextNode(e.text)):(r='[data-pg-id="'+t+'"]',h.getAttribute("data-pg-id")==t?$(h):(r=h.querySelector(r))?$(r):(r=pgParserNodeCatalogueInstance.get(t))?(n=(pinegrow.getCrsaPageOfPgParserNode(r)||e.page).getViewHTMLForElement(r),0<=["svg"].indexOf(r.tagName)?(n=n.replace(/\sdata\-pg\-collapsed(=\"[^\"]\")?/g,""),r=h.ownerDocument,i=(new DOMParser).parseFromString(n,"text/xml"),$(r.adoptNode(i.documentElement))):$(n)):null)}function s(t){for(var e=0;e<t.childNodes.length;e++){var n,r=t.childNodes[e];1===r.nodeType?s(r):3===r.nodeType&&0<=(n=r.wholeText).indexOf("data-pg-id")&&r.replaceWith(n.replace(/data\-pg\-id\="[0-9]+"/g,""))}}var a={},h=null,l=(this.play=function(t,e){if(!t.data.sourcePageView||t.data.sourcePageView!==o)try{h=e;var n=i(t.data.domPgId||t.pgId,t),r=t.data.objectHtml||t.data.objectDomHtml?$(t.data.objectDomHtml||t.data.objectHtml):t.objectId?i(t.objectId):null;if(n&&0!==n.length){if(!(t.operation in a))throw"PgNodeEventDOMPlayer: operation "+t.operation+" not implemented!";a[t.operation](t,n,r),l()}}catch(t){console.log("domPlayerError",t)}},this.destroy=function(){},function(){}),p=(a.update=function(t,e){var n=new pgParser,n=(n.assignIds=!1,n.parse(t.data.domHtml||t.data.html||""),pinegrow.shouldBlockUntrustedJS()&&pinegrow.blockUntrustedJS(n.rootNode),n.rootNode.children[0].toStringWithIds()),n=o.emulateCSSFeaturesInHTML(n);e.replaceWith(n)},a.updateInner=function(t,e){var n,r=t.data.domHtml||t.data.html||"";pinegrow.shouldBlockUntrustedJS()&&((n=new pgParser).assignIds=!1,n.parse(r),pinegrow.blockUntrustedJS(n.rootNode),r=n.rootNode.children[0].toStringWithIds()),r=o.emulateCSSFeaturesInHTML(r),e.html(r)},a.addClass=function(t,e){e.addClass(t.data.class)},a.removeClass=function(t,e){e.removeClass(t.data.class)},a.setAttr=function(t,e,n){var r,i=t.data.domValue||t.data.value||"",s=("style"===t.data.attr?i=o.emulateCSSFeatures(i):"src"===t.data.attr?(i=(r=pinegrow.getCurrentProject())?r.mapSourceUrlToDOMUrl(i):i)&&i.startsWith("/")&&r&&!pgf.root_urls&&(i=r.getUrl()+i,i=pinegrow.getProxyUrl(i)):"srcset"===t.data.attr&&(r=pinegrow.getCurrentProject(),i=i&&pgTransformSrcsetUrls(i,function(t){return r&&(t=r.mapSourceUrlToDOMUrl(t))&&t.startsWith("/")&&!pgf.root_urls&&(t=r.getUrl()+t,t=pinegrow.getProxyUrl(t)),t})),t.data.attr);pinegrow.shouldBlockUntrustedJS()&&s.match(/^on/i)&&(s="data-disabled-"+s),e.attr(s,i),"src"!==t.data.attr&&"srcset"!==t.data.attr||"IMG"!==e.get(0).nodeName||e.off(".pg").one("load.pg",function(t){pinegrow.selectedElements.repositionMenusDelayed()})},a.removeAttr=function(t,e,n){e.removeAttr(t.data.attr)},a.replaceTag=function(t,e,n){var r={};$.each(e.get(0).attributes,function(t,e){r[e.nodeName]=e.nodeValue}),e.replaceWith(function(){return $("<"+t.data.tag+"/>",r).append(e.contents())})},a.replaceWith=function(t,e,n){var r,i,s;e.is("body")?(i=t.data.objectDomHtml||t.data.objectHtml,i=o.emulateCSSFeaturesInHTML(i),(r=new pgParser).assignIds=!1,r.nodeCatalogue=null,r.parse(i),pinegrow.shouldBlockUntrustedJS()&&pinegrow.blockUntrustedJS(r.rootNode),i=r.rootNode.children[0],s=[],$.each(e.prop("attributes"),function(){s.push(this.name)}),s.forEach(function(t){e.removeAttr(t)}),i.getAttrList().forEach(function(t){e.attr(t.name,t.value||"")}),e.get(0).innerHTML=i.html(null,!0),t.data.detach&&console.log("player.replaceWith WARNING: Can not handle detach for body")):(n.insertBefore(e),t.data.detach?e.detach():e.remove())},a.replaceContentWithContentOf=function(t,e,n){t.data.detach?e.contents().detach():e.contents().remove(),e.append(n.contents())},a.replaceContentWithElement=function(t,e,n){t.data.detach?e.contents().detach():e.contents().remove(),e.append(n)},a.detag=function(t,e,n){e.contents().insertBefore(e),e.remove()},a.removeAllChildren=function(t,e,n){e.contents().remove()},a.html=function(t,e,n){e.html(t.data.domHtml||t.data.html)},a.remove=function(t,e,n){e.remove()},a.removeFromDOM=function(t,e,n){e.remove()},a.detach=function(t,e,n){e.detach()},a.appendPrepend=function(t,e,n){t.data.prepend?n.prepend(e):n.append(e)},a.insertBefore=function(t,e,n){e.insertBefore(n)},a.insertAfter=function(t,e,n){e.insertAfter(n)},a.insertAtIndex=function(t,e,n){n.get(0);var r=n.children(),r=t.data.element_index<r.length?$(r.get(t.data.element_index)):null;r?e.insertBefore(r):n.append(e)},0);a.executeScript=function(t,e,n){var r=h.ownerDocument.createElement("script"),i=(r.async=!1,t.data.code),s=null,o=/__THIS_ELEMENT__/g;i.match(o)&&(s=`data-pg-temp-id-`+p++,e.attr(s,""),i=i.replace(o,`document.querySelector('[${s}]')`)),r.text=i,h.ownerDocument.body.appendChild(r),setTimeout(function(){r.parentNode.removeChild(r),s&&e.removeAttr(s)},500)},a.scrollTo=function(t,e,n){crsaScrollToElementInIframe(r,e)},a.selected=function(t,e,n){},a.deselected=function(t,e,n){};a.checkBrokenCode=function(t,e,n){s(e.get(0))},a.hide=function(t,e,n){e.attr("data-pg-hidden","")},a.show=function(t,e,n){e.removeAttr("data-pg-hidden","")},a.removeAttrIfStartsWith=function(){}},PgNodeInfo=function(t){this.pgel=t,this.$el=null,this.$els=null,this.page=null,this.def=null,this.defs=null};PgNodeInfo.prototype.get$El=function(){return this.$el||(this.$el=this.pgel.get$DOMElement(this.getPage().get$Html())),this.$el},PgNodeInfo.prototype.get$Els=function(){return this.$els||(this.$els=this.pgel.get$DOMElements(this.getPage())),this.$els},PgNodeInfo.prototype.getPage=function(){return this.page||(this.page=this.pgel.getPage()),this.page},PgNodeInfo.prototype.getMainType=function(){return this.def||(this.def=this.getPage().getMainType(this.get$El(),this.pgel)),this.def},PgNodeInfo.prototype.getAllTypes=function(){return this.defs||(this.$el=this.getPage().getAllTypes(this.get$El(),this.pgel)),this.defs},pgParserNode.prototype.getInfo=function(){return new PgNodeInfo(this)},"undefined"!=typeof module&&(module.exports={pgParser:pgParser,pgParserNode:pgParserNode});