var path=require("path"),fs=require("fs"),cloneObject=function(e){return $.extend({},e)},extendObject=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.contructor=e};function pgStructureFlatListAsTree(e){const r=new Map,n=(e.forEach(e=>{r.set(e.id,{...e,items:[]})}),[]);return e.forEach(e=>{var t;0!==e.parent?(t=r.get(e.parent))&&t.items.push(r.get(e.id)):n.push(r.get(e.id))}),n}var pgSplitKeyEqualsValueString=function(e){var r=[];return e.split("\n").forEach(function(e){var t;(e=$.trim(e)).length&&(2===(t=e.split("=")).length?r.push({one:t[0].trim(),two:t[1].trim()}):1===t.length&&r.push({one:t[0].trim(),two:t[0].trim()}))}),r},pgMakeSlug=function(e,t,r){return e&&(e=e.toLowerCase(),void 0===r&&(r="_"),(e=t?e.replace(/[^\w \.]+/g,""):e.replace(/[^\w ]+/g,"")).replace(/ +/g,r))};function pgGetHttpRequest(e,n,i){var t=require("request"),r=pinegrow.getSelectedPage();t.get({url:e,encoding:null,headers:{"User-Agent":navigator.userAgent,Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,text/css,image/webp,*/*;q=0.8","Accept-Encoding":"identity","Accept-Language":"en-US,en;q=0.8","Cache-Control":"max-age=0",Connection:"close",Cookie:"",Referer:r?r.url:""}},function(e,t,r){e||200!=t.statusCode?i():n(r)})}function pgGetCookieByName(e){var t=(`; `+document.cookie).split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}function pgSetCookie(e,t,r){var n,i="";r&&((n=new Date).setTime(n.getTime()+r),i="; expires="+n.toUTCString()),document.cookie=e+"="+(t||"")+i+"; path=/"}function pgRemoveCookie(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}var CrsaProfile=function(e,r){r=r||"";var n,i=pgIsDev(),o=0,a=!1,l=0;i&&(n=(new Date).getTime(),l=0),this.pause=function(){o+=(new Date).getTime()-n,a=!0},this.resume=function(){n=(new Date).getTime(),a=!1},this.show=function(e){var t;i&&(t=a?o:o+(new Date).getTime()-n,console.log(r+e+" took "+t+" ms, "+(t-l)+"ms this step"),l=t)}},pgDummyTextarea=document.createElement("textarea");function pgDecodeHtml(e){return pgDummyTextarea.innerHTML=e,pgDummyTextarea.value}function pgUrlToDisplayString(e){return decodeURI(e)}function pgAddProxyLinksToStyleAttribute(e,a){var l;return e&&((l=pinegrow.getCurrentProject())&&(a=a&&l.getAbsoluteUrl(a)),e.indexOf(".eot"),e.replace(/(url\(['"])([^'"]*)/g,function(e,t,r,n){if(crsaIsRemoteUrl(o=r)||o.startsWith("data:")||(o=pinegrow.getProxyUrl(o)),l){if(a)try{o=new URL(o,a).toString(),o=l.getRelativeUrl(o)}catch(e){}var i=o.split("?"),o=l.mapSourceUrlToDOMUrl(i.shift());i.length&&!o.startsWith("blob:")&&(o=o+"?"+i.join("?"))}return t+o}))}function pgRemoveProxyLinksFromStyleAttribute(e){var i;return e&&(i=pinegrow.getCurrentProject(),e.replace(/url\('([^']*)'\)/g,function(e,t,r,n){return i&&(t=i.mapDOMUrlToSourceUrl(t)),"url('"+(t=pinegrow.getOriginalUrl(t))+"')"}))}function pgAddProxyLinksToAttr(e,t){switch(e){case"style":return pgAddProxyLinksToStyleAttribute(t);case"href":case"src":return pinegrow.getProxyUrl(t)}return t}function crsaEvaluateShowIfString(e,t,r,n){var i,o,a,l;return"boolean"==typeof e?e:(1<(i=e.split("&&")).length?(o=!0,i.forEach(function(e){o=o&&crsaEvaluateShowIfString(e,t)})):(i=e.startsWith("!"),o=!1,1==(a=(e=i?e.substr(1):e).split("==")).length?o=t[a[0]]||!1:2==a.length&&(l=a[1].split("||"),o=0<=l.indexOf(t[a[0]]||"")),i&&(o=!o)),o=r&&r.on_evaluate_show_if?r.on_evaluate_show_if(n,o,t,r):o)}function crsaRemoveScripts(e,t){return e=e&&0<=e.indexOf("<?")?e.replace(/<\?.*?\?>/g,t||""):e}function crsaPopulateSectionClosedStatus(e){var t;e.hasOwnProperty("closed")||(t="sec_open_"+e.key,localStorage[t]?e.closed="1"!=localStorage[t]:"default_closed"in e?e.closed=e.default_closed:e.closed=!0)}function pgParseCSSValue(e){var t,r={type:"value",calc:null,variable:null,value:null,unit:null,important:null,unknown:null,original:e,original_without_important:e};return null!==e&&""!==e&&((e=(e="string"!=typeof e?e.toString():e).trim()).endsWith("!important")&&(r.important=!0,e=e.replace("!important","").trim(),r.original_without_important=e),e.startsWith("calc(")?(r.calc=e,r.type="calc"):(t=e.match(/^var\((\-\-.*)\)$/))?(r.variable=t[1],r.type="var"):(t=e.match(/^\-\-[a-z0-9\-]+$/i))?(r.variable=e,r.type=e):(t=crsaSplitCSSValue(e,!0))?(r.value=t.value,r.unit=t.unit,r.type="value"):(r.unknown=r.original,r.type="unknown")),r}function pgGetCSSValueFromParsedInfo(e){var t="",t=e.calc||(e.variable?`var(${e.variable})`:null!==e.value?``+e.value+e.unit:e.original_without_important);return e.important&&(t+=" !important"),t}function crsaSplitCSSValue(e,t){if(null===e)return e;"string"!=typeof e&&(e+=t?"":"px");var r=e.match(/^(\-?[0-9\.]+)([a-z\%]*)$/);return r?{value:parseFloat(r[1]),unit:r[2].toLowerCase()||(t?"":"px")}:null}function crsaOneUpCSSValue(e,t){void 0===t&&(t=1);var r={px:1,em:.0625,rem:.0625,pt:1};return e&&(r=e.unit in r?r[e.unit]:1,{value:e.value+t*r,unit:e.unit})}var crsaConvertCSSValueToPx_el=null;function crsaConvertCSSValueToPx(e,t,r,n){var i,o="object"!=typeof e?e+"":e.value+e.unit,a=(o.match(/^[0-9\.]*$/)&&(o+="px"),-1),l=r?r.get(0):t?(0===(i=(l=$(getIframeBody(t.get(0)))).find("#crsa-dummy-div")).length&&(i=$('<div id="crsa-dummy-div" style="position:absolute;top:-1000px;"></div>'),l.append(i)),i.get(0)):crsaConvertCSSValueToPx_el=crsaConvertCSSValueToPx_el||$("#crsa-dummy-div").get(0),l=Length.toPx(l,o,n);return t&&i.remove(),-1!=a&&(a?r.attr("style",a):r.get(0).removeAttribute("style")),l}function pgConvertCSSUnit(e,t,r,n,i){if(0==e)return 0;var o=crsaConvertCSSValueToPx("1"+r,null,n,i);0===o&&(o=crsaConvertCSSValueToPx("1"+r,i=null,n,i));o=e*(crsaConvertCSSValueToPx("1"+t,null,n,i)/o),o=Math.round(1e3*(o+Number.EPSILON))/1e3;return o="px"===r?Math.round(o):o}function pgByteArrayToString(e){var t=8*1024;if(e.length<=t)return String.fromCharCode.apply(null,e);for(var r="",n=0;n<e.length;n+=t)r+=String.fromCharCode.apply(null,e.slice(n,n+t));return r}function pgRevealElement(e,t){var r,n,i,o,a,l,s,c,u;0===e.length?t&&t():(r=e.closest("body"),n=e.get(0).getBoundingClientRect(),i=$('<div class="pg-docs-revealer"></div>').appendTo(r),r.addClass("pg-docs-revealer-animating"),o=r.width(),a=r.height(),l=.8*Math.max(o,a),i.css({width:l+"px",height:l+"px",top:a/2-l/2+"px",left:o/2-l/2+"px"}).addClass("animate"),s=Math.min(n.width,n.height),c=n.left+n.width/2-s/2,u=n.top+n.height/2-s/2,i.get(0).addEventListener("transitionend",function(e){i.remove(),r.removeClass("pg-docs-revealer-animating"),t&&t(),t=null}),setTimeout(function(){i.css({left:c+"px",top:u+"px",width:s+"px",height:s+"px",opacity:.7})},10))}function pgAreArraysEqual(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function diffStrings(e,t){for(var r=0;r<e.length;r++){if(r>=t.length)return r;if(e.charAt(r)!=t.charAt(r))return r}return-1}function describeDiffStrings(e,t){var r=diffStrings(e,t);return r<0?"Strings are EQUAL":"Strings are DIFFERENT at "+r+" s1["+e.length+']="'+escapeHtmlCode(e.substr(r=(r=r-20)<0?0:r,25))+'" s2['+t.length+']="'+escapeHtmlCode(t.substr(r,25))+'"'}function crsaGetInlineStylePropertyValue(e,t,r){if(e){var n=new RegExp("(^|;\\s*)"+escapeRegExp(t)+"\\:\\s*"+(r?"url\\(([^\\)]*)\\)":"([^\\;]*)")+"\\;?"),n=e.match(n);if(n)return r?n[2].replace(/['"]/g,""):n[2]}return null}function crsaSetInlineStylePropertyValue(e,t,r,n,i,o){(e=(e=e||"").startsWith(";")?e:";"+e).endsWith(";")||(e+=";");var a,l=new RegExp(";\\s*"+escapeRegExp(t)+"\\:\\s*"+(n?"url\\(([^\\)]*)\\)":"([^\\;]*)")+"\\;","g");return null!==r&&""!==r&&void 0!==r?(a=t+":"+(n?"url('"+r+"')":r)+(i?" !important":"")+";",e.match(l)?e=e.replace(l,";"+a):e+=a):e=e.replace(l,";"),(e=";"===(e=e.startsWith(";")?e.substring(1):e)?"":e).trim()}function pgTransformSrcsetUrls(e,r){var n;return null!==e&&e.length?(n=[],e.split(",").forEach(function(e){var t=(e=$.trim(e)).split(/\s+/);t[0]=r(t[0],t[1]),n.push(t.join(" "))}),n.join(", ")):e}function escapeRegExp(e){return(e="string"!=typeof e?String(e):e).replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function escapeHtmlCode(e){return"string"==typeof e?e.replace(/&amp;/g,"###PGAMP###").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/###PGAMP###/g,"&amp;"):""}var cssHelperLink=document.createElement("a"),crsaAppendQueryToUrl=function(e,t){return cssHelperLink.href=e,cssHelperLink.search&&(cssHelperLink.search+="&"),cssHelperLink.search+=t.join("&"),cssHelperLink.href},pgDecodeUrl=function(e){return cssHelperLink.href=e,cssHelperLink.href},crsaMakeLinkRelativeTo=function(e,t,r){var n=/^[a-z:]*\/+/i,i=e.match(n);if(!i)return e;var i=i[0],o=t.match(n);if(!o)return e;o=o[0];if(i.toLowerCase()!=o.toLowerCase())return e;for(var a=e.replace(n,"").split("/"),l=t.replace(n,"").split("/"),s=0;s<a.length&&s<l.length&&a[s]==l[s];)s++;if(0==s)return e;if(a.splice(0,s),l.length>s+1)for(var c=0;c<l.length-s-1;c++)a.unshift("..");i=a.join("/");return 0&&!r&&0<=i.indexOf("../..")?e:i};function crsaGetAbsoluteUrlForRelativeUrlAndParentUrl(e,t){return crsaIsAbsoluteUrl(e)?e:require("url").resolve(t,e)}function crsaMakeUrlAbsolute(e){return e.match(/^[a-z]*:\/\//i)?e:crsaMakeUrlFromFile(crsaGetAppDir()+e)}function crsaDuplicateName(e,t,r){var n,i,o=e.split("."),a=1<o.length?o.length-2:o.length-1,l=0,s=t?crsaGetFileDir(t):null,c=isApp()?require("fs"):null;do{}while(o[a]=o[a].replace(/\([0-9]+\)$/i,""),o[a]=0==l?o[a]:o[a]+"("+l+")",i=o.join("."),n=!1,l++,n=!(n=r&&0<=r.indexOf(i)?!0:n)&&c&&s&&c.existsSync(s+i)?!0:n);return i}function crsaGetFileDir(e){var t,r;return isApp()?(r=(t=require("path")).dirname(e)).charAt(r.length-1)!=t.sep&&(r+=t.sep):(r="",1<(t=e.split("/")).length&&(t.splice(t.length-1,1),r=t.join("/")),"/"!=r.charAt(r.length-1)&&(r+="/")),r}function crsaGetAppDir(){return isApp()?crsaGetFileDir(crsaMakeFileFromUrl(pgMakeFileUrl(window.location.href))):null}function crsaIsFileOrDir(e,t){if(!isApp())return!1;try{var r=(t=t||require("fs")).statSync(e);return r.isFile()?"file":r.isDirectory()?"dir":null}catch(e){return null}}function crsaGetDir(e,t,r){return t=t||require("path"),"dir"==crsaIsFileOrDir(e,r)?e:t.dirname(e)}function crsaCopyFileSync(e,t,r,n,i){var o;i&&!n&&(n=function(e){return e}),e=e||require("fs"),n?(o=n(o=e.readFileSync(t,{encoding:"utf8"})),i?crsaWriteFileWithBackup(e,r,o,"utf8"):e.writeFileSync(r,o,{encoding:"utf8"})):(o=e.readFileSync(t),e.writeFileSync(r,o))}function crsaCopyFile(e,t,r,n){var i=!1,o=e.createReadStream(t),a=(o.on("error",function(e){l(e)}),e.createWriteStream(r));function l(e){i||(n(e),i=!0)}a.on("error",function(e){l(e)}),a.on("close",function(e){l()}),o.pipe(a)}function crsaCopyFolder(i,o,t,a,l){var s=require("path"),c=require("fs");require("fs-extra").copy(i,o,{filter:function(e){if(a){var t=e.replace(i,""),r=s.join(o,t),n=!1;try{c.statSync(r);n=c.statSync(e).isFile()}catch(e){}r="function"==typeof l?l(t):l;if(n&&!r)return!1}return!0}},function(e){t&&t(e)})}function crsaCopyFolderSync(i,o,a,l){var s=require("path"),c=require("fs");require("fs-extra").copySync(i,o,{filter:function(e){if(a){var t=e.replace(i,""),r=s.join(o,t),n=!1;try{c.statSync(r);n=c.statSync(e).isFile()}catch(e){}r="function"==typeof l?l(t):l;if(n&&!r)return!1}return!0}})}function crsaWriteFileWithBackup(u,e,t,r){u=u||require("fs");var p,g,n,i,f=require("path");"file"==crsaIsFileOrDir(e,u)?pgf.use_backups&&"1"==pinegrow.getSetting("backup","1")&&(f=require("path"),p=crsaGetFileDir(e)+"_pgbackup",(n=pinegrow.getCurrentProject())&&n.isFileInProject(e)&&(i=n.getRelativePath(e),p=f.dirname(f.join(n.getDir(),"_pgbackup",i))),crsaIsFileOrDir(p,u)||crsaCreateDirs(p,u),n=(g=getPageName(e)).split("."),i="_"+Math.floor((new Date).getTime()/1e3),1<n.length?n[n.length-2]+=i:n[0]+=i,i=f.join(p,n.join(".")),crsaCopyFileSync(u,e,i),u.readdir(p,function(e,t){if(!e){for(var r,n=f.extname(g),i=f.basename(g,n),o=new RegExp("^"+escapeRegExp(i+"_")+"([0-9]+)"+escapeRegExp(n)+"$"),a=[],l=0;l<t.length;l++)(r=t[l].match(o))&&a.push(parseInt(r[1]));a.sort();var s,c=(c=parseInt(pinegrow.getSetting("backup-revisions","20")))||9999999;a.length>c&&(console.log("Deleting "+(a.length-c)+" "+g+" old backup files..."),(s=function(e){var t;!e&&a.length>c&&(t=f.join(p,i+"_"+a.shift()+n),u.unlink(t,s))})())}})):crsaCreateDirs(crsaGetFileDir(e),u),u.writeFileSync(e,t,r)}function crsaGetUrlParameters(e){var t="",r=e.split("?"),n=r[1],r=(r=r[0].split("#"))[1];return n&&(t="?"+n),r&&(t+="#"+r),t}function crsaRemoveUrlParameters(e){var t=e.split(/[\?\#]/);return 0<t.length?t[0]:e}function pgRemoveUrlParameter(e,t){return e.replace(new RegExp(`\\??\\&?${escapeRegExp(t)}(=[^\\&\\#$\\n]*)?`,"g"),"")}function crsaRemoveUrlHash(e){return e.replace(/\#.*/,"")}function crsaGetUrlHash(e){var t=e.match(/\#(.*)/);return t?t[1]:null}function crsaCreateDirs(e,t){return!crsaIsFileOrDir(e,t)&&(mkdirpsync(e),!0)}function crsaCreateFile(e){var t=require("fs");return!crsaIsFileOrDir(e,t)&&t.writeFileSync(e,"")}function pgMakeFileUrl(e){return e.startsWith("chrome-extension:")||e.startsWith("https://pglive")||e.startsWith("https://pinegrow.com/liveapp")?(e=(e=(e=e.replace(/chrome\-extension\:\/\/[^\/]*/,"")).replace("https://pglivedev:8890","")).replace("https://pinegrow.com/liveapp",""),crsaMakeUrlFromFile(process.cwd())+e):e.startsWith("file:")?e:crsaMakeUrlFromFile(e)}function pgGetAppFilePath(e){return crsaMakeFileFromUrl(pgMakeFileUrl(crsaGetBaseForUrl(window.location.href)+e))}function pgDeleteFileOrFolder(n,e){var i=require("path"),o=require("fs");if(n.length<10||n.split(i.sep).length<3)throw"Not sure it is a good idea to delete this folder.";o.lstatSync(n).isDirectory()?(o.readdirSync(n).forEach(function(e,t){var r=i.join(n,e);o.lstatSync(r).isDirectory()?pgDeleteFileOrFolder(r):o.unlinkSync(r)}),e||o.rmdirSync(n)):o.unlinkSync(n)}function pgDeleteFolderContent(t){try{return pgDeleteFileOrFolder(t,!0),!0}catch(e){pinegrow.showAlert(`<p>The folder ${t} could not be emptied.</p><p>${e}</p>`)}return!1}function crsaMakeUrlFromFile(e){if(isApp()){if(e.match(/^(file|http|https)+\:\/\//))return e;require("path");e.match(/^[a-z]\:/i)?e="/"+e:e.startsWith("\\\\")&&(e=e.substr(2))}return"file://"+encodeURI(e.replace(/\\/g,"/")).replace(/\'/g,"%27")}function crsaMakeFileFromUrl(e,t){if(!e)return"";if(isApp()){var r=require("path"),n=(r.sep,"file://");if(!(e=t?e:crsaRemoveUrlParameters(e)).startsWith(n))return r.normalize(decodeURI(e.replace(/\//g,r.sep)));e=e.replace(n,""),"\\"==r.sep&&(e=(e=e.startsWith("wsl%24")?e.replace("wsl%24","wsl$"):e).startsWith("/")?e.substr(1):"//"+e);n=decodeURI(e.replace(/\//g,r.sep).replace(/\%27/g,"'"));return r.normalize(n)}return crsaRemoveUrlParameters(e).replace("file://","")}function pgDebugCanvas(e){e.setAttribute("style","position:absolute;top:00px;left:00px;z-index:100;"),$("body").append(e),$(e).on("click",function(){$(this).remove()})}function pgDebugPos(e){var t=$("<div/>");t.attr("style",`position:absolute;top:${e.top}px;left:${e.left}px;width:${e.width}px;height:${e.height}px;z-index:100;background:rgba(255,0,0,0.5);`),$("body").append(t),t.on("click",function(){$(this).remove()})}function pgGetColorWithEnoughContrast(e,t,r){return 4.5<chroma.contrast(e,t)?t:r}function crsaIsFileUrl(e){return e&&0==e.indexOf("file:")}function crsaCleanUpUrl(e){return e=e&&"/"==(e=crsaRemoveUrlParameters(e))[e.length-1]?e.substr(0,e.length-1):e}function crsaGetExtFromUrl(e){var t=crsaGetNameFromUrl(e=crsaCleanUpUrl(e));return-1<t.indexOf(".")?(t=t.split("."))[t.length-1].toLowerCase():null}function crsaGetNameFromUrl(e,t){for(var r=(e=crsaRemoveUrlParameters(e)).split(/[\\\/]/),n=r.pop();0==n.length&&r.length;)n=r.pop();var i=(n=0==n.length?t||"":n).split("?");return 1<i.length?i[0]:n}function crsaGetBaseForUrl(e){var t;return e&&((t=(e=crsaRemoveUrlParameters(e)).split(/[\/]/)).pop(),t.join("/"))}function crsaGeneralCombineUrlWith(e,t){if(0==t.length)return e;for(;t.startsWith("../");)e=crsaGetBaseForUrl(e),t=t.substr(3,t.length);return e+(t="/"!=t.charAt(0)?"/"+t:t)}function crsaCombineCurrentUrlWith(e,t){return crsaGeneralCombineUrlWith(e,t)}function crsaExtractDomain(e){var t,r=-1<e.indexOf("://")?(t=e.split("/")[0],e.split("/")[2]):e.split("/")[0];return(t?t+"//":"")+(r=r.split(":")[0])}function crsaCombineUrlWith(e,t){return e?crsaGeneralCombineUrlWith(e=(crsaIsAbsoluteUrl(e)&&"/"==t[0]?crsaExtractDomain:crsaGetBaseForUrl)(e),t):t}function crsaGetUrlToSmartCombine(e,t){for(var r=t,n=crsaGetBaseForUrl(r),i=crsaGetBaseForUrl(e);1;){var o=i.indexOf(n);if(-1<o&&i.substr(o,i.length)==n){""==(t=t.substr(r.length,t.length))&&(t=crsaGetNameFromUrl(r));break}o=r.split("/");if(1==o.length)break;o.pop(),r=o.join("/")}return t}function crsaIsAbsoluteUrl(e){return!!e&&(0<=e.indexOf("://")||0===e.indexOf("//"))}function crsaGetNumberAndUnit(e){var t,r=e.match(/^([0-9\.]+)(.*)/);return r&&1<r.length?(t=r[1],r=r[2],{text:(t=t.startsWith(".")?"0"+t:t)+r,number:t,unit:r}):null}function crsaIsRemoteUrl(e){return e&&crsaIsAbsoluteUrl(e)&&e.startsWith("http")}async function pgFetchRemoteContent(l,h){return new Promise(async function(s,c){crsaIsFileUrl(l)&&(l=pinegrow.getProxyUrl(l));let u=null,p;var e;(h=h||{}).pg_timeout&&(e=(p=new AbortController).signal,h.signal=e,u=setTimeout(function(){p.abort()},h.pg_timeout),delete h.pg_timeout);let g,f=0;if(h.pg_max_size)g=h.pg_max_size,delete h.pg_max_size,fetch(l,h).then(e=>{e.body||c(new Error("ReadableStream not yet supported in this browser."));const o=e.body.getReader();let a=[];const l=()=>o.read().then(({done:e,value:t})=>{if(e){var r,n=new Uint8Array(f);let e=0;for(r of a)n.set(r,e),e+=r.length;var i=n.buffer;u&&clearTimeout(u),void s(i)}else{if(f+=t.length,a.push(t),!(f>g))return l();p.abort(),o.cancel(),u&&clearTimeout(u),c(new Error(`More than ${g} bytes received, aborting fetch.`))}});return l()}).catch(e=>{u&&clearTimeout(u),"AbortError"===e.name?f>g||c(new Error("The fetch request timed out.")):c(e)});else try{if(l.startsWith("blob:")){var t,r=l.split("?")[0],n=pinegrow.getCurrentProject();if(n&&n.blobs.hasContent(r))return t=await n.blobs.getContent(r),u&&clearTimeout(u),void s(t)}(o=await fetch(l,h)).ok||(i=`An error has occurred: `+o.status,c(new Error(i)));var i,o,a=await o.arrayBuffer();u&&clearTimeout(u),s(a)}catch(e){"AbortError"===e.name?c(new Error("The fetch request timed out.")):c(e)}})}function pgCopyRemoteUrlToLocalPath(r,n,i){var o=require("fs"),a=require("path");pgFetchRemoteContent(r).catch(function(e){console.log("Error getting remote file "+r,e),i&&i()}).then(function(e){try{if(void 0===e)throw"Error getting remote file "+r;var t=new Buffer(e);try{crsaCreateDirs(a.dirname(n),o),o.writeFileSync(n,t),console.log("Save remote file "+r+" -> "+n)}catch(e){console.log("Could not save "+n,e)}}catch(e){console.log("Error getting remote file "+r,e)}i&&i()})}function crsaIsFileExist(e){return require("fs").existsSync(e)}function pgGetUrlNameWithoutExt(e){return crsaRemoveExtFromUrl(crsaGetNameFromUrl(e))}function crsaRemoveExtFromUrl(e){var t=crsaGetNameFromUrl(e),r=t.split(".");return 1===r.length?t:(r.splice(r.length-1,1),r.join("."))}function crsaGetUrlWithoutExt(e){return crsaGetBaseForUrl(e)+"/"+crsaRemoveExtFromUrl(e)}function crsaGetCaretPosition(e){var t,r,n,i=0,o=0;return window.getSelection?(t=window.getSelection()).rangeCount&&(n=t.getRangeAt(0)).commonAncestorContainer.parentNode==e&&(i=n.startOffset,o=n.endOffset):document.selection&&document.selection.createRange&&(n=document.selection.createRange()).parentElement()==e&&(t=document.createElement("span"),e.insertBefore(t,e.firstChild),(r=n.duplicate()).moveToElementText(t),r.setEndPoint("EndToEnd",n),i=o=r.text.length),[i,o]}function crsaSetCaretPosition(e,t,r){r=r||t;var n=e.firstChild,i=document.createRange(),n=(i.setStart(n,t),i.setEnd(n,r),window.getSelection());n.removeAllRanges(),n.addRange(i)}function crsaSplitAndTrimList(e){return e&&e.length?e.split(",").map(function(e){return $.trim(e)}):[]}function crsaGetSummaryStr(e,t,r){return e.length<=(t=t||40)?e:r?e.substr(0,t)+"...":"..."+e.substr(e.length-t,t)}function crsaGetRelativeDistanceForUrls(e,t,r){require("path");for(var n=t.split("/"),i=e.split("/"),o=n.slice(0),a=i.slice(0),l=0;l<n.length&&n[l]==i[l];l++)o.splice(o.indexOf(n[l]),1),a.splice(a.indexOf(i[l]),1);var s,c,u=o.join("/"),p=a.join("/"),g=u.replace(p,"");g==u?(s="/"==(g=p.replace(u,""))[g.length-1]?g+u:g,g==p?(c=u.split("/"),r&&r(c.length-1,s)):r&&r(0,s)):(p=-1*((c=g.split("/")).length-1),r&&r(p,null))}var splitCssValue=function(e,t,r,n,i){r=r||/\(/,n=n||/\)/;var o=[];if(e&&0!=e.length){e+=" \n";for(var a="",l=!1,s=0,c=0,u=0;u<e.length;u++){var p=e.charAt(u);if(" "==p)l=!0;else{if(t&&","==p&&0==s&&0==c){o.push($.trim(a)),l=!1,a="",o.push(",");continue}l&&0==s&&0==c&&(a=$.trim(a),i&&!a.length||o.push(a),l=!1,a=""),p.match(r)?s++:p.match(n)?s--:'"'!=p&&"'"!=p||(c=0==c?1:0)}a+=p}0<(a=$.trim(a)).length&&"\n"!=a&&o.push(a)}return o},getUrlFromCssUrlValue=function(e){var t=(e=e.replace(/[\'\"]/g,"")).match(/url\(([^\)]*)\)/i);return t?t[1]:e},getRand=function(e,t){return Math.round(Math.random()*(t-e))+e},pgGetRandomItem=function(e){return e[getRand(0,e.length-1)]},pgKeepScrollPosition=function(e,t){var r=e.scrollTop();t(),e.scrollTop(r)},CssBackgroundParser=function(e){var t=this,o=(this.parse=function(e){this.css=e,this.color="",this.image="",this.repeat="",this.attachment="",this.position="",this.important=!1;for(var t=["transparent","none","repeat","scroll","0%","0%"],r=splitCssValue(e,!0),n=(r.push(","),[]),i=0;i<r.length;i++)r[i].match(/\!important/i)?this.important=!0:","==r[i]?(0<this.color.length&&(this.color+=", "),this.color+=(1<=n.length?n:t)[0],0<this.image.length&&(this.image+=", "),this.image+=(2<=n.length?n:t)[1],0<this.repeat.length&&(this.repeat+=", "),this.repeat+=(3<=n.length?n:t)[2],0<this.attachment.length&&(this.attachment+=", "),this.attachment+=(4<=n.length?n:t)[3],0<this.position.length&&(this.position+=", "),this.position+=(5<=n.length?n:t)[4],this.position+=" ",this.position+=(6<=n.length?n:t)[5],n=[]):n.push(r[i]);this.color=o(this.color),this.image=o(this.image),this.repeat=o(this.repeat),this.attachment=o(this.attachment),this.position=o(this.position)},function(e){return e+(t.important?" !important":"")});this.getValue=function(e){switch(e.toLowerCase()){case"background-color":return this.color;case"background-image":return this.image;case"background-repeat":return this.repeat;case"background-attachment":return this.attachment;case"background-position":return this.position;default:return null}},e&&this.parse(e)};function crsaAddCancelSearch(t,e){var r=$("<a/>",{class:"cancel-search",href:"#"}).html("&times;").appendTo(t.parent()).on("click",function(e){e.preventDefault(),t.val("").trigger("input")});t.on("input",function(){var e=t.val();e&&e.length?(r.show(),t.addClass("has-value")):(r.hide(),t.removeClass("has-value"))}),r.hide(),e&&r.attr("style",e),""!=t.val()&&t.addClass("has-value")}function crsaShowDate(e){var t=e.getDate(),r=e.getMonth(),n=e.getFullYear();return t+". "+["January","February","March","April","May","June","July","August","September","October","November","December"][r]+" "+n}function downScaleCanvas(e,t){if(!(t<1&&0<t))throw"scale must be a positive number <1 ";for(var r,n,i,o,a,l,s,c,u,p=t*t,g=e.width,f=e.height,h=Math.ceil(g*t),d=Math.ceil(f*t),m=0,v=0,y=0,w=0,S=0,b=0,C=0,x=0,T=0,F=0,A=e.getContext("2d").getImageData(0,0,g,f).data,U=new Float32Array(4*g*f),v=0;v<f;v++)for(n=4*(i=0|(r=v*t))*h,(a=i!=(0|r+t))&&(T=i+1-r,F=r+t-i-1),m=0;m<g;m++,y+=4)w=n+4*(s=0|(l=m*t)),(o=s!=(0|l+t))&&(C=s+1-l,x=l+t-s-1),l=A[y],s=A[y+1],c=A[y+2],u=A[y+3],o||a?o&&!a?(U[w]+=l*(S=C*t),U[w+1]+=s*S,U[w+2]+=c*S,U[w+3]+=u*S,U[w+4]+=l*(b=x*t),U[w+5]+=s*b,U[w+6]+=c*b,U[w+7]+=u*b):a&&!o?(U[w]+=l*(S=T*t),U[w+1]+=s*S,U[w+2]+=c*S,U[w+3]+=u*S,U[w+4*h]+=l*(b=F*t),U[w+4*h+1]+=s*b,U[w+4*h+2]+=c*b,U[w+4*h+3]+=u*b):(U[w]+=l*(S=C*T),U[w+1]+=s*S,U[w+2]+=c*S,U[w+3]+=u*S,U[w+4]+=l*(b=x*T),U[w+5]+=s*b,U[w+6]+=c*b,U[w+7]+=u*b,U[w+4*h]+=l*(b=C*F),U[w+4*h+1]+=s*b,U[w+4*h+2]+=c*b,U[w+4*h+3]+=u*b,U[w+4*h+4]+=l*(b=x*F),U[w+4*h+5]+=s*b,U[w+4*h+6]+=c*b,U[w+4*h+7]+=u*b):(U[w]+=l*p,U[w+1]+=s*p,U[w+2]+=c*p,U[w+3]+=u*p);for(var E=document.createElement("canvas"),R=(E.width=h,E.height=d,E.getContext("2d")),P=R.getImageData(0,0,h,d),k=P.data,O=0,y=0,w=0;O<h*d;y+=4,w+=4,O++)k[w]=Math.ceil(U[y]),k[w+1]=Math.ceil(U[y+1]),k[w+2]=Math.ceil(U[y+2]),k[w+3]=Math.ceil(U[y+3]);return R.putImageData(P,0,0),E}!function(e){"use strict";function p(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function l(e,t,r,n,i,o){return p((t=p(p(t,e),p(n,o)))<<i|t>>>32-i,r)}function g(e,t,r,n,i,o,a){return l(t&r|~t&n,e,t,i,o,a)}function f(e,t,r,n,i,o,a){return l(t&n|r&~n,e,t,i,o,a)}function h(e,t,r,n,i,o,a){return l(t^r^n,e,t,i,o,a)}function d(e,t,r,n,i,o,a){return l(r^(t|~n),e,t,i,o,a)}function s(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var r,n,i,o,a=1732584193,l=-271733879,s=-1732584194,c=271733878,u=0;u<e.length;u+=16)a=g(r=a,n=l,i=s,o=c,e[u],7,-680876936),c=g(c,a,l,s,e[u+1],12,-389564586),s=g(s,c,a,l,e[u+2],17,606105819),l=g(l,s,c,a,e[u+3],22,-1044525330),a=g(a,l,s,c,e[u+4],7,-176418897),c=g(c,a,l,s,e[u+5],12,1200080426),s=g(s,c,a,l,e[u+6],17,-1473231341),l=g(l,s,c,a,e[u+7],22,-45705983),a=g(a,l,s,c,e[u+8],7,1770035416),c=g(c,a,l,s,e[u+9],12,-1958414417),s=g(s,c,a,l,e[u+10],17,-42063),l=g(l,s,c,a,e[u+11],22,-1990404162),a=g(a,l,s,c,e[u+12],7,1804603682),c=g(c,a,l,s,e[u+13],12,-40341101),s=g(s,c,a,l,e[u+14],17,-1502002290),a=f(a,l=g(l,s,c,a,e[u+15],22,1236535329),s,c,e[u+1],5,-165796510),c=f(c,a,l,s,e[u+6],9,-1069501632),s=f(s,c,a,l,e[u+11],14,643717713),l=f(l,s,c,a,e[u],20,-373897302),a=f(a,l,s,c,e[u+5],5,-701558691),c=f(c,a,l,s,e[u+10],9,38016083),s=f(s,c,a,l,e[u+15],14,-660478335),l=f(l,s,c,a,e[u+4],20,-405537848),a=f(a,l,s,c,e[u+9],5,568446438),c=f(c,a,l,s,e[u+14],9,-1019803690),s=f(s,c,a,l,e[u+3],14,-187363961),l=f(l,s,c,a,e[u+8],20,1163531501),a=f(a,l,s,c,e[u+13],5,-1444681467),c=f(c,a,l,s,e[u+2],9,-51403784),s=f(s,c,a,l,e[u+7],14,1735328473),a=h(a,l=f(l,s,c,a,e[u+12],20,-1926607734),s,c,e[u+5],4,-378558),c=h(c,a,l,s,e[u+8],11,-2022574463),s=h(s,c,a,l,e[u+11],16,1839030562),l=h(l,s,c,a,e[u+14],23,-35309556),a=h(a,l,s,c,e[u+1],4,-1530992060),c=h(c,a,l,s,e[u+4],11,1272893353),s=h(s,c,a,l,e[u+7],16,-155497632),l=h(l,s,c,a,e[u+10],23,-1094730640),a=h(a,l,s,c,e[u+13],4,681279174),c=h(c,a,l,s,e[u],11,-358537222),s=h(s,c,a,l,e[u+3],16,-722521979),l=h(l,s,c,a,e[u+6],23,76029189),a=h(a,l,s,c,e[u+9],4,-640364487),c=h(c,a,l,s,e[u+12],11,-421815835),s=h(s,c,a,l,e[u+15],16,530742520),a=d(a,l=h(l,s,c,a,e[u+2],23,-995338651),s,c,e[u],6,-198630844),c=d(c,a,l,s,e[u+7],10,1126891415),s=d(s,c,a,l,e[u+14],15,-1416354905),l=d(l,s,c,a,e[u+5],21,-57434055),a=d(a,l,s,c,e[u+12],6,1700485571),c=d(c,a,l,s,e[u+3],10,-1894986606),s=d(s,c,a,l,e[u+10],15,-1051523),l=d(l,s,c,a,e[u+1],21,-2054922799),a=d(a,l,s,c,e[u+8],6,1873313359),c=d(c,a,l,s,e[u+15],10,-30611744),s=d(s,c,a,l,e[u+6],15,-1560198380),l=d(l,s,c,a,e[u+13],21,1309151649),a=d(a,l,s,c,e[u+4],6,-145523070),c=d(c,a,l,s,e[u+11],10,-1120210379),s=d(s,c,a,l,e[u+2],15,718787259),l=d(l,s,c,a,e[u+9],21,-343485551),a=p(a,r),l=p(l,n),s=p(s,i),c=p(c,o);return[a,l,s,c]}function c(e){for(var t="",r=0;r<32*e.length;r+=8)t+=String.fromCharCode(e[r>>5]>>>r%32&255);return t}function u(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;for(t=0;t<8*e.length;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function n(e){for(var t,r="0123456789abcdef",n="",i=0;i<e.length;i+=1)t=e.charCodeAt(i),n+=r.charAt(t>>>4&15)+r.charAt(15&t);return n}function m(e){return unescape(encodeURIComponent(e))}function i(e){return c(s(u(e=m(e)),8*e.length))}function o(e,t){var r,n,e=m(e),t=m(t),i=u(e),o=[],a=[];for(o[15]=a[15]=void 0,16<i.length&&(i=s(i,8*e.length)),r=0;r<16;r+=1)o[r]=909522486^i[r],a[r]=1549556828^i[r];return n=s(o.concat(u(t)),512+8*t.length),c(s(a.concat(n),512+128))}function t(e,t,r){return t?r?o(t,e):n(o(t,e)):r?i(e):n(i(e))}"function"==typeof define&&define.amd?define(function(){return t}):e.md5=t}(this);var crsaResizeImage=function(e,t,r,n){var i=require("fs"),o=document.createElement("canvas"),a=(o.width=t,o.height=r,o.getContext("2d")),l=new Image;l.src=crsaMakeUrlFromFile(e),l.onload=function(){a.drawImage(this,0,0,t,r);var e=(e=downScaleCanvas(o,.5).toDataURL("image/png")).replace("data:image/png;base64,",""),e=new Buffer(e,"base64");i.writeFileSync(n,e)}},pgResizeImage=async function(e,u,p,g){return new Promise(function(o,a){var l=require("fs"),s=pinegrow.getMimeType(e),c=new Image;isApp()||(c.crossOrigin="anonymous"),c.src=e,c.onload=function(){var e=1,t=(u=c.width,p=c.height,c.width<u?u=c.width:e=u/c.width,c.height*e),e=(p<t?(e=p/c.height,u=c.width*e):p=t,document.createElement("canvas"));e.width=u,e.height=p;e.getContext("2d").drawImage(this,0,0,u,p);t=e;try{var r,n=t.toDataURL(s||"image/png"),i=n;g&&(n=n.replace("data:"+s+";base64,",""),r=new Buffer(n,"base64"),l.writeFileSync(g,r)),o({url:i,width:c.width,height:c.height})}catch(e){a(e)}}})},pg_is_safari=-1<navigator.userAgent.indexOf("Safari")&&navigator.userAgent.indexOf("Chrome")<0,pgScrollToWithoutAnimation=function(e,t,r){var n;e===window?n=e:9===e.nodeType&&(n=e.defaultView),n?pg_is_safari?n.scrollTo("left"===t?r:n.pageXOffset,"top"===t?r:n.pageYOffset):n.scrollTo({top:"top"===t?r:n.pageYOffset,left:"left"===t?r:n.pageXOffset,behavior:"auto"}):e["top"===t?"scrollTop":"scrollLeft"]=r},crsaScrollToElementInIframe=function(e,t){var r=e.contents(),n=e.get(0).clientHeight,i=e.get(0).clientWidth,o=r.scrollTop(),a=t.offset(),l=a.top,a=a.left,s=r.scrollLeft();(l<o||o+.9*n<l)&&(n/3<=l&&(l-=Math.floor(n/3)),r.scrollTop(l)),(a<s||s+.9*i<a)&&(i/3<=a&&(a-=Math.floor(i/3)),r.scrollLeft(a))};function takeElementPhoto(e,t,r){require("fs");pinegrow.takePhotoOfElement(e,400,t,function(){pinegrow.showQuickMessage("Screenshot has been taken."),pinegrow.cache_breaker++,require("nw.gui").App.clearCache(),r.preview_image=r.type+".png",pinegrow.frameworksChanged()})}function addTakePreviewImage(a){a.on_build_actions_menu=function(e,t,o,r){t.push({label:"Take preview image",kbd:null,action:function(e){var t,r=null;for(t in a.component_types){var n=a.component_types[t];if(n.selector){var i=n.selector;if(i="function"==typeof n.selector?n.selector(e):o.is(i)){r=n;break}}}r?takeElementPhoto(e,crsaMakeFileFromUrl(crsaCombineCurrentUrlWith(crsaCleanUpUrl(a.getImagePreviewBaseUrl()),r.type)+".png"),r):pinegrow.showQuickMessage("Component not found!")}})}}function useSelete2(){$("select").select2({allowClear:!0})}function getUrlWithoutProxy(e){return pinegrow.httpServer?pinegrow.getOriginalUrl(e):e}function styleToObject(e){if(e){styleArr=e.split(";");for(var t,r,n={},i=0;i<styleArr.length;i++)""!=styleArr[i]&&(r=(t=styleArr[i].split(":"))[0].trim(),t.splice(0,1),n[r]=t.join(":").trim());return n}return{}}function objectToStyle(e){var t,r="";for(t in e)t&&e[t]&&(r+=t+":"+e[t]+";");return r}function getNewStyle(e,t,r){var n,i=styleToObject(e),o=styleToObject(t);for(n in styleToObject(r))i[n]&&delete i[n];for(n in o)i[n]=o[n];return objectToStyle(i)}function getStyleFor(e,t){return e+":"+t+";"}function setStyle(e,t,r){var n;e&&(n=e.getAttr("style"),e.setAttr("style",getNewStyle(n,t,r)))}function crsaCopyToClipboard(e,t){copyCodeToClipboard(e,!0,t)}$.ui.autocomplete.filter=function(e,t){var r=new RegExp("^"+$.ui.autocomplete.escapeRegex(t),"i");return $.grep(e,function(e){return r.test(e.label||e.value||e)})};var crsaSelectText=function(e){var t,r=document;r.body.createTextRange&&((t=document.body.createTextRange()).moveToElementText(e),t.select()),r.body.createTextRange?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&(r=window.getSelection(),(t=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(t))},crsaSetCaretPlacement=function(e,t){var r,n;void 0!==window.getSelection&&void 0!==document.createRange?((r=document.createRange()).selectNodeContents(e),r.collapse(t),(n=window.getSelection()).removeAllRanges(),n.addRange(r)):void 0!==document.body.createTextRange&&((n=document.body.createTextRange()).moveToElementText(e),n.collapse(t),n.select())};function crsaGetNextElement(e,t){var r=$(t),n=r.index(e);return r[n+1]}function crsaGetPrevElement(e,t){var r=$(t),n=r.index(e);return r[n-1]}function crsaCamelize(e){return e.replace(/^([a-z])/,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")}var crsaHtmlEncodeHelper=document.createElement("div");function crsaHtmlEncode(e){return crsaHtmlEncodeHelper.innerText=e,crsaHtmlEncodeHelper.innerHTML}function crsaGetUrlAndParamsFromImportNEW(e){for(var t=[],r=e.split(","),n=0;n<r.length;n++){var i=r[n].trim(),o="",a=null,l=i.indexOf(" "),s=i.length,l=(-1<l?(o=i.substr(0,l),a=i.substr(l+1,s)):o=i,!1);-1<o.indexOf("url")&&(l=!0,o=o.replace(/(?:url\()(.*)(?:\))/,"$1")),o=o.replace(/[\'\"]/g,""),t.push({usedUrl:l,path:o,params:a})}return t}function crsaGetUrlAndParamsFromImport(e){var t=[],r=e.indexOf(" "),n=e.length;return-1<r?(t[0]=e.substr(0,r),t[1]=e.substr(r+1,n)):t[0]=e,t[0]=t[0].replace(/(?:url\()(.*)(?:\))/,"$1"),t[0]=t[0].replace(/[\'\"]/g,""),t}var colorToString=function(e){return null===e?"":1!=e.getAlpha()?e.toRgbString():e.toString()};function pgRemoveMultiselects(e){e.find(".crsa-input[data-autocomplete]").each(function(e,t){var r=$(t).data("pg-autocomplete");r&&(r.remove(!0),$(t).data("pg-autocomplete",r=null))})}function pgRemoveSpectrum(e,t){e.find(t=t||".crsa-input-color-picker").each(function(e,t){var r=$(t).data("pg-spectrum-helper");r&&(r.remove(),r=null,$(t).data("pg-spectrum-helper",null)),$(t).spectrum("destroy")})}function pgRemoveFilePicker(e,t){e.find(t=t||".crsa-pick-file").each(function(e,t){$(t).unbind("click")})}function pgSetDataOfObjsTo(e,r,n){e.each(function(e,t){$(t).data(r,n)})}function slideToggle(e,t){var r=$(e),n=r.data("originalHeight"),i=r.is(":visible");if((bShow=!i)==i)return!1;n||(n=r.show().height(),r.data("originalHeight",n),i)||r.hide().css({height:0}),bShow?r.show().animate({height:n},{duration:250,complete:function(){r.height("auto"),t&&t()}}):r.animate({height:0},{duration:250,complete:function(){r.hide(),t&&t()}})}function crsaGetFuzzySearchRegxFrom(e){for(var t=".*",r=0;r<e.length;r++){var n=e[r];t+=(n="$"==n?"\\"+n:n)+".*"}return new RegExp(t)}function getCodeMirrorMode(e){return"css"==e?"text/css":(e="scss")?"text/x-scss":(e="less")?"text/x-less":"text"}function pgE(e,t,r){var n=document.createElement(e);if(t)for(var i in t)n.setAttribute(i,t[i]);return r&&(n.innerHTML=r),n}function pg$E(e,t,r){return $(pgE(e,t,r))}!function(e,t,l){"use strict";var s,r=t.createElement("test"),c=t.documentElement,n=t.defaultView,u=n&&n.getComputedStyle,p=/^(-?[\d+\.\-]+)([a-z]+|%)$/i,g={},i=[1/25.4,1/2.54,1/72,1/6],o=["mm","cm","pt","pc","in","mozmm"],a=6;for(c.appendChild(r),u&&(r.style.marginTop="1%",s="1%"===u(r).marginTop);a--;)g[o[a]+"toPx"]=i[a]?i[a]*g.inToPx:f(r,"1"+o[a]);function f(e,t,r,n){r=r||"width";var i,o=(t.match(p)||[])[2],a="px"===o?1:g[o+"toPx"];if(a||/r?em/i.test(o)&&!n)e=a?e:"rem"===o?c:"fontSize"===r&&e.parentNode||e,a=a||parseFloat(h(e,"fontSize")),i=parseFloat(t)*a;else{a=(o=e.style)[r];try{o[r]=t}catch(e){return 0}i=o[r]?parseFloat(h(e,r)):0,o[r]=a!==l?a:null}return i}function h(e,t){var r,n,i=["paddingTop","paddingBottom","borderTop","borderBottom"],o=4,a=u?u(e)[t]:(a=e.style["pixel"+t.charAt(0).toUpperCase()+t.slice(1)])?a+"px":"fontSize"===t?f(e,"1em","left",1)+"px":e.currentStyle[t],l=(a.match(p)||[])[2];if("%"===l&&s)if(/^top|bottom/.test(t)){for(r=(n=e.parentNode||e).offsetHeight;o--;)r-=parseFloat(h(n,i[o]));a=parseFloat(a)/100*r+"px"}else a=f(e,a);else("auto"===a||l&&"px"!==l)&&u?a=0:l&&"px"!==l&&!u&&(a=f(e,a)+"px");return a}c.removeChild(r),r=l,e.Length={toPx:f}}(this,this.document),Object.values||(Object.values=function(e){var t,r=[];for(t in e)e.hasOwnProperty(t)&&r.push(e[t]);return r});var crsaGetPositionOverElementCenterPosition=function(e,t,r,n,i){void 0===i&&(i=1);var o=100,a=100,l=(e<110&&t<110&&(a=o=20),r+(e-o)/2),s=n+(t-a)/2;return{w:o,h:a,top:s,left:l,bottom:s+a,right:l+o}},crsaIsDOMElementDescendantOf=function(e,t){for(;e&&1===e.nodeType;){if(e===t)return!0;e=e.parentNode}return null},crsaGetPositionOverElement=function(p,g,f,h,d,e,m){var v=g,y=f,t=pinegrow.drag_drop_options,r=p.elementFromPoint(g,f);if(!r)return null;if(!(r=(r=r.ownerSVGElement&&"false"!==(a=r.closest("svg")).getAttribute("data-pg-collapsed")?a:r).classList.contains("pinegrow-ui-helper")?r.closest(":not(.pinegrow-ui-helper)"):r))return null;var w=$(r);if(0===(w="HTML"===r.tagName?w.find("body"):w).length)return null;var S=!1,n=getElementPgNode(w);if(t.force_parent)w=t.force_parent.get$DOMElement(),n=t.force_parent;else if(!e)if(n){for(var i,o=null;1&&"normal"!==(i=function(e){var t=e.getId();if(t){t=h.tree&&h.tree.getTreeDataItemForPgId(t);if(t&&"hidden"in t)return t.hidden?"hidden":t.collapsed?"collapsed":"normal";for(var r="normal",n=e;n.parent;)n.hasAttribute("data-pg-collapsed")&&(r=n===e?"collapsed":"hidden"),n=n.parent;return r}return"normal"}(n));){if("collapsed"===i){o=n;break}if(!n.parent)break;n=n.parent}o===n&&(n=n.parent,S=!0),w=n.get$DOMElement()}var a=w.offset(),b=(g+=p.scrollingElement.scrollLeft,f+=p.scrollingElement.scrollTop,null),t=null,l=pinegrow.getDragMenu();if(pgf.edit_css){t=new PgCSSGridInfo(w,!0);if(l&&l.setOverGrid(t.isGrid(),t.$el),pinegrow.keyState.cmdCtrl)if(t.isGrid())return w=t.$el,l=g-t.rect.left-p.scrollingElement.scrollLeft,x=f-t.rect.top-p.scrollingElement.scrollTop,l=t.getColForXOld(l),x=t.getRowForYOld(x),t=t.getCellRect(l,x),b={$e:w,grid:!0,rect:t,position:"inside-bottom",grid_position:{col:l,row:x}}}w.children().each(function(e,t){if(t.classList.contains("pinegrow-ui-helper"))return!0;var r=$(t),n=r.offset(),i=r.innerWidth(),o=r.innerHeight();if(0<i&&0<o&&"SCRIPT"!==t.nodeName){var a=parseInt(r.css("padding-top")),l=(parseInt(r.css("padding-bottom")),parseInt(r.css("margin-top"))),s=parseInt(r.css("margin-bottom")),c=parseInt(r.css("margin-left")),u=parseInt(r.css("margin-right")),c={x1:n.left-c,y1:n.top-l};if(c.x2=n.left+i+u,c.y2=n.top+o+s,c.x1<=g&&g<=c.x2&&c.y1<=f&&f<=c.y2)return b={$e:r},w=r,f<n.top?b.position="top":f>n.top+o?b.position="bottom":g<n.left?b.position="left":g>n.left+i?b.position="right":b.position=f<c.y1+a+o/2?"top":"bottom",0&&S&&!m&&(l=crsaGetPositionOverElementCenterPosition(i,o,n.left,n.top),g>l.left)&&g<l.right&&f>l.top&&f<l.bottom&&(b.center=!0,u=(new Date).getTime(),b.center_time=u,b.over_center=!0,d)&&d.center&&(b.center_time=d.center_time,1e3<u-b.center_time)&&(s=getElementPgNode(r))&&(b.uncollapsed=d.uncollapsed||[],b.uncollapsed.indexOf(s)<0&&b.uncollapsed.push(s),S=!1,b=crsaGetPositionOverElement(p,v,y,h,b,!0,!0)),!1}});var s,c,u,C,x,T,F,t=getElementPgNode(w);return b||(l=parseInt(w.css("padding-top")),x=parseInt(w.css("padding-bottom")),s=parseInt(w.css("padding-left")),C=parseInt(w.css("padding-right")),c=w.width(),F=10,T=F=15,F=20,(x=l+(u=w.height())+x)<4*(T=t&&"img"===t.tagName?F=50:T)&&(T=x/4),(C=s+c+C)<4*F&&(F=C/4),(b=b||{}).$e=w,b.position="inside-top",f-a.top>x/2&&(b.position="inside-bottom"),"BODY"!==r.tagName&&(f>a.top+l&&f<a.top+l+u&&g>a.left+s&&g<a.left+s+c&&(b.over_text=!0),f<a.top+T?b.position="top":f>a.top+x-T?b.position="bottom":g<a.left+F?b.position="left":g>a.left+C-F&&(b.position="right"))),d&&!b.uncollapsed&&d.uncollapsed&&(b.uncollapsed=d.uncollapsed),b.collapsed=S,t&&(b.target_pgel=t),b};function crsaSplitCharsInArray(e){for(var t=[],r=0;r<e.length;){var n,i=e[r];"&"==i?((n=e.indexOf(";",r))<0&&(n=e.length-1),t.push(e.substring(r,n+1)),r=n+1):(t.push(i),r++)}return t}function crsaGetCharArraySubstring(e,t,r){var n="";r>e.length&&(r=e.length);for(var i=t;i<r;i++)n+=e[i];return n}var crsaGetFreshMatchedRulesOLD=function(e,t,r){return e.getMatchedCSSRules(t,r=r||"")},crsaGetFreshMatchedRules=function(e,n){$.fn.crsa("getMatchedCSSRules",e,function(e,t,r){n&&n(e,t,r)})};function crsaCombinedTwoCSSList(e,t){e=e||[],t=t||[];for(var r=[],n=0;n<e.length;n++)r.push(e[n]);for(n=0;n<t.length;n++){for(var i=!1,o=0;o<r.length;o++)if(t[n]==r[o]){i=!0;break}i||r.push(t[n])}return r}var crsaGetAllUsedNodes=function(r,e,n){function i(e){var t=new RegExp("\\"+r.getDeclCharachter()+"[a-z0-9_\\-]*","ig");(t=e.match(t))&&t.forEach(function(e){var t=l.findNodeInside("decl","prop",e,r.getRootNode());t&&!n&&i(t.value),t&&-1==o.indexOf(e)&&(o.push(e),a.push(t))})}var o=[],a=[],l=pinegrow.pgPostCSSHelper,t=l.isVariable(e);return t&&o.push(e.prop),i(e.value),t&&a.push(e),{names:o,nodes:a}};function getStylePropWithoutImportant(e){var t,r;return e&&((r=e).endsWith(t="!important")?r.replace(new RegExp("\\s*\\"+t),""):r)}function pgGetActive$DOMElement(e,t){var r=e.get(0);return r.ownerDocument.defaultView?e:(r=r.getAttribute("data-pg-id"))&&(r=getPgNodeByPgId(r))&&(r=r.get$DOMElement())?(t&&t(),r):null}var getNewFontsUrl=function(e,t,r){if("remove"!=r)return"add"==r?e+"|"+t:e;var n=[],i=e.match(/family=(.*)/);if(i&&0<i.length)for(var o=i[1].split("|"),a=0;a<o.length;a++){var l=o[a],s=l.match(/([a-zA-Z0-9\+]*)/);s&&0<s.length&&s[1].replace(/\+/g," ")!=t&&n.push(l)}return 0<n.length?"https://fonts.googleapis.com/css?family="+n.join("|"):null},getFontNameFromURL=function(e){var t=[],r=e.match(/family=(.*)/);if(r&&0<r.length)for(var n=r[1].split("|"),i=0;i<n.length;i++){var o=n[i],a=o.match(/([a-zA-Z0-9\+]*)/);if(a&&0<a.length){var l=a[1].replace(/\+/g," "),s={};if(0<(o=o.replace(a[1],"")).length){var a=o.indexOf(":"),c=o.indexOf("&");if(-1<a&&(a=o.substr(a,-1<c?c:o.length),s["varients"]=a.slice(1).split(","),o=o.replace(a,"")),0<o.length&&-1<c)for(var u=(o=o.slice(1)).split("&"),p=0;p<u.length;p++){var g=u[p].split("=");"subset"==g[0]?s[g[0]]=g[1].split(","):s[g[0]]=g[1]}}t.push({name:l,options:s})}}return t},getFontNameAndOptions=function(e){for(var t=[],r=getFontNameFromURL(e),n=0;n<r.length;n++){var i=r[n].name;i&&(i={url:e,name:i},r[n].options&&(r[n].options.varients&&(i["included_varients"]=r[n].options.varients),r[n].options.display&&(i["included_display"]=r[n].options.display),r[n].options.subset)&&(i["included_subset"]=r[n].options.subset),t.push(i))}return t},getAttachedGoogleFonts=function(e){var i=[];return pinegrow.goThroughAllForAttribute(e,"href",function(e,t,r){var n=r.match(/fonts.googleapis.com\/css/);e.is("link")&&n&&0<n.length&&(i=[...i,...getFontNameAndOptions(r)])}),pinegrow.pgGoogleFontManager.getFontOptions(i)};function pgShow(e,t){e.style.display=t||"block"}function pgHide(e){e.style.display="none"}function pg$Show(e,r){e.each(function(e,t){t.style.display=r||"block"})}function pg$Hide(e){e.each(function(e,t){t.style.display="none"})}function pg$CSS(e,n){e.each(function(e,t){for(const r in n)t.style[r]=n[r]})}function pg$PositionAt(e,r,n){e.each(function(e,t){pgPositionAt(t,r,n)})}function pgPositionAt(e,t,r){e.pgCurrentPosition={x:t,y:r},e.style.transform=`translate3d(${t}px, ${r}px, 0)`}function pg$Closest(e,t){var r=e.get(0).closest(t);return r?$(r):$()}function pgFindAll(e,t){return e.querySelectorAll(t)}function pg$FindAll(e,t){return e.get(0).querySelectorAll(t)}function pg$Flash(e,t,r){t=t||"flash",e._pg_flash_timer&&clearTimeout(e._pg_flash_timer),e.addClass(t),flash_timer=setTimeout(function(){e.removeClass(t),e._pg_flash_timer=null},r||1e3)}function pgGetDOMElementName(e,t,r,n){void 0===t&&(t=!0),void 0===r&&(r=!0);var i=e.tagName.toLowerCase(),o='<nametag class="dyn">'+i+"</nametag>";if(r){var a,l,s="",c=!1;if("META"==e.tagName?(l=e.getAttribute("name"),a=e.getAttribute("content"),l?s=l+'="'+(a||"")+'"':e.attributes.length&&(s=e.attributes[0].nodeName+'="'+e.attributes[0].nodeValue+'"'),c=!0):"LINK"==e.tagName?(s=pinegrow.getOriginalUrl(e.getAttribute("href")||""),c=!0):"SCRIPT"==e.tagName&&((l=e.getAttribute("src"))?(s=pinegrow.getOriginalUrl(l),c=!0):s=e.innerText||""),!c)for(var u=0;u<e.childNodes.length;u++)if(3==e.childNodes[u].nodeType&&(s+=$.trim(e.childNodes[u].textContent)).length){s=s.substring(0,30);break}s.length&&(s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),"A"===e.tagName&&(a=pinegrow.getOriginalUrl(e.getAttribute("href")||""))&&(l=crsaGetSummaryStr(a,30),s.length&&(l+=" | "+s),s=l)}c=e.getAttribute("id");if(c&&(o+="<nameid>"+"#"+(c=escapeHtmlCode(c))+"</nameid>",i+=c),t){var p=0,g=null,f="";if(0<e.classList.length){for(var h,d=0;d<e.classList.length;d++)e.classList[d].startsWith("crsa")||e.classList[d].startsWith("pgc-")||e.classList[d].startsWith("pg-")||(p++,h=escapeHtmlCode(e.classList[d]),1===p&&(g=h),f+="."+h);0<p&&(i+=":"+f,o+="<nameclass"+(1<p?' title="'+f+'"':"")+">"+"."+g+(1<p?"...":"")+"</nameclass>")}}return s&&(o+=" | "+"<nametext>"+s+"</nametext>",i+="|"+s),n&&(n.search_string=i),o}function pgDynElementMessage(t){pinegrow.showNotice("<p><b>"+t+"</b></p><p>Dynamic elements are HTML elements created by Javascript code on your page. These elements are not part of the HTML code of the page and so can't be edited through Pinegrow.</p><p>You have to edit the relevant Javascript code in order to change dynamic elements.</p>",t,"dyn-element-operation",function(e){e||pinegrow.showQuickMessage(t,4e3,!1,"error")})}function pgGetElementClasses(e){var t=[],r=/^(crsa\-|medium\-editor|pg\-node|pgc\-|pg\-show\-outline|pinegrow\-ui\-|pg\-internal\-|pghelper\-|pg\-state\-|wp\-mark\-areas|pg\-show\-wrapper)/;return e.classList.forEach(function(e){e.match(r)||t.push(e)}),t}function getCSSFunctionNameAndParams(e){var t=e.indexOf("("),r=e.indexOf(")"),n=e,i=null;return-1<t&&(n=e.substring(0,t),i=e.substring(t+1,r)),{name:n,params:i}}function pgStringToNumberRange(e,t,r){for(var n=0,i=0;i<e.length;i++)n+=e.charCodeAt(i);return n%(r-t)+t}function pgScrollToItemInContainer(e,t,r,n,i,o){void 0===r&&(r=!1),void 0===o&&(o=0);var a=t.scrollTop(),l=e.get(0).getBoundingClientRect(),s=t.get(0).getBoundingClientRect(),c={},s=(c.top=l.top-s.top+a,s.height),l=l.height,c=c.top+o;!r&&a<=c&&c+l<=a+s?i&&i(!1):n?t.stop().animate({scrollTop:c},"number"==typeof n?n:150,function(){i&&i(!0)}):(t.scrollTop(c),i&&i(!0))}function pgGetUniqueShortNamesForUrls(e){function t(e){return!!e.items.length&&(e.name=e.items.pop()+"/"+e.name,!0)}for(var r=e.map(function(e){for(var t=e.split("/"),r=t.pop();0==r.length&&t.length;)r=t.pop();return{items:t,name:r}});1;){for(var n={},i=!1,o=!0,a=0;a<r.length;a++)n[r[a].name]?(1==n[r[a].name].length&&(i=i||t(n[r[a].name][0])),n[r[a].name].push(r[a]),i=i||t(r[a]),o=!1):n[r[a].name]=[r[a]];if(o||!i)return r.map(function(e){return e.name})}}function pgMakeStringArrayUnique(e){var t={},r=[];return e.forEach(function(e){e in t||(r.push(e),t[e]=!0)}),r}function mkdirpsync(e,r,n){var i,t=parseInt("0777",8),o=(r=r&&"object"==typeof r?r:{mode:r}).mode,a=r.fs||fs;void 0===o&&(o=t&~process.umask()),n=n||null,e=path.resolve(e);try{a.mkdirSync(e,o),n=n||e}catch(t){switch(t.code){case"ENOENT":n=mkdirpsync(path.dirname(e),r,n),mkdirpsync(e,r,n);break;default:try{i=a.statSync(e)}catch(e){throw t}if(i.isDirectory())break;throw t}}return n}function getTrimed(e){return e?e.trim():null}function pgGeneratePassword(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";e=e||6,s="";for(var r=0;r<e;r++)s+=t.charAt(Math.floor(Math.random()*t.length));return s}var pgGenerateUsername=function(){var e=["Space","Super","Cool","Quick","Smart","Kind","Clever","Amazing","Awesome","Good","Brainy","Blue","Red","Green","Yellow","White","Big","Slow","Full","Moving","Golden","Soft","Speedy","Loud","Quiet","Strong","Lovely","Kind"],t=["Cookie","Star","Rocket","Moon","Sun","Flower","Bird","Duck","Rabbit","Bee","Ship","Cloud","Hill","Tree","Puppy","Cat","Bear","Dove","River","Stone","Gold","Grass","Ant","Light","Dance","Lightning","Alien","Dog","Sea","Car","giant","Crab","Coder","Cricket","Boat","Jet"];return e[getRand(0,e.length-1)]+t[getRand(0,t.length-1)]+getRand(100,999)};function pgSaveOriginalStyle(e){e.attr("data-pg-original-style",e.attr("style")||"")}function pgRestoreOriginalStyle(e,t){var r,n=e.attr("data-pg-original-style");null!=n&&(n?(t&&(r=new RegExp(escapeRegExp(t)+"\\:\\s*"+"([^\\;]*)"+"\\;?","g"),n=n.replace(r,"")),e.attr("style",n)):e.removeAttr("style"),e.removeAttr("data-pg-original-style"))}function pgForgetOriginalStyle(e){e.removeAttr("data-pg-original-style")}var PgDOMHelper=function(){this.closestWithClass=function(e,t){for(;1===e.nodeType;){if(e.classList.contains(t))return e;e=e.parentNode}return null},this.getScrollLeft=function(e){return e.pageXOffset||e.scrollLeft},this.getScrollTop=function(e){return e.pageYOffset||e.scrollTop},this.getWidth=function(e){return e.clientWidth},this.getHeight=function(e){return e.clientHeight},this.getOffset=function(e){var t=e.getBoundingClientRect(),r=e.ownerDocument.documentElement,n=e.ownerDocument.defaultView;return{top:t.top+(n.pageYOffset||r.scrollTop)-(r.clientTop||0),left:t.left+(n.pageXOffset||r.scrollLeft)-(r.clientLeft||0)}},this.findChildByTag=function(e,t){for(var r=0;r<e.children.length;r++)if(1===e.children[r].nodeType&&e.children[r].tagName===t)return e.children[r];return null}},pgMeasureTextWidth_measureTextWidthCanvasContext=$("<canvas></canvas>").get(0).getContext("2d"),pgMeasureTextWidth=(pgMeasureTextWidth_measureTextWidthCanvasContext.font='13px -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif',function(e){return pgMeasureTextWidth_measureTextWidthCanvasContext.measureText(e).width}),pgUpdateGeneratedSectionContent=function(e,t,r,n){n=n||"append";var i=new RegExp("\\/\\*\\s*Pinegrow generated "+t+" Begin\\s*\\*\\/[\\s\\S]*?\\/\\*\\s*Pinegrow generated "+t+" End\\s*\\*\\/","ig");if(!e.match(i)){if("none"===n)return e;var o=`
/* Pinegrow generated ${t} Begin */

/* Pinegrow generated ${t} End */
`;"append"===n?e+=o:"prepend"===n&&(e=o+e)}return e=e.replace(i,"/* Pinegrow generated "+t+" Begin */\n"+r+"\n    /* Pinegrow generated "+t+" End */")},pgUpdateGeneratedSection=function(e,t,r){var n=require("fs"),i="";try{i=n.readFileSync(e,{encoding:"utf8"})||""}catch(e){}var i=pgUpdateGeneratedSectionContent(i,t,r),o=require("path").dirname(e);crsaIsFileOrDir(o,n)||crsaCreateDirs(o,n),crsaWriteFileWithBackup(n,e,i,"utf8")};class PgPreloadedResources{constructor(e){this.base=e,this.map={}}preload(e){var i=this,t=!1;e.forEach(function(r){var n=i.base+r,e=(n.endsWith(".php")&&(n+="dis.html"),Date.now());fetch(n+"?version="+e).then(function(e){var t;if(e.ok)return e.text().then(function(e){r.endsWith(".php"),e=e.replace(/___PHPSTART___/gm,"<?php").replace(/___PHPEND___/gm,"?>").replace(/___PHPSHORTSTART___/gm,"<?="),i.map[r]=e,console.log("Got remote resource file "+n)});throw t=`An error has occured: `+e.status,new Error(t)}).catch(function(e){console.log("Error getting remote resource file "+n,e),t||(pinegrow.showAlert(`<p>At least one of the required resources was not loaded: ${r} - ${e.toString()}</p><p>Try reloading Pinegrow. If this does not help contact support@pinegrow.com.</p>`,"Unable to load required resources"),t=!0)})})}getContent(e){return this.map[e]||null}}