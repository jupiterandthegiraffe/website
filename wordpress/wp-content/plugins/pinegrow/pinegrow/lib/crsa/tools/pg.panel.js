var myLayout=null,testGoldenLayout=function(){function F(e,n,t,o,i){return e.config.noDropOthersInPositions&&0<=e.config.noDropOthersInPositions.indexOf(n)?(console.log("cant drop"),!1):!(e.config.pages||e.config.codeEditors||e.config.dont_drop_stuff_here||0)}function e(e){return{settings:{showPopoutIcon:!1,showMaximiseIcon:!1,showCloseIcon:!0},content:[{type:"row",content:e}]}}function n(e,n,t){return{type:"stack",width:e||18,isClosable:!1,isDocked:t||!1,isAutoDocked:!1,notDraggable:R,tabsNotDraggable:R,content:n.filter(function(e){return null!==e})}}function t(e){return{type:"stack",isClosable:!1,notCollapsable:!0,width:0,isHidden:!0,hidden_stack:!0,dontCollapseOnActiveTabClick:!0,content:e.filter(function(e){return null!==e})}}function o(e,n){return{type:"column",isClosable:!1,content:e.filter(function(e){return null!==e}),isFloating:n}}function N(e){return{type:"row",isClosable:!1,content:e.filter(function(e){return null!==e})}}function O(e){for(var n=0;n<S.length;n++)if(S[n].key==e)return S[n];return null}function U(){return(pgIsMagic()?O("magic"):O($("body").width()<14?"default_small":"default")).config}function i(n,e){function a(e,n,t,o){if(e.content){for(var i=0;i<e.content.length;i++)if(e.content[i])if("function"==typeof n){if(n(e.content[i],e))return t&&(e.content.splice(o?i:i+1,0,t),s=!0),!0;if(a(e.content[i],n,t))return!0}else{if("hidden_stack"===n&&e.content[i].hidden_stack)return console.log("found hidden",e.content[i],e),e.content[i].content||(e.content[i].content=[]),t&&(e.content[i].content.push(t),s=!0),!0;if("component"===e.content[i].type){if(e.content[i].componentName===n)return!0}else if(a(e.content[i],n,t))return!0}return!1}}g=!1;var t=[],s=(p&&t.push({panel:p,after:function(e){return!!e.componentName&&"style"===e.componentName}}),l&&t.push({panel:l,after:function(e){return!!e.componentName&&"style"===e.componentName}}),c&&t.push({panel:c,after:function(e){return!!e.componentName&&"style"===e.componentName}}),r&&t.push({panel:r,after:function(e){return!!e.componentName&&"style"===e.componentName}}),d&&t.push({panel:d.content[0],after:function(e){return e.pages||!1}}),t.push({panel:C,after:function(e){return!!e.componentName&&"style"===e.componentName},before:!0}),t.push({panel:k,after:"hidden_stack",aaafter:function(e,n){return!!n.hidden_stack}}),!1);a(n,"hidden_stack")||n.content[0].content.push(q),t.forEach(function(e){a(n,"function"==typeof e.panel?e.panel:e.panel.componentName)||(s=!1,a(n,e.after,e.panel,e.before||!1),s)||console.error(`Unable to add the panel `+e.panel.componentName)}),K(n,e)}function B(t){var e,n,o,i;t.config.isFloating&&(t.config.floatingPosY="floatingPosY"in t.config?t.config.floatingPosY:100+T,100<=(T+=20)&&(T=0),e=Math.max(300,Math.floor(.85*($("body").height()-t.config.floatingPosY))),n=t.config.floatingWidth?Math.max(300,t.config.floatingWidth):300,(o=$("body").width())/2<(o=t.config.prefloatingPosX||o/2)?o=o-n-T:o+=T,t.config.floatingPosX="floatingPosX"in t.config?t.config.floatingPosX:o,t.isFloating=!0,t.element.addClass("lm_floating"),Q?(t.element.css({left:"",top:"",height:"",width:""}),o={},pinegrow.dispatchEvent("on_panel_open_in_floating_window",null,openPanelInExternalWindowStack,t,o),openPanelInExternalWindow(t.element,null,o,openPanelInExternalWindowStack||t)):(t.element.css({left:t.config.floatingPosX+"px",top:t.config.floatingPosY+"px",height:t.config.floatingHeight?Math.max(300,t.config.floatingHeight)+"px":e+"px",width:n+"px"}),o=$('<div class="lm_resize_handle pg-win-resizer"><i class="icon icon-drag-kotni"></i></div>'),t.element.append(o),t.dragMoverResizer=new PgMoverAndResizer(t.element,".lm_drag_header",o,".lm_goldenlayout"),t.dragMoverResizer.wholeVisible=!1,t.dragMoverResizer.onResize=function(e,n){t.config.floatingWidth=e,t.config.floatingHeight=n,t.callDownwards("setSize")},t.dragMoverResizer.onMove=function(e,n){t.config.floatingPosX=e,t.config.floatingPosY=n,t.callDownwards("setSize")},t.element.on("mousedown",function(e){t.element.hasClass("lm_floating_focused")||($(".lm_floating_focused").removeClass("lm_floating_focused"),t.element.addClass("lm_floating_focused"))}),t.element.on("dblclick",".lm_drag_header",function(){var e;t.dragMoverResizer&&(e=t.dragMoverResizer.ensureVisible(!0,!0))&&(t.config.floatingWidth=e.w,t.config.floatingHeight=e.h,t.config.floatingPosX=e.x,t.config.floatingPosY=e.y,t.callDownwards("setSize"))})),i=function(){t.dragMoverResizer&&t.dragMoverResizer.ensureVisible(!1,!0)&&t.callDownwards("setSize")},$(window).on("resize",i),i(),t.on("itemDestroyed",function(){$(window).off("resize",i)}))}var a,p,l,r,c,d,z,g,H={pages:function(e){return e.config.pages||!1},codeEditors:function(e,n,t,o){return"header"!==n},no_drop:function(e,n,t,o){return"header"!==n}},G=function(e,n){var t={isClosable:!0,isFlexible:!0,dontCollapseOnActiveTabClick:!0,pages:!0,addClass:"pg-fullsize-item pg-page-area",notDraggable:!0,validDropLocations:".pg-page-area",checkDropArea:H.pages,getNewStackDef:G,tabsNotDraggable:R};return"pageview"==n.config.componentName?t:{}},j="2",R=pgf.kids||!1,s={type:"component",componentName:"lib_panel",componentState:{text:"Component 1"},title:"Library",isClosable:!1,panel_key:"library",panel_category:"Essential",panel_description:"Add elements and components to the page.",panel_icon:"icon-import"},u={type:"component",componentName:"project_panel",componentState:{text:"Component 1"},title:"Project",isClosable:!1,panel_key:"project",panel_category:"Essential",panel_description:"Manage project settings, files and folders.",panel_icon:"icon-project"},m={type:"component",componentName:"history",componentState:{text:"Component 1"},title:"History",isClosable:!1,panel_key:"history",panel_category:"Tools",panel_description:"Move back and forward through the undo history.",panel_icon:"icon-undo"},w={type:"stack",isClosable:!1,isFlexible:!0,dontCollapseOnActiveTabClick:!0,pages:!0,addClass:"pg-fullsize-item",notDraggable:!0,content:[],validDropLocations:".pg-fullsize-item",checkDropAreaFunc:"pages",getNewStackDef:G},f={type:"stack",isClosable:!1,notCollapsable:!0,isHidden:!0,dontCollapseOnActiveTabClick:!0,height:50,width:20,codeEditors:!0,checkDropAreaFunc:"codeEditors",tabsNotDraggable:!0,content:[]},_=(R&&(w.tabsNotDraggable=!0,f.tabsNotDraggable=!0),{type:"stack",isClosable:!1,dontCollapseOnActiveTabClick:!0,noHeaders:!0,fixedHeight:32,noSplitter:!0,noDropOthersInPositions:["bottom","left","right"],addClass:"pg-fullsize-item",content:[{type:"component",componentName:"status_bar",componentState:{text:"Component 3"},title:"Status bar",height:100,noDragDrop:!0}]}),h={type:"component",componentName:"tree",componentState:{text:"Component 3"},title:"Tree",isClosable:!1,panel_key:"tree",panel_category:"Essential",panel_description:"View and edit the structure of the HTML document.",panel_icon:"icon-Pin11"},y={type:"component",componentName:"prop_panel",componentState:{text:"Component 1"},title:pgf.kids?"Element attributes":"Element properties",isClosable:!1,panel_key:"prop",panel_category:"Essential",panel_description:"Edit element attributes and use framework visual controls.",panel_icon:"icon-settings"},v={type:"component",componentName:"style",componentState:{text:"Component 1"},title:"Style",isClosable:!1,panel_key:"style",panel_category:"Essential",panel_description:"Use CSS to style elements on the page.",panel_icon:"icon-Pin15"},b={type:"component",componentName:"element_code",componentState:{text:"Component 1"},title:"Element code",isClosable:!1,panel_key:"element_code_panel",panel_category:"Tools",panel_description:"Edit the code of the selected element.",panel_icon:"icon-KODA"},k={type:"component",componentName:"info",componentState:{text:"Component 1"},title:pgf.kids?"Your Adventure":"Information",isClosable:!1,panel_category:"Tools",panel_icon:pgf.kids?null:"icon-274",panel_key:"info",panel_description:"Show information and instructions for the current project."},C=("PG"!==pgf.product&&"ONLINE"!==pgf.product&&"WPPLUGIN"!==pgf.product||(a={type:"component",componentName:"act_panel",componentState:{text:"Component 1"},title:"Actions",isClosable:!1,panel_key:"act",panel_category:"Components",panel_description:"Define and use components and master pages.",panel_icon:"icon-actions"},p={type:"component",componentName:"cms_panel",componentState:{text:"Component 1"},title:"WordPress theme builder",isClosable:!1,panel_key:"cms",panel_category:"WordPress",panel_description:"Add WordPress template functions to HTML elements.",panel_icon:"icon-WP"},l={type:"component",componentName:"class_styles_panel",componentState:{text:"Component 1"},title:"Style manager",isClosable:!1,panel_key:"classstyles",panel_category:"Tailwind CSS",panel_description:"Manage Tailwind CSS styles.",panel_icon:"icon-classes"},r={type:"component",componentName:"ai",componentState:{text:"Component 1"},title:"AI Assistant",isClosable:!1,panel_key:"ai",panel_category:"Tools",panel_description:"Let the AI Assistant help you build your project.",panel_icon:"icon-wand"},c={type:"component",componentName:"animations_panel",componentState:{text:"Component 1"},title:"Interactions",isClosable:!1,panel_key:"animations",panel_category:"Interactions",panel_description:"Manage interactions and scroll scenes.",panel_icon:"icon-113"},d={type:"stack",isClosable:!1,notCollapsable:!0,isHidden:!0,dontCollapseOnActiveTabClick:!0,tabsNotDraggable:!0,dont_drop_stuff_here:!0,noAlwaysShownButton:!0,addClass:"pg-force-min-panel-height",height:25,content:[{type:"component",componentName:"animation_timeline",componentState:{text:"Component 1"},title:"Animation Timeline",isClosable:!1,reorderEnabled:!1,notDraggable:!0,panel_category:"Interactions",panel_description:"Edit animation timeline.",panel_icon:"icon-snap-timeline",panel_on_show:function(){pinegrow.findFrameworkByKey("pg.ia").showTimelineEditor(!0)},panel_on_hide:function(){pinegrow.findFrameworkByKey("pg.ia").showTimelineEditor(!1)},panel_on_is_visible:function(){return pinegrow.findFrameworkByKey("pg.ia").isTimelineEditorShown()}}]}),pinegrow.hasActivatedProduct("IA")||pgIsInTrial()||!crsaIsEmailActivated()||(d=c=null),pinegrow.hasActivatedProduct("TW")||pgIsInTrial()||!crsaIsEmailActivated()||(l=null),pinegrow.hasActivatedProduct("WP")||pgIsInTrial()||!crsaIsEmailActivated()||(p=null),{type:"component",componentName:"dm_design_panel",componentState:{text:"Component 1"},title:"Design panel",isClosable:!1,panel_key:"pgdm",panel_category:"Essential",panel_description:"Manage the overall design (theme) of the current project.",panel_icon:"icon-color"}),S="KIDS"===pgf.product?[{name:"Large screen (4 columns)",key:"default",config:e([n(22,[k]),o([w,f,_]),n(18,[y,v]),n(18,[h])])},{name:"Small screen (3 columns)",key:"small",config:e([n(27,[k]),o([w,f,_]),n(20,[h,y,v])])}]:"SNAP"===pgf.product?[{name:"Default",key:"default",config:e([o([w]),n(25,[{type:"component",componentName:"snap",componentState:{text:"Component 1"},title:"HTML Snapshots",isClosable:!1}])])}]:"PGTC"===pgf.product?[{name:"Large screen (4 columns)",key:"default",config:e([n(18,[u,m,{type:"component",componentName:"db_tree",componentState:{text:"Component 1"},title:"Action mappings",isClosable:!1}],!0),o([w,f,_]),n(22,[p]),n(22,[h])])}]:"ONLINE"===pgf.product||"WPPLUGIN"===pgf.product?(pinegrow.hasActivatedProduct("WP")||(p=null),s=null,[{name:"Default (4 columns)",key:"default",config:e([n(20,[k],!1),o([w,f,d,_]),n(20,[C,y,v,c,p,r]),n(18,[h,u]),t([b,m,l,a])])},{name:"Minimal",key:"minimal",config:e([n(20,[k],!1),o([w,f,d,_]),n(20,[C,h,y,v,c,p,r]),t([b,m,l,a,u])])},{name:"Left - Right",key:"left_right",config:e([n(20,[h,k,u],!1),o([w,f,d,_]),n(20,[C,y,v,c,p,r]),t([b,m,l,a])])}]):[{name:"Default (3 columns)",key:"default",config:e([n(22,[u,h],!1),o([w,f,d,_]),n(28,[C,y,v,c,a,p,r]),t([b,m,k,l,s])])},{name:"Large screen (4 columns)",key:"large",config:e([n(18,[s,u],!1),o([w,f,d,_]),n(18,[y,l,v,C,c,a,p,r]),n(18,[h],!1),t([b,m,k])])},{name:"All sides (Props and code below page view)",key:"all_sides",config:e([n(18,[s,u,m]),o([(z={height:60},$.extend(w,z)),d,f,N([n(50,[y,l]),n(50,[b])]),_]),n(18,[h]),n(18,[C,v,c,a,p,r]),t([k])])},{name:"Minimal (all panels collapsed)",key:"minimal",config:e([n(18,[s,u,m],!0),o([w,f,d,_]),n(18,[h],!0),n(18,[C,y,l,v,c,b,a,p,r],!0),t([k])])},{name:"Two screens (Pages on one, tools on another)",key:"2screens",config:e([o([w,d,_]),o([N([n(20,[s,u,m]),n(20,[C,y,l,v,c,b,a,p,r]),n(18,[h])]),f],!0),t([k])])}],y=(s&&pinegrow.panelManager.registerPanel(s),y&&pinegrow.panelManager.registerPanel(y),v&&pinegrow.panelManager.registerPanel(v),h&&pinegrow.panelManager.registerPanel(h),u&&pinegrow.panelManager.registerPanel(u),C&&pinegrow.panelManager.registerPanel(C),a&&pinegrow.panelManager.registerPanel(a),p&&pinegrow.panelManager.registerPanel(p),c&&(pinegrow.panelManager.registerPanel(c),pinegrow.panelManager.registerPanel(d.content[0])),l&&pinegrow.panelManager.registerPanel(l),m&&pinegrow.panelManager.registerPanel(m),b&&pinegrow.panelManager.registerPanel(b),k&&pinegrow.panelManager.registerPanel(k),r&&pinegrow.panelManager.registerPanel(r),pgIsMagic()&&((S=[]).push({name:"Magic",key:"magic",config:e([n(20,[s,u,m],!0),o([w,f,_]),n(20,[{type:"component",componentName:"dm_prop_panel",componentState:{text:"Component 1"},title:"Props",isClosable:!1},C,{type:"component",componentName:"dm_style_panel",componentState:{text:"Component 1"},title:"Style",isClosable:!1},{type:"component",componentName:"dm_styles_panel",componentState:{text:"Component 1"},title:"Styles",isClosable:!1},a]),n(18,[h],!0)])}),pinegrow.showQuickMessage("This is MAGIC!")),window.pgGetWorkspaces=function(){return S},U()),v=jQuery.extend(!0,{},y),K=function(e,n){for(var t,o=["pageview","code_editor","canvas"],i=(n&&(o=o.concat(n)),[]),a=0;a<e.content.length;a++)e.content[a]&&o.indexOf(e.content[a].componentName||"")<0&&(e.content[a].content&&K(e.content[a],n),t=!1,e.content[a].codeEditors?(e.content[a].notCollapsable=!0,e.content[a].dontCollapseOnActiveTabClick=!0,(e.content[a].isHidden||1)&&(e.content[a].height=50,e.content[a].width=20),e.content[a].isHidden=!0,e.content[a]["undocked_width_px"]&&delete e.content[a]["undocked_width_px"],e.content[a].checkDropAreaFunc="codeEditors",e.content[a].tabsNotDraggable=!0):e.content[a].pages?(e.content[a].getNewStackDef=G,e.content[a].addClass="pg-fullsize-item pg-page-area",g?t=!0:g=!0):"component"===e.content[a].type||e.content[a].content&&0!==e.content[a].content.length||(t=!0),t||(i.push(e.content[a]),e.content[a].checkDropAreaFunc&&(e.content[a].checkDropArea=H[e.content[a].checkDropAreaFunc]),e.content[a].config&&e.content[a].config.checkDropAreaFunc&&(e.content[a].config.checkDropArea=H[e.content[a].config.checkDropAreaFunc]),e.content[a].config&&e.content[a].config.newStackDef&&e.content[a].config.newStackDef.checkDropAreaFunc&&(e.content[a].config.newStackDef.checkDropArea=H[e.content[a].config.newStackDef.checkDropAreaFunc])));e.content=i,e.activeItemIndex>=e.content.length&&(e.activeItemIndex=e.content.length-1,e.activeItemIndex<0)&&delete e.activeItemIndex},q={type:"stack",isClosable:!1,notCollapsable:!0,width:0,isHidden:!0,hidden_stack:!0,dontCollapseOnActiveTabClick:!0,content:[]},P=pinegrow.isContributorMode()?["dm_design_panel","code_editor","element_code","style","css_var_panel","act_panel","cms_panel","animations_panel","animation_timeline","class_styles_panel"]:[],I=(c||(P.push("animations_panel"),P.push("animation_timeline")),l||P.push("class_styles_panel"),p||P.push("cms_panel"),a||P.push("act_panel"),"pg_layout_state"),A=(pgIsMagic()&&(I="pg_layout_state_magic2"),I+=pgf.layout_prefix,localStorage),T=((A=pinegrow.saveSettingsOnBackend()&&pgwpdata&&pgwpdata.user_settings?pgwpdata.user_settings:A)[I]?(b=A.pg_layout_state_version||"0","1"!=A.pg_layout_state_ccmode||pinegrow.isContributorMode()||(b="modechange"),j==b&&(v=JSON.parse(null||A[I]),g=!1,i(v,P),P=null)):(i(v,P),P=null),P&&i(v,P),myLayout=new GoldenLayout(v,$('<div id="layout-container"></div>').appendTo($("body"))),$("#layout-container").on("scroll",function(e){$(this).scrollTop(0)}),$(window).resize(myLayout._resizeFunction),0),Q=isApp(),L=(myLayout.on("rowCreated",B),myLayout.on("columnCreated",B),myLayout.on("itemCreated",function(e){e.config.checkDropArea||(e.config.checkDropArea=F),e.config.validDropLocations||(e.config.validDropLocations=":not(.pg-fullsize-item)")}),myLayout.on("stackCreated",function(a){a.layoutManager.config.labels.popout;a.config.checkDropArea||(a.config.checkDropArea=F),a.config.validDropLocations||(a.config.validDropLocations=":not(.pg-fullsize-item)"),$('<div class="lm_drag_header"></div>').insertAfter(a.header.element.find(".lm_handle")),$('<div class="lm_drag_header lm_drag_header_left"></div>').appendTo(a.element),$('<div class="lm_drag_header lm_drag_header_right"></div>').appendTo(a.element),a.toggleAllwaysShown=function(){a.config.allwaysShown=!(a.config.allwaysShown||0),a.config.allwaysShown?a.allwaysShownButton.element.addClass("active"):a.allwaysShownButton.element.removeClass("active"),saveUIState()},a.popout=function(e,n,t){var o,i;myLayout.ignoreNextClick()||(i=a.element.closest(".floating-win"),Q&&(n||i.length&&1===i.find(".lm_stack").length)?(i=a.parent,o=a.element.get(0).ownerDocument.defaultView,pgUIViewManager.forEachView(a.element,function(e){e.onBeforeMovedToAnotherWindow&&e.onBeforeMovedToAnotherWindow(o,a.element)}),i=pgGetAppWindowForDOMWindow(i.element.get(0).ownerDocument.defaultView),myLayout.withoutUpdateSize(function(){a.element.detach();var e=a.parent;a.parent.removeChild(a,!0),!t&&a.restoreAtRememberedPosition(e)||myLayout.root.contentItems[0].addChild(a,void 0,null,!0),a.config.width=a.width_before_float||18,0==e.contentItems.length&&e.dragMoverResizer&&e.dragMoverResizer.destroy()}),myLayout.updateSize(),pgUIViewManager.forEachView(a.element,function(e){e.onMovedToAnotherWindow&&e.onMovedToAnotherWindow(o,a.element)}),pinegrow.selectedElements.reselect(),pinegrow.dispatchEvent("on_panel_moved_in_another_window",i)):(i=a.header.activeContentItem,(i=a).rememberPosition(),openPanelInExternalWindow$Element=a.element,openPanelInExternalWindowStack=a,i=myLayout._$normalizeContentItem({title:"KOLI",type:"column",componentName:"kolicol",componentState:{text:"Ha"},width:17,floatingWidth:a.element.width(),isFloating:!0,prefloatingPosX:i.element.offset().left}),openPanelInExternalWindowStack=openPanelInExternalWindow$Element=null,myLayout.root.contentItems[0].addChild(i),a.width_before_float=a.config.width,a.element.detach(),a.parent&&a.parent.removeChild(a,!0),i.addChild(a)))},a.config.pages||(!a.config.codeEditors&&pgf.hide_panels&&(a.allwaysShownButton=new GoldenLayout.__lm.controls.HeaderButton(a.header,"Show this panel even when all panels are hidden. "+`Use ${pgShowKbd("TAB")} key to toggle all panels.`,"lm_allways_shown",a.toggleAllwaysShown),a.allwaysShownButton.element.addClass("icon-custom"),addTooltip(a.allwaysShownButton.element),a.config.allwaysShown)&&a.allwaysShownButton.element.addClass("active"),a.headerButton=new GoldenLayout.__lm.controls.HeaderButton(a.header,"Toggle floating panel.","lm_popout",a.popout),a.headerButton.element.addClass("icon-custom"),addTooltip(a.headerButton.element)),a.config.addClass&&a.element.addClass(a.config.addClass),a.config.isFloating,a.config.isDocked&&(a.hasVerticalTabs=!0,setTimeout(function(){a.setDocked(a.config.isDocked)},100)),a.config.isHidden&&a.hideStack(),a.config.pages&&(a.on("activeContentItemChanged",function(e){e.pgPageTab&&pinegrow.setSelectedPageTab(e.pgPageTab)}),a.on("activeContentItemClicked",function(e){e.pgPageTab&&pinegrow.setSelectedPageTab(e.pgPageTab)}))}),null),Y=(myLayout.getHiddenStackForHiddenPanels=function(){return(L=L||myLayout.root.getItemsByFilter(function(e){if(e.config.hidden_stack)return!0})[0])||(L=myLayout._$normalizeContentItem(q),myLayout.root.contentItems[0].addChild(L,void 0,null,!0)),L},!1),X=(myLayout.on("dragStart",function(e){$.fn.crsapages("showOverlays"),e._contentItem&&e._contentItem.config.validDropLocations&&$(".lm_stack").not(e._contentItem.config.validDropLocations).addClass("show-invalid-drop-location"),Y=!0}),myLayout.on("dragStop",function(e){$.fn.crsapages("showOverlays",!0),e._contentItem&&e._contentItem.config.validDropLocations&&$(".lm_stack").not(e._contentItem.config.validDropLocations).removeClass("show-invalid-drop-location"),Y=!1,saveUIState(),pgUpdateAppWindowTitles()}),myLayout.on("dragNotAllowed",function(e){pgf.kids||pinegrow.showQuickMessage("Page area is not draggable."),$("body").removeClass("lm_dragging")}),myLayout.on("tabDragNotAllowed",function(e){pgf.kids||pinegrow.showQuickMessage("Individual code tabs are not draggable. Move the whole panel instead."),$("body").removeClass("lm_dragging")}),myLayout.on("collapseNotAllowed",function(e){pinegrow.showQuickMessage("Collapsing the panel at this location is not supported. Move the panel outside of the page area first.",6e3)}),myLayout.on("singleClickOnActiveTab",function(e){pinegrow.showQuickMessage("Double click on any tab to collapse the panel.")}),myLayout.registerComponent("custom",function(e,n){}),myLayout.registerComponent("pageview",function(e,n){}),myLayout.registerComponent("code_editor",function(e,n){}),myLayout.registerComponent("canvas",function(e,n){e.getElement().append($(".canvas"))}),null),J=(myLayout.registerComponent("tree",function(e,n){X=X||new PgTreeView;e.getElement().append(X.view.get$Element());X.view.addedToLayout(e)}),null),Z=(myLayout.registerComponent("css_tree",function(e,n){J=J||new PgCSSTreeView(!1);e.getElement().append(J.view.get$Element());J.view.addedToLayout(e)}),null),ee=(myLayout.registerComponent("css_tree_active",function(e,n){Z=Z||new PgCSSTreeView(!0);e.getElement().append(Z.view.get$Element());Z.view.addedToLayout(e)}),null),ne=(myLayout.registerComponent("css_visual",function(e,n){ee=ee||new PgCSSEditorView;e.getElement().append(ee.view.get$Element());ee.view.addedToLayout(e)}),null),te=(myLayout.registerComponent("lib_panel",function(e,n){ne=ne||new PgPageLibsTabbedView;e.getElement().append(ne.view.get$Element());ne.view.addedToLayout(e)}),null),oe=(myLayout.registerComponent("prop_panel",function(e,n){te=te||new PgPropertiesView;e.getElement().append(te.view.get$Element());te.view.addedToLayout(e)}),null),E=(myLayout.registerComponent("history",function(e,n){oe=oe||new PgUndoView;e.getElement().append(oe.view.get$Element());oe.view.addedToLayout(e)}),null),W=(myLayout.registerComponent("element_code",function(e,n){E=E||new PgCodeEditorsView({view_name:"element_code_panel"});e.getElement().append(E.view.get$Element());E.view.addedToLayout(e),pinegrow.codeEditorsView=E}),null),x=(myLayout.registerComponent("info",function(e,n){W=W||new PgInfoPanelView;e.getElement().append(W.view.get$Element());W.view.addedToLayout(e),pinegrow.infoPanel=W}),null),ie=(myLayout.registerComponent("ai",function(e,n){x=x||new PgUIViewProxy(e,"ai","icon-wand","Loading AI Assistant from the server. Please wait...",function(e){x=e});e.getElement().append(x.view.get$Element());x.view.addedToLayout(e)}),null),M=(myLayout.registerComponent("style",function(e,n){ie=ie||new PgCSSActiveRulesCombinedView;e.getElement().append(ie.view.get$Element());ie.view.addedToLayout(e)}),null),ae=(myLayout.registerComponent("status_bar",function(e,n){M=M||new PgStatusBarView,pinegrow.statusBar=M;e.getElement().append(M.view.get$Element());M.view.addedToLayout(e)}),null),se=(myLayout.registerComponent("css_var_panel",function(e,n){ae=ae||new PgVarsView;e.getElement().append(ae.view.get$Element());ae.view.addedToLayout(e)}),null),pe=(myLayout.registerComponent("act_panel",function(e,n){se=se||new PgCombinedActionsView("ACT","icon-actions");e.getElement().append(se.view.get$Element());se.view.addedToLayout(e)}),null),D=(p&&myLayout.registerComponent("cms_panel",function(e,n){pe=pe||new PgCombinedActionsView("CMS","icon-WP");e.getElement().append(pe.view.get$Element());pe.view.addedToLayout(e)}),null),le=(c&&myLayout.registerComponent("animations_panel",function(e,n){D=D||new PgCombinedActionsView("ANIMATIONS","icon-113");e.getElement().append(D.view.get$Element());D.view.addedToLayout(e),window.pgAnimationsPanel=D}),null),re=(d&&myLayout.registerComponent("animation_timeline",function(e,n){le=le||new PgAnimationEditorTimelineView("animations_timeline","icon-113");e.getElement().append(le.view.get$Element());le.view.addedToLayout(e),setTimeout(function(){$(`<div class="lm_close_tab""></div>`).appendTo(e.tab.element).on("click",function(e){e.preventDefault(),pinegrow.findFrameworkByKey("pg.ia").showTimelineEditor(!1)})},1e3)}),null),ce=(myLayout.registerComponent("db_tree",function(e,n){re=re||new PgProjectDBTreeView;e.getElement().append(re.view.get$Element());re.view.addedToLayout(e)}),null),de=(myLayout.registerComponent("project_panel",function(e,n){ce=ce||new PgProjectView;e.getElement().append(ce.view.get$Element());ce.view.addedToLayout(e),"project_panel",0}),null),ge=(myLayout.registerComponent("class_styles_panel",function(e,n){de=de||new PgClassTreeView(!0);e.getElement().append(de.view.get$Element());de.view.addedToLayout(e)}),null),ue=(myLayout.registerComponent("dm_design_panel",function(e,n){ge=ge||new PgDmView;e.getElement().append(ge.view.get$Element());ge.view.addedToLayout(e)}),null),me=(myLayout.registerComponent("dm_style_panel",function(e,n){ue=ue||new PgDmStyleView;e.getElement().append(ue.view.get$Element());ue.view.addedToLayout(e)}),null),we=(myLayout.registerComponent("dm_prop_panel",function(e,n){me=me||new PgDmPropertiesView;e.getElement().append(me.view.get$Element());me.view.addedToLayout(e)}),null),fe=(myLayout.registerComponent("dm_styles_panel",function(e,n){we=we||new PgDmStyleListView;e.getElement().append(we.view.get$Element());we.view.addedToLayout(e)}),null);if(myLayout.registerComponent("snap",function(e,n){fe=fe||new PgSnapView;e.getElement().append(fe.view.get$Element());fe.view.addedToLayout(e)}),myLayout.on("initialised",function(){pgUIViewManager.updateVisibility()}),pgIsDev()&&0)myLayout.init(),myLayout.updateSize();else try{myLayout.init(),myLayout.updateSize()}catch(e){console.error(e),delete A[I],pinegrow.saveSettingsOnBackend()&&pinegrow.setSetting(I,""),pinegrow.showAlert("Invalid workspace layout. Please restart Pinegrow.","Invalid layout")}myLayout.restoreWorkspace=function(e){var n,t=!1;if("object"==typeof e){if(n=JSON.parse(e.config),e.ccmode!=pinegrow.isContributorMode())return void pinegrow.showAlert("This layout can only be used if <b>CMS mode</b> is <b>"+(e.ccmode?"ON":"OFF")+"</b>.","Can't use the layout in the current mode");t=!0}else n=e?O(e).config:U();var a=jQuery.extend(!0,{},n.content[0]);i(a,P);try{L=null,pgPageCodeEditorsStack.beforeDestroy(),myLayout.withoutUpdateSize(function(){var e=myLayout._$normalizeContentItem(a),n=myLayout.root.contentItems[0],t=n._$getItemsByProperty("componentName","pageview"),o=e.getItemsByFilter(function(e){return e.config.pages||!1}),t=(t.forEach(function(e){e.parent.removeChild(e,!0),o[0].addChild(e)}),n._$getItemsByProperty("componentName","code_editor")),i=e.getItemsByFilter(function(e){return e.config.codeEditors||!1});t.forEach(function(e){e.parent.removeChild(e,!0),i[0].addChild(e)}),myLayout.root.replaceChild(n,e,!0)}),myLayout.updateSize(),setTimeout(function(){myLayout.root.getItemsByFilter(function(e){return e.updateSplittersVisibility&&e.updateSplittersVisibility(),!1}),myLayout.updateSize()},200),pgPageCodeEditorsStack.setStack(null),t&&saveUIState(),pgf.kids||pinegrow.showQuickMessage("Restart Pinegrow if you are experiencing issues after restoring workspace.",5e3)}catch(e){pinegrow.showAlert(`There was a problem with restoring workspace. Please restart ${pgf.product_name}.`,"Restart is needed"),delete A[I],pinegrow.saveSettingsOnBackend()&&pinegrow.setSetting(I,"")}},$("#crsa-left-plane").detach();function _e(e){function t(e){if("component"===e.type?o[e.componentName]=!0:"stack"===e.type&&(e.pages?o["pages_stack"]=!0:e.codeEditors&&(o["editors_stack"]=!0)),e.content)for(var n=0;n<e.content.length;n++)t(e.content[n])}var o={history:!1,pages_stack:!1,editors_stack:!1,status_bar:!1,tree:!1,prop_panel:!1,style:!1,element_code:!1,dm_design_panel:!1,project_panel:!1},i=(c&&(o.animations_panel=!1),d&&(o.animation_timeline=!1),l&&(o.class_styles_panel=!1),p&&(o.cms_panel=!1),a&&(o.act_panel=!1),pinegrow.isContributorMode()&&(delete o.style,delete o.act_panel,delete o.cms_panel,delete o.element_code,delete o.animations_panel,delete o.animation_timeline,delete o.class_styles_panel,delete o.dm_design_panel),"PGTC"===pgf.product&&(o={project_panel:!1,history:!1,pages_stack:!1,status_bar:!1,tree:!1,cms_panel:!1,db_tree:!1}),"MAGIC"===pgf.product&&(o={project_panel:!1,history:!1,pages_stack:!1,status_bar:!1,tree:!1,dm_design_panel:!1,dm_style_panel:!1,dm_styles_panel:!1,dm_prop_panel:!1,act_panel:!1}),"KIDS"===pgf.product&&(o={pages_stack:!1,editors_stack:!1,status_bar:!1,tree:!1,prop_panel:!1,style:!1,info:!1}),"SNAP"===pgf.product&&(o={snap:!1,pages_stack:!1}),t(e||myLayout.config),!0);return $.each(o,function(e,n){!1===n&&(console.log("layout error on "+e),i=!1)}),i}myLayout.withoutSaveState=function(e){var n="undefined"!=typeof pgDontSaveLayoutState&&pgDontSaveLayoutState;pgDontSaveLayoutState=!0,e(),pgDontSaveLayoutState=n},window.saveUIState=function(){var e;Y||"undefined"!=typeof pgDontSaveLayoutState&&pgDontSaveLayoutState||(e=myLayout.toConfig(),_e(e)?(e=JSON.stringify(e),A[I]=e,A.pg_layout_state_version=j,A.pg_layout_state_ccmode=pinegrow.isContributorMode()?"1":"",pinegrow.saveSettingsOnBackend()&&pinegrow.setSetting(I,e)):pinegrow.showQuickError("Oops... Invalid workspace layout. Please restart Pinegrow.",!0))},window.pgCustomWorkspaces=new PgCustomWorkspaces(myLayout),myLayout.on("stateChanged",function(){pgUIViewManager.updateVisibility(),pinegrow.connectors&&pinegrow.connectors.update(),saveUIState(),myLayout.updateSplitters(),pgPreview.hide(),Q&&pgCloseEmptyUIWindows();var t=[],o=0,i=(pgGetAppWindows().forEach(function(e){$(e.window.document).find("#layout-container").find(".lm_drop_tab_placeholder").remove(),o++}),function(e){var n=!1;return!e.parent||$.contains(e.parent.element.get(0),e.element.get(0))||e.isFloating||(n=!0,t.push("Misplaced element "+o)),e.contentItems.forEach(function(e){n=n||i(e)}),n});i(myLayout.root),t.length&&console.log("PROBLEMS",t)}),myLayout.on("stackCollapsedOnActiveTabClick",function(){});var V=!0;window.pgArePanelsQuicklyHidden=function(){return!V},window.pgToggleFloatingPanels=function(e,n){var t;pgf.hide_panels&&(0==(t=$(".lm_floating")).length&&0?(n||pinegrow.showQuickMessage('There are no floating panels. Use <i class="icon icon-window" style="margin:0 4px;"></i> icon to float a panel.'),pinegrow.hidePanelsButton.setActive(!1),V=!0):((V=void 0===e?!V:e)?(pg$Show(t),myLayout.uncollapseAllStacks()):(t.each(function(e,n){0==$(n).find(".lm_allways_shown.active").length&&pgHide(n)}),myLayout.collapseAllStacks(),pinegrow.showNotice("<p>All docked panels are collapsed and floating panels are hidden.</p><p>Press "+pgShowKbdCombo("TAB")+' or click on the <i class="icon icon-hide"></i> icon in the top toolbar to quickly toggle panels visibility.</p>',"Panels are hidden","hideFloatingPanels2")),pgUIViewManager.updateVisibilityInArea(t),pinegrow.hidePanelsButton.setActive(!V)))},$("body").on("pg-ui-add-ss-panel",function(e,n){var t,o=n.cs;0==$("#pg-"+o.getUniqueName()+"-panel").length&&(o={type:"component",componentName:"css_panel",componentState:{uniqueName:o.getUniqueName()},title:o.name,isClosable:!0},0<(t=myLayout.root.getItemsByFilter(function(e){return"component"==e.type&&"sheets_panel"==e.componentName})).length)&&t[0].parent.addChild(o)})},pgUIViewId=0,PgUIView=function(p,e,n){this.onDestroy=null,this.onShow=null,this.onHide=null,this.onResize=null,this.onMovedToAnotherWindow=null,this.name=e,this.display_name=n,this.alwaysVisible=!1,this.tabIcon=null;function t(){var e=p.width(),n=p.attr("class")||"",t="lg";e<=200?t="xs":e<=300?t="sm":e<=400&&(t="md"),n=n.replace(/(^|\s)pg\-view\-width\-(xs|sm|md|lg)(\s|$)/,""),p.attr("class",n+=" pg-view-width-"+t),s.onResize&&s.whenVisible(function(){s.onResize()},"resize",1),d()}function o(){s.destroy()}function i(){s.onBeforeDestroy&&s.onBeforeDestroy()}var a=pgUIViewId++,s=(this.getId=function(){return a},this),l=(this.parent=null,[]),r=null,c=(this.getWindow=function(){var e=p.get(0);return e.ownerDocument?e.ownerDocument.defaultView:null},this.getTab=function(){return r&&r.tab?r.tab:null},this.addedToLayout=function(e){(r=e).on("resize",t),r.on("tabClosed",o),r.on("beforeTabClosed",i),this.classForContainer&&r._element.addClass(this.classForContainer),this.tabIcon&&e.on("tab",function(){$('<i class="tab-icon icon '+s.tabIcon+'"></i>').insertBefore(e.tab.element.find(".lm_title"));e.tab.element.addClass("pg-tab-with-icon"),addTooltip(e.tab.element,"<b>"+e.parent.config.title+".</b>"+(pgf.kids?"":" Click to switch to the tab. Double click to collapse the panel."))}),this.onAddedToLayout&&this.onAddedToLayout(e)},null),d=function(){var e,n;c&&r&&(e=r._element.closest(".lm_item").hasClass("lm_docked_closed"),n=r.tab.element.offset(),c.css({top:n.top-6+"px",left:n.left+r.tab.element.width()-6+(e?-20:0)+"px"}))},g=(this.setNotificationBadge=function(e,n){r&&(c&&(c.remove(),c=null),c=c||$(`<div class="pg-notification-badge"></div>`).appendTo(r.tab.element.closest("body")),e?(c.html(e),n&&addTooltip(c,n),d()):(c.remove(),c=null))},null),u=(this.getLayoutItem=function(){return r?r.parent:null},this.showInUI=function(e,n,t){if(r){var o,i=r.parent,a=myLayout.getHiddenStackForHiddenPanels(),s=(i.parent!==a&&!i.parent.config.hidden_stack||(a=!1,t&&!i.config.rememberedPosition&&("pages"===t?(s=myLayout.root.getItemsByFilter(function(e){if(e.config.pages)return!0})[0])&&(o=myLayout._$normalizeContentItem({type:"stack",isClosable:!1,notCollapsable:!1,width:0,height:i.config.parentStackHeight||25,addClass:"pg-force-min-panel-height",isHidden:!1,hidden_stack:!1,dontCollapseOnActiveTabClick:!1,hideStackIfSinglePanelHidden:!0}),s.parent.addChild(o,s.parent.contentItems.indexOf(s)+1),i.rememberedParent=o,i.rememberedIndex=0,a=!0):(s=pgUIViewManager.getView(t))&&!s.isHiddenInUI()&&(o=s.getLayoutItem())&&(i.rememberedParent=o.parent,i.rememberedIndex=0,a=!0)),a||(i.rememberedIndex=i.config.rememberedPosition?i.config.rememberedPosition.index:0,i.rememberedParent=i.config.rememberedPosition?u(i.config.rememberedPosition.parent_id):null),myLayout.withoutSaveState(function(){i.parent.removeChild(i,!0)}),i.restoreAtRememberedPosition(i.parent,!0))||myLayout.root.contentItems[0].addChild(i,void 0,null,!0),i.parent.config.isHidden&&i.parent.showStack(),i.element.closest(".lm_floating"));if(s.length&&!s.is(":visible")&&pgToggleFloatingPanels(!0),i.parent.config.isHidden&&i.parent.showStack(),i.parent.isDockedClosed){if(n)return;i.parent.openDocked()}(g=i.parent.getActiveContentItem())==i&&(g=null),i.parent.setActiveContentItem(i),e&&pg$Flash(p,"string"==typeof e?e:"bck_flash")}},function(n){return myLayout.root.getItemsByFilter(function(e){if(e.config.position_object_id===n)return!0})[0]}),m=(this.hideInUI=function(){var e,n,t;r&&((e=r.parent).parent?.config?.hideStackIfSinglePanelHidden&&1===e.parent.contentItems.length?e.parent.hideStack():(e.rememberPosition(),n=e.rememberedParent.config.position_object_id||"pid"+Math.random(),e.rememberedParent.config.position_object_id=n,e.config.rememberedPosition={index:e.rememberedIndex,parent_id:n},e.config.parentStackHeight=e.parent.config.height,n=myLayout.getHiddenStackForHiddenPanels(),t=e.parent,myLayout.withoutSaveState(function(){e.parent.removeChild(e,!0)}),n.addChild(e),0===t.contentItems.length&&t.hideStack()))},this.isHiddenInUI=function(){var e;if(r)return(e=r.parent).parent.config.hidden_stack||e.parent.config.isHidden},this.undoShowInUI=function(){g&&(r.parent.parent.setActiveContentItem(g),g=null)},this.setAlwaysVisible=function(e){this.alwaysVisible=e,this.updateVisibility()},this.on=function(e,n){l.push({event:e,func:n}),$("body").on(e,n)},p.addClass("pg-ui-view").data("pg-ui-view",this),this.get$Element=function(){return p},this.destroy=function(){w=[],e&&pgUIViewManager.unregisterView(e),p.data("pg-ui-view",null),r&&(r.off("resize",t),r.off("tabClosed",o),r.off("beforeTabClosed",i)),l.forEach(function(e){$("body").off(e.event,e.func)}),this.onDestroy&&this.onDestroy(),c&&(c.remove(),c=null),p.remove(),this.parent=null},p.is(":visible")||this.alwaysVisible),w=(this.isVisible=function(e){return m=e?p.is(":visible")||this.alwaysVisible:m},this.updateVisibility=function(){var e=this.alwaysVisible||p.is(":visible");e!=m&&((m=e)?(w.forEach(function(e){e.func()}),w=[],this.onShow&&this.onShow()):this.onHide&&this.onHide())},[]),f=(this.whenVisible=function(e,n,t){if(n=n||"show",void 0===t&&(t=0),m)e();else{f(n);for(var o={func:e,task:n,order:t},i=!1,a=0;a<w.length;a++)if(w[a].order>=t){w.splice(a,0,o),i=!0;break}i||w.push(o)}},function(e){for(var n=-1,t=0;t<w.length;t++)if(w[t].task===e){n=t;break}0<=n&&w.splice(n,1)});this.clearWhenVisible=function(e){e?f(e):w=[]},this.getFastdomTasks=function(){return pgGetFastdomTasks(p.get(0))},e&&pgUIViewManager.registerView(e,this)};class PgUIViewProxy{constructor(e,n,t,o,i){this.container=e,this.$element=$(`<div><div class="alert alert-info alert-panel-notice">${o}</div></div>`),this.view=new PgUIView(this.$element,n),(this.view.proxy=this).view.tabIcon=t,this.on_replace=i}replaceWith(e){this.$element.remove(),this.container.getElement().append(e.view.get$Element()),e.view.addedToLayout(this.container),this.on_replace(e)}}var pgGetFastdomTasks=function(e){return pgFastdomTasks},PgUIViewManager=function(){function n(e,o){e.add(e).find(".pg-ui-view").each(function(e,n){var t=$(n).data("pg-ui-view");t&&o(t)})}var t={},o=this;this.registerView=function(e,n){t[e]=n},this.unregisterView=function(e){t[e]&&delete t[e]},this.getView=function(e){return t[e]||null};this.forEachView=n,this.destroyViewsInArea=function(e){n(e,function(e){e.destroy()})},this.updateVisibility=function(){pgGetAppWindows().forEach(function(e){o.updateVisibilityInArea($(e.window.document.body))})},this.updateVisibilityInArea=function(e){n(e,function(e){e.updateVisibility()})},this.getViewForElement=function(e,n){return(e=!e.is(".pg-ui-view")&&n?e.closest(".pg-ui-view"):e).data("pg-ui-view")},this.hideElement=function(e){e.hide();var n=this.getViewForElement(e);n&&n.updateVisibility()},this.showElement=function(e){e.show();var n=this.getViewForElement(e);n&&n.updateVisibility()}},pgUIViewManager=new PgUIViewManager,PgToggleButtonMaker=function(){function i(e,n,t,o){return n=n||"","<"+(o=o||"div")+' class="pg-tb-button'+(t?" "+t:"")+'" '+function(e){if(!e)return"";e.title&&(e.attributes||(e.attributes={}),e.attributes.title=e.title);var t,n=e.attributes;return n?(t="",$.each(n,function(e,n){t+=e+'="'+n+'" '}),t):""}(e)+'style="'+((t=e)&&(i=t.styles)?(a="",$.each(i,function(e,n){a+=e+":"+n+" !important;"}),a):"")+'">'+n+"</"+o+">";var i,a}var a=this;this.makeColor=function(e,n,t){var o="background-color",o=((t=t||{})&&t["use-background-image"]&&(o="background-image"),{styles:{"border-radius":"3px",width:"18px",height:t.height||"16px",[o]:e||"transparent"}});return i($.extend({},o,t),n,"pg-tb-button-color")},this.makeColorFromCSSVariable=function(n,t,o){return function(){var e=a.getColorFromCSSVariable(n,t.default||null);return a.makeColor(e,o,t)}},this.getColorFromCSSVariable=function(e,n){var t=n||"rgba(0,0,0,0)",o=pinegrow.getSelectedPage();return t=o?o.getCSSVariableValue(e)||n||"rgba(0,0,0,0)":t},this.makeColorTextFromCSSVariable=function(n,t,o){return function(){var e=a.getColorFromCSSVariable(n,t.default_color||null);return a.makeColorText(e,t,o)}},this.makeColorText=function(e,n,t){return i($.extend({},{styles:{color:e}},n),"","pg-tb-button-icon icon icon-ikone1-100-copy-63","i")},this.makeText=function(e,n){return i(n,e,"pg-tb-button-text")},this.makeIcon=function(e,n){return i(n,"","pg-tb-button-icon icon icon-"+e,"i")},this.makeImage=function(e,n){return i(n,`<img src="${e}">`,"pg-tb-button-image")}},pgToggleButtonsCount=1,PgToggleButtons=function(e,p){function n(){if(!g)switch(c.input_type){case"hidden":g=$('<input type="hidden">').appendTo(d);break;case"checkbox":g=$('<input type="checkbox" value="'+c.checkbox_value+'" style="display:none;">').appendTo(d)}}this.id="pgToggleButton_"+pgToggleButtonsCount++;var t,l,s=null,r=null,c=(this.default_value=null,$.extend({},{input_type:"hidden",multiple:!1,compact:!1,compact_current_html:null,on_button_highlighted:null,on_enter:null,on_leave:null},p)),d=(c.compact&&(t=$(`<div class="pg-tb-compact-container"><div class="pg-tb-compact-current"></div></div>`).appendTo(e),l=(e=t).find(".pg-tb-compact-current")),$(`<div class="pg-tb${c.compact?" pg-tb-compact":""}"></div>`).appendTo(e)),g=null,u=function(e){if(g)switch(c.input_type){case"hidden":g.val(e);break;case"checkbox":g.prop("checked",e==c.checkbox_value)}},p=(this.options=[],[]),m=(this.show_empty=!1,null),w=this,o=(this.get$list=function(){return d},this.get$input=function(){return n(),g},!1),f=(this.show=function(){p="function"==typeof this.options?this.options():this.options,n(),a(),i(),o=!0,g.on("crsa-field-value-updated",function(e){w.setValue(function(){switch(c.input_type){case"hidden":return g.val();case"checkbox":return g.is(":checked")?c.checkbox_value:null}}())})},null),i=(this.setValue=function(e){u(m=e),o&&i()},this.getValue=function(){return m},this.setMultipleValues=function(o){o&&o instanceof Array&&d.find(">div").each(function(e,n){var t=p[e];t&&0<=o.indexOf(t.key)&&$(n).addClass("active")})},function(){s&&(s.stop(),s=null),r&&(r.stop(),r=null),g&&g.detach(),w.onBeforeUpdate&&w.onBeforeUpdate(),f=null;for(var e,n="",t=(c.multiple?e=(m||"").split(","):(e=[],null!==m&&e.push(m)),""),o=0;o<p.length;o++){var i=p[o].html?"function"==typeof p[o].html?p[o].html():p[o].html:p[o].icon?'<i class="fa fa-'+p[o].icon+'"></i>':p[o].name,a=0<=e.indexOf(p[o].key)||null!==w.default_value&&w.default_value==p[o].key;0!==o&&!a||(t=i),c.compact_current_html&&(t=c.compact_current_html),n+="<div "+(a?'class="active" ':"")+'data-item-id="'+o+'" data-item-key="'+p[o].key+'">'+i+"</div>"}d.get(0).innerHTML=n,null!==m?d.addClass("has-value"):d.removeClass("has-value"),g&&g.appendTo(d),l&&(l.get(0).innerHTML=t),w.onAfterUpdate&&w.onAfterUpdate()}),a=(this.setInheritedValue=function(n,t){o&&(r&&(r.stop(),r=null),(r=pgFastdomTasks.create(w.id+"_set_inherited")).mutate(function(){var e;f&&f.classList.remove("inherited"),n&&(f=d.get(0).querySelector(`[data-item-key="${n}"]`))&&(f.classList.add("inherited"),(e=f.querySelector("span.responsive-label"))||((e=document.createElement("span")).classList.add("responsive-label"),f.prepend(e)),e.innerText=t)}))},function(){function a(e){var n;return(s=$(e.target).closest("[data-item-id]")).length&&(n=parseInt(s.attr("data-item-id")))<p.length?p[n]:null}var s;c.on_enter&&d.on("mouseenter",function(e){c.on_enter(d)}),c.on_leave&&d.on("mouseleave",function(e){c.on_leave(d)}),c.on_button_highlighted&&(d.on("mouseenter","[data-item-id]",function(e){var n=a(e);n&&c.on_button_highlighted(n)}),d.on("mouseleave","[data-item-id]",function(e){c.on_button_highlighted(null)})),d.get(0).addEventListener("click",function(e){var n,t,o,i=a(e);i&&(n=s.hasClass("active"),(w.show_empty||c.multiple)&&n?(s.removeClass("active"),m=c.multiple?(0<=(o=(t=m?m.split(","):[]).indexOf(i.key))&&t.splice(o,1),t.join(",")):(d.find(">.active").removeClass("active"),null),u(m),l&&(l.get(0).innerHTML=c.compact_current_html||d.find(">div").get(0).innerHTML)):(c.multiple||d.find(">div").removeClass("active"),s.addClass("active"),m=c.multiple?((o=(t=m?m.split(","):[]).indexOf(i.key))<0&&t.push(i.key),t.join(",")):i.key,u(m),l&&(l.get(0).innerHTML=c.compact_current_html||d.find(">.active").get(0).innerHTML)),c.on_click&&c.on_click(),g&&g.trigger("change"),w.onChanged)&&w.onChanged.call(w,m)},!0)});this.destroy=function(){s&&(s.stop(),s=null),r&&(r.stop(),r=null)}},PgCheckbox=function(e,n,t){var o=new PgToggleButtonMaker;PgToggleButtons.call(this,e,{input_type:"checkbox",checkbox_value:t}),this.show_empty=!0,this.options=[{key:t,name:n,html:o.makeText(n)}]},PgPanelNotice=(PgCheckbox.prototype=Object.create(PgToggleButtons.prototype),PgCheckbox.prototype.constructor=PgCheckbox,function(e,n){this.$element=$('<div class="alert alert-info alert-panel-notice"><content></content></div>').hide();var t=!1,o=this.$element.find("content");e&&(this.$element.append(`<div class="alert-arrow"></div>`),this.$element.addClass("with-arrow")),n&&this.$element.addClass("important"),this.isShown=function(){return t},this.show=function(e){e?(o.html(e),this.$element.show(),t=!0):t&&(o.empty(),this.$element.hide(),t=!1)}}),PgCodePanelNotice=function(){var t=null,o=$('<div class="panel-notice"></div>').hide();this.onShow=null,this.onHide=null,this.hideOnEmpty=!1,this.get$Element=function(){return o},this.getMessage=function(){return t},this.setMessage=function(e,n){e!==t&&(o.html(e),t=e,this.hideOnEmpty)&&(t?o.is(":visible")||(o.show(),this.onShow&&this.onShow()):o.is(":visible")&&(o.hide(),this.onHide)&&this.onHide()),void 0!==n&&(n?o.addClass("top"):o.removeClass("top"))}},PgFastdomTask=function(e,n){this.manager=n||pgFastdomTasks,this.fastdom=e||fastdom,this.ids=[],this.done_count=0},PgFastdomTaskManager=(PgFastdomTask.prototype.measure=function(e){var n=this;this.ids.push(this.fastdom.measure(function(){e(),n.done_count++,n.cleanupIfDone()}))},PgFastdomTask.prototype.mutate=function(e){var n=this;this.ids.push(this.fastdom.mutate(function(){e(),n.done_count++,n.cleanupIfDone()}))},PgFastdomTask.prototype.stop=function(e){var n=this;this.ids.forEach(function(e){n.fastdom.clear(e)}),this.ids=[],this.done_count=0,this.cleanupIfDone()},PgFastdomTask.prototype.cleanupIfDone=function(){this.done_count===this.ids.length&&(this.ids=[],this.manager.done(this))},function(o){o=o||fastdom;var a=[],e=0;this.getUniqueKey=function(){return"task_"+e++},this.create=function(e,n){var t=this.find(e,n);return t&&t.stop(),t=new PgFastdomTask(o,this),a.push({key:e,data:n,task:t}),t},this.createDummy=function(){return{measure:function(e){e()},mutate:function(e){e()}}},this.done=function(e){for(var n=0;n<a.length;n++)if(a[n].task===e){a.splice(n,1);break}},this.find=function(e,n,t){for(var o=[],i=0;i<a.length;i++)if(a[i].key===e&&(!n||a[i].data===n)){if(!t)return a[i].task;o.push(a[i].task)}return t?o:null},this.stopAll=function(e,n){this.find(e,n,!0).forEach(function(e){e.stop()})},o.catch=function(e){}}),PgCustomWorkspaces=(window.pgFastdomTasks=window.pgFastdom=new PgFastdomTaskManager,function(i){var a=[],n="pg_custom_workspaces",t=localStorage;if((t=pinegrow.saveSettingsOnBackend()&&pgwpdata&&pgwpdata.user_settings?pgwpdata.user_settings:t)[n])try{a=JSON.parse(t[n])}catch(e){}function s(e){for(var n=0;n<a.length;n++)if(a[n].name===e)return n;return-1}this.getList=function(){return a},this.save=function(e,n){var t={name:e,config:n=n||JSON.stringify(i.toConfig()),ccmode:pinegrow.isContributorMode()},o=s(e);o<0?a.push(t):a[o]=t,p()},this.remove=function(e){var n=s(e);0<=n&&a.splice(n,1),p()};var p=function(){var e=JSON.stringify(a);t[n]=e,pinegrow.saveSettingsOnBackend()&&(pinegrow.setSetting(n,e),pinegrow.backend.savePendingUserSettings())}}),pg_app_windows=[],pg_app_internal_windows=[],pg_active_window=null,pg_win_id_count=0,pg_focus_list=[],pg_app_win_under_mouse=null,pg_app_win_dont_put_on_top=!1,pg_app_win_ignore_focus_blur=!1,pg_app_win_set=!1,pg_app_win_main_on_top=is_mac,pg_app_win_is_main_on_top=!1,pg_app_win_shown=!1,pg_win_ids=[],pg_is_pg_win_active=!0,pgHasFloatingWindows=function(){return 1<pg_app_windows.length},pgAppWindowsStopIgnoringBlurDelayed=function(){pg_app_win_delayed_tasks.run("clearIgnore",function(){pg_app_win_ignore_focus_blur=!1},200)},pgAppWindowIgnoreBlurForAWhile=function(){pg_app_win_ignore_focus_blur=!0,pgAppWindowsStopIgnoringBlurDelayed()},pgShowAppWindows=function(){for(var e=0;e<pg_app_windows.length;e++)pg_focus_list.indexOf(pg_app_windows[e])<0&&pg_focus_list.unshift(pg_app_windows[e]);for(e=0;e<pg_focus_list.length;e++)pg_focus_list[e]!==pg_app_windows[0]&&pgAppWindowHasVisibleContent(pg_focus_list[e])&&(pgAppWindowSetOnTop(pg_focus_list[e],!0),pg_focus_list[e].pg_is_shown=!0);pg_app_win_shown=!0},pgDebugAppWins=function(){},pgAppWindowSetOnTop=function(e,n){e!==pg_app_windows[0]&&(n!==e._pg_is_shown&&(n?pgAppWindowHasVisibleContent(e)&&(e.show(),e._pg_is_shown=n):(e.hide(),e._pg_is_shown=n)),e.setAlwaysOnTop(n))},pgAppWindowHasFocus=function(e){if(e){"undefined"!=typeof pinegrow&&pinegrow.getClipboard().onWindowFocus(),pg_app_win_ignore_focus_blur=!0,pg_app_win_delayed_tasks.run("endIgnoreBlur",function(){pg_app_win_ignore_focus_blur=!1},100);var n=pg_focus_list.indexOf(e),n=(0<=n&&pg_focus_list.splice(n,1),pg_focus_list.push(e),e===pg_app_windows[0]);if(n&&(pgAppWindowSetOnTop(pg_app_windows[0],!1),pg_app_win_is_main_on_top=!1),!pg_is_pg_win_active||pg_active_window===pg_app_windows[0]){n||!pg_app_win_main_on_top||pg_app_win_is_main_on_top||(pgAppWindowSetOnTop(pg_app_windows[0],!0),pg_app_win_is_main_on_top=!0,pg_app_win_set=!1);for(var t=0;t<pg_app_windows.length;t++)pg_focus_list.indexOf(pg_app_windows[t])<0&&pg_focus_list.unshift(pg_app_windows[t]);pg_app_win_shown&&(!pg_app_win_is_main_on_top||pg_app_win_set)||(pgShowAppWindows(),pg_app_win_set=!0)}pgDebugAppWins(),pg_active_window=e,pg_is_pg_win_active=!0}},pgAppWindowLostFocus=function(e){"undefined"!=typeof pinegrow&&pinegrow.getClipboard().onWindowBlur(),pg_app_win_ignore_focus_blur||(pg_is_pg_win_active=!1,pg_app_windows.length&&(pg_active_window=pg_app_windows[0]),pg_app_win_delayed_tasks.run("hideIfPgNotFocused",function(){if(!pg_is_pg_win_active){pg_app_win_main_on_top&&(pgAppWindowSetOnTop(pg_app_windows[0],!1),pg_app_win_is_main_on_top=!1);for(var e=1;e<pg_app_windows.length;e++)pgAppWindowSetOnTop(pg_app_windows[e],!1),pg_app_windows[e].pg_is_shown=!1;pg_app_win_set=pg_app_win_shown=!1}pgDebugAppWins()},100),pgDebugAppWins())},pgAppWindowsHandleFullscreen=function(e){pinegrow.showAlert(`<p>Full screen mode is not compatible with floating panels. You can maximize the window instead.</p>`,"Full screen is not supported","Exit fullscreen",null,function(){e.leaveFullscreen(),e.maximize(),e.focus()})},pgRegisterAppWindow=function(o,e){o.pg_win_id;pg_app_windows.indexOf(o)<0&&(pg_app_windows.push(o),pg_app_internal_windows.push(o.window),$(o.window).on("dragenter",function(e){pgAutoScrollManager.stopAll()}).on("dragover",function(e){}).on("drag",function(e){}),setTimeout(function(){o.on("minimize",function(e){if(o.window===window){for(var n=1;n<pg_app_windows.length;n++)pg_app_windows[n].hide();pg_app_win_set=pg_app_win_shown=!1}}),o.on("maximize",function(e){o.window===window&&pgAppWindowSetOnTop(pg_app_windows[0],!1)}),o.on("enter-fullscreen",function(e){1<pg_app_windows.length&&pgAppWindowsHandleFullscreen(o)}),o.on("restore",function(e){if(o.window===window){for(var n=1;n<pg_app_windows.length;n++)pg_app_windows[n].show();pg_app_win_shown=!0}}),o.on("blur",function(e){pgAppWindowLostFocus(o)}),o.on("focus",function(e){pgAppWindowHasFocus(o)}),o.window!==window&&o.on("close",function(){for(o===pg_active_window&&(pg_active_window=null);1;)try{var e=$(o.window.document.body).find(".lm_popout").first();if(!e.length)break;var n=e.closest(".lm_stack"),t=myLayout.root.findItemWithDOMElement(n.get(0));if(t&&t.popout(null,!0),0<=$(o.window.document.body).find(".lm_popout").index(e)&&t.popout(null,!0,!0),0<=$(o.window.document.body).find(".lm_popout").index(e)){pinegrow.showQuickError("Oops... Can't undock panel. Please restore workspace.");break}}catch(e){break}pgUnregisterAppWindow(o);try{o.window;pinegrow.dispatchEvent("on_window_before_close",null,o)}catch(e){}o.close(!0)}),pgIsDev()&&!1||$(o.window.document.body).on("contextmenu",function(e){if(!(0<$(e.target).closest(".navbar-brand, .pg-allow-right-click").length))return pgCloseContextMenus(),!1}),"undefined"!=typeof pinegrow&&pinegrow.dispatchEvent("on_new_window_registered",null,o)},1===pg_app_windows.length?3e3:100))},pg_app_win_delayed_tasks=new PgDelayedTasks,pgAppWindowOnMouseEnter=function(e,n){var t=pgGetAppWindowForDOMWindow(e.view)||pg_app_windows[0];pg_app_win_under_mouse=t,pg_app_win_delayed_tasks.run("focusWin",function(){pg_is_pg_win_active&&t===pg_app_windows[0]&&pg_active_window!==t&&t.focus()},200)},pgUnregisterAppWindow=function(e){var n=pg_app_windows.indexOf(e);0<=n&&(pg_app_windows.splice(n,1),pg_app_internal_windows.splice(n,1)),0<=(n=pg_focus_list.indexOf(e))&&pg_focus_list.splice(n,1),0<=(n=pg_win_ids.indexOf(e.pg_win_id))&&pg_win_ids.splice(n,1),pgDebugAppWins()},pgGetAppWindowForDOMWindow=function(e){for(var n=0;n<pg_app_windows.length;n++)if(pg_app_windows[n].window===e)return pg_app_windows[n];return null},pgGetAppWindows=function(){return pg_app_windows},pgGetInternalWindows=function(){return pg_app_internal_windows},pgGetMainAppWindow=function(){return pg_app_windows[0]},pgGetFocusedWindow=function(){return pg_active_window},pgCloseEmptyUIWindows=function(){for(var e,n=[],t=1;t<pg_app_windows.length;t++)pgIsAppWindowEmpty(pg_app_windows[t])?n.push(pg_app_windows[t]):(e=$(pg_app_windows[t].window.document.body).find("#layout-container")).attr("data-stacks",e.find(".lm_stack").length);n.forEach(function(e){pgUnregisterAppWindow(e),e.close(!0)})},pgCloseAllUIWindows=function(){for(var e=[],n=1;n<pg_app_windows.length;n++)0===$(pg_app_windows[n].window.document.body).find(".pg-quick-win-floating").length&&e.push(pg_app_windows[n]);e.forEach(function(e){$(e.window.document.body).find("#layout-container").detach(),pgUnregisterAppWindow(e),e.close(!0)})},pgIsAppWindowEmpty=function(e){return 0===$(e.window.document.body).find(".lm_item:not(.lm_floating),.pg-quick-win-floating").length},pgAppWindowHasVisibleContent=function(e){return 0<$(e.window.document.body).find(".lm_item:visible,.pg-quick-win-floating:visible").not(".lm_floating").length},pgGetAppWindowForDOMElement=function(e){return pgGetAppWindowForDOMWindow(e.ownerDocument.defaultView)},pgGetAppWindowUnderMouse=function(){return pg_app_win_under_mouse||pg_app_windows[0]},pgGetAppWindowTitle=function(e){var n=[];return pgUIViewManager.forEachView(e,function(e){e.display_name&&(2<n.length?3===n.length&&n.push("..."):n.push(e.display_name))}),(n.length?n.join(" | ")+" - ":"")+"Pinegrow"},pgUpdateAppWindowTitle=function(e){e.title=pgGetAppWindowTitle($(e.window.document.body))},pgUpdateAppWindowTitles=function(){for(var e=1;e<pg_app_windows.length;e++)pgUpdateAppWindowTitle(pg_app_windows[e])},pgAppWindowSetZoom=function(e,n){n=parseFloat(n),(e.zoomLevel=n=-2==n?-2.224:n)<0?$(e.window.document.body).addClass("zoom"):$(e.window.document.body).removeClass("zoom")},pgAppWindowApplyCodeFontSize=function(n){var t=pinegrow.getSetting("code-size","12px"),o=pinegrow.getSetting("code-font","");pgGetAppWindows().forEach(function(e){n&&n!==e||pinegrow.codeEditor.setFontSize(t,o,e.window.document)})},gui=require("nw.gui"),openPanelInExternalWindow$Element=(gui.Window.get().pg_win_id="MainWindow",pgRegisterAppWindow(gui.Window.get()),null),openPanelInExternalWindowStack=null,openPanelInExternalWindow=function(a,s,e,n,t){function o(){for(var e="pgUIWin_",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=6,o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}function i(e){if(e.config.pg_win_id)return e.config.pg_win_id;if(e.contentItems)for(var n=0;n<e.contentItems.length;n++){var t=i(e.contentItems[n]);if(t)return t}return null}n=openPanelInExternalWindowStack||n;var p=null,l=require("nw.gui"),r=(l.Window.get().isFullscreen&&pgAppWindowsHandleFullscreen(l.Window.get()),null);if(n&&(r=i(n)||null)&&console.log("Found win id in config: "+r),r&&0<=pg_win_ids.indexOf(r)&&(console.log("another win is using the win id"),r=null),!r){for(r=o();0<=pg_win_ids.indexOf(r);)r=o();n&&(n.config.pg_win_id=r)}pg_win_ids.push(r),pg_app_win_ignore_focus_blur=!0;var c=!1,d=$.extend({focus:!1,id:r,always_on_top:!0,title:"Pinegrow",frame:!c,min_width:200,min_height:200},e||{});console.log("Open panel in new win "+r),l.Window.open("empty.html",d,function(e){(p=e).pg_is_shown=!0;var i=!0;pg_app_win_ignore_focus_blur=!1,p.on("loaded",function(){var n,e,t,o;i&&(n=p.window,p.window.pgFastdomTasks=new PgFastdomTaskManager(p.window.fastdom),pgUIViewManager.forEachView(a,function(e){e.onBeforeMovedToAnotherWindow&&e.onBeforeMovedToAnotherWindow(n,a)}),pgAppWindowSetZoom(p,getUIZoom()),p.pg_win_id=r,pgRegisterAppWindow(p),pgAppWindowApplyCodeFontSize(p),e=$(p.window.document.body),is_windows?$("body").addClass("win"):is_mac&&$("body").addClass("osx"),isApp()&&$("body").addClass("app"),t=$('<div class="pg-app-win-header"><div class="pg-app-win-header-drag"><i class="drag icon icon-drag-vert-double-x225"></i></div><i class="icon close icon-close"></i></div>'),c&&t.appendTo(e),o=$('<div id="layout-container" class="floating-win"></div>'),e.find("#win-content").append(o),c||o.css("top",0),$(p.window).on("resize",function(){$(window).trigger("resize")}),t.find(".close").on("click",function(){p.close()}),a&&o.append(a),s&&s(p.window,o,p),i=!1,p.title="Loaded - Pinegrow",$(p.window.document).on("keydown.crsa",function(e){return $.fn.crsa("processKeydownEvent",e)}),$(p.window.document).on("keyup.crsa",function(e){return $.fn.crsa("processKeyupEvent",e)}),$(window).trigger("resize"),p.title=pgGetAppWindowTitle(openPanelInExternalWindow$Element||a),pinegrow.activateCurrentWorkspaceThemeInWindow(p),saveUIState(),pgUIViewManager.forEachView(a,function(e){e.onMovedToAnotherWindow&&e.onMovedToAnotherWindow(n,a)}),pinegrow.selectedElements.reselect(),pinegrow.dispatchEvent("on_panel_moved_in_another_window",p))}),p.on("closed",function(){t&&t(p),pgUnregisterAppWindow(p),p=null})})};class PgPanelManager{constructor(){this.panels=[]}registerPanel(e){this.panels.push({key:e.panel_key||e.componentName,name:e.title,description:e.panel_description||null,category:e.panel_category,on_show:e.panel_on_show||null,on_hide:e.panel_on_hide||null,on_is_visible:e.panel_on_is_visible||null,icon:e.panel_icon||null,kbd:e.panel_kbd||null})}forEachPanel(e){var i={Essential:1,Components:2,WordPress:3,Interactions:4,"Tailwind CSS":5,Tools:6};this.panels.sort(function(e,n){var t=i[e.category]||1e3,o=i[n.category]||1e3;return o<t?1:t<o?-1:0}),this.panels.forEach(e)}}