var testGoldenLayout=function(){var t={settings:{showPopoutIcon:!1,showMaximiseIcon:!1,showCloseIcon:!1},content:[{type:"row",content:[{type:"stack",width:15,isClosable:!1,content:[{type:"component",componentName:"lib_panel",componentState:{text:"Component 1"},title:"LIB",isClosable:!1},{type:"component",componentName:"css_panel",componentState:{text:"Component 1"},title:"CSS",isClosable:!1},{type:"component",componentName:"act_panel",componentState:{text:"Component 1"},title:"ACT",isClosable:!1},{type:"component",componentName:"cms_panel",componentState:{text:"Component 1"},title:"WP",isClosable:!1},{type:"component",componentName:"project_panel",componentState:{text:"Component 1"},title:"PRJ",isClosable:!1}]},{type:"component",componentName:"canvas",componentState:{text:"Component 1"},title:"PAGES"},{type:"component",componentName:"tree",componentState:{text:"Component 3"},title:"TREE",width:15},{type:"stack",width:17,isClosable:!1,isFloating:!0,content:[{type:"component",componentName:"prop_panel",componentState:{text:"Component 1"},title:"PROP",isClosable:!1},{type:"component",componentName:"attr_panel",componentState:{text:"Component 1"},title:"ATTR",isClosable:!1}]}]}]},n=(localStorage.pg_layout_state&&(t=JSON.parse(localStorage.pg_layout_state)),new GoldenLayout(t));n.on("stackCreated",function(e){var t=e.layoutManager.config.labels.popout;e.popout=function(){e.header.activeContentItem;var l=n._$normalizeContentItem({title:"KOLI",type:"column",componentName:"kolicol",componentState:{text:"Ha"}}),t=(l.isFloating=!0,n.root.contentItems[0].addChild(l),e.parent.removeChild(e,!0),l.element.css({position:"absolute",left:"100px",top:"100px",border:"1px solid orange",height:"500px"}),$('<div class="lm_header"></div>')),t=(l.element.prepend(t),l.element.addClass("lm_floating"),new GoldenLayout.__lm.utils.DragListener(t)),o=0,i=0,a=0;t.on("dragStart",function(t,e){var n=l.element.closest(".lm_goldenlayout").offset(),n=(o=n.top,l.element.offset());i=t-n.left,a=e-n.top,$.fn.crsapages("showOverlays")},this),t.on("drag",function(t,e,n){t=n.pageX,e=n.pageY,l.element.css({left:t-i+"px",top:e-o-a+"px"})},this),t.on("dragStop",function(){var t,e,n,o,i,a,s,p;$.fn.crsapages("showOverlays",!0),t=l.element,e=window.innerWidth,n=window.innerHeight,o=t.offset(),i=t.width(),t.height(),a=t.closest(".lm_goldenlayout").offset(),o.top-=a.top,s=!1,o.top<-a.top&&(o.top=-a.top,s=!0),p=40,n-o.top-a.top<p&&(o.top=n-p-a.top,s=!0),n=40,o.left+i<n&&(o.left=-i+n,s=!0),o.left>e-n&&(o.left=e-n,s=!0),s&&(t.addClass("lm_floating_animate"),t.css({left:o.left+"px",top:o.top+"px"}),setTimeout(function(){t.removeClass("lm_floating_animate")},500))},this),l.addChild(e)},new GoldenLayout.__lm.controls.HeaderButton(e.header,t,"lm_popout",e.popout),e.config.isFloating&&e.popout()}),n.registerComponent("example",function(t){t.getElement().append($("#crsa-left-plane"))}),n.registerComponent("canvas",function(t){t.getElement().append($(".canvas"))}),n.registerComponent("tree",function(t){t.getElement().append($("#crsa-tree"))}),n.registerComponent("lib_panel",function(t){t.getElement().append($("#crsa-elements"))}),n.registerComponent("prop_panel",function(t){var e=new PgPropertiesView;t.getElement().append(e.view.get$Element())}),n.registerComponent("attr_panel",function(t){var e=new PgAttributesEditorView;t.getElement().append(e.view.get$Element())}),n.registerComponent("css_panel",function(t){t.getElement().append($("#crsa-rules"))}),n.registerComponent("act_panel",function(t){t.getElement().append($("#crsa-actions"))}),n.registerComponent("cms_panel",function(t){t.getElement().append($("#crsa-cms"))}),n.registerComponent("project_panel",function(t){t.getElement().append($("#crsa-project"))}),n.init(),$("#crsa-left-plane").detach(),n.on("stateChanged",function(){pgUIViewManager.updateVisibility(),localStorage.pg_layout_state=JSON.stringify(n.toConfig())}),n.on("initialised",function(){pgUIViewManager.updateVisibility()})},PgUIView=function(e){this.onDestroy=null,this.onShow=null,this.onHide=null,e.addClass("pg-ui-view").data("pg-ui-view",this),this.get$Element=function(){return e},this.destroy=function(){e.data("pg-ui-view",null),this.onDestroy&&this.onDestroy()};var n=e.is(":visible"),o=(this.updateVisibility=function(){var t=e.is(":visible");t!=n&&(t?(o&&(o(),o=null),this.onShow&&this.onShow()):this.onHide&&this.onHide(),n=t)},null);this.whenVisible=function(t){n?t():o=t},this.clearWhenVisible=function(){o=null}},PgPropertiesView=function(){function t(t,e){o.whenVisible(function(){$.fn.crsa("showProperties",e,n)}),i=e}function e(){o.whenVisible(function(){$.fn.crsa("showProperties",i,n)})}var n=$('<div class="crsa-panel crsa-properties"></div>'),o=new PgUIView(n),i=(this.view=o,null);$("body").on("crsa-element-selected",t).on("crsa-frameworks-changed",e),o.onDestroy=function(){$.fn.crsa("showProperties",null,n),$("body").off("crsa-element-selected",t).off("crsa-frameworks-changed",e)}},PgUIViewManager=function(){function e(t,o){t.add(t).find(".pg-ui-view").each(function(t,e){var n=$(e).data("pg-ui-view");n&&o(n)})}this.destroyViewsInArea=function(t){e(t,function(t){t.destroy()})},this.updateVisibility=function(){this.updateVisibilityInArea($("body"))},this.updateVisibilityInArea=function(t){e(t,function(t){t.updateVisibility()})},this.getViewForElement=function(t,e){return(t=!t.is(".pg-ui-view")&&e?t.closest(".pg-ui-view"):t).data("pg-ui-view")},this.hideElement=function(t){t.hide();var e=this.getViewForElement(t);e&&e.updateVisibility()},this.showElement=function(t){t.show();var e=this.getViewForElement(t);e&&e.updateVisibility()}},pgUIViewManager=new PgUIViewManager,PgToggleButtonMaker=function(){function o(t,e,n,o){return e=e||"","<"+(o=o||"div")+' class="pg-tb-button'+(n?" "+n:"")+'" style="'+((n=t)?(i="",$.each(n,function(t,e){i+=t+":"+e+";"}),i):"")+'">'+e+"</"+o+">";var i}this.makeColor=function(t,e,n){return o($.extend({},{"border-radius":"8px",width:"16px",height:"16px","background-color":t||"transparent"},n),e,"pg-tb-button-color")},this.makeColorText=function(t,e,n){return this.makeColor(null,e,$.extend({},{color:t},n))},this.makeText=function(t,e){return o(e,t,"pg-tb-button-text")},this.makeIcon=function(t,e){return o(e,"","pb-tb-button-icon fa fa-"+t,"i")}},PgToggleButtons=function(t,o){var e=$.extend({},{input_type:"hidden"},o),i=$('<div class="pg-tb"></div>').appendTo(t),a=$('<input type="hidden">').appendTo(t),s=function(t){switch(e.input_type){case"hidden":a.val(t);break;case"checkbox":a.prop("checked",t==e.checkbox_value)}},o=(this.options=[],[]),p=(this.show_empty=!1,null),l=this,n=(this.get$input=function(){return a},!1),c=(this.show=function(){if(o="function"==typeof this.options?this.options():this.options,!a)switch(e.input_type){case"hidden":a=$('<input type="hidden">').appendTo(t);break;case"checkbox":a=$('<input type="checkbox" value="'+e.checkbox_value+'" style="display:none;">').appendTo(t)}r(),c(),n=!0},this.setValue=function(t){p=t,n&&c()},function(){i.empty();for(var t="",e=0;e<o.length;e++){var n=o[e].html||(o[e].icon?'<i class="fa fa-'+o[e].icon+'"></i>':o[e].name);t+="<div "+(p==o[e].key?'class="active" ':"")+'data-item-id="'+e+'">'+n+"</div>"}i.get(0).innerHTML=t}),r=function(){var n;i.get(0).addEventListener("click",function(t){var e=(n=$(t.target).closest("[data-item-id]")).length&&(e=parseInt(n.attr("data-item-id")))<o.length?o[e]:null;e&&(l.show_empty&&n.hasClass("active")?(n.removeClass("active"),s(null)):(i.find(">div").removeClass("active"),n.addClass("active"),s(e.key)),a.trigger("change"))},!0)}},PgCheckbox=function(t,e,n){var o=new PgToggleButtonMaker;PgToggleButtons.call(this,t,{input_type:"checkbox",checkbox_value:n}),this.show_empty=!0,this.options=[{key:n,name:e,html:o.makeText(e)}]};PgCheckbox.prototype=Object.create(PgToggleButtons.prototype),PgCheckbox.prototype.constructor=PgCheckbox;