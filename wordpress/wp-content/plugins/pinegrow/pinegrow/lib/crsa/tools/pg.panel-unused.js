var PgPanelManager=function(){var a=this,i=0,s=0,l=60,p=60,r=$(window),e=100,c=[],d=[],u=(this.findGroupForPanel=function(e){for(var t=0;t<d.length;t++)if(0<=d[t].indexOf(e))return d[t];return null},function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(t.indexOf(e[n])<0)return!1;return!0}),h=(this.updateGroups=function(e){var t=e&&this.findGroupForPanel(e);if(d=[],c.forEach(function(e){var t=a.findGroupForPanel(e);h(e).forEach(function(e){t||(t=[],d.push(t)),t.indexOf(e.panel)<0&&t.push(e.panel)})}),d.forEach(function(e){e.sort(function(e,t){var n=e.getPosition(),o=t.getPosition();return Math.abs(n.top-o.top)<2?n.z<o.z?1:n.z>o.z?-1:0:n.top<o.top?-1:n.top>o.top?1:0})}),t&&2<t.length)for(var n=t,o=0;o<d.length;o++)if(u(n,d[o]))return void d[o]},this.updateGroupLayout=function(e){var n=null,o=null;e.forEach(function(e){var t=e.getPosition();null===n?(n=t.top,o=t.left):t.top==n&&t.left==o||e.setPosition({top:n,left:o}),n+=e.getSize().height+1})},this.updateLayoutForAllGroups=function(){d.forEach(function(e){a.updateGroupLayout(e)})},this.addPanel=function(e){c.push(e)},this.getPositionForNewPanel=function(e){var t=e.getSize(),n=r.width(),o=r.height();return s+=p,(i+=l)+t.width>n&&(i=100),s+t.height>o&&(s=100),{left:i,top:s}},this.getTopZIndex=function(){return e++},this.panelStartedMoving=function(e){(this.findGroupForPanel(e)||[e]).forEach(function(e){e.putOnTop()})},this.panelMoved=function(e){var n=this.findGroupForPanel(e)||[e];if(n.forEach(function(e){var t=h(e,n);t.length?(t=t.map(function(e){return e.snap}),e.showSnaps(t)):e.showSnaps(null)}),n){for(var t=[],o=n.indexOf(e);o<n.length;o++)t.push(n[o]);this.updateGroupLayout(t)}},this.panelMoveEnded=function(e){this.panelMoved(e),this.updateGroups(),this.updateLayoutForAllGroups()},this.panelSizeChanged=function(e){var t=this.findGroupForPanel(e);t&&this.updateGroupLayout(t)},function(a,i){var s=[],l=a.getPosition(),p=a.getSize(),r=4;return c.forEach(function(e){var t,n,o;e!=a&&(!i||i.indexOf(e)<0)&&(t=e.getPosition(),n=e.getSize(),o=[],t.left>=l.left&&t.left<=l.left+p.width&&t.left,(Math.abs(t.left-l.left)<=r||Math.abs(t.left+n.width-l.left-p.width)<=r)&&(Math.abs(t.top+n.height-l.top)<=r&&o.push("top"),Math.abs(t.top-(l.top+p.height))<=r)&&o.push("bottom"),o.length)&&s.push({panel:e,snap:o[0]})}),s})},PgPanel=function(e,n){this.title=e,this.visible=!1;var o=this,t=$('<div class="panel">        <div class="panel-head"><i class="fa fa-bars"></i><span>'+e+'</span></div>        <div class="panel-content"></div>        \x3c!--<div class="panel-subpanels"></div>--\x3e    </div>').appendTo($("body")),a=t.find("> .panel-head"),i=t.find("> .panel-content"),s=(t.on("click",function(e){o.putOnTop()}),this.isCollapsed=function(){return t.hasClass("panel-collapsed")},a.on("dblclick",function(e){o.isCollapsed()?t.removeClass("panel-collapsed"):t.addClass("panel-collapsed"),n.panelSizeChanged(o)}),t.draggable({handle:".panel-head",scroll:!1}).on("dragstart",function(e,t){t&&$.fn.crsapages("showOverlays"),n.panelStartedMoving(o)}).on("drag",function(e,t){n.panelMoved(o)}).on("dragstop",function(e,t){t&&$.fn.crsapages("showOverlays",!0),o.showSnaps(null),n.panelMoveEnded(o)}),t.find(".panel-subpanels").sortable(),n.addPanel(this),this.setTitle=function(e){this.title=e,a.find("span").html(e)},this.setContent=function(e){i.empty().append(e)},this.addSubpanel=function(e){},this.getSize=function(){return{width:t.width(),height:t.height()}},this.getPosition=function(){var e=t.offset();return e.z=t.css("z-index"),e},this.setPosition=function(e){t.css(e)},this.showSnaps=function(e){t.removeClass("panel-snap-top panel-snap-bottom"),e&&e.forEach(function(e){t.addClass("panel-snap-"+e)})},!0);this.show=function(){s&&(s=!1,this.setPosition(n.getPositionForNewPanel(this))),t.show(),this.putOnTop(),this.visible=!0},this.putOnTop=function(){t.css("z-index",n.getTopZIndex())}},PgDraggable=function(e){e.attr("draggable","true")},testGoldenLayout=function(){var n=new GoldenLayout({settings:{showPopoutIcon:!1,showMaximiseIcon:!1,showCloseIcon:!1},content:[{type:"row",content:[{type:"stack",width:15,isClosable:!1,content:[{type:"component",componentName:"lib_panel",componentState:{text:"Component 1"},title:"LIB",isClosable:!1},{type:"component",componentName:"css_panel",componentState:{text:"Component 1"},title:"CSS",isClosable:!1},{type:"component",componentName:"act_panel",componentState:{text:"Component 1"},title:"ACT",isClosable:!1},{type:"component",componentName:"cms_panel",componentState:{text:"Component 1"},title:"WP",isClosable:!1},{type:"component",componentName:"project_panel",componentState:{text:"Component 1"},title:"PRJ",isClosable:!1}]},{type:"component",componentName:"canvas",componentState:{text:"Component 1"},title:"PAGES"},{type:"component",componentName:"tree",componentState:{text:"Component 3"},title:"TREE",width:15},{type:"stack",width:17,isClosable:!1,isFloating:!0,content:[{type:"component",componentName:"prop_panel",componentState:{text:"Component 1"},title:"PROP",isClosable:!1},{type:"component",componentName:"attr_panel",componentState:{text:"Component 1"},title:"ATTR",isClosable:!1}]}]}]});n.on("stackCreated",function(t){var e=t.layoutManager.config.labels.popout;t.popout=function(){t.header.activeContentItem;var c=n._$normalizeContentItem({title:"KOLI",type:"column",componentName:"kolicol",componentState:{text:"Ha"}}),e=(c.isFloating=!0,n.root.contentItems[0].addChild(c),t.parent.removeChild(t,!0),c.element.css({position:"absolute",left:"100px",top:"100px",border:"1px solid orange",height:"500px"}),$('<div class="lm_header"></div>')),e=(c.element.prepend(e),c.element.addClass("lm_floating"),new GoldenLayout.__lm.utils.DragListener(e)),o=0,a=0,i=0;e.on("dragStart",function(e,t){var n=c.element.closest(".lm_goldenlayout").offset(),n=(o=n.top,c.element.offset());a=e-n.left,i=t-n.top,$.fn.crsapages("showOverlays")},this),e.on("drag",function(e,t,n){e=n.pageX,t=n.pageY,c.element.css({left:e-a+"px",top:t-o-i+"px"})},this),e.on("dragStop",function(e,t){var n,o,a,i,s,l,p,r;$.fn.crsapages("showOverlays",!0),n=c.element,o=window.innerWidth,a=window.innerHeight,i=n.offset(),s=n.width(),n.height(),l=n.closest(".lm_goldenlayout").offset(),i.top-=l.top,p=!1,i.top<-l.top&&(i.top=-l.top,p=!0),r=40,a-i.top-l.top<r&&(i.top=a-r-l.top,p=!0),a=40,i.left+s<a&&(i.left=-s+a,p=!0),i.left>o-a&&(i.left=o-a,p=!0),p&&(n.addClass("lm_floating_animate"),n.css({left:i.left+"px",top:i.top+"px"}),setTimeout(function(){n.removeClass("lm_floating_animate")},500))},this),c.addChild(t)},new GoldenLayout.__lm.controls.HeaderButton(t.header,e,"lm_popout",t.popout),t.config.isFloating&&t.popout()}),n.registerComponent("example",function(e,t){e.getElement().append($("#crsa-left-plane"))}),n.registerComponent("canvas",function(e,t){e.getElement().append($(".canvas"))}),n.registerComponent("tree",function(e,t){e.getElement().append($("#crsa-tree"))}),n.registerComponent("lib_panel",function(e,t){e.getElement().append($("#crsa-elements"))}),n.registerComponent("prop_panel",function(e,t){e.getElement().append($("#crsa-properties"))}),n.registerComponent("attr_panel",function(e,t){e.getElement().append($(".attributes-panel"))}),n.registerComponent("css_panel",function(e,t){e.getElement().append($("#crsa-rules"))}),n.registerComponent("act_panel",function(e,t){e.getElement().append($("#crsa-actions"))}),n.registerComponent("cms_panel",function(e,t){e.getElement().append($("#crsa-cms"))}),n.registerComponent("project_panel",function(e,t){e.getElement().append($("#crsa-project"))}),n.init(),$("#crsa-left-plane").detach()},PgToggleButtonMaker=function(){function o(e,t,n,o){return t=t||"","<"+(o=o||"div")+' class="pg-tb-button'+(n?" "+n:"")+'" style="'+((n=e)?(a="",$.each(n,function(e,t){a+=e+":"+t+";"}),a):"")+'">'+t+"</"+o+">";var a}this.makeColor=function(e,t,n){return o($.extend({},{"border-radius":"8px",width:"16px",height:"16px","background-color":e||"transparent"},n),t,"pg-tb-button-color")},this.makeColorText=function(e,t,n){return this.makeColor(null,t,$.extend({},{color:e},n))},this.makeText=function(e,t){return o(t,e,"pg-tb-button-text")},this.makeIcon=function(e,t){return o(t,"","pb-tb-button-icon fa fa-"+e,"i")}},PgToggleButtons=function(e,o){var t=$.extend({},{input_type:"hidden",compact:!0},o),a=$(`<div class="pg-tb${setting.compact?" pg-tb-compact":""}"></div>`).appendTo(e),i=$('<input type="hidden">').appendTo(e),s=function(e){switch(t.input_type){case"hidden":i.val(e);break;case"checkbox":i.prop("checked",e==t.checkbox_value)}},o=(this.options=[],[]),l=(this.show_empty=!1,null),p=this,r=(this.get$input=function(){return i},!1),c=(this.show=function(){if(o="function"==typeof this.options?this.options():this.options,!i)switch(t.input_type){case"hidden":i=$('<input type="hidden">').appendTo(e);break;case"checkbox":i=$('<input type="checkbox" value="'+t.checkbox_value+'" style="display:none;">').appendTo(e)}u(),n(),r=!0,i.on("crsa-field-value-updated",function(e){p.setValue(i.val())})},null),d=null,n=(this.setValue=function(e){l=e,r&&(c.classList.remove("active"),null!==e)&&(c=a.get(0).querySelector(`[data-item-key="${e}"]`))&&c.classList.add("active")},function(){var e="";d=c=null;for(var t=0;t<o.length;t++){var n=o[t].html||(o[t].icon?'<i class="fa fa-'+o[t].icon+'"></i>':o[t].name);e+="<div "+(l==o[t].key?'class="active" ':"")+'data-item-id="'+t+'" data-item-key="'+o[t].key+'">'+n+"</div>"}a.get(0).innerHTML=e}),u=(this.setInheritedValue=function(e,t){var n;r&&(d&&d.classList.remove("inherited"),e)&&(d=a.get(0).querySelector(`[data-item-key="${e}"]`))&&(d.classList.add("inherited"),(n=d.querySelector("span.responsive-label"))||((n=document.createElement("span")).classList.add("responsive-label"),inherited_value.append(n)),n.innerText=t)},function(){var n;a.get(0).addEventListener("click",function(e){var t=(n=$(e.target).closest("[data-item-id]")).length&&(t=parseInt(n.attr("data-item-id")))<o.length?o[t]:null;t&&(p.show_empty&&n.hasClass("active")?(n.removeClass("active"),s(null)):(a.find(">div").removeClass("active"),n.addClass("active"),s(t.key)),i.trigger("change"))},!0)})},PgCheckbox=function(e,t,n){var o=new PgToggleButtonMaker;PgToggleButtons.call(this,e,{input_type:"checkbox",checkbox_value:n}),this.show_empty=!0,this.options=[{key:n,name:t,html:o.makeText(t)}]};PgCheckbox.prototype=Object.create(PgToggleButtons.prototype),PgCheckbox.prototype.constructor=PgCheckbox,window.pgCreateMediaQueryControl=function(e){function p(e){var t,n,o,a,i,s;r&&(a=u(e),t=r.find(".browsers-input"),o=r.find(".type-input"),"only"==a[n=0]?(t.prop("checked",!0),n++):t.prop("checked",!1),"screen"==a[n]||"print"==a[n]?(o.val(a[n]),n++):o.val(""),(t=r.find(".query-selector-container")).find(".btn").removeClass("active"),2<(o=a.splice(n,a.length)).length||(1==o.length?(n=o[0].replace(/[\(\)]/g,"").split(":"),i="",s=parseInt(n[1],10),"max-width"==n[0]?(i="smaller",s++):"min-width"==n[0]&&(i="larger"),t.find('[data-direction="'+i+'"][data-number="'+s+'"]').addClass("active")):2==o.length&&(a=o[0].replace(/[\(\)]/g,""),n=o[1].replace(/[\(\)]/g,""),o=a.split(":"),a=n.split(":"),i="between",s=-1,parseInt(o[1],10),parseInt(a[1],10),"min-width"==o[0]&&"max-width"==a[0]?s=parseInt(o[1],10)+","+(parseInt(a[1],10)+1):"min-width"==a[0]&&"max-width"==o[0]&&(s=parseInt(a[1],10)+","+(parseInt(o[1],10)+1)),t.find('[data-direction="'+i+'"][data-number="'+s+'"]').addClass("active"))))}function l(e,t,n,o){var a,i,s=u(e),l=("browsers"==t?n?"only"!=s[0]&&s.splice(0,0,"only"):"only"==s[0]&&s.splice(0,1):"type"==t?("only"==s[l=0]&&l++,"screen"==s[l]||"print"==s[l]?n?s[l]=n:s.splice(l,1):s.splice(l,0,n)):"direction"==t&&("only"==s[l=0]&&l++,"screen"!=s[l]&&"print"!=s[l]||l++,s.splice(l,s.length),"smaller"==n&&o?s[l]="(max-width: "+(o-1)+"px)":"larger"==n&&o?s[l]="(min-width: "+o+"px)":"between"==n&&o&&(o=o.split(","),a=parseInt(o[0]),i=parseInt(o[1]),s[l]="(min-width: "+a+"px) and (max-width: "+(i-1)+"px)")),"only"==s[0]&&("screen"==s[1]||"print"==s[1]?(s[1]="only "+s[1],s.splice(0,1)):s[0]="only screen"),s.join(" and "));return p(l),l}function o(e){if(r){var n=r.find("table > tbody");n.html("");for(var t=0;t<e.length;t++){var o,a=parseInt(e[t],10),i=$('<tr class="container-md"></tr>').appendTo(n);$('<td><i class="icon '+s[s.length-1<t?s.length-1:t]+'"></i></td>').appendTo(i),$('<td><a href="#" data-direction="smaller" data-number="'+a+'" class="btn pg-button add-btn"><i class="icon icon-131"></i> '+a+" px</a></td>").appendTo(i),$('<td><a href="#" data-direction="larger" data-number="'+a+'" class="btn pg-button add-btn">'+a+' px <i class="icon icon-right-arrow"></i></a></td>').appendTo(i);t+1<e.length&&(o=parseInt(e[t+1],10),$('<td><a href="#" data-direction="between" data-number="'+a+","+o+'" class="btn pg-button add-btn">'+a+' px <i class="icon icon-131"></i> '+o+" px</a></td>").appendTo(i))}n.find(".btn").on("click",function(e){var t=$(e.target).closest(".btn");t.hasClass("active")?(mediaParams=l(mediaParams,"direction",t.data("direction"),""),n.find(".btn").removeClass("active")):(mediaParams=l(mediaParams,"direction",t.data("direction"),t.data("number")),n.find(".btn").removeClass("active"),t.addClass("active")),c.$field.find("input").val(mediaParams).trigger("change")})}}var r=null,c=null,t=new PgCustomPropertyControl("css-media-query"),d={type:"media-query",name:"",action:"rule_media",live_update:!0,skip_handle_events:!1},s=(e&&(d.skip_handle_events=!0),["icon-Xs","icon-Md","icon-Lg"]),u=function(e){var t=(e=e||"").split(" and ");return 0<(t=t.filter(function(e){if(e)return e})).length&&(-1<t[0].indexOf("only")||-1<t[0].indexOf("screen")||-1<t[0].indexOf("print"))&&(t[0]=t[0].split(" "),t=[].concat.apply([],t)),t};return t.onDefine=function(){this.registerInputField("media-query",d)},t.onShow=function(){r=$('<div class="media-query-container"></div>');var e=$('<div class="row media-query-row"></div>').appendTo(r),t=$('<div class="col-sm-9 input-container"></div>').appendTo(e),t=((c=this.showInputField(t,"media-query",d)).$field.addClass("crsa-block-input"),$('<div class="col-sm-3 button-container"></div>').appendTo(e)),n=$('<a href="#" class="btn pg-button add-btn">Select <i class="icon icon-down"></i></a>').appendTo(t),o=$('<div style="display: none;"><table class="query-selector-container"><tbody></tbody></table></div>').appendTo(r),a=o.find("> table"),e=(a.find("> tbody"),$('<div class="row media-type"></div>').appendTo(o)),i=$('<div class="col-sm-5 select-container">                                        <select class="type-input">                                            <option value=""></option>                                            <option value="screen">Screen</option>                                            <option value="print">Print</option>                                        </select>                                    </div>').appendTo(e).find("> select"),s=$('<div class="col-sm-7 checkbox-container">                                        <label><input type="checkbox" class="browsers-input"> Ignore in old browsers</label>                                    </div>').appendTo(e).find("input"),t=$('<div class="manage-breakpoints-container"><a href="#" class="btn btn-default add-btn">Manage Breakpoints</a></div>').appendTo(o).find(".btn");return i.on("change",function(e){a.find(".btn.active");mediaParams=l(mediaParams,"type",i.val()),c.$field.find("input").val(mediaParams).trigger("change")}),s.on("change",function(e){a.find(".btn.active");mediaParams=l(mediaParams,"browsers",s.is(":checked")),c.$field.find("input").val(mediaParams).trigger("change")}),n.on("click",function(e){o.hasClass("open")?(o.slideUp(),o.removeClass("open"),n.find("i").removeClass("icon-up").addClass("icon-down")):(o.slideDown(),o.addClass("open"),n.find("i").removeClass("icon-down").addClass("icon-up"))}),t.on("click",function(){pinegrow.getSelectedPage().showManageBreakpoints()}),r},t.onSetValues=function(){mediaParams=this.values["media-query"];var e=pinegrow.getSelectedPage();e&&(o(e.breakpoints),p(mediaParams))},$("body").on("crsa-breakpoints-changed",function(e,t){var n=pinegrow.getSelectedPage();n&&(o(n.breakpoints),p(mediaParams))}),t};