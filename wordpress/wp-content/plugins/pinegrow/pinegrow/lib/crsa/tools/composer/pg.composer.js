class PgComposerManager{constructor(){this.instances_map={},this.unused_map={},this.types={}}registerType(e,t){this.types[e]=t}unused(e){this.unused_map[e.type]||(this.unused_map[e.type]=[]),this.unused_map[e.type].push(e)}used(e){var t;this.unused_map[e.type]&&0<=(t=this.unused_map[e.type].indexOf(e))&&this.unused_map[e.type].splice(t,1)}registerInstance(e){this.instances_map[e.type]||(this.instances_map[e.type]=[]),this.instances_map[e.type].push(e)}getInstance(e){return this.unused_map[e]&&this.unused_map[e].length?this.unused_map[e].pop():new this.types[e]}}const pgComposerManager=new PgComposerManager;class PgComposerComponent{constructor(e){this.type=e,this.id=null,this.data=null,this.element=null,this.map={},this.cache={},this.children_map={},this.manager=pgComposerManager,this.manager.registerInstance(this)}setData(e){this.data=e}detach(){for(var e in this.element.parentNode.removeChild(this.element),this.manager.unused(this),this.children_map)this.children_map[e].forEach(function(e){e.detach()}),this.children_map[e]=[]}create(e,t,s,r){const a=document.createElement(t);if(s)for(var n in s)a.setAttribute(n,s[n]);return r&&r.forEach(function(e){a.appendChild(e)}),e&&(this.map[e]=a),a}text(e){return document.createTextNode(e)}setHtml(e,t){var s=e+"__html";t!==this.cache[s]&&(this.map[e].innerHTML=t,this.cache[s]=t)}addClass(e,t){var s=this.map[e];s.classList.contains(t)||s.classList.add(t)}removeClass(e,t){var s=this.map[e];s.classList.contains(t)&&s.classList.remove(t)}setAttribute(e,t,s){var r=this.map[e];r.getAttribute(t)!==s&&r.setAttribute(t,s)}removeAttribute(e,t){var s=this.map[e];s.hasAttribute(t)&&s.removeAttribute(t)}append(e,t){var s=this.map[e];t.parentNode!==s&&s.appendChild(t)}setChildren(t,e){const s=this;this.children_map[t]&&this.children_map[t].forEach(function(e){e.detach()}),e.forEach(function(e){s.map[t].appendChild(e.element)}),this.children_map[t]=e}getElement(e){return this.map[e]}objToString(e){if(Array.isArray(e)){for(var t="[",s=0;s<e.length;s++)t+=this.objToString(e[s])+`,
`;return t+="]"}if("object"==typeof e){var r,t="{";for(r in e)t+=`${r}: ${this.objToString(e[r])},\n`;return t+="}"}if("number"==typeof e||"string"==typeof e)return e}didChange(e,t){var s=e+"__value",r=this.cache[s]||null;return null!==r?r!==(r=this.objToString(t))&&(this.cache[s]=r,!0):null!==t}}!function(){const t=new PgGetCSSValueHTML;class e extends PgComposerComponent{constructor(){super("PgComposerCSSProp"),this.element=this.create("top","div",{class:"pgc-css-prop"},[this.create("label","div",{class:"pgc-css-prop-label"}),this.create("value","div",{class:"pgc-css-prop-value"}),this.create("remove","i",{class:"icon icon-close"})])}setData(e){super.setData(e),this.setHtml("label",e.prop),this.setHtml("value",t.getHTML(e.value))}}class s extends PgComposerComponent{constructor(){super("PgComposerCSSComment"),this.element=this.create("top","div",{class:"pgc-css-comment"})}setData(e){super.setData(e),this.setHtml("top",e.text)}}class r extends PgComposerComponent{constructor(){super("PgComposerCSSAtRule"),this.element=this.create("top","div",{class:"pgc-css-atrule"},[this.create("name","span",{class:"pgc-css-atrule-name"}),this.create("params","span",{class:"pgc-css-atrule-params"})])}setData(e){super.setData(e),this.setHtml("name",e.rule.name),this.setHtml("params",e.rule.params);var t=10*e.level;this.setAttribute("top","style","margin-left:"+t+"px")}}class a extends PgComposerComponent{constructor(){super("PgComposerCSSAddProp"),this.element=this.create("top","div",{class:"pgc-css-add-prop"},[this.text("Add")])}setData(e){super.setData(e)}}class n extends PgComposerComponent{constructor(){super("PgComposerCSSRule"),this.element=this.create("top","div",{class:"pgc-css-rule"},[this.create("atrule","div",{class:"pgc-css-prop-atrule"}),this.create("selector","div",{class:"pgc-css-prop-selector"}),this.create("props","div",{class:"pgc-css-rule-props"})])}setData(e){const s=this;super.setData(e);var t=e.node;if(this.didChange("rule",t)){this.setHtml("selector",t.selector);const i=[];t.nodes.forEach(function(e){let t;(t="comment"===e.type?s.manager.getInstance("PgComposerCSSComment"):s.manager.getInstance("PgComposerCSSProp")).setData(e),i.push(t)}),i.push(s.manager.getInstance("PgComposerCSSAddProp")),this.setChildren("props",i)}var r=[];let a=t.parent;for(;a&&"atrule"===a.type;)r.unshift(a),a=a.parent;var n=[];for(let c=0;c<r.length;c++){var o=s.manager.getInstance("PgComposerCSSAtRule");o.setData({rule:r[c],level:c}),n.push(o)}this.setChildren("atrule",n);var p=10*n.length;this.setAttribute("selector","style","margin-left:"+p+"px"),this.setAttribute("props","style","margin-left:"+p+"px"),pinegrow.selectedCSSNodes.isSelected(t)?this.addClass("top","selected"):this.removeClass("top","selected")}}class o extends PgComposerComponent{constructor(){super("PgComposerCSSElementRules"),this.element=this.create("top","div",{class:"pgc-css-element-rules"},[this.create("element","div",{class:"pgc-css-element-rules-element"}),this.create("rules","div",{class:"pgc-css-element-rules-rules"})])}setData(e){const s=this,r=(super.setData(e),this.setHtml("element",e.pgel.getName()),[]);e.rules.forEach(function(e){var t=s.manager.getInstance("PgComposerCSSRule");t.setData(e),r.push(t)}),this.setChildren("rules",r)}}class p extends PgComposerComponent{constructor(){super("PgComposerCSSPanel"),this.element=this.create("top","div",{class:"pgc-css-panel"},[this.create("rules","div",{class:"pgc-css-rules"})]);var e=$(this.element);new PgCSSEditableValue(e,"num").onChange=function(e,t,s){},new PgCSSEditableColor(e,"colorbox").onChange=function(e){},new PgCSSEditableText(e,".pgc-css-prop-label,.pgc-css-prop-value").onGetValue=function(e){return e.text()}}setData(e){const s=this,r=(super.setData(e),[]);e.forEach(function(e){var t=s.manager.getInstance("PgComposerCSSElementRules");t.setData(e),r.push(t)}),this.setChildren("rules",r)}}window.PgComposerCSSPanel=p,pgComposerManager.registerType("PgComposerCSSProp",e),pgComposerManager.registerType("PgComposerCSSComment",s),pgComposerManager.registerType("PgComposerCSSAtRule",r),pgComposerManager.registerType("PgComposerCSSAddProp",a),pgComposerManager.registerType("PgComposerCSSRule",n),pgComposerManager.registerType("PgComposerCSSElementRules",o),pgComposerManager.registerType("PgComposerCSSPanel",p)}();