var PgPanelManager=function(){var a=this,i=0,s=0,p=60,l=60,c=$(window),t=100,r=[],u=[],h=(this.findGroupForPanel=function(t){for(var e=0;e<u.length;e++)if(0<=u[e].indexOf(t))return u[e];return null},function(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(e.indexOf(t[n])<0)return!1;return!0}),d=(this.updateGroups=function(t){var e=t&&this.findGroupForPanel(t);if(u=[],r.forEach(function(t){var e=a.findGroupForPanel(t);d(t).forEach(function(t){e||(e=[],u.push(e)),e.indexOf(t.panel)<0&&e.push(t.panel)})}),u.forEach(function(t){t.sort(function(t,e){var n=t.getPosition(),o=e.getPosition();return Math.abs(n.top-o.top)<2?n.z<o.z?1:n.z>o.z?-1:0:n.top<o.top?-1:n.top>o.top?1:0})}),e&&2<e.length)for(var n=e,o=0;o<u.length;o++)if(h(n,u[o]))return void u[o]},this.updateGroupLayout=function(t){var n=null,o=null;t.forEach(function(t){var e=t.getPosition();null===n?(n=e.top,o=e.left):e.top==n&&e.left==o||t.setPosition({top:n,left:o}),n+=t.getSize().height+1})},this.updateLayoutForAllGroups=function(){u.forEach(function(t){a.updateGroupLayout(t)})},this.addPanel=function(t){r.push(t)},this.getPositionForNewPanel=function(t){var e=t.getSize(),n=c.width(),o=c.height();return s+=l,(i+=p)+e.width>n&&(i=100),s+e.height>o&&(s=100),{left:i,top:s}},this.getTopZIndex=function(){return t++},this.panelStartedMoving=function(t){(this.findGroupForPanel(t)||[t]).forEach(function(t){t.putOnTop()})},this.panelMoved=function(t){var n=this.findGroupForPanel(t)||[t];if(n.forEach(function(t){var e=d(t,n);e.length?(e=e.map(function(t){return t.snap}),t.showSnaps(e)):t.showSnaps(null)}),n){for(var e=[],o=n.indexOf(t);o<n.length;o++)e.push(n[o]);this.updateGroupLayout(e)}},this.panelMoveEnded=function(t){this.panelMoved(t),this.updateGroups(),this.updateLayoutForAllGroups()},this.panelSizeChanged=function(t){var e=this.findGroupForPanel(t);e&&this.updateGroupLayout(e)},function(a,i){var s=[],p=a.getPosition(),l=a.getSize(),c=4;return r.forEach(function(t){var e,n,o;t!=a&&(!i||i.indexOf(t)<0)&&(e=t.getPosition(),n=t.getSize(),o=[],e.left>=p.left&&e.left<=p.left+l.width&&e.left,(Math.abs(e.left-p.left)<=c||Math.abs(e.left+n.width-p.left-l.width)<=c)&&(Math.abs(e.top+n.height-p.top)<=c&&o.push("top"),Math.abs(e.top-(p.top+l.height))<=c)&&o.push("bottom"),o.length)&&s.push({panel:t,snap:o[0]})}),s})},PgPanel=function(t,n){this.title=t,this.visible=!1;var o=this,e=$('<div class="panel">        <div class="panel-head"><i class="fa fa-bars"></i><span>'+t+'</span></div>        <div class="panel-content"></div>        \x3c!--<div class="panel-subpanels"></div>--\x3e    </div>').appendTo($("body")),a=e.find("> .panel-head"),i=e.find("> .panel-content"),s=(e.on("click",function(){o.putOnTop()}),this.isCollapsed=function(){return e.hasClass("panel-collapsed")},a.on("dblclick",function(){o.isCollapsed()?e.removeClass("panel-collapsed"):e.addClass("panel-collapsed"),n.panelSizeChanged(o)}),e.draggable({handle:".panel-head",scroll:!1}).on("dragstart",function(t,e){e&&$.fn.crsapages("showOverlays"),n.panelStartedMoving(o)}).on("drag",function(t,e){n.panelMoved(o)}).on("dragstop",function(t,e){e&&$.fn.crsapages("showOverlays",!0),o.showSnaps(null),n.panelMoveEnded(o)}),e.find(".panel-subpanels").sortable(),n.addPanel(this),this.setTitle=function(t){this.title=t,a.find("span").html(t)},this.setContent=function(t){i.empty().append(t)},this.addSubpanel=function(){},this.getSize=function(){return{width:e.width(),height:e.height()}},this.getPosition=function(){var t=e.offset();return t.z=e.css("z-index"),t},this.setPosition=function(t){e.css(t)},this.showSnaps=function(t){e.removeClass("panel-snap-top panel-snap-bottom"),t&&t.forEach(function(t){e.addClass("panel-snap-"+t)})},!0);this.show=function(){s&&(s=!1,this.setPosition(n.getPositionForNewPanel(this))),e.show(),this.putOnTop(),this.visible=!0},this.putOnTop=function(){e.css("z-index",n.getTopZIndex())}},PgDraggable=function(t){t.attr("draggable","true")},testGoldenLayout=function(){var n=new GoldenLayout({settings:{showPopoutIcon:!1,showMaximiseIcon:!1,showCloseIcon:!1},content:[{type:"row",content:[{type:"stack",width:15,isClosable:!1,content:[{type:"component",componentName:"lib_panel",componentState:{text:"Component 1"},title:"LIB",isClosable:!1},{type:"component",componentName:"css_panel",componentState:{text:"Component 1"},title:"CSS",isClosable:!1},{type:"component",componentName:"act_panel",componentState:{text:"Component 1"},title:"ACT",isClosable:!1},{type:"component",componentName:"cms_panel",componentState:{text:"Component 1"},title:"WP",isClosable:!1},{type:"component",componentName:"project_panel",componentState:{text:"Component 1"},title:"PRJ",isClosable:!1}]},{type:"component",componentName:"canvas",componentState:{text:"Component 1"},title:"PAGES"},{type:"component",componentName:"tree",componentState:{text:"Component 3"},title:"TREE",width:15},{type:"stack",width:17,isClosable:!1,isFloating:!0,content:[{type:"component",componentName:"prop_panel",componentState:{text:"Component 1"},title:"PROP",isClosable:!1},{type:"component",componentName:"attr_panel",componentState:{text:"Component 1"},title:"ATTR",isClosable:!1}]}]}]});n.on("stackCreated",function(e){var t=e.layoutManager.config.labels.popout;e.popout=function(){e.header.activeContentItem;var l=n._$normalizeContentItem({title:"KOLI",type:"column",componentName:"kolicol",componentState:{text:"Ha"}}),t=(l.isFloating=!0,n.root.contentItems[0].addChild(l),e.parent.removeChild(e,!0),l.element.css({position:"absolute",left:"100px",top:"100px",border:"1px solid orange",height:"500px"}),$('<div class="lm_header"></div>')),t=(l.element.prepend(t),l.element.addClass("lm_floating"),new GoldenLayout.__lm.utils.DragListener(t)),o=0,a=0,i=0;t.on("dragStart",function(t,e){var n=l.element.closest(".lm_goldenlayout").offset(),n=(o=n.top,l.element.offset());a=t-n.left,i=e-n.top,$.fn.crsapages("showOverlays")},this),t.on("drag",function(t,e,n){t=n.pageX,e=n.pageY,l.element.css({left:t-a+"px",top:e-o-i+"px"})},this),t.on("dragStop",function(){var t,e,n,o,a,i,s,p;$.fn.crsapages("showOverlays",!0),t=l.element,e=window.innerWidth,n=window.innerHeight,o=t.offset(),a=t.width(),t.height(),i=t.closest(".lm_goldenlayout").offset(),o.top-=i.top,s=!1,o.top<-i.top&&(o.top=-i.top,s=!0),p=40,n-o.top-i.top<p&&(o.top=n-p-i.top,s=!0),n=40,o.left+a<n&&(o.left=-a+n,s=!0),o.left>e-n&&(o.left=e-n,s=!0),s&&(t.addClass("lm_floating_animate"),t.css({left:o.left+"px",top:o.top+"px"}),setTimeout(function(){t.removeClass("lm_floating_animate")},500))},this),l.addChild(e)},new GoldenLayout.__lm.controls.HeaderButton(e.header,t,"lm_popout",e.popout),e.config.isFloating&&e.popout()}),n.registerComponent("example",function(t){t.getElement().append($("#crsa-left-plane"))}),n.registerComponent("canvas",function(t){t.getElement().append($(".canvas"))}),n.registerComponent("tree",function(t){t.getElement().append($("#crsa-tree"))}),n.registerComponent("lib_panel",function(t){t.getElement().append($("#crsa-elements"))}),n.registerComponent("prop_panel",function(t){t.getElement().append($("#crsa-properties"))}),n.registerComponent("attr_panel",function(t){t.getElement().append($(".attributes-panel"))}),n.registerComponent("css_panel",function(t){t.getElement().append($("#crsa-rules"))}),n.registerComponent("act_panel",function(t){t.getElement().append($("#crsa-actions"))}),n.registerComponent("cms_panel",function(t){t.getElement().append($("#crsa-cms"))}),n.registerComponent("project_panel",function(t){t.getElement().append($("#crsa-project"))}),n.init(),$("#crsa-left-plane").detach()},PgToggleButtonMaker=function(){function o(t,e,n,o){return e=e||"","<"+(o=o||"div")+' class="pg-tb-button'+(n?" "+n:"")+'" style="'+((n=t)?(a="",$.each(n,function(t,e){a+=t+":"+e+";"}),a):"")+'">'+e+"</"+o+">";var a}this.makeColor=function(t,e,n){return o($.extend({},{"border-radius":"8px",width:"16px",height:"16px","background-color":t||"transparent"},n),e,"pg-tb-button-color")},this.makeColorText=function(t,e,n){return this.makeColor(null,e,$.extend({},{color:t},n))},this.makeText=function(t,e){return o(e,t,"pg-tb-button-text")},this.makeIcon=function(t,e){return o(e,"","pb-tb-button-icon fa fa-"+t,"i")}},PgToggleButtons=function(t,o){var e=$.extend({},{input_type:"hidden"},o),a=$('<div class="pg-tb"></div>').appendTo(t),i=$('<input type="hidden">').appendTo(t),s=function(t){switch(e.input_type){case"hidden":i.val(t);break;case"checkbox":i.prop("checked",t==e.checkbox_value)}},o=(this.options=[],[]),p=(this.show_empty=!1,null),l=this,n=(this.get$input=function(){return i},!1),c=(this.show=function(){if(o="function"==typeof this.options?this.options():this.options,!i)switch(e.input_type){case"hidden":i=$('<input type="hidden">').appendTo(t);break;case"checkbox":i=$('<input type="checkbox" value="'+e.checkbox_value+'" style="display:none;">').appendTo(t)}r(),c(),n=!0},this.setValue=function(t){p=t,n&&c()},function(){a.empty();for(var t="",e=0;e<o.length;e++){var n=o[e].html||(o[e].icon?'<i class="fa fa-'+o[e].icon+'"></i>':o[e].name);t+="<div "+(p==o[e].key?'class="active" ':"")+'data-item-id="'+e+'">'+n+"</div>"}a.get(0).innerHTML=t}),r=function(){var n;a.get(0).addEventListener("click",function(t){var e=(n=$(t.target).closest("[data-item-id]")).length&&(e=parseInt(n.attr("data-item-id")))<o.length?o[e]:null;e&&(l.show_empty&&n.hasClass("active")?(n.removeClass("active"),s(null)):(a.find(">div").removeClass("active"),n.addClass("active"),s(e.key)),i.trigger("change"))},!0)}},PgCheckbox=function(t,e,n){var o=new PgToggleButtonMaker;PgToggleButtons.call(this,t,{input_type:"checkbox",checkbox_value:n}),this.show_empty=!0,this.options=[{key:n,name:e,html:o.makeText(e)}]};PgCheckbox.prototype=Object.create(PgToggleButtons.prototype),PgCheckbox.prototype.constructor=PgCheckbox;