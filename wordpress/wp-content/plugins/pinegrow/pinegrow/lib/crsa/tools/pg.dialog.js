var PgDialogFieldsView=function(t,c,d){function f(e,n){return n in c?c[n]:null}var e=$('<div class="pg-dialog-fields"></div>'),n=new PgUIView(e),h=(this.view=n,{}),p=(this.onValueChanged=function(e,n){},this),v={},r=new PgUISectionGrid;e.append(r.$element),r.onGetNumberOfColumns=function(){return 1};this.isValid=function(){var i;return d?(i=!0,$.each(t.sections,function(e,n){$.each(n.fields,function(e,n){var t;n.validate&&(t=pinegrow.validateField(h,e,c.hasOwnProperty(e)?c[e]:null,n,v[e],c),i=i&&t)})}),i):0===r.$element.find("p.error-message:visible").length},this.populateDefaultValues=function(){$.each(t.sections,function(e,n){$.each(n.fields,function(e,n){!n.default_value||void 0!==c[e]&&null!==c[e]&&""!==c[e]||(c[e]=n.default_value)})})},this.show=function(){var s=r.$element.parent(),o=(s.scrollTop(),r.clear(),[]),u=[];$.each(t.sections,function(e,i){o.push(i),i.section_key=e,$.each(i.fields,function(e,n){var t;"custom"==n.type&&n.control&&!n.control_defined&&((t=n.control().define(i.component_definition))&&o.push(t),n.control_defined=!0)})}),$.each(o,function(e,o){o.section_key;var l=new PgUISection(o.name,null,o,null,o.force_open||!1),a=(l.is_closable=void 0===o.is_closable||o.is_closable,l._propData={controls:[],fields:[]},r.addSection(l),l.$content);$.each(o.fields,function(r,t){var e,n,i=t.append_to?a.parent().find(t.append_to):a;if(t.hasOwnProperty("show")&&!t.show)return!0;t.action="custom",t.get_value=f,t.set_value=function(e,n,t,i,o,l){var a,s;return a=r,s=n,(l=l).neg_value&&!s&&(s=l.neg_value),c[a]=s,p.onValueChanged(a,s),n},"custom"===t.type?t.control&&((e=t.control()).setObject(h),e.setValues(c),e.show(s),i.append(e.$element),n=e.$element,l._propData.controls.push(e)):(n=(i=new PgPropertyField(a,h,r,t,c,s)).$field,l._propData.fields.push(i)),v[r]=n,t.without_icon||o.icons&&(n.addClass("with-icons"),$('<i class="field-icon icon-'+r+'"></i>').insertAfter(n.find(">label"))),t.on_fields_created&&u.push({func:t.on_fields_created,obj:h,field:n,def:t,name:r,default_value:t.default_value||null}),t.validate&&!d&&pinegrow.validateField(h,r,c.hasOwnProperty(r)?c[r]:null,t,n,c),t.show_if&&(t.show_if_selector=".fields",("function"==typeof t.show_if?t.show_if(c,h):crsaEvaluateShowIfString(t.show_if,c,t,h))?pg$Show(n,t.control?"block":"flex"):pg$Hide(n)),t.on_field_updated&&(t.on_field_updated(h,n,t,e,r,null),e)&&e.shown_fields&&$.each(e.shown_fields,function(e,n){t.on_field_updated(h,n.$field,n.def,e,n)})})});for(var e=0;e<u.length;e++){var n=c.hasOwnProperty(u[e].name)?c[u[e].name]:null;null===n&&u[e].default_value&&(n=u[e].default_value),u[e].func(u[e].obj,u[e].name,n,u[e].def,u[e].field,c)}u=null,r.updateLayout()},n.onDestroy=function(){var e=r.$element;e.find(".crsa-input-color-picker").spectrum("destroy"),pgRemoveMultiselects(e),e.trigger("crsa-will-clear-area"),r.clear()}},PgDialog=function(i){function o(){s&&s.view.destroy()}var l,a=this,s=(this.before="",this.after="",this.sections={},this.values={},this.cancelButtonLabel="Cancel",this.okButtonLabel="OK",this.onCancel=function(){},this.onOK=function(){},this.validate_on_submit=!1,this.$dialog=null,null);this.setFieldValue=function(e,n){var t;s&&((t=s.view.get$Element().find(".crsa-field-"+e+" input.crsa-input, .crsa-field-"+e+" textarea.crsa-input, .crsa-field-"+e+" select.crsa-input")).val(n),t.trigger("change"))},this.getFieldValue=function(e){return s?s.view.get$Element().find(".crsa-field-"+e+" input.crsa-input, .crsa-field-"+e+" textarea.crsa-input, .crsa-field-"+e+" select.crsa-input").val():null},this.setFieldErrorMessage=function(e){},this.get$OKButton=function(){return l.find(".modal-footer button.ok")},this.get$Dialog=function(){return l},this.addExtraButton=function(e,n,t){$(`<a href="#" class="btn ${t}">${e}</a>`).appendTo(l.find(".modal-footer")).on("click",function(e){e.preventDefault(),n&&n(e)})};this.hide=function(){o(),l.modal("hide"),a.non_modal&&l.remove()},this.show=function(){function e(){o(),a.onCancel()}function n(){return s&&!s.isValid()?(pinegrow.showQuickError("The form contains errors."),!1):(s&&s.populateDefaultValues(),!1!==a.onOK(function(){l.modal("hide"),o()})&&void o())}var t=new PgComponentType("pg.dialog","Dialog dummy def",{selector:null,not_main_type:!0,sections:this.sections}),t=(s=new PgDialogFieldsView(t,this.values,this.validate_on_submit),l=this.non_modal?makeAndShowDialog(i,this.cancelButtonLabel,this.okButtonLabel,this.before+'<div class="fields"></div>'+this.after,e,n,function(){return!(s&&!s.isValid()&&(pinegrow.showQuickError("The form contains errors."),1))},!0):pinegrow.showAlert(this.before+'<div class="fields"></div>'+this.after,i,this.cancelButtonLabel,this.okButtonLabel,e,n),(this.$dialog=l).find(".fields").append(s.view.get$Element()),s.show(),s.view.get$Element().get(0).querySelector("input,textarea,select"));return t&&t.focus(),l}};