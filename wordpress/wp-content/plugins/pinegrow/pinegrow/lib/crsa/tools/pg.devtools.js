window.pgDevVersion=!0,window.pgTestMode=!1;var win=require("nw.gui").Window.get();win.showDevTools(),$(function(){$("body").one("pinegrow-ready",function(e,g){pgTestMode&&g.addEventHandler("on_undo_state_added",function(){g.undoManager.undo(),g.undoManager.redo()}),$(window).on("aaaaresize",function(){var e=$("body").width()/16*9-36;$("#layout-container").css("height",e+"px")}),g.showQuickMessage("DEV MODE - Will look for live changes to edit.css",3e3);var n=g.getWorkspaceTheme(),t=require("path"),o=require("fs"),s="lib/crsa/edit.theme."+n+".css",s=t.join(process.cwd(),s),p=(o.watchFile(s,{interval:2e3},function(){var e=o.readFileSync(s,{encoding:"utf8"});$('link[href="lib/crsa/edit.theme.'+n+'.css"],.live-css').replaceWith($('<style class="live-css">'+e+"</style>"))}),function(){var e=g.getSelectedPage(),n=(e.activeView.setDeviceSize(1024,1024),require("path")),t=n.resolve(n.dirname(e.localFile),"../screenshots/"+n.basename(g.getCurrentProject().getDir())+"."+n.basename(e.localFile)+".jpg");console.log(t),e.get$Html().find("body").css("overflow","hidden"),g.takePhotoOfPage(e,t,function(){g.showQuickMessage("Image generated in "+t)},600)}),i=(g.addEventHandler("on_key_pressed",function(t,e,n){var o,s,r,i,c,l,a,u,f,t,d,h;"/"==n.key&&n.ctrl?(n.done=!0,p()):"-"==n.key&&n.ctrl?(o=g.showAlert(`<div class="test"></div>`,"Composer test"),new PgComposerTester(o.find(".test").get(0))):0&&","===n.key&&n.ctrl&&(t=g.getSelectedPage(),d=0,h=0,t.sourceNode.walk(function(n){var e;return n.isElementOrScript&&((e=n.getUniqueSelectors(0,2,!0)).length?e.forEach(function(e){t.sourceNode.findOne(e)!==n&&console.error("Selector issue",e,n)}):(h++,console.log("No selector for",n)),++d%100==0)&&console.log(d),!0}),console.log(`Did ${d} elements, ${h} without selectors`))}),function(n){fetch("/lib/crsa/dev/css_tree.txt").then(function(e){return e.text()}).then(function(e){var o,s={},r=0,i=null,c=null,l=null,i=null,t=(e.split("\n").forEach(function(e){e=e.replace(/    /g,"\t");var n=0;if(e=(e=e.replace(/\t+/g,function(e){return n=e.length,""})).trim(),0===n)c=[],s[o=e]={sub:c,level:0,parent:null},i=l=s[o],r=0;else if(r===n){var t={name:e,level:n,parent:i,sub:[]};c.push(t),l=t}else if(r<n){c=(i=l).sub;t={name:e,level:n,parent:i,sub:[]};c.push(t),l=t}else if(n<r){for(;i.level>=n;)i=i.parent,c=i.sub;t={name:e,level:n,parent:i,sub:[]};c.push(t),l=t}r=n}),function(e){e.forEach(function(e){delete e.parent,delete e.level,e.sub.length?t(e.sub):delete e.sub})});$.each(s,function(e,n){t(n.sub)}),n(s)})}),c=function(r,i){var c={name:r,examples:[],desc:null};console.log("Getting "+r+"..."),fetch("https://developer.mozilla.org/en-US/docs/Web/CSS/"+r).then(function(e){return e.text()}).then(function(e){console.log("Got "+r+".");var n=new pgParser,n=(n.assignIds=!1,n.parse(e),n.rootNode.findOne("#wikiArticle"));if(n){for(var t=n.find(">p"),o=null,s=0;s<t.length;s++)if(t[s].html().length){(o=t[s]).find("a").forEach(function(e){e.setAttribute("href","https://developer.mozilla.org"+e.getAttribute("href")),e.addClass("external")}),c.desc=o.html();break}n=n.findOne("iframe");n?(n=n.getAttribute("src"),console.log("Getting example for "+r+"..."),fetch(n).then(function(e){return e.text()}).then(function(e){console.log("Got example for "+r+".");var n=new pgParser;n.assignIds=!1,n.parse(e),n.rootNode.find(".example-choice").forEach(function(e){var n=e.findOne("code").text();c.examples.push(n)}),i(c)})):i(c)}else i(null)})},r=function(){var s=1,n=pgGetAppFilePath("/lib/crsa/pgeditor/resources/css_desc.json");try{var t=require("fs").readFileSync(n,{encoding:"utf8"}),r=JSON.parse(t)}catch(e){t=require("fs").readFileSync(pgGetAppFilePath("/lib/crsa/pgeditor/resources/css_info.json"),{encoding:"utf8"}),t=JSON.parse(t),r={};$.each(t.properties,function(e,n){r[e]={}})}function i(){var t=null,o=null;$.each(r,function(e,n){if(!n.v||n.v!=s)return t=n,o=e,!1}),t&&c(o,function(e){e&&(t.desc=e.desc,t.examples=e.examples),t.v=s,require("fs").writeFileSync(n,JSON.stringify(r),{encoding:"utf8"}),console.log(e),i()})}i()},l=function(){},a=function(){var r={properties:{},inherited:[],sections:{}},t=[];fetch("/lib/crsa/dev/chromium_css_info.js").then(function(e){return e.text()}).then(function(e){var n=JSON5.parse(e),o=(console.log(n),[]),s=g.devTools.getCSSPropsInfo();n.data.forEach(function(e){var n,t;e.name.startsWith("-")||e.svg||(n={name:e.name,inherited:e.inherited||!1},e.alias_for&&(n.alias_for=e.alias_for),e.longhands&&(n.longhands=e.longhands),e.keywords&&(n.values=e.keywords),o.push(n),n.inherited&&r.inherited.push(n.name),t=n,$.each(s,function(e,n){if(("_"+t.name+"_").match(n.re))return r.sections[e]||(r.sections[e]={list:[]}),r.sections[e].list.push(t.name),t.section=e,!1}))}),o.sort(function(e,n){return e.name.localeCompare(n.name)}),o.forEach(function(e){(r.properties[e.name]=e).section||t.push(e.name)}),$.each(r.sections,function(e,n){n.list.sort()}),i(function(e){var n;$.each(e,function(e,n){r.sections[e].tree=n.sub}),n=pgGetAppFilePath("/lib/crsa/pgeditor/resources/css_info.json"),require("fs").writeFileSync(n,JSON.stringify(r),{encoding:"utf8"}),console.log("NO SECTION:",t)})})}})});