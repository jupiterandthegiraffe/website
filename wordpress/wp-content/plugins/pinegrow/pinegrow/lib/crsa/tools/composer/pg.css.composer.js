var PgCSSComposerView=function(){function e(e,n,o){}function n(e,n){n.edited_by!==m&&n.node}function o(e,n){n.edited_by!==m&&(k(),b(r))}function t(e,n){n.edited_by!==m&&(k(),b(r))}var r,i=$("<div/>",{id:"pg-tree",class:"pg-tree pg-css-composer"}),a=(new PgApi,new PgSearchBox({toolbar_on:!0})),d=this.toolbar=a.getToolbar(),s=new PgButtonToolbarItem("icon-filter","Select what kind of elements to show in the tree."),l=(d.addItem("settings",s),{position:{label:"Position",desc:"Show only the elements with inline styles",re:/_(top|right|bottom|left|position|z\-index)_/i},text:{label:"Text",desc:"Show only images",re:/font|line-height|_color_|letter-spacing|text-decoration|text-align|text-transform|white-space|word-break|_direction_|text-indent/i}}),c={},p=($.each(l,function(e,n){c[e]=!1}),c),g=(s.onClick=function(){var o=new CrsaContextMenu(null,this.$element);o.add({type:"header",label:"Show only:"}),$.each(l,function(n,e){o.add({label:e.label,action:function(){var e=!(!0===p[n]);m.setFilterOption(e?n:null)},check:!0===p[n]})}),o.add({type:"divider"}),o.add({label:"Clear filter",action:function(){m.setFilterOption(null)}}),o.showForElement(this.$element,null,8)},this.setFilterOption=function(e,n){var o;p=$.extend({},c),e?(o=l[e],p[e]=!0,s.setActive(!0),pinegrow.showMode(o.desc,!0),_(o.label)):(s.setActive(!1),_()),cs_tree.setFilterOptions(p),n||cs_tree.research(!0)},a.$element.appendTo(i),a.$element.find(".pg-button-toolbar-section.icons")),f=((new PgSearchBoxSpacer).$element.appendTo(i),a.onSearch=function(e){var n=new CrsaProfile;e.length?pg$Show(g,"inline-block"):pg$Hide(g),n.show("SEARCH")},pg$Hide(g),$('<div class="pg-tree-filter-msg"><div>Show only: <span></span><i class="close icon icon-close"></i></div></div>').appendTo(i)),_=(pg$Hide(f),f.on("click",function(e){e.preventDefault(),m.setFilterOption(null)}),function(e){e?(f.find("span").html(e),pg$Show(f,"flex"),i.addClass("with-filter-msg")):(pg$Hide(f),i.removeClass("with-filter-msg"))}),d=$("<div/>",{class:"pg-css-panel"}).appendTo(i),u=pgComposerManager.getInstance("PgComposerCSSPanel"),v=(d.append(u.element),this.view=new PgUIView(i,"","CSS Composer")),a=`pg_ct${v.getId()}_`,h=a+"ov",w=a+"ninh",m=(v.classForContainer="pg-tree-panel-container",this),d=(v.tabIcon="icon-Pin11",new PgCSSTreeActiveCommandsView),E=(i.prepend(d.view.get$Element()),d.onStateChanged=function(){k()},v.onShow=function(){},v.on("crsa-rule-selected",function(e,n){v.whenVisible(function(){})}),v.on("crsa-rules-changed",function(e,n){k(),b(r)}),pinegrow.addEventHandler("on_css_node_selected_deselected",e),pinegrow.addEventHandler("on_css_node_deleted",o),pinegrow.addEventHandler("on_css_node_updated",n),pinegrow.addEventHandler("on_css_node_added",t),v.onDestroy=function(){resizeObserver.disconnect(),pinegrow.removeEventHandler("on_css_loaded",H),pinegrow.removeEventHandler("on_selected_elements_changed",k),pinegrow.removeEventHandler("on_page_stylesheets_loaded",b),pinegrow.removeEventHandler("on_css_node_selected_deselected",e),pinegrow.removeEventHandler("on_css_node_deleted",o),pinegrow.removeEventHandler("on_css_node_updated",n),pinegrow.removeEventHandler("on_css_node_added",t),pinegrow.removeEventHandler("on_page_changed",E),pinegrow.removeEventHandler("on_page_loaded",A),pinegrow.removeEventHandler("on_page_refreshed",A),pinegrow.removeEventHandler("on_page_selected",I),pinegrow.removeEventHandler("on_drag_drop_operation_done",T),pinegrow.removeEventHandler("on_page_frameworks_changed",M),pinegrow.removeEventHandler("on_element_isolated",F),i.off("mousemove",onMouseMoved),i.off("mouseleave",onMouseOut),i.off("mouseenter",onMouseIn)},function(e,n,o){}),H=function(e,n){},b=function(e){},S={},y=(["border-spacing","border-collapse","color-adjust","empty-cells","caret-color","font-variant-ligatures","font","caption-side","font-style","list-style-image","color","object-position","font-family","letter-spacing","line-height","font-stretch","font-variant-numeric","rotate","list-style-position","font-size","font-optical-sizing","font-weight","pointer-events","perspective","text-align","overflow-wrap","text-align-last","quotes","list-style-type","image-rendering","word-wrap","text-indent","visibility","font-variant","mix-blend-mode","transform","word-spacing","scale","text-shadow","transform-style","translate","word-break","font-variant-caps","white-space","text-transform","cursor","hyphens","position","z-index"].forEach(function(e){S[e]=!0}),function(e){e.forEach(function(e){e.node.nodes&&e.node.nodes.forEach(function(e){e[w]=!1,e[h]=!1})})}),C=function(e){var o=[];return e.forEach(function(e){var n=!1;e.node.nodes&&e.node.nodes.forEach(function(e){"decl"===e.type&&(e.prop in S?(e[w]=!1,n=!0):e[w]=!0)}),n&&o.push(e)}),o},x=function(e){var n={};e.forEach(function(e){e.node.nodes&&e.node.nodes.forEach(function(e){"decl"===e.type&&(e.prop in n?e.important&&!n[e.prop].important?(n[e.prop][h]=!0,(n[e.prop]=e)[h]=!1):e[h]=!0:(n[e.prop]=e)[h]=!1)})})},P=function(a,d){new CrsaProfile(!0,"getMatchedForStack");pinegrow.pgActiveRules.clear(),pinegrow.pgActiveRules.setPgel(a),pinegrow.pgActiveRules.updateMatchedRules(!0,function(e){var n=pinegrow.pgActiveRules.getActiveNodes(),o=(console.log("BUBI",n),[]);if(n)for(var t={pgel:a,rules:n.inline_rules.map(function(e){return{node:e}}).concat(n.nodes_to_show)},r=(o.push(t),y(t.rules),x(t.rules),n.inherited.forEach(function(e){x(e.data.nodes_to_show);var n=C(e.data.nodes_to_show);n.length&&o.push({pgel:e.pgel,rules:n})}),{}),i=o.length-1;0<=i;i--)o[i].rules.forEach(function(e){e.node.nodes&&e.node.nodes.forEach(function(e){!e.prop||r[e.prop]&&r[e.prop].important&&!e.important||(r[e.prop]=e)})});d(o),console.log("Computed",r)})},k=function(){v.whenVisible(function(){var n,e=pinegrow.selectedElements.getLastSelected();e&&(n=new CrsaProfile(!0,"Show active rules"),P(e,function(e){n.show("Got from devtools"),console.log(e),e.length&&u.setData(e),n.show("Updated composer")}))})},A=function(e){},M=function(e){},F=function(e,n){},I=function(e){r=e},T=function(e,n){};pinegrow.addEventHandler("on_css_loaded",H),pinegrow.addEventHandler("on_selected_elements_changed",k),pinegrow.addEventHandler("on_page_stylesheets_loaded",b),pinegrow.addEventHandler("on_page_changed",E),pinegrow.addEventHandler("on_page_loaded",A),pinegrow.addEventHandler("on_page_refreshed",A),pinegrow.addEventHandler("on_page_selected",I),pinegrow.addEventHandler("on_drag_drop_operation_done",T),pinegrow.addEventHandler("on_element_isolated",F),pinegrow.addEventHandler("on_page_frameworks_changed",M),this.onSelected=function(e){},this.onDeselected=function(e){}};