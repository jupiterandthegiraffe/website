var PgUISection=function(e,t,o,s,i,n){var c,l,h=this;this.name=e,this.category=t,this.parent=null,null==s&&(s=!1),this.key="sec_open_"+escapeHtmlCode(e).replace(/"/g,"").replace(/'/g,"")+"_"+(t?escapeHtmlCode(t):""),this.sec_def=o||{},this.options=n||{},this.sec_def.hasOwnProperty("closed")||((c=this.key)in localStorage?this.sec_def.closed="1"!=localStorage[c]:"default_closed"in this.sec_def?this.sec_def.closed=this.sec_def.default_closed:this.sec_def.closed=s),this.is_closable=void 0===this.sec_def.is_closable||this.sec_def.is_closable,this.open=!this.sec_def.closed||!this.is_closable,"closed"===i?this.open=!1:i&&(this.open=!0),this.originalHeight=null,this.$element=$(`<div class="pg-ui-section ${this.sec_def.section_class||""}" data-key="${this.key}"><h2 class="section-title"><span>`+this.name+"</span>"+(this.category?"<small>"+this.category+"</small>":"")+'<i class="icon icon-right closed"></i><i class="icon icon-down opened"></i></h2></div>'),this.is_closable||(this.open=!0,this.$element.find(".icon.closed, .icon.opened").remove()),this.$content=$('<div class="pg-ui-section-content"></div>').appendTo(this.$element),this.$title=this.$element.find("h2"),crsaHandleExternalLinks(this.$title),this.open||(this.$content.hide().css("height",0),this.$element.addClass("section-closed")),this.onOpenClosed=null,o&&o.pinnable?(this.$element.find(".icon").remove(),(c=$('<i class="icon pin-close icon-Pin pin"></i>').appendTo(this.$title)).on("click",function(e){e.preventDefault();var t=$(e.target);t.hasClass("pin")?(h.onPin&&h.onPin(h),t.removeClass("pin icon-Pin").addClass("icon-close")):(h.onClose&&h.onClose(h),t.addClass("pin icon-Pin").removeClass("icon-close"))}),o.pinned&&c.removeClass("pin icon-Pin").addClass("icon-close")):this.is_closable&&(c=this.$element.find(">h2").on("click",function(e){e.preventDefault(),e.altKey&&h.parent?h.parent.openCloseAll(!h.open):h.openClose(!h.open)}),l="Click to open / close. "+pgShowKbd("ALT")+" + click to open / close all sections.",o&&o.collapse_tooltip&&(l=o.collapse_tooltip),n&&n.tooltip&&(l=n.tooltip+"<br>"+l),addTooltip(c.find("span,.icon"),l)),o&&o.on_created&&o.on_created(this)},PgUISectionGrid=(PgUISection.prototype.detach=function(e){this.$element.detach()},PgUISection.prototype.appendTo=function(e){this.$content.append(e)},PgUISection.prototype.setTitle=function(e){this.$title.find(">span").html(e)},PgUISection.prototype.toggle=function(e,t){this.open=!this.open;var o=this.$content;!this.originalHeight&&this.open&&(this.originalHeight=o.css("height","auto").show().outerHeight(),o.hide().css({height:0})),this.open?t?(o.show().css({height:this.originalHeight}),e&&e()):o.show().animate({height:this.originalHeight},{duration:250,complete:function(){o.height("auto"),e&&e()}}):t?(o.hide().css({height:0}),e&&e()):o.animate({height:0},{duration:250,complete:function(){o.hide(),e&&e()}}),this.onOpenClosed&&this.onOpenClosed(this.open)},PgUISection.prototype.forceOpen=function(){this.open||this.toggle(null,!0)},PgUISection.prototype.forceClose=function(){this.open&&this.toggle(null,!0)},PgUISection.prototype.show=function(){this.$element.show()},PgUISection.prototype.hide=function(){this.$element.hide()},PgUISection.prototype.openClose=function(e,t){var o=this;this.open!=e&&o.toggle(function(){o.open?(o.$element.removeClass("section-closed"),o.sec_def&&(o.sec_def.closed=!1,localStorage[o.key]="1")):(o.$element.addClass("section-closed"),o.sec_def&&(o.sec_def.closed=!0,localStorage[o.key]="0")),o.options.onOpenClose&&o.options.onOpenClose(o.$element,o.open)},t)},PgUISection.prototype.setHasData=function(e){e?this.$element.addClass("has-data"):this.$element.removeClass("has-data")},PgUISection.prototype.scrollTo=function(e){void 0===e&&(e=!0);var t=this;pgScrollToItemInContainer(this.$element,this.parent.$element,e,!0,function(){pg$Flash(t.$element,"bck_flash")})},function(){this.sections=[],this.$element=$('<div class="pg-grid"></div>'),this.$columns,this.minWidth=280,this.maxWidth=4e4,this.prevW=0,this.prevH=0,this.num_columns=0,this.new_section_id=0,this.fit=!1,this.fastdom_key=pgGetFastdomTasks(this.$element.get(0)).getUniqueKey(),this._sectionChromeH=14+30+4+12+3-14-3});PgUISectionGrid.prototype.openCloseAll=function(t){this.sections.forEach(function(e){e.openClose(t)})},PgUISectionGrid.prototype.popSection=function(){var e=this.sections.pop();return e.parent=null,e},PgUISectionGrid.prototype.addSection=function(e){this.sections.push(e),e.parent=this},PgUISectionGrid.prototype.addSectionAt=function(e,t){this.sections.splice(t,0,e),e.parent=this},PgUISectionGrid.prototype.clear=function(){this.sections.forEach(function(e){e.detach()}),this.$columns&&this.$columns.remove(),this.$columns=null,this.sections=[],this.num_columns=0,pgGetFastdomTasks(this.$element.get(0)).stopAll(this.fastdom_key)},PgUISectionGrid.prototype.newSectionAdded=function(){var e=this.sections;this.clear(),this.sections=e},PgUISectionGrid.prototype.updateLayout=function(e,t){var o=1?pgGetFastdomTasks(this.$element.get(0)).createDummy():pgGetFastdomTasks(this.$element.get(0)).create(this.fastdom_key),d=this;o.measure(function(){var l=e||d.$element.width()-12,h=t||d.$element.height(),a=Math.floor(l/d.minWidth),p=((a=d.sections.length<a?d.sections.length:a)<1&&(a=1),d.onGetNumberOfColumns&&(a=d.onGetNumberOfColumns(l,h,d.sections.length,a)),l/a);l===d.prevW&&h===d.prevH&&d.num_columns===a||(d.prevW=l,d.prevH=h,o.mutate(function(){var e=[];if(d.num_columns!=a){for(var t=0;t<a;t++){var o=$('<div class="pg-grid-col"></div>');e.push(o.get(0));for(var s=t;s<d.sections.length;s+=a)o.append(d.sections[s].$element)}d.$columns&&d.$columns.remove(),d.$columns=$(e),d.$columns.appendTo(d.$element),d.num_columns=a}var i,n,c=100/(1*a);Math.round(l/a);d.$columns.each(function(e,t){$(t).css({"max-width":c+"%",flex:"0 0 "+c+"%"})}),p<360?d.$element.get(0).classList.add("pg-grid-narrow"):d.$element.get(0).classList.remove("pg-grid-narrow"),d.fit&&(n=Math.ceil(d.sections.length/a),(i=Math.floor((h-n*d._sectionChromeH)/n))<(n=80)&&(i=n),d.sections.forEach(function(e){e.$content.css("height",i)})),d.sections.forEach(function(e){e.onLayoutChanged&&e.onLayoutChanged()})}))})},PgUISectionGrid.prototype.destroy=function(){this.clear(),this.$element.remove()};