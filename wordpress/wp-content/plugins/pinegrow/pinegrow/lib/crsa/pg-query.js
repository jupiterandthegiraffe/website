function getElementPgId(t){var e;return t&&0!==t.length&&1===(e=t.get(0)).nodeType?e.getAttribute("data-pg-id"):null}function getElementPgNode(t,e){var r=getElementPgId(t);if(r)return getPgNodeByPgId(r);if(t&&!e){r=getCrsaPageForIframe(getIframeOfElement(t));if(r)return r.registerDynamicElement(t.get(0))}return null}function getDomElementPgNode(t){var e=t.getAttribute("data-pg-id");return e?getPgNodeByPgId(e):null}function getPgNodeByPgId(t){return pgParserNodeCatalogueInstance.get(t)}var getPgNodeForTextNode=function(t){for(var e,r=-1,i=0;i<t.parentNode.childNodes.length;i++)if(t==t.parentNode.childNodes[i]){r=i;break}return!(r<0)&&(e=getElementPgNode($(t.parentNode)))&&(e=e.getChildAtPos(r)).textNode?e:null};function pgFindUniqueSelectorForElement(t,e,r){if((r=r||{id:!0,tag:!0,class:!0,path:!0}).id){var i=t.getAttr("id");if(i)return"#"+i}if(t==e)return"self";if(r.tag&&1==e.find(t.tagName).length)return t.tagName;if(r.class)for(var n=t.getClasses(),s=0;s<n.length;s++)if(!n[s].match(/col\-|text\-|[0-9]/)&&1==e.find("."+n[s]).length)return"."+n[s];if(r.path){for(var l,o="",h=t;h&&h!=e;)o=1==h.parent.find(h.tagName,!1,!0).length?">"+h.tagName+o:(l=h.parent.getChildPos(h,!0),">"+h.tagName+":nth-child("+(l+1)+")"+o),h=h.parent;if(o)return o}return null}function pgRemovePgIdsFromCode(t){return t.replace(/\s*data\-pg\-id="[^"]*"/g,"")}function pgCompareNodes(t,e){if(t.children.length!==e.children.length)return!1;if(t.tagName!==e.tagName||t.closingTag!==e.closingTag||t.closed!==e.closed)return!1;if(t.content!==e.content||t.comment!==e.comment)return!1;if(t.isElement!==e.isElement)return!1;if(t.selfClosed!==e.selfClosed)return!1;if(t.isElement){var r=t.getAttrList(),i=e.getAttrList();if(r.length!==i.length)return!1;for(var n=0;n<r.length;n++)if(r[n].name!==i[n].name||r[n].value!==i[n].value||r[n].quote!==i[n].quote)return!1}else if((t.comment||e.comment)&&t.attributes!==e.attributes)return!1;for(n=0;n<t.children.length;n++)if(!pgCompareNodes(t.children[n],e.children[n]))return!1;return!0}function pgFindChangedNodes(t,e,r){if(pgCompareNodes(t,e))return null;for(var i=[],n=[],s=0;s<t.children.length;s++)t.children[s].textNode&&t.children[s].isTextContentEmpty()||i.push(t.children[s]);for(s=0;s<e.children.length;s++)e.children[s].textNode&&e.children[s].isTextContentEmpty()||n.push(e.children[s]);if(i.length!==n.length)r.push({original:t,changed:e});else{for(var l=!1,s=0;s<i.length;s++)pgFindChangedNodes(i[s],n[s],r)&&(l=!0);l&&t.tagName===e.tagName&&t.closingTag===e.closingTag&&t.content===e.content&&t.getAttributesString(pgGetAttributesStringFilterOutPgIds)===e.getAttributesString(pgGetAttributesStringFilterOutPgIds)||r.push({original:t,changed:e})}return!0}function pgFindChangedNodesInPage(t,e){var r=new CrsaProfile(!0),i=new pgParser,n="string"==typeof t?(i.parse(t),i.rootNode):t,i="string"==typeof e?(i.parse(e),i.rootNode):e,s=(r.show("Find nodes parse"),[]);if(pgFindChangedNodes(n,i,s),s.length)for(var l=0;l<s.length;l++)(h=s[l]).original.isElementOrScript&&h.changed.isElementOrScript||!h.original.parent||!h.changed.parent||(h.original=h.original.parent,h.changed=h.changed.parent);r.show("Find nodes");for(var o=[],l=0;l<s.length;l++){for(var h=s[l],g=!1,a=!1,u=0;u<o.length;u++)if(h.original===o[u].original){a=!0;break}if(!a){for(var p=0;p<s.length;p++)if(h.original.isDescendantOf(s[p].original)){g=!0;break}g||o.push(h)}}return s=o}function pgNodeContainsDynamic(t){function r(t){if(1!=t.nodeType)return!1;if(t.hasAttribute("data-pg-inline-edit-remove"))return t.parentNode.removeChild(t),!1;if(getElementPgId($(t))){for(var e=0;e<t.childNodes.length;e++)if(1==t.childNodes[e].nodeType&&r(t.childNodes[e]))return!0;return!1}return!t.classList.contains("pinegrow-ui-helper")}return r(t.get(0))}function pgFindDynamicDiffs(t,e){var r=e.get(0).outerHTML,r=removeCrsaClassesFromHtml(r),i=new pgParser,n=(i.assignIds=!1,{}),s=(t.walkSelfAndChildren(function(t){var e=t.getId();return e&&(n[e]=t),!0}),!1);return i.parse(r),i.rootNode.walk(function(t){var e;return t.dynamic=!1,t.dynamic_attributes=[],t.dynamic_content=!1,t.shouldHaveId()&&((e=t.getId())&&n[e]?n[e].html()!=t.html()&&(t.dynamic_content=!0,s=!0):(t.dynamic=!0,s=!0)),!0}),s?i:null}function pgDescribeDynamicDiffs(t){var e=t.rootNode.toString(null,!0,!1,function(t,e,r){return"node"==r?e=t.dynamic?'_###span class="dynamic"###_'+e+"_###/span###_":'_###span class="static"###_'+e+"_###/span###_":"content"==r&&t.dynamic_content&&(e='_###span class="dynamic_content"###_'+e+"_###/span###_"),e}),e=pinegrow.formatHtml(e);return escapeHtmlCode(e).replace(/_###/g,"<").replace(/###_/g,">")}function pgInsertNodeAtDOMElementLocation(t,e){var r=e.prev();if(0==r.length){var i=getElementPgNode(e.parent());if(i)i.prepend(t);else{i=e.next();if(!i.length)return!1;i=getElementPgNode(i);if(!i)return!1;t.insertBefore(i)}}else{i=getElementPgNode(r);if(!i)return!1;t.insertAfter(i)}return!0}var pgReindentText=function(t,e,r){e=e||"",void 0===r&&(r=e);for(var i=t.split("\n"),n=/^\s+/,s=999999999,l=0;l<i.length;l++){var o=i[l].match(n);if(o){o=o[0].length;o==i[l].length?i[l]="":o<s&&(s=o)}else if(0<i[l].length){s=0;break}}for(var h=1<i.length,g=i.length-1,l=0;l<i.length;l++)h&&l==g?i[l]=r+i[l].substr(s):0<l&&(i[l]=e+i[l].substr(s));return t=i.join("\n")},pgNodeDomElementPair=function(t,e){t&&t.length&&(this.el=t.get(0),this.pgel=e||(t?getElementPgNode(t):null)),this.equal=function(t){return this.el==t}},pgQuery=function(t){var r=this;"array"==typeof t?this.list=t:t?t instanceof pgNodeDomElementPair?this.list=[t]:(this.list=[],t.each(function(t,e){r.add(new pgNodeDomElementPair($(e)))})):this.list=[],this.length=this.list.length};pgQuery.prototype.create=function(t,e){var r=pgCreateNodeFromHtml(t);return this.createFromPgNode(r,e),this},pgQuery.prototype.createFromPgNode=function(t,e){var r=e?e.getViewHTMLForElement(t):t.toStringWithIds(),i=$(r);return!i.length&&r.length&&(i=$(document.createTextNode(r))),this.add(new pgNodeDomElementPair(i,t)),this},pgQuery.prototype.add=function(t){return this.list.push(t),this.length=this.list.length,this},pgQuery.prototype.get=function(t){return t>=this.list.length?null:this.list[t]},pgQuery.prototype.$get=function(t){return t>=this.list.length?$():$(this.list[t].el)},pgQuery.prototype.each=function(t){for(var e=0;e<this.list.length&&!1!==t(e,this.list[e]);e++);return this},pgQuery.prototype.indexOfElement=function(t){for(var e=0;e<this.list.length;e++)if(this.list[e].el==t)return e;return-1},pgQuery.prototype.find=function(r){var i=new pgQuery;return this.each(function(t,e){$(e.el).find(r).each(function(t,e){i.indexOfElement(e)<0&&i.add(new pgNodeDomElementPair($(e)))})}),i},pgQuery.prototype.is=function(t){return 0<this.length&&this.$get(0).is(t)},pgQuery.prototype.closest=function(r){var i=new pgQuery;return this.each(function(t,e){$(e.el).closest(r).each(function(t,e){i.indexOfElement(e)<0&&i.add(new pgNodeDomElementPair($(e)))})}),i},pgQuery.prototype.parent=function(){var r=new pgQuery;return this.each(function(t,e){$(e.el).parent().each(function(t,e){r.indexOfElement(e)<0&&r.add(new pgNodeDomElementPair($(e)))})}),r},pgQuery.prototype.requireNode=function(t){if(!t.pgel)throw new pgParserException("DOM Element has no PG node",t.el)},pgQuery.prototype.attr=function(t,e){for(var r=0;r<this.list.length;r++){if(void 0===e)return this.requireNode(this.list[r]),pgDecodeAttribute(this.list[r].pgel.getAttr(t));this.requireNode(this.list[r]),e=this.list[r].pgel.setAttr(t,e),this.list[r].el.setAttribute(t,e)}return void 0===e?null:this},pgQuery.prototype.removeAttr=function(t){for(var e=0;e<this.list.length;e++)this.requireNode(this.list[e]),this.list[e].pgel.removeAttr(t),this.list[e].el.removeAttribute(t);return this},pgQuery.prototype.hasAttr=function(t){var e=0;return e<this.list.length&&(this.requireNode(this.list[e]),this.list[e].pgel.hasAttr(t))},pgQuery.prototype.getInlineStylePropertyValue=function(t,e){var r=0;return r<this.list.length?(this.requireNode(this.list[r]),this.list[r].pgel.getInlineStylePropertyValue(t,e)):null},pgQuery.prototype.setInlineStylePropertyValue=function(t,e,r){r&&pinegrow.getProxyUrl(e);for(var i=0;i<this.list.length;i++){this.requireNode(this.list[i]),this.list[i].pgel.setInlineStylePropertyValue(t,e,r);var n=r?pinegrow.getProxyUrl(e):e,n=crsaSetInlineStylePropertyValue(this.list[i].el.getAttribute("style"),t,n,r);n?this.list[i].el.setAttribute("style",n):this.list[i].el.removeAttribute("style")}return this},pgQuery.prototype.val=function(t){for(var e=0;e<this.list.length;e++){if(void 0===t)return $(this.list[e].el).val();$(this.list[e].el).val(t)}return this},pgQuery.prototype.html=function(t){for(var e=0;e<this.list.length;e++){if(void 0===t)return this.list[e].pgel.html();this.requireNode(this.list[e]),this.list[e].pgel.html(t),$(this.list[e].el).html(this.list[e].pgel.html(null,!0))}return this},pgQuery.prototype.text=function(t){for(var e=0;e<this.list.length;e++){if(void 0===t)return this.list[e].pgel.text();this.list[e].pgel.html(t),$(this.list[e].el).text(this.list[e].pgel.toStringWithIds())}return this},pgQuery.prototype.append=function(t){for(var e=0;e<this.list.length;e++){this.requireNode(this.list[e]);for(var r=0;r<t.length;r++)this.requireNode(t.list[r]),this.list[e].pgel.append(t.list[r].pgel),$(this.list[e].el).append(t.list[r].el)}return this},pgQuery.prototype.prepend=function(t){for(var e=0;e<this.list.length;e++){this.requireNode(this.list[e]);for(var r=0;r<t.length;r++)this.requireNode(t.list[r]),this.list[e].pgel.prepend(t.list[r].pgel),$(this.list[e].el).prepend(t.list[r].el)}return this},pgQuery.prototype.insertBefore=function(t){for(var e=0;e<this.list.length;e++){this.requireNode(this.list[e]);for(var r=0;r<t.length;r++)this.requireNode(t.list[r]),this.list[e].pgel.insertBefore(t.list[r].pgel),$(this.list[e].el).insertBefore(t.list[r].el)}return this},pgQuery.prototype.insertAfter=function(t){for(var e=0;e<this.list.length;e++){this.requireNode(this.list[e]);for(var r=0;r<t.length;r++)this.requireNode(t.list[r]),this.list[e].pgel.insertAfter(t.list[r].pgel),$(this.list[e].el).insertAfter(t.list[r].el)}return this},pgQuery.prototype.hasClass=function(t){var e=0;return e<this.list.length&&(this.requireNode(this.list[e]),this.list[e].pgel.hasClass(t))},pgQuery.prototype.addClass=function(t){for(var e=0;e<this.list.length;e++)this.requireNode(this.list[e]),this.list[e].pgel.addClass(t),$(this.list[e].el).addClass(t);return this},pgQuery.prototype.removeClass=function(t){for(var e=0;e<this.list.length;e++)this.requireNode(this.list[e]),this.list[e].pgel.removeClass(t),$(this.list[e].el).removeClass(t);return this},pgQuery.prototype.replaceTag=function(t){for(var e=new pgQuery,r=0;r<this.list.length;r++){this.requireNode(this.list[r]),this.list[r].pgel.replaceTag(t);var i,n=$(this.list[r].el),s={};$.each(this.list[r].el.attributes,function(t,e){s[e.nodeName]=e.nodeValue}),n.replaceWith(function(){return i=$("<"+t+"/>",s).append(n.contents())}),e.add(new pgNodeDomElementPair(i))}return e},pgQuery.prototype.replaceWith=function(t,e){t instanceof pgQuery&&(t=t.get(0));var r=0;return r<this.list.length&&(this.requireNode(this.list[r]),this.list[r].pgel.replaceWith(t.pgel,e),$(this.list[r].el).replaceWith(t.el)),this},pgQuery.prototype.remove=function(){for(var t=0;t<this.list.length;t++)this.requireNode(this.list[t]),this.list[t].pgel.remove(),$(this.list[t].el).remove();return this},pgQuery.prototype.detach=function(){for(var t=0;t<this.list.length;t++)this.requireNode(this.list[t]),this.list[t].pgel.detach(),$(this.list[t].el).detach();return this},pgQuery.prototype.contents=function(){for(var r=new pgQuery,t=0;t<this.list.length;t++){var e=this.list[t];$(e.el).children().each(function(t,e){r.indexOfElement(e)<0&&r.add(new pgNodeDomElementPair($(e)))})}return r};