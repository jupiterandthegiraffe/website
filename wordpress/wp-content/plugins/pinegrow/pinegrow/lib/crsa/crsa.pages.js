var crsaPageUid=1,CrsaPageTemplate=function(){this.type=null,this.header=null,this.html=null,this.detect=function(e){var t;return 0==e.indexOf("---")&&!((t=e.split("---")).length<3||(this.type="liquid",this.header="---"+t[1]+"---",t.splice(0,2),this.html=1==t.length?t[0]:t.join("---"),0))},this.getTemplateSource=function(e){return this.type?this.header+"\n"+e:e},this.getHtml=function(){return this.html}},pgDefaultClassSetter={class_setter_info:null,canAddClass:async function(e,t){return!0},hasClass:function(e,t){return e.hasClass(t)},addClass:function(e,t,r){e.addClass(t,r)},removeClass:function(e,t,r){e.removeClass(t,r)},canRemoveClass:function(e,t){return e.canRemoveClass(t)},getClasses:function(e){return e.getClasses()}},CrsaPage=function(not_interactive){this.url=null,this.wrapper_url=null,this.wrapper_selector=null,this.name=null,this.localFile=null,this.localFileWatcher=null,this.lastSavedAt=0,this.$iframe=null,this.$page=null,this.activeView=null,this.visible=!0,this.loading=!1,this.changed=!0,this.force_close=!1,this.live_update=null,this.save_parent=!1,this.uid=crsaPageUid++,this.undoHistory=new PgUndoHistory(this),this.webapp=!1,this.exists=!1,this.crsaProjectTemplate=null,this.allowReload=!1,this.readOnly=!1,this.treeTop=null,this.treeRepaintOnShow=null,this.treeCurrentRoot=null,this.load_source=null,this.frameworks_added=0,this.breakpoints=[],this.openedInEditor=!0,this.onlyCode=!1,this.code=null,this.isBackgroundPage=!1,this.data={},this.firstLoad=!0,this.tree=new PgPageTree(this),this.currentFrameworkHandlerReturnValues={},this.sourceNode=null,this.selected_element_pgid=null,this.scrollMode=!0,this.deviceWidth=1024,this.zoom=1,this.template=new CrsaPageTemplate,this.frameworks=[],this.animationsStopped=!1,this.javascriptEnabled="1"==pinegrow.getSetting("javascript-enabled","1"),this.assetsCache={},this.delayedTasks=new PgDelayedTasks,this.show_head_in_tree=!1,this.externalWindow=null,this.mappedRemote=!1,this.mappedRemoteFirstSave=!1,this.classSetter=pgDefaultClassSetter,this.default_wrapper_selector=".entry-content,.content,.post,.page,article,main,body",this.handleWrapperOnPageLoad=function(i,t){var a,n,s,o=this,l=t||o;pinegrow.getCurrentProject()?(a=function(e){t?pinegrow.showAlert(`<p>Unable to load the preview page <code>${l.wrapper_url}</code>. The error is "${e.toString()}".</p><p>Select another preview and selector or disable the preview.</p>`,"Unable to display the preview page",null,"Close"):pinegrow.showPageWrapperDialog(l.url,`<div class="alert alert-info"><p>Unable to load the wrapper page <code>${l.wrapper_url}</code>. The error is "${e.toString()}".</p><p>Select another wrapper page or disable the wrapper.</p></div>`,!0,o),l.wrapper_node=null},this.default_wrapper_selector,n=pinegrow.getCurrentProjectInfo(),l.wrapper_url?(s=l.wrapper_url,isApp()||pgSetCookie("pinegrow-no-admin-bar","1",1e4),pgFetchRemoteContent(s,{pg_timeout:1e5,pg_max_size:1e7}).then(function(e){try{if(void 0===e)throw"Error getting remote file "+s;r=(new TextDecoder).decode(e)}catch(e){return r="Error getting remote file "+s+e,a(e),pgRemoveCookie("pinegrow-no-admin-bar"),void i("done")}isApp()||pgRemoveCookie("pinegrow-no-admin-bar");var t=new pgParser,r=(t.assignIds=!1,t.parse(r),l.wrapper_node=t.rootNode,l.wrapper_selector||o.default_wrapper_selector);r&&"auto_detect"===r&&(t={selector:""},pinegrow.dispatchEvent("on_auto_detect_wrapper_selector",o,t),r=t.selector||o.default_wrapper_selector),(r="blocks_in_content"===r?o.default_wrapper_selector:r)&&0<=r.indexOf("_replace")&&(r=r.replace("_replace","")),l.wrapper_node.findOneKeepFindOrder(r)||a(`The element with the selector <code>${r}</code> can not be found on the page.`),n.setSettingForUrl(o.url,"open-with-wrapper",!!l.wrapper_node),n.save(),i("done")}).catch(function(e){console.log("Error getting remote file "+s,e),a(e),i("done")})):(pgf.use_page_wrappers&&(n.setSettingForUrl(o.url,"open-with-wrapper",!1),n.save()),i("done"))):i("done")},this.getHTMLNodeForBrowserWithSupportForWrapper=async function(i,a){var f=this,m=i,n=a||f;return new Promise(async function(e,t){var c,o,l,h,d,r,u,p,g;await new Promise(function(e){n.did_handle_wrapper_loading?e():f.handleWrapperOnPageLoad(function(){e()},a)}),n.wrapper_node&&(m=m.clone(!0,!0),c=n.wrapper_url,o=n.wrapper_node.clone(!0),l=n.wrapper_selector||f.default_wrapper_selector,h="prepend",d="",l&&"auto_detect"===l&&(r={selector:"",content_selector:d},pinegrow.dispatchEvent("on_auto_detect_wrapper_selector",f,r),l=r.selector||f.default_wrapper_selector),l&&0<=l.indexOf("_replace")&&(l=l.replace("_replace",""),h="replace"),"blocks_in_content"===l&&(l=f.default_wrapper_selector,d="[cms-block]"),u=o.findOneKeepFindOrder(l))&&(p=[],g=[],u.withoutEvents(function(){"body"===l&&"replace"===h||(u.setAttribute("data-pg-wrapper","true"),u.walk(function(e){return e.isElement&&e.setAttribute("data-pg-wrapper-el"),!0}));var e=m.findOne("body"),r=(e.children.forEach(function(e){var t;e.isElement&&("script"===e.tagName?(t=e.getAttribute("src")||e.getAttribute("data-pg-script-src"))&&null!==o.findOne(`script[src="${t}"]`)||p.push(e):g.unshift(e))}),d&&(g=[],(n=new PgCollection).setList(m.find(d)),n.normalize(),n.forEachElement(function(e){g.push(e)})),[]);function t(e){var t=o.findOneIncludingSelf(e),r=m.findOneIncludingSelf(e);t&&r&&t.setAttribute("data-pg-id",r.getId())}var i,a,n=m.findOne("head"),s=(n&&(i=o.findOne("head"),n)&&i&&(a=i.find('link[rel="stylesheet"]'),n.find('style,link[rel="stylesheet"]').forEach(function(e){var t=function(t,r){var i=pinegrow.getCurrentProject();if(t){t=crsaRemoveUrlParameters(t);i=i.getRelativeUrl(f.makeAbsoluteUrl(t));let e=null;try{e=new URL(i,c).toString()}catch(e){}for(var a=0;a<r.length;a++){var n=r[a],s=n.getAttribute("href");if(s){s=crsaRemoveUrlParameters(s);try{var o=crsaIsAbsoluteUrl(s)?s:new URL(s,c).toString(),l=new RegExp(`/wp-content/themes/[^/]+/${escapeRegExp(t)}$`,"i");if(t===s||e===s||t===o||e===o||o.match(l))return n}catch(e){continue}}}}return!1}(e.getAttribute("href")||e.getAttribute("data-pg-script-src"),a);r.push(e),t&&t.remove()}),n=i.findOne("base"))&&(c=n.getAttribute("href")||c),t("html"),t("head"),o.findOne("body"));s.setAttribute("data-pg-id",e.getId()),e.getClasses().forEach(function(e){s.hasClass(e)||s.addClass(e)}),e.getAttrList().forEach(function(e){s.hasAttribute(e.name)||s.setAttribute(e.name,e.value)}),o.goThroughAllUrls(function(e,t,r){try{crsaIsAbsoluteUrl(e)||(e=new URL(e,c).toString())}catch(e){}return e}),r.forEach(function(e){i.append(e)}),"replace"===h&&u.children.slice().forEach(function(e){"script"!==e.tagName&&e.remove()}),g.forEach(function(e){u.prepend(e)}),p.forEach(function(e){s.append(e)})}),i=o),e(i)})},this.stylesheets=null,this.setStylesheets=function(e){this.stylesheets=e},this.getStylesheets=function(e){return this.stylesheets||!this.openedInEditor||e?this.stylesheets:(this.updateStylesheetsList(),new CrsaPageStyles(this))},this.getAttachedStylesheets=function(e){return this.stylesheets?this.stylesheets.getList(e):[]},this.hasAttachedStylesheetWithUrl=function(e){for(var t=this.getAttachedStylesheets(),r=0;r<t.length;r++)if(t[r].url&&t[r].url===e)return t[r];return null},this.getPageLibs=function(){var r=[];return this.frameworks.forEach(function(t){t.getPageLibs().forEach(function(e){e.framework=t,r.push(e)})}),this.callFrameworkHandler("on_get_page_libs",r),r.forEach(function(e){e.dynamic=!0}),r},this.setUrl=function(e){this.url=pgDecodeUrl(e)},this.isRemote=function(){return this.url&&!crsaIsFileUrl(this.url)},this.isNew=function(){return!this.localFile&&(!this.isRemote()||this.pageIsRemoteTemplate)},this.getName=function(){return this.tab_name||this.name},this.scrollToHash=function(t){pageViews.forEach(function(e){e.scrollToHash(t)})};var dynamicPgels=[],pageViews=(this.registerDynamicElement=function(e){if(this.wrapper_node&&!e.closest("[data-pg-id]"))return null;for(var t=$(e),r=e.tagName.toLowerCase(),i="<"+r,a=[],n=0;n<e.attributes.length;n++){var s,o,l=e.attributes[n];l.specified&&(s=l.name,null!==l.value&&void 0!==l.value&&(s+="="+(o=0<=l.value.indexOf('"')?`'`:`"`)+l.value+o),a.push(s))}a.length&&(i+=" "+a.join(" ")),0<=pgSingleTags.indexOf(r)?i+=">":i+=`></${r}>`;r=new pgParser,r.assignIds=!0,r.parse(i),i=r.rootNode.children[0];return i.dynamic=!0,i.page=this,i.document=this.sourceNode,(i.$el=t).attr("data-pg-id",i.getId()),dynamicPgels.push(i),i},[]),_this=(this.addPageView=function(e){pageViews.push(e)},this.removePageView=function(e){var t=pageViews.indexOf(e);0<=t&&pageViews.splice(t,1)},this.getPageViews=function(){return pageViews},this.getPageViewOf$DOMElement=function(e,t){if(t=t||getIframeOfElement(e))for(var r=0;r<pageViews.length;r++)if(t.get(0)==pageViews[r].get$Iframe().get(0))return pageViews[r];return null},this.getPageViewById=function(e){for(var t=0;t<pageViews.length;t++)if(pageViews[t].getId()==e)return pageViews[t];return null},this.closePageView=function(e){var t=pageViews.indexOf(e);0<=t&&pageViews.splice(t,1)},this.get$Iframes=this.getPageView$Iframes=function(){return pageViews.map(function(e){return e.get$Iframe()})},this.showInExternalWindow=function(){var e=require("nw.gui"),t=(this.externalWindow=e.Window.open("empty.html",{focus:!0}),this.externalWindow.on("close",function(){_this.externalWindow.close(!0),_this.externalWindow=null}),this.externalWindow.setAlwaysOnTop(!0),!1);this.externalWindow.on("loaded",function(){var e;t||(_this.allowReload=!0,e=$(_this.externalWindow.window.document.body),_this.$page.appendTo(e.find("#win-content")),t=!0)})},this.fromFile=function(e,t,r){void 0===t&&(t=!1);var i=isApp()?crsaMakeUrlFromFile(e):e,i=(this.setUrl(i),this.name=crsaGetNameFromUrl(this.url),this.localFile=e,this.visible=!1,this.changed=!1,this.exists=!0,this.openedInEditor=!1,this.onlyCode=t,new CrsaProfile(!0)),a=pinegrow.getCurrentProject();if(a&&a.loaded_from_backend)n=a.getContentOfUrl(this.url);else{var a=require("fs");try{var n=a.readFileSync(e).toString("utf8")}catch(e){n=""}}t?this.code=n:((a=new pgParser).assignIds=!1,a.nodeCatalogue=null,a.parse(n),this.sourceNode=a.rootNode,this.callGlobalFrameworkHandler("on_page_parsed_in_proxy",this.sourceNode,this.url),i.show("FROM FILE PARSE "+this.localFile)),r&&this.setLocalFile(this.localFile)},this.getCodeForSave=function(){return this.getCode("1"==pinegrow.getSetting("keep-collapsed","0"),!0)},this.getCode=function(e,t){return this.onlyCode?this.code:this.sourceNode.toStringForCodeEditorOrSave(this,t,e)},this.setCode=function(e,t,r){var i,a=pinegrow.getCurrentProject();this.onlyCode?(this.code=e,a&&a.loaded_from_backend&&a.setContentOfUrl(this.url,e),pinegrow.dispatchEvent("on_only_code_page_changed",this)):(a=t&&this.sourceNode?this.sourceNode.toStringWithIds(!0):null,i=e instanceof pgParserNode?e:((i=new pgParser).assignIds=!0,i.parse(e),i.rootNode),this.sourceNode&&this.sourceNode.withoutEvents(function(){_this.sourceNode.remove()}),this.sourceNode=i,t&&(i=new PgNodeEvent(this.sourceNode,"setCode",null,{oldValue:a},this),a=new PgUndoEvent(i),pinegrow.undoManager.getHistoryForPage(this).addEvent(a),r||pinegrow.changeManager.didChange(this.sourceNode,t.action||"Set code",t,this)))},this.addPageStateToUndoHistory=function(e){var t=new PgNodeEvent(this.sourceNode,"setCode",null,{oldValue:e},this),t=new PgUndoEvent(t);pinegrow.undoManager.getHistoryForPage(this).addEvent(t)},this.setLocalFile=function(e){var t=pinegrow.getCurrentProject(),t=!t||!t.loaded_from_backend;t&&this.stopWatchingFileForChanges(),this.localFile=e,t&&this.watchFileForChanges()},this.setJavascriptEnabled=function(e){this.javascriptEnabled!=e&&(this.javascriptEnabled=e,this.refresh())},this.hasScripts=function(e){return void 0===e&&(e=4),this.sourceNode.find("script").length>=e},this.makeRelativeUrl=function(e){return crsaMakeLinkRelativeTo(e,crsaMakeUrlAbsolute(_this.url))},this.makeAbsoluteUrl=function(e){return crsaIsAbsoluteUrl(e)?e:require("url").resolve(this.url,e)},this.watchFileOnFileChanged=function(e,t){function r(e){var t=_this.applyChangesToSource(e,!1,!1,!0);t.updated?(crsaQuickMessage("Auto refreshed!"),t.changes&&1==t.changes.length&&t.replace_selected.forEach(function(e){pinegrow.selectedElements.replace(e.old_pgel,e.new_pgel)})):t.changes&&!t.update&&(pinegrow.selectedElements.cleanDeleted(),_this.refreshWithUpdateStylesheets()),_this.setPageChanged(!1),_this.callFrameworkHandler("on_page_loaded_from_external")}var i,a=require("fs");e.mtime>t.mtime&&!_this.live_update&&"1"==pinegrow.getSetting("auto-reloading","1")&&5e3<(new Date).getTime()-_this.lastSavedAt&&(console.log(_this.localFile+" changed"),i=a.readFileSync(_this.localFile,{encoding:"utf8"}),pinegrow.codeEditors.isCodeForUrlSameInExternalEditor(_this.url,i,function(e){if(_this.watchReloadDialog)try{_this.watchReloadDialog.modal("hide"),_this.watchReloadDialog=null}catch(e){}e||(_this.changed?_this.watchReloadDialog=showAlert("<p><b>"+_this.name+"</b> was modified outside of Pinegrow. The file has unsaved changes. Do you want to reload it?</p><p><em>You can disable auto-reloading in Support -&gt; Settings.</em></p>","Unsaved file modified outside of Pinegrow","Don't reload","Reload from disk and lose unsaved changes",function(){_this.watchReloadDialog=null},function(){_this.watchReloadDialog=null,r(i)}):r(i))}))},this.isWatchingFileForChanges=!1,this.watchReloadDialog=null,this.watchFileForChanges=function(){if(this.localFile&&"1"==pinegrow.getSetting("auto-reloading","1")){require("fs");this.nodeFileWatcher&&(_this.delayedTasks.cancel("reloadFile"),this.nodeFileWatcher.close(),this.nodeFileWatcher=null);try{this.nodeFileWatcher=require("chokidar").watch(this.localFile,{persistent:!0,ignoreInitial:!0});this.nodeFileWatcher.on("change",function(e){_this.delayedTasks.run("reloadFile",function(){_this.watchFileOnFileChanged({mtime:1},{mtime:0})},10)}),this.isWatchingFileForChanges=!0}catch(e){}}},this.stopWatchingFileForChanges=function(){this.localFile&&this.isWatchingFileForChanges&&(_this.delayedTasks?.cancel("reloadFile"),this.nodeFileWatcher&&(this.nodeFileWatcher.close(),this.nodeFileWatcher=null),this.isWatchingFileForChanges=!1)},this.getAsset=function(e){return e in this.assetsCache?this.assetsCache[e]:null},this.addAsset=function(e,t,r){this.assetsCache[e]={data:t,mime:r}},this.clearAssetsCache=function(){this.assetsCache={}},this),pageChangedTimer=null,cssid="crsa-inline-styles",componentTypes=null,componentTypesDict={},libSections=null,actionsSections=null,whenParsedQueue=(this.parsedStatus=null,this.parsedError=null,[]),resetFrameworksCache=(this.whenParsed=function(e,t,r){"done"==this.parsedStatus?t(this):"error"==!this.parsedStatus?r(this,_this.parsedError):null===this.parsedStatus?(_this.parsedStatus="progress",whenParsedQueue.push({doFunc:t,errorFunc:r}),e(this,function(t,e){_this.parsedStatus=t,_this.parsedError=e,whenParsedQueue.forEach(function(e){("done"==t?e.doFunc:e.errorFunc)(_this,_this.parsedError)}),whenParsedQueue=[]})):(this.parsedStatus="progress")&&whenParsedQueue.push({doFunc:t,errorFunc:r})},this.onClose=function(){$("body").off(".page"+this.uid),this.setPageChanged(!1,!0),this.setLocalFile(null),this.tree&&(this.tree.destroy(),this.tree=null),pinegrow.selectedElements.removeForPage(this),pinegrow.pageHasIsolatedElement(this)&&pinegrow.isolateElement(null),this.codeEditor&&(this.codeEditor.closeTab(),this.codeEditor=null),this.undoHistory.destroy(),this.undoHistory=null,pinegrow.undoManager.purgePage(this);var e=this.getStylesheets(),e=(e&&(e.destroy(),this.setStylesheets(null)),this.$iframe&&this.$iframe.off(".crsa"),pageViews=[],this.activeView=null,this.sourceNode&&(this.sourceNode.withoutEvents(function(){_this.sourceNode.remove()}),this.sourceNode=null),pinegrow.getCurrentProject());e&&e.removeBackgroundPageForUrl(this.url),dynamicPgels.forEach(function(e){e.removeWithoutEvents()}),dynamicPgels=[],this.data={}},this.askClose=function(t){var r,e=null,i=(_this.hasCssChanges()&&(e="Stylesheets attached to this page have unsaved changes. Are you sure you want to proceed?"),_this.changed&&!_this.force_close&&(e="This page has unsaved changes. Are you sure you want to close it?"),pinegrow.getCurrentProject());(e=i&&i.loaded_from_backend?!1:e)?(r=showAlert(e,"Page has unsaved changes","Cancel","Save &amp; Close",null,function(){canSavePage(_this)&&(isAppForProject()?_this.save(function(){_this.view.closeTab(),t&&t()},!0,!0):(pinegrow.showQuickMessage("Please wait, saving..."),pinegrow.backend.saveCurrentProject(function(e){e?pinegrow.showQuickError("Error saving the project."):(_this.view.closeTab(),t&&t())})))}),$('<a href="#" class="btn pull-left">Don\'t save</a>').appendTo(r.find(".modal-footer")).on("click",function(e){e.preventDefault(),_this.view.closeTab(),r.modal("hide")})):(_this.view.closeTab(),t&&t())},this.close=function(){$.fn.crsapages("closePage",this)},this.show=function(e){this.view.show(e)},this.refreshDisplay=function(){},this.getPageUrlFromLoadedUrl=function(e){return e=(e=(e=(e=(e=pinegrow.getOriginalUrl(e)).replace(/&*pgid=[0-9]+/,"")).replace(/&*pgpvid=[0-9]+/,"")).replace("?pgedit=1","").replace("&pgedit=1","").replace("pgedit=1","")).length&&"?"==e.charAt(e.length-1)?e.substr(0,e.length-1):e},this.getPreviewUrl=function(e){var t=crsaMakeUrlAbsolute(this.url);return pinegrow.getProxyUrl(t)},function(){componentTypesDict=actionsSections=libSections=componentTypes=null}),total_in_get_type=(this.getComponentTypes=function(){if(!componentTypes){componentTypes=[];for(var e=0;e<this.frameworks.length;e++){var t=this.frameworks[e];t.not_main_types||$.each(t.getComponentTypes(),function(e,t){componentTypes.push(t)})}componentTypes.sort(function(e,t){return e.priority-t.priority}),componentTypesDict={},$.each(componentTypes,function(e,t){componentTypesDict[t.type]||(componentTypesDict[t.type]=t)})}return componentTypes},this.setComponentTypesInformation=function(e){componentTypes=e.list,componentTypesDict=e.dict,this.frameworks=e.frameworks},this.getComponentTypesInformation=function(){return this.getComponentTypes(),{list:componentTypes,dict:componentTypesDict,frameworks:this.frameworks}},this.getPageStylesheets=function(){return this.stylesheets},this.getPageStylesheet=function(e){for(var t=this.getPageStylesheets().stylesheets,r=0;r<t.length;r++)if("string"==typeof e){if(t[r].url==e)return t[r]}else if(t[r].url.match(e))return t[r];return null},this.hasLinkedStylesheet=function(e){for(var t=this.sourceNode.find("link"),r=0;r<t.length;r++)if(t[r].getAttr("href")==e)return t[r];return null},this.getViewHTMLForElement=function(pgel,disable_js){disable_js=!0;var origjs=this.javascriptEnabled,html=(disable_js&&(this.javascriptEnabled=!1),pgCurrentRequestContext.setCurrentRequestContext(this.url,this.sourceNode,!1,this),pgel.toStringWithIds(!0,pinegrow.getFormatHtmlOptions(),pgCurrentRequestContext.createProxyUrlNodeOutputFilter)),React,ReactDOMServer,js,html;return 0&&pgel.hasAttr("react")&&(React=require("react"),ReactDOMServer=require("react-dom/server"),js=Babel.transform(html,{plugins:["transform-react-jsx"]}),html=ReactDOMServer.renderToString(eval(js.code)),console.log(html)),this.javascriptEnabled=origjs,html},this.getViewInnerHTMLForElement=function(e,t){var r,i;return"script"==e.tagName?e.content:"style"==e.tagName?(r=pinegrow.stylesheets.findCrsaInlineStylesheet(e),i=e.content,r&&(i=r.getSourceForRules(null,!0)),pgAddProxyLinksToStyleAttribute(i)):(r=this.javascriptEnabled,!0&&(this.javascriptEnabled=!1),pgCurrentRequestContext.setCurrentRequestContext(this.url,this.sourceNode,!1,this),i=e.toStringWithIds(!0,pinegrow.getFormatHtmlOptions(),pgCurrentRequestContext.createProxyUrlNodeOutputFilter,!0),this.javascriptEnabled=r,i)},this.addStylesheet=function(e,t,r,i,a){var n,s,o,l,c=this.openedInEditor;if(c&&!i){var h=this.getPageStylesheet(e);if(h)return r&&r(h),!1}return e=this.makeRelativeUrl(e),!this.hasLinkedStylesheet(e)&&(s='<link rel="stylesheet" href="'+e+'">',n=this.sourceNode.findOne("head"))?(s=pgCreateNodeFromHtml(s),i?i.setAttribute("href",e):(o=!1,a&&(l=n.findOne(`link[href="${a}"]`))&&(s.insertBefore(l),o=!0),o||n.append(s)),t&&c&&(l=function(){_this.updateStylesheetsList(function(){h=_this.getPageStylesheet(e),r&&r(h)})},pgf.load_srcdoc?_this.refresh(l):l()),!0):(r&&r(),!1)},this.updateStylesheetsList=function(e){this.delayedTasks.run("updateStylesheetsList",function(){$.fn.crsacss("loadLessStyles",_this.$iframe.get(0),function(){$("body").trigger("crsa-stylesheets-changed"),_this.addCrsaStyles(),e&&e()})},500)},this.hasScriptInHeaderOrFooter=function(e,t){var r=this.sourceNode.findOne(t?"body":"head");if(r)for(var i=r.find("script"),a=0;a<i.length;a++)if(i[a].getAttr("src")==e)return i[a];return null},this.addScript=function(e,t,r,i){e=this.makeRelativeUrl(e);var a,n,s=this.hasScriptInHeaderOrFooter(e,!(t=void 0===t?!1:t));return s&&!r&&s.remove(),!(this.hasScriptInHeaderOrFooter(e,t)&&!r||(s=i?`<script>${i}</script>`:'<script src="'+e+'"><\/script>',!(a=this.sourceNode.findOne("body")))||!(n=this.sourceNode.findOne("head"))||(s=pgCreateNodeFromHtml(s),r?i?r.html(i):r.setAttribute("src",e):(t?a:n).append(s),0))},this.getTypeDefinition=function(e){return null==componentTypesDict&&this.getComponentTypes(),componentTypesDict[e]||null},this.hasStylesheet=function(e){var t=this?.$iframe.get(0)?.contentDocument||this?.$iframe.get(0)?.contentWindow?.document;if(t)for(var r=0;r<t.styleSheets.length;r++){var i=t.styleSheets[r];if(i.href){if(i.href.match(e))return i}else if(i.ownerNode){var a=i.ownerNode.getAttribute("data-pg-style-url");if(a&&a.match(e))return i}}return!1},this.getAllDOMStylesheets=function(){var e=[],t=this?.$iframe.get(0)?.contentDocument||this?.$iframe.get(0)?.contentWindow?.document;if(t)for(var r=0;r<t.styleSheets.length;r++){var i=t.styleSheets[r];i.href&&e.push(i)}return e},this.stylesheetsThatContain=function(i,a,n,s){var o,l,c,h=[],d=[],u=!1,e=this.getStylesheets();e?(o=e.getAllCrsaStylesheets(),l=-1,(c=function(){if(++l<o.length){var t=o[l],r=null;if("css"==t.fileType&&(!a||t.url&&t.url.match(a)))if(s||!t.loaded&&!t.getSource())if(t.localFile){try{var e=require("fs").readFileSync(t.localFile,{encoding:"utf8"});e&&(r=e.match(i))&&(h.push(t),d.push(r)),t.source=e}catch(e){}c()}else if(t.url)try{u=!0,$.ajax({url:t.url,data:null,dataType:"text"}).done(function(e){e&&(r=e.match(i))&&(h.push(t),d.push(r)),t.source=e,c()}).fail(function(){c()})}catch(e){c()}else c();else(r=(t.getSource()||"").match(i))&&(h.push(t),d.push(r)),c();else c()}else n(h,d,u)})()):n(h)},this.hasScript=function(i){var a,e=this?.$iframe.get(0)?.contentDocument||this?.$iframe.get(0)?.contentWindow?.document;return!!e&&(a=!1,$(e).find("script[src]").each(function(e,t){var r=$(t).attr("src");if(r&&r.match(i))return a=!0,!1}),a)},this.getLibSections=function(){if(!libSections){libSections=[];for(var e=0;e<this.frameworks.length;e++){var t=this.frameworks[e];$.each(t.getLibSections(),function(e,t){libSections.push(t)})}}return libSections},this.getActionsSections=function(){if(!actionsSections){actionsSections=[];for(var e=0;e<this.frameworks.length;e++){var t=this.frameworks[e];$.each(t.getActionsSections(),function(e,t){actionsSections.push(t)})}}return actionsSections},this.getAllTypes=function(e,t,r,i){for(var a=(new Date).getTime(),n=[],s=0;s<this.frameworks.length;s++){var o=this.frameworks[s];i&&!o.auto_updatable||(o=o.getTypes(e,t,r)).length&&(n=n.concat(o))}return total_in_get_type+=(new Date).getTime()-a,n},0),sortFrameworksByOrder=(this.getMainType=function(e,t,r,i){e instanceof pgParserNode&&(t=e,e=null);for(var a=0;a<this.frameworks.length;a++){var n=this.frameworks[a];if(!i||n.auto_updatable){n=n.getType(e,t,r);if(n)return n}}return null},this.getTypeThatFiltersTree=function(e){for(var t=0;t<this.frameworks.length;t++){var r=this.frameworks[t];if(r.has_types_that_filter_tree){r=r.getTypeThatFiltersTree(e);if(r)return r}}return null},this.getAllActionTypes=function(e){for(var t=[],r=0;r<this.frameworks.length;r++){var i=this.frameworks[r];i.has_actions&&(i=i.getActionTypes(e)).length&&(t=t.concat(i))}return t},this.editCode=function(){$("body").crsa("editCode",this.$iframe)},this.exitEditCode=function(){pinegrow.codeEditor.isInEdit(this.$iframe)&&pinegrow.codeEditor.exitEdit(!1)},this.toggleEditCode=function(){pinegrow.codeEditor.isInEdit(this.$iframe)?pinegrow.codeEditor.exitEdit(!1):this.editCode()},this.getActionTag=function(e,t,r){for(var i=[],a=0;a<this.frameworks.length;a++){var n=this.frameworks[a];n.has_actions&&(n=n.getActionTag(e,t,r))&&i.push(n)}return i.length?i.join(", "):null},this.detectAndAddFrameworks=function(i,a){var o,n,l,c,r,h,e,s,d,u,p,g;pgf.use_webview?i&&i():(n=(o=this).getProjectInfo(),l=n.getSettingsForFile(this.localFile),c=[],r=[],this.crsaProjectTemplate&&(r=this.crsaProjectTemplate.frameworks),a<=1&&(this.frameworks=[]),h=function(e,t){o.canAddFramework(e)&&o.frameworks.indexOf(e)<0&&(t?o.frameworks.splice(t,0,e):o.frameworks.unshift(e),e.on_plugin_activated&&e.on_plugin_activated(o),e.type&&c.push(e.type),e.default||pinegrow.stats.using(e.key),e.required_frameworks&&e.required_frameworks.forEach(function(e){var t=pinegrow.findFrameworkByKey(e);t&&h(t)}),pinegrow.dispatchEventDelayed("on_page_frameworks_changed",o))},0<r.length&&$.each(pinegrow.getFrameworks(),function(e,t){0<=r.indexOf(e)&&h(t)}),l&&l.frameworks&&0!==l.frameworks.length||!this.crsaProjectTemplate||!this.crsaProjectTemplate.framework||h(this.crsaProjectTemplate.framework),e=pinegrow.getCurrentProject(),e&&e.framework&&h(e.framework),s=Object.values(pinegrow.getFrameworks()),d=-1,p=function(){if(l&&l.frameworks){for(var e,r,i,t=[],a=0;a<l.frameworks.length;a++){for(var n=!1,s=0;s<o.frameworks.length;s++)if(o.frameworks[s].key==l.frameworks[a]){n=!0;break}n||t.push(l.frameworks[a])}(t.length?(e=Object.values(pinegrow.getFrameworks()),r=-1,i=function(){if(++r<e.length){var t=e[r];if(t.default)h(t),i();else if(t.detect&&o.sourceNode){if(t.detect(o)){if(t.type&&0<=c.indexOf(t.type))return i(),!0;h(t),t.silent_detection||crsaQuickMessage(t.name+" detected.",2e3)}i()}else t.detect_async&&o.sourceNode?t.detect_async(o,function(e){if(e){if(t.type&&0<=c.indexOf(t.type))return i(),!0;h(t),t.silent_detection||crsaQuickMessage(t.name+" detected.",2e3)}i()}):i()}else g()}):g)()}else g()},g=function(){if(sortFrameworksByOrder(),resetFrameworksCache(),o.frameworks_added=a||2,pinegrow.dispatchEventDelayed("on_page_frameworks_changed",o),n){var e=!1;if((t=n.getSetting("breakpoints"))&&t.length){for(var t=$.unique(t),r=0;r<t.length;r++)String(t[r]).match(/^[0-9\.]*$/)&&(t[r]=String(t[r])+"px");o.breakpoints=t,e=!0}e&&$("body").trigger("crsa-breakpoints-changed")}i&&i()},(u=function(){if(++d<s.length){var e,t=s[d],r=!0;if(l&&l.frameworks?(0<=(e=l.frameworks.indexOf(t.key))&&h(t,e),r=!1):t.default&&(h(t),r=!1),(r=t.show_in_manager?r:!0)&&t.detect&&o.sourceNode&&1===a&&t.detect(o)){if(t.type&&0<=c.indexOf(t.type))return u(),!0;h(t),t.silent_detection||crsaQuickMessage(t.name+" detected.",2e3)}r&&t.detect_async&&o.sourceNode&&2===a?t.detect_async(o,function(e){e?(h(t),t.silent_detection||crsaQuickMessage(t.name+" detected.",2e3)):!t.show_in_manager&&t.default&&h(t),u()}):(!t.show_in_manager&&t.default&&h(t),u())}else p()})())},function(){_this.frameworks=_this.frameworks.sort(function(e,t){return e.order>t.order?1:e.order<t.order?-1:0})}),arraysEqual=(this.setResourceNamespaceForFramework=function(e,t){var r=this.getProjectInfo(),i=r.getSetting("resources")||{};i[e.type]=t,r.setSetting("resources",i),r.save()},this.getResourceNamespaceForFramework=function(e,t){if(!this.localFile)return"";if(t){var r=this.getProjectOrFileDir(),i="components/"+e.type+"/";if(r){r=require("path").join(r,i);try{require("fs").statSync(r);return i}catch(e){return""}}}r=this.getProjectInfo(),i=r.getSetting("template_framework_id");return i&&i==e.type?"":"components/"+e.type+"/"},this.findFrameworkOfType=function(e){for(var t=0;t<this.frameworks.length;t++)if(this.frameworks[t].type===e)return this.frameworks[t];return null},this.hasFramework=function(e){return 0<=this.frameworks.indexOf(e)},this.canAddFramework=function(e){if(e.allow_single_type&&e.type&&this.findFrameworkOfType(e.type))return!1;return!0},this.getFrameworks=function(){return this.frameworks},this.addFramework=function(e,t,r){const i=this;var a=!1;if(this.frameworks.indexOf(e)<0){if(!this.canAddFramework(e))return!1;this.frameworks.unshift(e),e.required_frameworks&&e.required_frameworks.forEach(function(e){var t=pinegrow.findFrameworkByKey(e);t&&i.addFramework(t,!0)}),sortFrameworksByOrder(),a=!0,e.on_plugin_activated?e.on_plugin_activated(this,r):r&&r(e),this.addCrsaStyles()}return a&&!t&&pinegrow.frameworksChanged(),!0},this.frameworksChanged=function(){resetFrameworksCache()},this.removeFramework=function(e){var t=this.frameworks.indexOf(e);0<=t&&(this.frameworks.splice(t,1),resetFrameworksCache(),e.on_plugin_deactivated&&e.on_plugin_deactivated(this),$("body").trigger("crsa-frameworks-changed"),this.addCrsaStyles())},function(e,t){var r=e.length;if(r!=t.length)return!1;for(;r--;)if(e[r]!==t[r])return!1;return!0}),copyContentFromPage=(this.copyContentOfPage=function(e,t){var r=this.applyChangesToSource(e.sourceNode,!1,!0,pinegrow.getSelectedPage()==this);!r.changes||r.updated||t||this.refresh()},function(e){pageChangedTimer&&clearTimeout(pageChangedTimer),pageChangedTimer=setTimeout(function(){_this.copyContentOfPage(e),_this.readOnly||($.fn.crsa("buildTree",_this.$iframe),_this.treeRepaintOnShow=!0),pageChangedTimer=null,arraysEqual(_this.breakpoints,e.breakpoints)||(_this.setAllBreakpoints(e.breakpoints),$("body").trigger("crsa-breakpoints-changed")),_this.autoSize(),_this.setPageChanged(!0)},500)}),sortBreakpoints=(this.onPageChanged=function(e){copyContentFromPage(e)},this.setSyntaxErrorIndicator=function(e,t,r){},this.refreshPageChangedStatus=function(e){var t=this.changed||this.hasCssChanges();this.setPageChanged(t,e,!0)},this.setPageChanged=function(e,t,r){var i=pinegrow.getCurrentProject(),a=!i||!i.loaded_from_backend;(this.changed!==e||t)&&(r||(this.changed=e),e&&!a&&(this.onlyCode?i&&i.settingsFileIsChanged(i.getRelativeUrl(this.url)):pinegrow.backend.saveDelayed()),this.view&&this.view.setModified(e),this.codeEditor&&this.codeEditor.setModified(e),a)&&(e?this.setFileNodeTag(new CrsaFileTag("&#x2731;","info","Save changes.",null)):this.removeFileNodeTag("&#x2731;"))},this.openInBrowser=function(e){if(!e){var t={done:!1};if(pinegrow.dispatchEvent("on_preview_page_in_browser",this,t),t.done)return}var r,t=pinegrow.getCurrentProject();t&&t.loaded_from_backend||(0&&!this.localFile&&this.url.startsWith("file://")?pinegrow.showAlert("<p>After creating a new page, you have to <b>save the page</b> first, before using Preview in browser. After the page is saved on disk, you can use Preview in browser without saving the page.</p>","Page needs a home first"):(t=require("nw.gui"),r=this.getPreviewUrl(!0),t.Shell.openExternal(r),pinegrow.showNotice("<p>The page was opened in your default browser. Click on <b>the link icon</b> next to Page -&gt; Preview in Browser to <b>copy the preview link to clipboard</b> from where you can use it to open the preview in any browser.</p><p>The preview link will work as long as the page is opened in Pinegrow.</p>","About the preview link","page-preview-link")))},this.getProject=function(){var e=pinegrow.getCurrentProject();return!e||e.localFile&&!e.isPageInProject(this)?null:e},this.getProjectOrFileDir=function(){var e=pinegrow.getCurrentProject();return!e||e.localFile&&!e.isPageInProject(this)?this.localFile?require("path").dirname(this.localFile):null:e.getDir()},this.getFileNode=function(){var e=pinegrow.getCurrentProject();if(e)return e.getFileForUrl(this.url)},this.setFileNodeTag=function(e,t,r,i){(r=r||pinegrow.getCurrentProject())&&(t=t||r.getFileForUrl(this.url))&&(t.addTag(e,i),r.updateTagsForFile(t))},this.removeFileNodeTag=function(e,t,r){(r=r||pinegrow.getCurrentProject())&&(t=t||r.getFileForUrl(this.url))&&(t.removeTag(e),r.updateTagsForFile(t))},this.getMirroredPages=function(){for(var e=[],t=0;t<crsaPages.length;t++)crsaPages[t]!=this&&crsaPages[t].live_update==this&&e.push(crsaPages[t]);return e},this.elementWasSelected=function(e){},this.pageLoaded=function(){for(var e=this.getMirroredPages(),t=0;t<e.length;t++){var r=e[t];r.url!=this.url&&(r.rename(this.url),r.reload())}},this.hasCssChanges=function(){var e,i;return!this.force_close&&!!this.openedInEditor&&(e=this.stylesheets,i=!1,e&&$.each(e.stylesheets,function(e,t){if(!t.loaded)return!0;var r=i||t.changed;!r&&t.sourceStylesheet&&t.sourceStylesheet.forEachStylesheet(function(e){if(r=e.changed)return!1}),i=r}),i)},this.hasChanges=function(){return this.changed||!this.onlyCode&&this.hasCssChanges()},this.getBreakpointsFromCss=function(a){function r(){for(var e=[],t=0;t<n.length;t++){var r=crsaSplitCSSValue(n[t]),i=crsaOneUpCSSValue(r);0==r.value||0<=n.indexOf(i.value+i.unit)?n[t]=-1:e.push(n[t])}e.sort(function(e,t){var r=crsaSplitCSSValue(e),i=crsaSplitCSSValue(t);return r.value-i.value}),e=pgMakeStringArrayUnique(e),a(e)}var i,e=getCrsaPageStylesForPage(this.$iframe),n=[];e&&(i=0,$.each(e.stylesheets,function(e,t){i++,t.loaded?setTimeout(function(){!t.ignore||1?t.getBreakpoints(function(e){n=$.unique(n.concat(e)),0==--i&&r()}):0==--i&&r()},100):(t.setIgnore(!1),t.load(t.url,function(){t.getBreakpoints(function(e){n=$.unique(n.concat(e)),t.setIgnore(!0),0==--i&&r()})}))}),0!=i)||r()},this.changeBreakpoint=function(r,i,e){if(r!=i){for(var t=0;t<this.breakpoints.length;t++)if(i==this.breakpoints[t])throw"Breakpoint "+i+" is already set.";for(t=0;t<this.breakpoints.length;t++)r==this.breakpoints[t]&&(this.breakpoints[t]=i);sortBreakpoints(),this.setPageChanged(!0),describeMediaQueryCache={};function a(){e(o)}var n,s=getCrsaPageStylesForPage(this.$iframe),o=!1;s&&(n=0,$.each(s.stylesheets,function(e,t){n++,(t=t.compiledFile?t.sourceStylesheet:t).loaded?setTimeout(function(){t.changeBreakpoint(r,i,function(e){n--,o=o||e,_this.setPageChanged(!0),0==n&&a()})},40):(t.ignore=!1,t.load(t.url,function(){t.changeBreakpoint(r,i,function(e){n--,o=o||e,_this.setPageChanged(!0),t.ignore=!e,0==n&&a()})}))}),0!=n)||a()}},this.addBreakpoint=function(e){for(var t=0;t<this.breakpoints.length;t++)if(e==this.breakpoints[t])throw"Breakpoint "+e+" is already set.";this.breakpoints.push(e),sortBreakpoints(),this.setPageChanged(!0),describeMediaQueryCache={}},function(){_this.breakpoints.sort(function(e,t){return parseFloat(crsaConvertCSSValueToPx(e,_this.$iframe))-parseFloat(crsaConvertCSSValueToPx(t,_this.$iframe))})}),describeMediaQueryCache=(this.removeBreakpoint=function(e){for(var t=[],r=0;r<this.breakpoints.length;r++)e!=this.breakpoints[r]&&t.push(this.breakpoints[r]);this.breakpoints=t,this.setPageChanged(!0),describeMediaQueryCache={}},this.setAllBreakpoints=function(e){this.breakpoints=pgMakeStringArrayUnique(e),this.breakpoints.sort(function(e,t){return e-t}),describeMediaQueryCache={}},this.showManageBreakpoints=function(){var t=pinegrow.getCurrentProject(),h=function(){var e;t&&t.loaded_from_backend&&((e=pinegrow.getCurrentProjectInfo()).setSetting("breakpoints",_this.breakpoints),e.save()),pinegrow.selectedElements.reselect()},s=function(s,o){var l,c=getUniqueIdFast();s.data("popover-active")?(s.popover("destroy"),s.data("popover-active",null)):(l=function(e){setTimeout(function(){e.closest(".popover").remove()},750)},s.popover({html:!0,placement:"right",trigger:"manual",title:o?"Edit breakpoint":"Add new breakpoint",container:"body",content:'<form id="'+c+'"><form><input class="form-control" placeholder="width with unit" style="margin-bottom:8px;"/><button class="ok btn">'+(o?"Set":"Add")+'</button><button class="useit btn btn-link">Use current width</button><button class="closeit btn btn-link">Cancel</button></form>'}).on("shown.bs.popover",function(){function t(){if(0<(t=$.trim(i.val())).length){var e=crsaSplitCSSValue(t),t=e.value+e.unit;try{o?(s&&s.html("Please wait...").addClass("disabled"),_this.changeBreakpoint(o,t,function(e){s.html("Edit").removeClass("disabled"),e&&(setTimeout(function(){crsaQuickMessage("Stylesheets were updated!",3e3)},250),setTimeout(function(){$("body").trigger("crsa-stylesheets-changed")},50)),h()})):(_this.addBreakpoint(t),h()),s.popover("hide"),l(r),d(),$("body").trigger("crsa-breakpoints-changed")}catch(e){pinegrow.alert(e)}}}var r=$("#"+c),i=r.find("input").focus(),e=r.find("button.ok"),a=r.find("button.closeit"),n=r.find("button.useit");o&&i.val(o);e.on("click",function(e){e.preventDefault(),t()}),r.on("submit",function(e){e.preventDefault(),t()}),n.on("click",function(e){e.preventDefault(),i.val(_this.activeView.deviceWidth+"px")}),a.on("click",function(e){s.popover("hide"),e.preventDefault(),l(r)})}).on("hidden.bs.popover",function(){setTimeout(function(){s.popover("destroy").data("popover-active",null)},10)}),s.popover("show").data("popover-active",!0))},o=$("<div/>"),d=function(){o.html("");for(var e,t,r,i,a=$("<ul/>",{style:"margin-bottom: 0px"}).appendTo(o),n=($("<ul/>",{style:"margin-bottom: 0px"}).appendTo(o),0);n<_this.breakpoints.length;n++)e=_this.breakpoints[n],t=a,i=r=void 0,r=$('<a href="#" class="btn btn-sm btn-link">Edit</a>'),i=$('<a href="#" class="btn btn-sm btn-link">Delete</a>'),$("<li></li>").html(e).appendTo(t).append(r).append(i).data("breakpoint",e),r.on("click",function(e){var t=$(e.delegateTarget).closest("li");e.preventDefault(),s($(e.delegateTarget),t.data("breakpoint"))}),i.on("click",function(e){var t=$(e.delegateTarget).closest("li");e.preventDefault(),confirm("Are you sure? Existing CSS rules will not be affected.")&&(_this.removeBreakpoint(t.data("breakpoint")),d(),h(),$("body").trigger("crsa-breakpoints-changed"))})},e=(d(),o),i=$('<div class="manager"><p>Breakpoints:</p></div>').append(e),a=($('<a href="#" class="btn btn-link add">Add breakpoint...</a>').appendTo(i).on("click",function(e){e.preventDefault(),s($(this))}),$('<a href="#" class="btn btn-link add">Get from stylesheets</a>').appendTo(i).on("click",function(e){e.preventDefault();var i=$(e.delegateTarget);i.html("Please wait...").addClass("disabled"),_this.getBreakpointsFromCss(function(e){var t,r;e.length?(t=function(){_this.setAllBreakpoints(e),crsaQuickMessage("Done!",2e3),h()},_this.breakpoints.length&&(r="Breakpoints ["+e.join(", ")+"] were found in CSS. Do you want to use them instead of current breakpoints? This can't be undone.",!confirm(r))||t()):crsaQuickMessage("No breakpoints found!",2e3),d(),$("body").trigger("crsa-breakpoints-changed"),i.html("Get from stylesheets").removeClass("disabled")})}),crsaHandleExternalLinks(i),function(){var e,t=i.find(".meta-add"),r=(t.length||(t=$('<div class="meta-add well" style="margin-top:12px;"></div>').appendTo(i)),_this.sourceNode.findOne("head"));r&&(r.findOne('meta[name="viewport"]')?t.hide():(t.html('<p>Document needs <code>&lt;meta name=&quot;viewport&quot; ... &gt;</code> directive to enable responsive behaviour on mobile devices. <a href="#" class="">Add it!</a></p>'),e=t.find("a"),t.show(),e.on("click",function(e){e.preventDefault();var t=pgCreate('<meta name="viewport" content="width=device-width, initial-scale=1.0">');r.append(t),_this.setPageChanged(!0),pinegrow.changeManager.didChange(t,"Add viewport declaration"),a(),crsaQuickMessage("Viewport declaration added!",2e3)})))}),e=(a(),makeModalDialog("Manage breakpoints","Close",null,i));e.removeAttr("tabindex"),e.find(".modal-dialog").css("width","500px")},{}),refresh_done_callbacks=(this.describeMediaQuery=function(r){var i=null;if(r in describeMediaQueryCache)return describeMediaQueryCache[r];var e=r.indexOf("("),t=(0<=e?(i=r.substr(e),0<=r.indexOf("only")&&(i=i.replace("only ","")),$.each(["screen","print"],function(e,t){0<=r.indexOf(t)&&(type=t,i=i.replace(t,""))})):i=r,i=i.replace(/\s/g,""),null);if(_this.breakpoints.length)for(var a=0;a<_this.breakpoints.length;a++){var n=crsaSplitCSSValue(_this.breakpoints[a]),s=n.value,o="(max-width:"+crsaOneUpCSSValue(n,-1).value+n.unit+")";if(i==o){t='<span class="line"></span><span class="excluding">'+s+"</span>";break}if(o="(min-width:"+s+n.unit+")",i==o){t='<span class="including">'+s+'</span><span class="line"></span>';break}if(a<_this.breakpoints.length-1){var l=crsaSplitCSSValue(_this.breakpoints[a+1]),c=l.value,o="(min-width:"+s+"px)and(max-width:"+crsaOneUpCSSValue(l,-1).value+n.unit+")";if(i==o){t='<span class="including">'+s+'</span><span class="line"></span><span class="excluding">'+c+"</span>";break}}}return describeMediaQueryCache[r]=t||r,t||r},this.showMediaQueryHelper=function(r){r.offset().left,$(window).width();var e=getUniqueIdFast();if(!r.data("tool-active")){function i(e){y.hide(),r.data("tool-active",null),T.closed=!0,setTimeout(function(){y.remove()},500)}var a=$.trim(r.val()),n="",t=!!localStorage.mediaToolOnly,s=localStorage.mediaToolType||null,o=!0,l=(a?0<=(v=a.indexOf("("))?(n=a.substr(v),0<=a.indexOf("only")&&(t=!0,n=n.replace("only ","")),$.each(["screen","print"],function(e,t){0<=a.indexOf(t)&&(s=t,n=n.replace(t,""))}),n=n.replace(/\s\s+/g," "),o=!1):n=a:o=!1,!1),c="";if(_this.breakpoints.length)for(var h=0;h<_this.breakpoints.length;h++){var d,u,p,g=crsaSplitCSSValue(_this.breakpoints[h]),f=g.value,c=(c+='<li class="media-query" data-media="'+("(max-width:"+crsaOneUpCSSValue(g,-1).value+g.unit+")")+'"><i class="fa fa-check"></i><span class="line"></span><span class="excluding">'+f+"</span><small>smaller than "+f+" "+g.unit+"</small></li>")+('<li class="media-query" data-media="'+("(min-width:"+f+g.unit+")")+'"><i class="fa fa-check"></i><span class="including">'+f+'</span><span class="line"></span><small>'+f+" "+g.unit+" and up</small></li>");h<_this.breakpoints.length-1&&(u=(d=crsaSplitCSSValue(_this.breakpoints[h+1])).value,p=crsaOneUpCSSValue(d,-1),c+='<li class="media-query submedia-last" data-media="'+("(min-width:"+f+g.unit+") and (max-width:"+p.value+g.unit+")")+'"><i class="fa fa-check"></i><span class="including">'+f+'</span><span class="line"></span><span class="excluding">'+u+"</span><small>from "+f+" "+g.unit+" to "+d.value+" "+g.unit+"</small></li>")}else c+="<li>No breakpoints are defined. Use &quot;Manage breakpoints&quot; to define them.</li>";var m=null,w=function(e){m&&clearTimeout(m),m=setTimeout(function(){e.focus(),e.trigger("change"),m=null},50)},v=$('<div id="'+e+'" class="media-tool"><ul class="media-list">'+c+"</ul>"+'<form role="form" class="form-inline">            <div class="form-group" style="margin-right:10px;">            <label class="control-label sr-only" for="formInput1">Field label</label>            <select id="formInput1" class="form-control input-sm">            <option></option>            <option>screen</option>            <option>print</option>        </select>        </div>            <div class="checkbox">                <label class="control-label">                    <input type="checkbox"> Ignore in old browsers</label>                </div>            </form>'+"</div>"),_=$("body"),y=makeDialog("Select media query","Cancel","Ok",v).css("width","400px"),v=(_.append(y),y.find(".modal-footer").prepend('<a href="#" class="pull-left manage btn btn-link">Manage breakpoints...</a>').css("margin-top","0px"),y.find(".modal-body").css("padding-bottom","0px"),y.on("keydown",function(e){27==e.which&&(y.find("button.cancel").trigger("click"),e.preventDefault())}),r.offset()),b=_.width(),_=_.height(),_=(f=v.left<b/2?v.left+r.width()+35:v.left-y.width()-10,v=v.top-y.height()/2,f=localStorage.mediaToolX?parseInt(localStorage.mediaToolX):f,(v=(v=localStorage.mediaToolY?parseInt(localStorage.mediaToolY):v)<10?10:v)+y.height()>_&&(v=_-10-y.height()),(f=f<10?10:f)+y.width()>b&&(f=b-10-y.width()),y.css("top",v+"px").css("left",f+"px"),y.draggable({handle:".modal-header"}).on("dragstart",function(){$.fn.crsapages("showOverlays")}).on("dragstop",function(){$.fn.crsapages("showOverlays",!0);var e=y.offset();localStorage.mediaToolX=e.left,localStorage.mediaToolY=e.top}),$("#"+e)),k=_.find("ul"),b=y.find("button.ok"),v=y.find("button.close,button.cancel"),P=_.find("select"),C=_.find('input[type="checkbox"]'),S=(o?(P.attr("disabled","disabled"),C.attr("disabled","disabled")):(P.val(s),t&&C.attr("checked","checked"),P.on("change",function(e){S(n),localStorage.mediaToolType=P.val()}),C.on("change",function(e){S(n),localStorage.mediaToolOnly=C.is(":checked")?"1":"0"})),function(e){var t=P.val();t&&(e.length?e=t+" and "+e:e=t),C.is(":checked")&&(e="only "+(t?"":"screen and ")+e),r.val(e),w(r)}),F=n.replace(/\s/g,""),T=(k.find("li").each(function(e,t){var r,i=$(t),a=i.attr("data-media");a&&(a.replace(/\s/g,"")==F&&i.addClass("media-current"),r=_this.getWindow())&&r.matchMedia(a).matches&&i.addClass("media-match")}),k.find("i.fa-check:visible").tooltip({container:"body",title:"Matches current window size ("+_this.deviceWidth+"px)."}),k.find("li").on("mouseover",function(e){var t;l||(t=$(e.delegateTarget).attr("data-media"))&&S(t)}).on("mouseout",function(e){l||$(e.delegateTarget).attr("data-media")&&(o?(r.val(a),w(r)):S(n))}).on("click",function(e){l=!0,e.preventDefault();var t=$(e.delegateTarget),r=t.attr("data-media");r&&(k.find("li.media-current").removeClass("media-current"),t.addClass("media-current"),S(r),i())}),b.on("click",function(e){e.preventDefault(),l=!0,i()}),v.on("click",function(e){l=!0,r.val(a),w(r),e.preventDefault(),i()}),y.find(".manage").on("click",function(e){l=!0,r.val(a),w(r),e.preventDefault(),i(),_this.showManageBreakpoints()}),r.data("tool-active",!0),{closed:!1,close:function(){i()}});return T}r.data("tool-active",null)},this.getProjectInfo=function(){return new pgProjectInfo(_this.localFile)},this.getDocument=function(){return this.$iframe.get(0).contentDocument},this.getWindow=function(){return this.$iframe.get(0).contentWindow},this.getBody=function(){return getIframeBody(this.$iframe.get(0))},this.get$Html=function(){var e=this.getDocument();return e.documentElement?$(e.documentElement):null},this.getElementWithPgId=function(e){var t=this.get$Html().find('[data-pg-id="'+e+'"]');return t.length?t:null},this.getCSSVariableValue=function(e){var t=this.activeView.get$Body(),t=this.activeView.getWindow().getComputedStyle(t.get(0)).getPropertyValue(e);return t="string"==typeof t?t.trim():t},this.getElementFromPgParserNode=function(e){return this.getElementWithPgId(e.getId())},this.getData=function(e,t){try{var r=getUniqueIdFast("crsa"),i=(e.attr("data-tmp",r),this.$iframe[0].contentWindow.$),a=this.$iframe.contents().find('[data-tmp="'+r+'"]');return e.removeAttr("data-tmp"),0<a.length?i.data(a.get(0),t):null}catch(e){}return null},this.saveHTML=function(){this.save(function(){},!0,!1,!1,!1)},this.saveAs=function(t){pinegrow.codeEditor&&pinegrow.codeEditor.refreshBeforeSaveIfNeeded(),this.save(function(e){e||(pinegrow.recentFiles.add(_this.url),pinegrow.pageTabs.updateDisplay(),t&&t(_this))},!0,!0,!0)},this.save=function(s,o,l,e,c,h,t){if((p=pinegrow.getCurrentProject())&&p.loaded_from_backend){var i=new CrsaBrowserStorage;o&&(i.save(this.url,d),this.setPageChanged(!1)),l&&(m=getCrsaPageStylesForPage(this.$iframe),w=0,$.each(m.getAllCrsaStylesheets(),function(e,t){if(t.inline)return!0;var r=t.getLessSource();i.save(t.url,r),t.setChanged(!1)})),s&&s()}else{if(pgf.save_css||(l=!1),!this.openedInEditor||this.onlyCode){c=l=!1,o=!0;var r=pinegrow.stylesheets.getByUrl(this.url,!0);if(r){for(var a=pinegrow.stylesheets.getPagesForStylesheet(r),n=0;n<a.length;n++)if(a[n].isNew())return void pinegrow.showQuickError(`Please save the page ${a[n].getName()} before saving the stylesheet.`);return void r.save(r.localFile,function(){pinegrow.refreshPageChangedStatusForAllPages(!0),pinegrow.dispatchEvent("on_css_file_edited_in_code_editor_saved",pinegrow.getAllPages(),r),s&&s()})}}void 0===c&&(c=!0),d=this.onlyCode?this.code:this.getCodeForSave();var d,u=require("fs"),p=(require("path"),pinegrow.getCurrentProject());if(pinegrow.dispatchEvent("on_before_save",this),this.localFile&&!e)try{if(this.live_update&&this.save_parent)s&&s(),showAlert("The page was not saved because it is a mirrored page. You should save the parent page "+this.live_update.name+" instead.","Page was not saved");else{function g(e,t){pgf.save_html&&((!p||p&&!p.isPageInProject(_this))&&_this.crsaProjectTemplate&&c&&_this.crsaProjectTemplate.copyRequiredFilesTo(b),_this.pageIsRemoteTemplate&&(r=new PgResourcesList).detectRequiredResources(_this,_this.source_framework)&&(d=_this.getCode("1"==pinegrow.getSetting("keep-collapsed","0"),!0),crsaWriteFileWithBackup(u,_this.localFile,d,"utf8")),(i=crsaMakeUrlFromFile(_this.localFile))!=_this.url&&(crsaIsFileUrl(_this.url)||_this.pageIsRemoteTemplate)&&_this.rename(i),_this.pageIsRemoteTemplate)&&(pinegrow.addFrameworkResourcesToPageOrProject(_this.source_framework,_this,{resources:r,only_add_to_page:_this,overwrite:function(e){return!("pinegrow.json"!==e||!F||!F.was_just_created)},done:function(){var e=function(){pinegrow.stylesheets.removeAllUnusedStylesheets(),pinegrow.removeEventHandler("on_page_stylesheets_loaded",e)};pinegrow.addEventHandler("on_page_stylesheets_loaded",e),_this.refresh(function(){})}}),P=!0,_this.pageIsRemoteTemplate=!1),e||(_this.onlyCode?_this.callFrameworkHandler("on_code_page_saved"):(_this.callFrameworkHandler("on_page_saved",t,h),_this.view&&_this.view.rememberPageViews())),s&&s(e),o&&(_this.changed=!1,_this.refreshPageChangedStatus(!0)),pinegrow.refreshPageChangedStatusForAllPages(!0);var r,i,a="";if(!P&&h&&(a+=P?"</ul>":"</ul><p>Images, scripts and other resources were not saved.</p><p>If you want to save all changes it is recommended to first save the whole webpage to your computer (Save As Complete page in your browser) and then open it in Pinegrow.</p>"),0<k.length){a+=P?"<p>The following stylesheets were not saved:</p><ul>":"<p>The following stylesheets were not saved because they have syntax errors or their paths would place them outside of the folder selected for saving the HTML file:</p><ul>";for(var n=0;n<k.length;n++)a+="<li>"+k[n].url+" - "+function(e){var t="Unknown error";switch(e.error){case"syntax":t="Syntax error (check CSS panel for more)";break;case"url":t="Invalid or remote url";break;case"file":t="Error writting to file: "+e.msg;break;default:t=e.error}return t}(k[n])+"</li>"}(h||_this.mappedRemoteFirstSave)&&(pinegrow.refreshCurrentProjectDelayed(!0),_this.mappedRemoteFirstSave=!C),0<a.length?showAlert(a,"Some files were not saved"):C&&crsaQuickMessage(l||_this.onlyCode||!pgf.edit_css?_this.name+" was saved.":_this.name+" (HTML only) was saved.")}var f,m,w,v,_,y,b=crsaGetFileDir(this.localFile),k=((!p||p&&!p.isPageInProject(this))&&this.crsaProjectTemplate&&c&&this.crsaProjectTemplate.copyRequiredFilesTo(b,null,null,!0),[]),P=crsaIsFileUrl(this.url),C=!1;if(o)if(pgf.save_html)if(this.mappedRemote&&!this.changed&&!this.pageIsRemoteTemplate||(this.lastSavedAt=(new Date).getTime(),crsaWriteFileWithBackup(u,this.localFile,d,"utf8"),C=!0),!(p=pinegrow.getCurrentProject())||this.openedInEditor||this.codeEditor||p.removeBackgroundPageForUrl(this.url),c){for(var S=_this.localFile,F=((p=pinegrow.getCurrentProject())&&p.isFileInProject(_this.localFile)&&(S=p.getDir()),new pgProjectInfo(S,h)),T={frameworks:[]},n=0;n<_this.frameworks.length;n++)T.frameworks.push(_this.frameworks[n].key);F.setSettingForFile(_this.localFile,"frameworks",T.frameworks),F.setSetting("breakpoints",_this.breakpoints),F.setSetting("frameworks",T.frameworks),_this.source_framework&&F.setSetting("template_framework_id",_this.source_framework.type),F.save()}l?(f=[],m=getCrsaPageStylesForPage(this.$iframe),w=0,v=null,t&&((v=new CrsaOverwriteProtectionFileWriter("dummy_source",null)).use_export_cache=!1,h)&&(v.skip_existing_files=!0),_=function(e){var t=e.url,t=crsaMakeLinkRelativeTo(t,crsaMakeUrlAbsolute(_this.url));return crsaRemoveUrlParameters(t)},y=function(e,t){return!h&&e.localFile?e.localFile:0<=(t=t||_(e)).indexOf("://")?crsaMakeFileFromUrl(t):require("path").resolve(b,decodeURI(t))},$.each(m.getAllCrsaStylesheets(),function(e,t){var r=null;if((t=t.sourceStylesheet?(r=t).sourceStylesheet:t).inline)return t.fileSaved(),!0;if(!t.loaded)return!0;if(t.ignoreInSave)return!0;if(t.loadingFailed)return!0;var i=_(t),a=y(t,i);if(n=t.getError())k.push({url:t.url,error:n||"syntax"});else{var n=!1;if((0<=i.indexOf("://")&&!crsaIsFileUrl(i)||!P&&0<=i.indexOf(".."))&&(t.localFile?a=t.localFile:(t.changed&&k.push({url:t.url,error:"url"}),n=!0)),!n){if(!t.needsSave(a)){if(!r||!r.needsSave())return!0;a=y(t=r)}w++,t.save(a,function(e){e&&k.push({url:t.url,error:"file",msg:e}),w--,f.push({cs:t,path:a,error:e}),0==w&&(v?v.askIfNeeded(function(){g(null,f)}):g(null,f))},u,null,v)}}}),0==w&&(v?v.askIfNeeded(function(){g()}):g())):g()}}catch(e){s&&s(e);showAlert("<p>Could not save file: "+e.message+"</p>"+"<p>A HINT: By default, Save dialog will select the root folder of your computer. Files can't be written there of course. Select the folder where you have write access and it will be ok.</p>","Error")}else crsaChooseFile(function(r,e){function t(){_this.localFile;var t=_this.save_parent;_this.setLocalFile(e),_this.save_parent=!1,_this.save(function(e){e?(_this.setLocalFile(_this.localFile),_this.save_parent=t):crsaIsFileUrl(_this.url)&&(_this.rename(r),$.fn.crsapages("updateFilesName"),_this.reload(function(){_this.updateStylesheetsList()})),$body.trigger("crsa-page-saved-as",_this),s()},o,l,!1,!0,!0,!0)}r.indexOf(".htm")<0?showAlert("Do you want to use the file without the <b>.html</b> extension? Some browsers will not recognize it.","No .html extension","Use as is","Add .html extension",function(){t()},function(){e+=".html",r+=".html",t()}):t()},this.name)}},this.saveChangedFrameworks=function(e){pinegrow.saveChangedFrameworks(this,e)},this.rename=function(e){this.setUrl(e),this.name=this.tab_name=getPageName(e),this.updateNameDisplay()},this.updateNameDisplay=function(){this.view.updateTitle(),this.codeEditor&&this.codeEditor.pageWasRenamed()},this.duplicate=function(){for(var e=new CrsaPage,t=(e.wrapper_url=this.wrapper_url,e.wrapper_selector=this.wrapper_selector,e.scrollMode=this.scrollMode,e.javascriptEnabled=this.javascriptEnabled,e.parsedStatus=this.parsedStatus,e.loaded=this.loaded,this.sourceNode&&(e.sourceNode=this.sourceNode.clone()),e.frameworks=this.frameworks.slice(0),e.frameworks_added=0<this.frameworks.length?2:0,e.frameworksChanged(),e.breakpoints=this.breakpoints.slice(0),[]),r=0;r<crsaPages.length;r++)t.push(crsaPages[r].name);return e.name=this.name,e.localFile=this.localFile,e.setUrl(this.url),e},this.reload=function(e){this.view.reload(e)},[]),show_name_classes_filter=(this.refresh=function(e,t){e&&refresh_done_callbacks.push(e),this.delayedTasks.run("refresh",function(){_this.view.refresh(function(t,r,i,e){var a=refresh_done_callbacks.slice(0);refresh_done_callbacks=[],a.forEach(function(e){e(t,r,i,e)})},null,t),pgf.srcset_mode&&!t&&pinegrow.showQuickMessage("Page view refreshed.")},50)},this.refreshWithUpdateStylesheets=function(){this.refresh(function(e,t,r,i){i==_this.activeView&&_this.updateStylesheetsList()})},this.autoSize=function(){this.view.updateSize()},this.setLiveUpdate=function(e){var t;$("body");e?(this.$page.addClass("mirrored"),t=e.live_update||e,this.live_update=t):(this.live_update,this.$page.removeClass("mirrored"),this.live_update=null)},this.getCurrentFrameworkHandlerReturnValue=function(e){return this.currentFrameworkHandlerReturnValues[e]||null},this.callFrameworkHandler=function(e,t,r,i,a,n,s){return pinegrow.dispatchEvent(e,this,t,r,i,a,n,s)},this.callGlobalFrameworkHandler=function(e,t,r,i,a,n,s){return pinegrow.callGlobalFrameworkHandler(e,t,r,i,a,n,s,this)},this.getSource=function(e,t){return this.getCode(!0)},this.applyChangesToSource=function(e,t,r,i,a){var n,s=pinegrow.selectedElements.getSelectedOnPage(this),o={changes:null,errors:null,updated:!1,stylesheets_changed:!1,scripts_changed:!1,whole_changed:!1,replace_selected:[]},l=!1,c=null,h=new CrsaProfile;if(this.onlyCode)(v="string"==typeof e?e:e.toStringOriginal(!0))!=this.code&&(this.code=v,(w=pinegrow.getCurrentProject())&&w.loaded_from_backend&&w.setContentOfUrl(this.url,v),this.setPageChanged(!0)),o.updated=!0;else if("string"==typeof e?((c=new pgParser).assignIds=!1,c.parse(e),n=c.rootNode):(n=e,l=!0),o.errors=n.validateTree(!0),!o.errors.length||!t){h.show("applyChangesToSource PARSED");function d(e){var t=!1;return e.walk(function(e){return!e.isElement||!m(e)||(t=!0,!1)}),t}var u=pgFindChangedNodesInPage(this.sourceNode,n),p=(o.changes=u,h.show("applyChangesToSource FOUND CHANGES"),$([]),!1),g=!1,f=["html","head"],m=function(e){return"style"==e.tagName||"link"==e.tagName&&"stylesheet"==e.getAttr("rel")};if(u.length&&this.openedInEditor){pgCurrentRequestContext.setCurrentRequestContext(this.url,n);for(var w,v,_=!1,y=0;y<u.length;y++)if(null==(b=u[y]).original.parent||0<=f.indexOf(b.original.tagName)||0<=f.indexOf(b.changed.tagName)){o.whole_changed=_=!0;break}if(!_)for(y=0;y<u.length;y++){var b;(b=u[y]).original.getId(),b.original;l&&(b.changed=b.changed.clone(!0)),b.changed.assignIdAndAddToCatalog(!0),0<=s.indexOf(b.original)&&o.replace_selected.push({old_pgel:b.original,new_pgel:b.changed}),b.original.replaceWith(b.changed),g||(m(b.original)||d(b.original)||m(b.changed)||d(b.changed))&&(g=!0),"script"!=b.original.tagName&&"script"!=b.changed.tagName||(o.scripts_changed=!0),p=!0}o.stylesheets_changed=g,p?(g&&i&&_this.updateStylesheetsList(),this.setPageChanged(!0),r||this.openedInEditor,o.updated=!0):(w=this.sourceNode.toStringWithIds(!0),this.sourceNode.removeWithoutEvents(),this.sourceNode=l?n.clone(!0):n,this.sourceNode.assignIdAndAddToCatalog(!0),v=new PgNodeEvent(this.sourceNode,"setCode",null,{oldValue:w},this),c=new PgUndoEvent(v),pinegrow.undoManager.getHistoryForPage(this).addEvent(c))}else o.updated=!0;h.show("applyChangesToSource DONE")}return o},this.setSource=function(e,s,o,t){var l=new pgParser;l.parse(e,function(){_this.sourceNode=l.rootNode;var e=l.rootNode.find(">html");if(e&&e.length){for(var t=e[0].html(null,!0),r=getIframeDocument(_this.$iframe.get(0)),i=$(r).find("> html"),r=(i[0].innerHTML=t,$.map(i[0].attributes,function(e){return e.name})),a=($.each(r,function(e,t){i.removeAttr(t)}),e[0].getAttrList()),n=0;n<a.length;n++)i.attr(a[n].name,a[n].value);o?s&&s():setTimeout(function(){$.fn.crsacss("loadLessStyles",_this.$iframe.get(0),function(){$.fn.crsa("updateStructureAndWireAllElemets",_this.$iframe),$("body").trigger("crsa-stylesheets-changed"),_this.addCrsaStyles(),s&&s()})},500)}else s&&s()})},this.runScripts=function(e){e&&e()},this.addCrsaStyles=function(e){var t,r,i;pgf.use_webview||(e=e||this.$iframe,t={css:'.crsa-highlighted {            box-shadow: 0 0 10px rgba(0, 255, 0, 0.9) !important;        }        .aaaacrsa-selected {            box-shadow: 0 0 0px 2px rgba(0, 180, 255, 1) !important;        }        .crsa-edit {            cursor: default;        }        .pg-partial-container {            box-shadow: 0 0 0px 1px rgba(0, 236, 255, 1) !important;        }        [data-pg-hidden] {display: none !important;}        script-disabled {display: none !important;}        *[contenteditable="true"] {            outline: rgb(255, 215, 0) dotted 2px !important;            outline-offset: 0px !important;        }        .crsa-disable-hover {            pointer-events: none;        }        .crsa-in-drag body {            padding-bottom:200px !important;        }        [data-pg-preview-ref] {            box-shadow: 0 0 0px 1px rgba(0, 236, 255, 1) !important;        }        * {            user-select:none;        }        [contenteditable="true"], [contenteditable="true"] * {            user-select:auto;        }        '},"1"==pinegrow.getSetting("show-placeholders","1")&&(t.css+=".pg-empty-placeholder {            min-height: 100px;            min-width: 100px;            box-shadow: 0 0 0 1px rgba(0,0,0,0.15);            background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAADklEQVQIW2NgQAXGZHAAGioAza6+Hk0AAAAASUVORK5CYII=);        }        ",t.css+="*.pg-no-placeholder:empty {            min-height: inherit;        }        "),t.css+="        .crsa-placed {            opacity: 0.5 !important;        }        html.crsa-stop-animations * {            -webkit-transition-property: none !important;            transition-property: none !important;            -webkit-transform: none !important;            transform: none !important;            -webkit-animation: none !important;            animation: none !important;        }",t.css+=`
:root {
    scroll-behavior: auto !important;
}

html.pg-dm-surprise {
    transition: opacity 0.3s;
    opacity: 0 !important;
}

html.pg-dm-surprise-ended {
    transition: opacity 0.5s;
    opacity: 1 !important;
}

`,pgf.empty_ph_attribute&&"1"==pinegrow.getSetting("show-placeholders","1")&&(t.css+=`
[${pgf.empty_ph_attribute}] {
            min-height: 100px;
            padding-top:1px;
            padding-bottom:1px;
            outline: rgba(200,200,200,0.75) dashed 1px;
    outline-offset: -1px;
            background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAADklEQVQIW2NgQAXGZHAAGioAza6+Hk0AAAAASUVORK5CYII=);
}
`),pgf.kids&&(t.css+=`
h1:empty,p:empty {
    min-height:1em;
}
`),t.css+=`
::highlight(pg-dom-text-highlighter) {
  background-color: yellow;
  color: black;
}        
        `,this.callFrameworkHandler("on_set_inline_style",t),t='<style id="'+cssid+'">'+t.css+"</style>",0==(i=(r=$(getIframeHead(e.get(0)))).find("#"+cssid)).length?r.prepend(t):i.replaceWith($(t)))},this.stopAnimations=function(){$(getIframeHtmlElement(this.$iframe.get(0))).addClass("crsa-stop-animations"),this.animationsStopped=!0},this.startAnimations=function(){$(getIframeHtmlElement(this.$iframe.get(0))).removeClass("crsa-stop-animations"),this.animationsStopped=!1},this.hasStoppedAnimations=function(){return $(getIframeHtmlElement(this.$iframe.get(0))).hasClass("crsa-stop-animations")},this.doWithoutCrsaStyles=function(e){var t=$(getIframeHead(this.$iframe.get(0))),r=t.find("#"+cssid);r.detach(),e(),t.append(r)},this.removeCrsaStyles=function(){pgf.use_webview||$(getIframeHead(this.$iframe.get(0))).find("#"+cssid).detach()},this.getCompatibleUrl=function(e){return crsaIsFileUrl(e)?pinegrow.sourceParser&&(e=pinegrow.httpServer.makeUrl(e)):!this.webapp&&pinegrow.httpServer&&(e=pinegrow.httpServer.makeProxyUrl(e)),e},null);this.getShowNameClassesFilter=function(){return show_name_classes_filter},this.setShowNameClassesFilter=function(e){show_name_classes_filter=e},this.warmupDevTools=function(e){e&&e()}},PgCurrentRequestContext=function(){var g=this,f=isApp(),m={documentNode:null,crsaPage:null,isRemote:!1,remotePath:null,remotePathParts:null,remoteHost:null,base:"",body_element:null,html_element:null,pageView:null};this.makeProxyUrl=function(e){return pinegrow.getProxyUrl(e)},this.releaseRequestContextForPage=function(e){m.crsaPage==e&&this.setCurrentRequestContext(null,null,!1)},this.setCurrentRequestContext=function(e,t,r,i,a){var n;m.crsaPage=i||(t?pinegrow.getCrsaPageOfPgParserNode(t):null),m.documentNode=t,m.previewMode=r||pgf.srcset_mode,m.html_element=null,m.body_element=null,m.pageView=a,t&&(m.html_element=t.findOne("html"),m.body_element=t.findOne("body")),!e||crsaIsFileUrl(e)?(m.isRemote=!1,m.remotePath=null,m.remotePathParts=null,m.remoteHost=null,m.base=""):(m.base="",t&&(n=t.find("base",!0)).length&&(m.base=n[0].getAttr("href")||""),m.isRemote=!0,m.remotePath=crsaRemoveUrlParameters(e).replace(/^[a-z]+:\/\//,""),m.remotePathParts=m.remotePath.split("/"),m.remotePathParts.length&&(m.remoteHost=m.remotePathParts.shift(),m.remotePathParts.length)&&(m.remotePathParts.pop(),m.remotePath=m.remotePathParts.join("/")))},this.createProxyUrlNodeOutputFilter=function(e,t,r,i,a,n){var h,d,u,p,s;if("attrs"!==r||e.script_info||(t=crsaRemoveScripts(t),m.crsaPage&&!m.crsaPage.javascriptEnabled&&(t=t.replace(/\s(on[a-z]*\="[^"]*")/g," pg-disabled-$1"))),"attrs"===r&&("script"===e.tagName||"link"===e.tagName||"img"===e.tagName||"base"===e.tagName||"source"===e.tagName))return h=m.isRemote,d=m.remotePath,u=m.remoteHost,p=m.remotePathParts,s=e.getAttributesString(function(e,t,r,i){var a=t.toLowerCase();if("href"===a||"src"===a){var n;if(r)if(crsaIsAbsoluteUrl(r)){var s=!0;(r=0==r.indexOf("//")?"http:"+r:r).match(/^https?\:\/\//)&&!r.match(/^https?\:\/\/pinegrow\.com\/placeholders/)&&(s=!1),(s="link"===e.tagName&&"stylesheet"===e.getAttribute("rel")&&(s=!0,m.crsaPage.wrapper_url)&&!e.getId()?!1:s)&&(r=g.makeProxyUrl(r))}else if(h){if("base"!==e.tagName){if(null!==d){for(var o=r.split("/"),l=p.length,c=0;c<o.length&&".."==o[c];c++)l--;if(l<0){for(;l<0;)o.shift(),l++;r=o.join("/")}}r.length&&("/"===(r="/"!==r.charAt(0)?m.base+r:r).charAt(0)&&f&&(r=g.makeProxyUrl(r="http://"+u+r)),n=pinegrow.getCurrentProject())&&(r=n.mapSourceUrlToDOMUrl(r))}}else"/"===r.charAt(0)&&(n=pinegrow.getCurrentProject())&&!pgf.root_urls&&(r=n.getUrl()+r,r=g.makeProxyUrl(r))}else{if("integrity"===a)return"";"srcset"===a&&(n=pinegrow.getCurrentProject())&&(r=pgTransformSrcsetUrls(r,function(e){return n.mapSourceUrlToDOMUrl(e)}))}s=null===r?t:t+"="+i+r+i;return crsaRemoveScripts(s)}),"script"===e.tagName&&m.crsaPage&&!m.crsaPage.javascriptEnabled?s.replace(/type\=[\"\'][^\"\']*[\"\']/g,"")+' type="pinegrow/disabled"':s;if("attrs"!==r||"a"!==e.tagName&&"form"!==e.tagName||m.previewMode)if("node"===r&&e.script_info)e.script_info&&(t=m.html_element&&!e.closest("html")&&e.document&&e.document===m.documentNode?"":'<php data-pg-id="'+e.getId()+'" data-pg-script-type="'+e.script_info.type+'">'+escapeHtmlCode(e.content)+"</php>");else{if("attribute"===r){if("style"===i){if(t)return m.pageView&&(t=m.pageView.emulateCSSFeatures(t)),pgAddProxyLinksToStyleAttribute(t)}else if("http-equiv"===i&&"refresh"===a)return'http-equiv="disable-refresh"';return t}"content"===r&&"style"===e.tagName?((s=pinegrow.stylesheets.findCrsaInlineStylesheet(e))&&(t=s.getSourceForRules(null,!0)||t),t=pgAddProxyLinksToStyleAttribute(t),m.pageView&&(t=m.pageView.emulateCSSFeatures(t))):"node"===r&&"html"===e.tagName&&m.pageView&&(m.pageView.isMobileDevice&&(t=t.replace(/\<html/i,"<html data-pg-mobile")),m.pageView.isPgiaEnabled||(t=t.replace(/\<html/i,"<html data-pg-ia-disabled")))}else t=t.replace(/starget\=["'][^"']*["']/g,""),t+=' target="_pg_blank"';return t}},pgCurrentRequestContext=new PgCurrentRequestContext,getCrsaPageForIframe=function(e){var t,r;return e?((t=e.data("crsa-page"))||(r=getPageViewOf$Iframe(e))&&(t=r.getPage(),e.data("crsa-page",t)),t):null},getPageName=function(e){var t=e.split(/[\\\/]/).pop(),r=(t=0==t.length?"index.html":t).split("?");return(t=1<r.length?r[0]:t).length||(t="index.html"),pgUrlToDisplayString(t)},options,pages,crsaPages=($.fn.crsapages=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void $.error("Method "+e+" does not exist on jQuery.crsacss"):methods.init.apply(this,arguments)},[]),currentZoom=1,centerLeft=300,centerRight=300,fitZoom=!1,$body=$("body"),$empty,customPageActions=[],s_ajaxListener=new Object,handleXMLHTTPOpen=function(e,t,r,i,a){console.log("Sync AJAX call to "+t+" changed to async. PG would block otherwise."),s_ajaxListener.tempOpen.call(this,e,t,!0,i,a)},methods={init:function(e){var t;options=$.extend({},$.fn.crsapages.defaults,e),$empty=$(".empty-canvas"),updatePagesList(this),isApp()&&((t=require("nw.gui")).Window.get().on("document-start",function(e){var t;e&&(t=getPageViewOfWindow(e))&&(e.ServiceWorkerContainer&&(e.ServiceWorkerContainer.prototype.register=function(e){return console.log(`Service workers are disabled in Pinegrow: `+e),new Promise(function(e,t){t("Service workers are disabled in Pinegrow.")})}),s_ajaxListener.tempOpen=e.XMLHttpRequest.prototype.open,e.XMLHttpRequest.prototype.open=handleXMLHTTPOpen,t.get$Iframe().trigger("frame-document-start"))}),t.Window.get().on("document-end",function(e){}),t.Window.get().on("new-win-policy",function(e,t,r){console.log("Win open: "+t),t!=window.location.href&&r.ignore()}))},getAllPages:function(){return crsaPages},clearUndoSetFlag:function(){$.each(crsaPages,function(e,t){t.undoSetFlag=!1})},saveAll:function(i){pinegrow.dispatchEvent("on_before_save");var a=[],e=($.each(crsaPages,function(e,t){var r;if(t)return!(!t.live_update||!t.save_parent)||void((t.changed||t.hasCssChanges())&&(r=!1,t.crsaProjectTemplate&&a.indexOf(t.crsaProjectTemplate)<0&&(r=!0,a.push(t.crsaProjectTemplate)),t.save(function(){i&&(t.force_close=!0,t.view)&&t.view.closeTab()},!0,!0,!1,r)))}),pinegrow.getCurrentProject());e&&e.getAllBackgroundPages().forEach(function(e){e.changed&&e.save(function(){})}),pinegrow.saveChangedFrameworks()},downloadAllPages:function(){crsaLoadScript("lib/jszip/jszip.js",function(){function e(){t.html('<a download="PinegrowProject.zip">Download the project Zip file</a></p><p>The zip file contains .html sources of all open pages, stylesheets in .css and .less format as well as Bootstrap files.'),($a=t.find("a")).attr("href",window.URL.createObjectURL(n.generate({type:"blob"})))}function a(){r?r.copyRequiredFilesToZip(n,e):e()}var t=$('<p><i class="fa fa-refresh fa-spin"></i> Preparing the Zip file. Please wait...</p>'),n=(showAlert(t,"Download project"),new JSZip),r=null,i=($.each(crsaPages,function(e,t){n.file(t.name,t.getSource(!0)),t.crsaProjectTemplate&&(r=t.crsaProjectTemplate),t.setPageChanged(!1)}),pinegrow.stylesheets.getAllCrsaStylesheets()),s=0;$.each(i,function(e,r){s++;var i=r.getLessSource();r.getCssSource(function(t){setTimeout(function(){n.file(r.name,t);var e=r.name.replace(/\.css$/i,".less");e==r.name&&(e+=".less"),n.file(e,i),0==--s&&a()},10)})}),0==s&&a()})},addCustomPageAction:function(e,t){customPageActions.push({label:e,func:t})},addPage:function(e,r,t,i,a){var n,s=getPageName(e);return t?n=t:((n=new CrsaPage).name=s,n.webapp=pgf.edit_apps&&!crsaIsFileUrl(e),n.webapp&&((s=new pgParser).parse("<html></html>"),n.sourceNode=s.rootNode),n.setUrl(e)),n.openOptions=a||{},n.loading=!0,n.view?n.view.addView(n):n.view=new PgPageViewTab(n),n.setPageChanged(!1,!0),a&&(a.wrapper_url&&(n.wrapper_url=a.wrapper_url),a.wrapper_selector&&(n.wrapper_selector=a.wrapper_selector),a.original_new_url&&(n.original_new_url=a.original_new_url),a.on_source_parsed)&&(n.onSourceParsed=a.on_source_parsed),crsaPages.push(n),n.view.load(function(e,t){r&&r(e,t)},i),methods.updateFilesName(),updatePagesList(this),n.autoSize(),this},closePage:function(e,t){var r,i=pinegrow.getCurrentProject(),a=(i&&i.loaded_from_backend&&e.changed&&(a=pinegrow.getCurrentProject())&&a.setContentOfUrl(e.url,e.getCodeForSave()),e.onlyCode||(a=e.$page.find("iframe,webview"),r=$("div.canvas"),methods.updateFilesName(e),pinegrow.clearSelectedElements(),$("body").trigger("crsa-page-closed",e),(a=getCrsaPageStylesForPage(a))&&!t&&a.removeAllExclusiveSheets()),crsaPages.indexOf(e));0<=a&&crsaPages.splice(a,1),e.closed_without_saving=e.changed,e.onClose(),e.view&&e.view.closePage(e),pinegrow.lastActivePage.closePage(e),(i=pinegrow.getCurrentProject())&&!i.is_closing_all_pages&&i.pageWasOpenedOrClosed(e,!1),updatePagesList(r),methods.refresh(),pgCurrentRequestContext.releaseRequestContextForPage(e),$("body").trigger("crsa-stylesheets-changed"),$body.trigger("crsa-page-closed-removed",e),pinegrow.dispatchEvent("on_page_closed",e)},updateFilesName:function(e){for(var t,r={},i=0;i<crsaPages.length;i++)crsaPages[i]!=e&&(crsaPages[i].tab_name=crsaPages[i].name,r[crsaPages[i].name]||(r[crsaPages[i].name]=[]),r[crsaPages[i].name].push(crsaPages[i]));for(t in r)if(1<r[t].length)for(var a=r[t],i=0;i<a.length;i++){var n=a[i].name,s=crsaGetBaseForUrl(a[i].url),s=crsaGetNameFromUrl(s);path?a[i].tab_name=path.join(s,n):a[i].tab_name=s+"/"+n,a[i].view.updateTitle(a[i].tab_name)}else r[t][0].view.updateTitle(r[t][0].tab_name)},checkIfPageExists:function(e,i){var t=pinegrow.getCurrentProject();if(t&&t.loaded_from_backend||!crsaIsFileUrl(e))$.ajax({url:e,data:null,dataType:"html"}).done(function(e){i(!0)}).fail(function(e,t,r){i(!1)});else{t=crsaMakeFileFromUrl(e,!0);try{require("fs").statSync(t).isFile()?i(!0):i(!1,"NOT A FILE - Path is a folder")}catch(e){i(!1,e)}}},showOverlays:function(n,s,o){function a(e,t){var r,i=e.find(".content"),a=e.find(".iframe-overlay");n?o?gsap.to(a.get(0),{opacity:0,duration:1,onComplete:function(){a.remove(),s&&a.removeClass(s)}}):(a.remove(),s&&a.removeClass(s)):(r=t.position(),pgf.use_webview&&(r.top=0),0==a.length&&(a=$("<div/>",{class:"iframe-overlay"}).appendTo(i).data("iframe_element",t).css("top",r.top+"px")),gsap.killTweensOf(a.get(0)),s&&a.addClass(s),o&&gsap.to(a.get(0),{opacity:1,duration:.25,onComplete:function(){}}))}pinegrow.getAllPages().forEach(function(e){e.view&&e.getPageViews().forEach(function(e){var t=e.get$Page(),r=e.get$Iframe();a(t,r)})}),$(".page-lib").each(function(e,t){var r=$(t),i=r.find("iframe");a(r,i)})},showLoadingOverlay:function(t,e,r){var i,a=t.get$Iframe(),n=t.get$Page(),s=n.find(".content"),n=n.find(".iframe-loading-overlay"),a=a.position();pgf.use_webview&&(a.top=0),e?n.remove():0==n.length&&(i=pgf.use_webview?'<a href="#">Cancel</a>':"If the page doesn't load check your firewall settings or / and try changing the internal web server port in Support -&gt; Settings.",(n=$("<div/>",{class:"iframe-loading-overlay"}).html('<div><i class="icon-REFRESH icon-spin"></i>Loading, please wait...<p style="padding-left:40px;padding-right:40px;"><small>'+i+"</small></p></div>").appendTo(s).css("top",a.top+"px")).find("a").on("click",function(e){e.preventDefault(),methods.showLoadingOverlay(t,!0),r&&r()}))},showDeviceValue:function(r){var i,a=r.get$Page().find(".device-menu");a&&(i=!1,$.each(options.sizes,function(e,t){if(r.deviceWidth==t)return a.find(">button").html(t+'px <span class="caret"></span>'),i=!0,!1}),i||a.find(">button").html(r.deviceWidth+'px <span class="caret"></span>'))},getZoom:function(e){return e?e.zoom:1},refresh:function(){var e=$("#textedit");e.is(":visible")&&e.width(),methods.centerPages(centerLeft,centerRight),fitZoom?methods.zoom(getFitZoomScale()):methods.zoom(currentZoom)},autoSizePage:function(e,t){sizePage(e,currentZoom,t)},setFit:function(e){fitZoom=e,methods.refresh()},getFit:function(e){return fitZoom},canvasResized:function(){methods.refresh()},zoom:function(e){},centerPages:function(e,t){}},getFitZoomScale=function(){var r=24,i=0,a=r,e=($.each(crsaPages,function(e,t){t.visible&&(i+=t.deviceWidth,a+=r)}),$("div.canvas").width()),n=(e-a)/i,s=200,i=0,a=r;do{var o=!0,l=a;$.each(crsaPages,function(e,t){t.visible&&(t.deviceWidth*n<s?l+=s:(l+=t.deviceWidth*n,o=!1),l+=r)}),e<l&&(n*=.95)}while(!o&&e<l);return n=1<n?1:n},sizePage=function(e,t,r,i){var a=e.closest(".content"),n=(i=i||e.width(),Math.ceil(i*t)),s=$("div.canvas"),o=(s=r?(o=(s=s.height()-50-$.fn.crsa("getPageTabs").getHeight()-pinegrow.statusBar.getHeight())/t,s):(o=Math.ceil(1.05*e[0].contentWindow.document.body.scrollHeight),Math.ceil(o*t)),e.css("height",o+"px").css("width",i+"px"),a.css("width",n+"px").css("height",s+"px"),a.parent());n<225?o.addClass("narrow"):o.removeClass("narrow")},panels_hidden=!0,updatePagesList=function(e){$("#crsa-tree").show(),pages=$("div.page")};function getIframeBody(e){return(e.contentDocument||e.contentWindow.document).body}function getIframeHtmlElement(e){return(e.contentDocument||e.contentWindow.document).getElementsByTagName("html")[0]}function getIframeHead(e){return(e.contentDocument||e.contentWindow.document).getElementsByTagName("head")[0]}function getIframeTag(e,t){return(e.contentDocument||e.contentWindow.document).getElementsByTagName(t)[0]}$.fn.crsapages.defaults={title:"crsa",sizes:{desktop:1600,laptop:1280,"tablet-landscape":1024,"tablet-portrait":768,phone:320}};var pgGetActionsForPageMenu=function(e,r){r=r||pinegrow.getSelectedPage();var t;$("body");r?(pgf.edit_html&&(e.add({label:"Page properties...",action:function(){var e,t=r.sourceNode.findOne("html");t?(pinegrow.showQuickMessage("Select the top HTML element and go to the Properties panel."),pinegrow.selectElement(t),e=pinegrow.showUIPanel("prop"),setTimeout(function(){pgRevealElement(e.get$Element().find(".crsa-field-page-title").parent())},200)):pinegrow.showQuickError("The page does not have the top HTML element.")}}),e.add({type:"divider"}),e.add({label:"Duplicate",action:function(){pinegrow.duplicatePage(r)}})),e.add({label:"Refresh views",kbd:"CMD R",action:function(){r.refresh()}}),pgf.edit_html&&(e.add({label:"Manage stylesheets...",action:function(){$.fn.crsacss("showStylesheetsManager")}}),e.add({label:"Manage libraries &amp; plugins...",action:function(){$.fn.crsacss("showFrameworkManager",r)}}),e.add({label:"Manage breakpoints...",action:function(){r.showManageBreakpoints()}}),pinegrow.isContributorMode()||e.add({label:"Edit code",kbd:"CMD E",action:function(){pinegrow.editCode(r)}}),e.add({label:"Preview in browser",kbd:"CMD B",action:function(){r.openInBrowser()},check:'<i class="icon icon-Pin2"></i>',check_action:function(e){var t;isApp()&&(t=require("nw.gui").Clipboard.get(),$(e.delegateTarget).closest("a"),t.set(r.getPreviewUrl(),"text"),pinegrow.showQuickMessage("Link to the page was copied to the clipboard."),e.stopPropagation(),e.preventDefault())}}),e.add({label:"Get free stock photos from Unsplash...",kbd:null,action:function(){pgShowQuickImageBrowser()}})),t=[],r.sourceNode&&r.callFrameworkHandler("on_page_menu",t),e.addMany(t),e.add({type:"divider",action:function(){}}),e.add({label:"CSS animations",check:function(){return!r.animationsStopped},action:function(){var e=!this.check_value;e?r.startAnimations():r.stopAnimations(),this.setCheckValue(e),pinegrow.showQuickMessage("CSS animations on "+r.getName()+" are "+(e?"ON":"OFF"))}}),e.add({label:"JavaScript enabled",check:function(){return r.javascriptEnabled},action:function(){var e=!this.check_value;r.setJavascriptEnabled(e),this.setCheckValue(e),pinegrow.showQuickMessage("Javascript on "+r.getName()+" is "+(e?"ON":"OFF"))}}),e.add({type:"divider",action:function(){}}),e.add({label:"Close",action:function(){r.askClose()}})):e.add({label:"Open a page first!",action:function(){}})};