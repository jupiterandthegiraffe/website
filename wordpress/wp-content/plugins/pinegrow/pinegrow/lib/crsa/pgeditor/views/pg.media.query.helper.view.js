var PgMediaQueryHelperView=function(a,i,u,e){function t(e){y&&clearTimeout(y),y=setTimeout(function(){e.trigger("change"),y=null},50)}function l(e){var n=x.val();return n&&(e.length?(e=n+" and "+e,0):e=n),e=w.is(":checked")?"only "+(n?"":"screen and ")+e:e}function n(e,n){E=null;var i,a=h(e);d=a.rule,f=a.only,m=a.type,v=a.strange,a.button?(i=H.find('li[data-key="'+M(a.rule)+'"]'),A(i),E=a,n||D(a.button)):n||A(null),w.prop("checked",!!a.only&&"checked"),x.val(a.type)}function o(e,n){e==i&&i.activeView==n&&I()}function s(){O()}var r=a,p=(a.attr("placeholder","Select or enter a media query"),this),c=(this.keep_list_open=void 0!==e&&e,this.breakpoints=i.breakpoints,function(){return i=pinegrow.getSelectedPage()}),g=function(){return(i=c())?i.breakpoints:[]},r=$.trim(r.val()),d="",f=!!localStorage.mediaToolOnly,m=localStorage.mediaToolType||null,v=!0,h=(this.getMediaQuery=function(){return a.val()},function(i){var e,a,t={type:null,only:!1,strange:!0,query:i,rule:"",button:null};return"noquery"==i?t.button=V(i):0<=(e=i.indexOf("("))?(a=i.substr(e),0<=i.indexOf("only ")&&(t.only=!0,a=a.replace("only ","")),$.each(["screen","print"],function(e,n){0<=i.indexOf(n)&&(t.type=n,a=a.replace(n,""))}),t.rule=a.replace(/\s/g,""),t.strange=!1,t.button=V(t.rule)):t.rule=i,t}),y=null,b=$('<div class="media-tool"><ul class="media-list">'+'</ul><div class="media-tool-footer"><div class="checkbox">                <label class="control-label">                    <input type="checkbox" class="ignore"> '+(u?"Ignore in old":"Ignore in old browsers")+'</label>                </div><a href="#" class="manage">'+(u?"Manage&hellip;":"Manage breakpoints&hellip;")+"</a></div></div>"),F="block",w=b.find("input.ignore"),k=$('<div class="media-tool-selected crsa-field">'+(u?"":"<label>Media query</label>")+'<ul class="media-list"></ul><i class="icon icon-close"></i></div>').insertAfter(a.closest(".crsa-field")),_=a.closest(".crsa-field"),S=_.get(0).style.display||"flex",q=b.find(".media-tool-footer"),T=new PgInputField("querytype",{type:"select",show_empty:!0,name:"Type",without_text:!0,default_value:localStorage.mediaToolType||null,options:[{key:"screen",name:"screen"},{key:"print",name:"print"}]}),x=(T.prependTo(q),T.on("input",function(e){}),T.$input),H=b.find("ul"),C=(u&&H.addClass("narrow"),{}),M=function(e){return e.replace(/[\s\"]/g,"")},V=function(e){return C[M(e)]||null},O=function(){C={};function e(){return d='<li class="pg-button media-query submedia-last" data-media="noquery" title="No media query - show on all sizes."><i class="icon icon-see"></i><span class="including">'+(u?"None":"No media query")+"</span></li>",C["noquery"]=d}var n="";if(g().length){p.breakpoints=g();for(var i=0;i<p.breakpoints.length;i++){var a,t,l=crsaSplitCSSValue(p.breakpoints[i]),o=l.value,s="(max-width:"+crsaOneUpCSSValue(l,-1).value+l.unit+")",r="smaller than "+o+" "+l.unit,c=M(s),d='<li data-key="'+c+'" class="pg-button media-query" data-media="'+s+'" title="'+r+'"><i class="icon icon-see"></i><span class="line"></span><span class="excluding">'+o+"</span></li>";n+=C[c]=d,s="(min-width:"+o+l.unit+")",c=M(s),r=o+" "+l.unit+" and up",d='<li data-key="'+c+'" class="pg-button media-query" data-media="'+s+'" title="'+r+'"><i class="icon icon-see"></i><span class="including">'+o+'</span><span class="line"></span></li>',n+=C[c]=d,i<p.breakpoints.length-1?(a=(r=crsaSplitCSSValue(p.breakpoints[i+1])).value,t=crsaOneUpCSSValue(r,-1),s="(min-width:"+o+l.unit+") and (max-width:"+t.value+l.unit+")",d='<li data-key="'+(c=M(s))+'" class="pg-button media-query submedia-last" data-media="'+s+'" title="'+("from "+o+" "+l.unit+" to "+r.value+" "+l.unit)+'"><i class="icon icon-see"></i><span class="including">'+o+'</span><span class="line"></span><span class="excluding">'+a+"</span></li>",n+=C[c]=d):n+=e()}}else n=n+e()+'<li class="no-breakpoints">No breakpoints are defined. Use &quot;<a href="#" class="manage">Manage breakpoints</a>&quot; to define them.</li>';H.html(n),addTooltip(H.find("li"))},E=(O(),null),A=function(e){H.find("li.media-current").removeClass("media-current"),e?e.attr("data-media")&&e.addClass("media-current"):z()},D=function(e,n){var i,a,t=k.find("ul");t.empty(),e?(i=$(e).addClass("media-current"),a=$('<li class="tip">'+("noquery"!=n?i.attr("title"):"Click to select")+"</li>"),i.removeAttr("title"),"noquery"==n?(i.removeClass("media-current"),u&&i.text("Media query..."),pg$Hide(k.find("i.icon-close"))):pg$Show(k.find("i.icon-close"),"inline"),t.append(i),p.keep_list_open||(pg$Show(k,"flex"),pg$Hide(_)),u||t.append(a)):(pg$Hide(k),pg$Show(_,S))},z=function(){A(H.find('li[data-media="noquery"]')),E=h("noquery"),D(E.button,"noquery"),pg$Hide(b)},I=(r?(n(r),pg$Hide(b)):(v=!1,z()),this.showFieldAndSelectors=function(){pg$Hide(k),pg$Show(_,S),a.get(0).focus(),pg$Show(b,F)},k.on("click","li",function(e){e.preventDefault(),p.showFieldAndSelectors()}),k.on("click","i.icon-close",function(e){e.preventDefault(),z(),a.val(""),t(a)}),a.on("blur",function(e){}).on("focus",function(e){}).on("input",function(e){n(a.val(),!0)}).on("changeaaa",function(e){n(a.val())}),v?(x.attr("disabled","disabled"),w.attr("disabled","disabled")):(x.val(m),f&&w.attr("checked","checked"),x.on("change",function(e){a.val(l(d)),localStorage.mediaToolType=x.val()}),w.on("change",function(e){a.val(l(d)),localStorage.mediaToolOnly=w.is(":checked")?"1":"0"})),d.replace(/\s/g,""),function(){var t=c().getWindow();H.find("li").each(function(e,n){var i=$(n),a=i.attr("data-media");a&&(t&&(0==a.length||t.matchMedia(a).matches)?i.addClass("media-match"):i.removeClass("media-match"))}),H.find("i.icon-see").tooltip("destroy"),addTooltip(H.find("i.icon-see:visible"),"Matches current window size ("+c().activeView.deviceWidth+"px).")}),q=(I(),H.on("click","li.media-query",function(e){e.preventDefault();var n,i=$(this),i=(A(i),i.attr("data-media"));"noquery"!=i?(n=l(i),a.val(n),E=h(n),D(E.button,i)):(E=h(i),D(E.button,i),a.val("")),p.keep_list_open||pg$Hide(b),t(a),setTimeout(function(){0},100)}),b.find(".manage").on("click",function(e){e.preventDefault(),c().showManageBreakpoints()}),new PgUIView(b));this.view=q,this.keep_list_open&&this.showFieldAndSelectors();this.updateMediaValue=function(e){n(e)},q.on("crsa-breakpoints-changed",s),pinegrow.addEventHandler("on_selected_elements_changed",s),pinegrow.addEventHandler("on_active_page_view_changed",o),pinegrow.addEventHandler("on_page_view_resized",o),q.onDestroy=function(){pinegrow.removeEventHandler("on_selected_elements_changed",s),pinegrow.removeEventHandler("on_active_page_view_changed",o),pinegrow.removeEventHandler("on_page_view_resized",o)}};