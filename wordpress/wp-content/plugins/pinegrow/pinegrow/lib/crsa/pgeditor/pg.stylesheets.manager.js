var PgGoogleFontManager=function(){var t="AIzaSyCTphlYszhVyhJKDwKgUDdl64PfPaXxXUI",d="Pinegrow web editor, asset manager.",r="https://fonts.googleapis.com/css?family=",n={regular:"Regular",100:"Thin",200:"Extra light",300:"Light",400:"Regular",500:"Medium",600:"Normal",700:"Bold",800:"Extra bold",900:"Black"};const x="swap";function p(){var t=$(this).closest("li"),e=b[parseInt(t.attr("data-index"))];$(this).is(":checked")?(y[e.family]=e,t.addClass("checked")):(y[e.family]&&delete y[e.family],t.removeClass("checked"))}function h(t){t.preventDefault();var e=$(this).closest("li"),n=e.data("included_font"),a=parseInt(e.attr("data-index")),a=b[a];g.openSettingsFor(a,n,function(){},function(){e.find('[type="checkbox"]').prop("checked",!0).change()})}function c(d){function e(){if(!_){c.show();var t=20*(w-1),e=20*w;if(t>=b.length)_=!0,c.hide();else{e>=b.length&&(e=b.length,_=!0,c.hide());for(var n,a=t;a<e;a++){var i=g.getIncludedFont(b[a]),o=$('<li data-index="'+a+'"></li>').appendTo(d),i=(o.data("included_font",i),$(`<input type="checkbox" ${i?"checked":""}>`).appendTo(o)),s=($("head").append('<link href="'+(n=b[a],s=l=void 0,(l=[]).push(r),l.push(n.family.replace(/ /g,"+")),s=n.variants.map(function(t){var e=F(t);return e["font-weight"]+("italic"==e["font-style"]?"italic":"")}),l.push(":"+s.join(",")),l.push("&subset="+n.subsets.join(",")),l.join(""))+'" rel="stylesheet">'),$("<h3 class='font-preview' style='font-family:"+b[a].family+";'><span>"+T+"</span></h3>").appendTo(o)),l=$('<i class="advance-settings-icon pull-right glyphicon glyphicon-cog"></i>').appendTo(s);$("<p class='more-info'><b>"+b[a].family+"</b>, category: "+b[a].category+"</p>").appendTo(o),i.change(p),l.click(h)}u=d}}}var t=d.closest(".modal-body"),n=t.find("> div"),c=t.find(".loading-icon"),a=t.find(".load-fonts-failed"),i=a.find("> a");t.on("scroll",function(){var t=n.closest(".modal-dialog").height()+30;n.height()+n.offset().top<t&&!_&&(w++,e())}),g.loadFonts(function(t){t?(pinegrow.showQuickMessage("There is a problem with calling google fonts"),c.hide(),a.show()):u||e()}),i.on("click",function(t){c.show(),a.hide(),loadFontsArray(),t.preventDefault()})}function a(t,e){var n=t.info;n&&$('<i class="glyphicon glyphicon-copy" title="Copy family name to clipboard"></i>').appendTo(e).click(function(t){t.preventDefault(),crsaCopyToClipboard(n),pinegrow.showQuickMessage("Font name copied to your clipboard...")})}function f(){_=!(w=1),u=null,b=m}var T=d,u=null,g=this,y={},v=[],w=1,m=[],b=[],_=!1,F=function(t){var e=t.match(/([0-9]+)([a-z]*)/),n={},a=(e?(n["font-weight"]=e[1],n["font-style"]=e[2]||"normal"):(n["font-weight"]="400","regular"==t?n["font-style"]="normal":"italic"==t&&(n["font-style"]="italic")),t);return e&&(a=e[1]),n["text"]=g.getWeightText(a="regular"!=a&&"italic"!=a?a:400,n["font-style"]),n},C=(this.getWeightText=function(t,e){return n[t]+` ${t} `+("italic"==e?"italic":"")},this.getIncludedFont=function(t){for(var e=0;e<v.length;e++){var n=v[e];if(t.family==n.family)return n}return null},this.loadFonts=function(e){m&&0!=m.length?e&&e(null,m):$.ajax({type:"GET",url:"https://www.googleapis.com/webfonts/v1/webfonts",data:{key:t},success:function(t){m=t.items,b=m,e&&e(null,t)},error:function(t){e&&e(t)}})},this.openSettingsFor=function(a,t,e,n){for(var i=$('<div class="advance-settings pg-dialog-fields"></div>'),o=$('<div class="advance-settings-content"></div>').appendTo(i),s=$('<div class="font-style"><h4>Font styles</h4></div>').appendTo(o),l=$('<table width="100%" style="font-family:'+a.family+';"><tbody></tbody></table>').appendTo(s).find("> tbody"),d=a.variants,c=0;c<d.length;c++){var r=F(d[c]),p=function(t,e){if(e&&e.included_varients&&0<e.included_varients.length){var n="regular"==(t=t)?"400":"italic"==t?"400italic":t;if(-1<e.included_varients.indexOf(n))return!0}return!1}(d[c],t),h=$('<tr style="font-weight:'+r["font-weight"]+";font-style:"+r["font-style"]+';"></tr>').appendTo(l),f=$('<td width="30%"></td>').appendTo(h),u=$('<input data-font-weight="'+r["font-weight"]+'" data-font-style="'+r["font-style"]+'" type="checkbox" '+(p?"checked":"")+">").appendTo(f),f=($("<span> "+r["text"]+"</span>").appendTo(f),$('<td width="70%">'+T+"</td>").appendTo(h),u.change(function(t){var e=$(this).attr("data-font-weight")+("italic"==$(this).attr("data-font-style")?"italic":"");a.wanted_weights_and_style||(a.wanted_weights_and_style=[]),$(this).is(":checked")?a.wanted_weights_and_style.indexOf(e)<0&&a.wanted_weights_and_style.push(e):-1<(e=a.wanted_weights_and_style.indexOf(e))&&e<a.wanted_weights_and_style.length&&a.wanted_weights_and_style.splice(e,1)}),r["font-weight"]+("italic"==r["font-style"]?"italic":""));a.wanted_weights_and_style&&-1<a.wanted_weights_and_style.indexOf(f)&&u.prop("checked",!0).change()}for(var g,y,v,w=$('<div class="font-charset"><h4>Character sets</h4></div>').appendTo(o),m=(pg$Hide(w),a.subsets),c=0;c<m.length;c++){var b=m[c],p=(y=b,!!((v=t)&&v.included_subset&&0<v.included_subset.length&&-1<v.included_subset.indexOf(y))),_=$('<span class="subset-option"></span>').appendTo(w),u=$('<input data-subset="'+b+'" type="checkbox" '+(p?"checked":"")+">").appendTo(_);$("<span> "+(g=void 0,g=b.split("-"),crsaCamelize(g[0]))+("ext"==g[1]?" Extended":"")+" </span>").appendTo(_);u.change(function(t){var n,e;a.wanted_subsets=(n=[],w.find('[type="checkbox"]').each(function(t,e){!$(e).is(":disabled")&&$(e).is(":checked")&&n.push($(e).attr("data-subset"))}),e=w.find('[data-subset="latin"]'),0<n.length?1==n.length&&"latin"==n[0]?(e.attr("disabled",""),n=[]):e.is(":disabled")&&(e.removeAttr("disabled"),e.is(":checked"))&&n.push("latin"):e.prop("checked",!0).attr("disabled",""),n)}),a.wanted_subsets?-1<a.wanted_subsets.indexOf(b)&&u.prop("checked",!0).change():"latin"==b&&(u.prop("checked",!0),u.attr("disabled",""))}var s=$('<div class="font-display"><h4>Font display</h4></div>').appendTo(o),k=new PgPropertyField(s,null,"googlefont.display",{type:"select",name:"Font display",action:"custom",show_empty:!0,options:[{name:"Auto",key:"auto"},{name:"Block",key:"block"},{name:"Swap",key:"swap"},{name:"Fallback",key:"fallback"},{name:"Optional",key:"optional"}],get_value:function(t){},set_value:function(t,e,n){a.wanted_display=e},helptext:`<p>Decide what to do while the font is loading:</p><ul>
            <li><p><b>Auto</b> - Text will be hidden until the font is loaded, unless browser decides that the waiting is too long. This is the default behavior.</p></li>
            <li><p><b>Block</b> - The closest available font is used to display the text while the font is loaded. Recommended setting for best performance.</p></li>
            <li><p><b>Swap</b> - Text will be hidden until the font is loaded.</p></li>
            <li><p><b>Fallback</b> - Text is hidden for a very short time and if the font is not loaded till then, the closest available font is used. This is a good alternative to swap if you want to avoid showing unsettled text.</p></li>
            <li><p><b>Optional</b> - Let the browser decide whether to use the font or not.</p></li>
            </ul>`},[]);k.$field.find("label").css("width","auto"),a.wanted_display?k.setValue(a.wanted_display):t&&t.included_display?k.setValue(t.included_display):k.setValue(x),makeModalDialog("Styles","Cancel","Accept",i,function(){e&&e()},function(){a.wanted_display=k.getValue();var t=C(a);n&&n(a,t)},null,!0)},function(t){return{url:(e=t,(n=[]).push(r),n.push(e.family.replace(/ /g,"+")),e.wanted_weights_and_style&&0<e.wanted_weights_and_style.length&&n.push(":"+e.wanted_weights_and_style.join(",")),e.wanted_subsets&&0<e.wanted_subsets.length&&n.push("&subset="+e.wanted_subsets.join(",")),n.push("&display="+(e.wanted_display||x)),n.join("")),name:t.family,action:a,category:t.category,variants:t.variants,subsets:t.subsets,wanted_styles:t.wanted_weights_and_style};var e,n});this.getFont=function(t){var e=function(t){for(var e={},n=t.replace("https://fonts.googleapis.com/css?","").split("&"),a=0;a<n.length;a++){var i,o=n[a].split("=");"family"==o[0]?(i=o[1].split(":"),e["family"]=i[0].replace(/\+/g," "),i[1]&&(e["variants"]=i[1].split(","))):"subset"==o[0]?e["subset"]=o[1].split(","):"display"==o[0]&&(e["display"]=o[1])}for(var s=e.variants||[],a=0;a<s.length;a++){var l=s[a];l.endsWith("i")&&(s[a]=l.replace("i","italic"))}return{...e,variants:s}}(t),n=null;for(let i=0;i<m.length;i++){var a=m[i];if(a.family==e.family){n=a;break}}return n={...n,wanted_weights_and_style:e["variants"],wanted_subsets:e["subset"],wanted_display:e["display"]}},this.show=function(n){y={},v=getAttachedGoogleFonts(pinegrow.getSelectedPage());function t(t){if(13===t.keyCode)return t.preventDefault(),!1}var e=$('<div class="gfonts-modal"><p>Choose fonts you want to add to your page</p></div>'),a=$('<div class="row"></div>').appendTo(e),i=$('<div class="col-sm-6 col-xs-12"></div>').appendTo(a),a=$('<div class="col-sm-6 col-xs-12"></div>').appendTo(a),o=$('<form class="form-inline font-search"><div class="form-group"><label for="search-for-font">Search:</label><input type="search" class="form-control" placeholder="Search by font name..." style="margin: 10px 2px; min-width: 250px" id="search-for-font"></div></form>').appendTo(i).find("input"),s=$('<form class="form-inline font-preview-text"><div class="form-group"><label for="font-preview-text">Preview text:</label><input type="text" class="form-control" placeholder="Preview text..." style="margin: 10px 2px; min-width: 250px" id="font-preview-text"></div></form>').appendTo(a).find("input"),l=(makeModalDialog("Google fonts","Close","Add selected fonts",e,function(){n&&n([])},function(){if(n){var t,e=[];for(t in y)e.push(C(y[t]));n(e)}},null,!0),$('<ul class="gfonts-list"></ul>').appendTo(e));$('<center class="loading-icon"><img src="lib/crsa/images/loading.GIF"></center>').appendTo(e),$('<p class="load-fonts-failed text-center text-danger" style="display:none;"><strong>Failed to load fonts, check your internet connection.</strong> <a href="#" class="refresh-content">Refresh</a></div>').appendTo(e),f(),c(l);o.on("input",function(t){t.preventDefault(),b=o.val()?(_=!(w=1),u=null,m.filter(function(t){if(t.family)return t.family.toLowerCase().match(o.val().toLowerCase())})):(f(),m),l.html(""),c(l)}),s.on("input",function(t){t.preventDefault(),T=s.val()?s.val():d,l.find("h3 > span").html(T)}),o.on("keypress",t),s.on("keypress",t)},this.checkForLinks=function(t){for(var e=getAttachedGoogleFonts(t),n=0;n<e.length;n++)e[n].action=a;return e},this.addNotes=function(t){$('<span>Click on <i class="glyphicon glyphicon-copy"></i> icon to copy the family name to clipboard. Then paste it into the Font family property of the CSS rule.</span>').appendTo(t)},this.getFontOptions=function(t){for(var e=[],n=0;n<m.length;n++){for(var a=m[n],i=0;i<t.length;i++){var o=t[i];if(o.name==a.family){e.push({...o,...a}),t.splice(i,1);break}}if(0==t.length)break}return 0<e.length?e:t},this.init=function(){this.loadFonts(function(t){t&&console.log("Error: Can't load Google fonts")})}};