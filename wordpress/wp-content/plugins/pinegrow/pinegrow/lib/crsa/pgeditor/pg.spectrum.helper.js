window.PgSpectrumHelper=function(r,a,l){$("body");var e=null,p=new WeakMap;r.data("pg-spectrum-helper",this),(a=a||{})["mouse-moved"]=a["mouse-moved"]||null,a["color-picked"]=a["color-picked"]||null;function s(e){e.pageX===o&&e.pageY===t||(o=e.pageX,t=e.pageY,i.run("move",function(){c(e)},200))}function d(e){i.runAllNow(),v(),u=!1}var n=function(e){var o;if(null!=n)return e.preventDefault(),$(this).data("color-picked",!0),(o=$(this).data("selected-jq-element"))&&0<o.length&&(a["color-picked"]&&a["color-picked"](o),$(this).data("selected-jq-element",null)),o.spectrum("hide"),!1},o=0,t=0,i=new PgDelayedTasks,c=function(e){var o=e.target,o=$(o).offset(),o={x:e.pageX-o.left,y:e.pageY-o.top},n=p.get(e.view);n&&(o="#"+("000000"+function(e,o,n){if(255<e||255<o||255<n)throw"Invalid color component";return(e<<16|o<<8|n).toString(16)}((n=n.getImageData(o.x,o.y,1,1).data)[0],n[1],n[2])).slice(-6),r.spectrum("set",o),a["mouse-moved"]&&a["mouse-moved"](r),r.spectrum("get"))},u=!1,g=null,m="click",v=(r.on("show.spectrum",function(e,o){u=!1;r.spectrum("get");var n=r.spectrum("container").find(".sp-button-container"),t=n.find(".pg-sp-pick-color");if(0==t.length){t=$('<div class="pg-sp-pick-color" draggable="true"><i class="icon icon-pipet"></i></div>'),isApp()&&t.prependTo(n);var i=$('<div class="pg-sp-pick-color-system"><input type="color"/></div>');pgf.kids||i.prependTo(n),($pick_input=i.find("input")).on("input change",function(e){var o=$pick_input.val();r.spectrum("set",o),a["mouse-moved"]&&a["mouse-moved"](r)});const c="MULTIPLE WINDOWS OPEN: ";1<pgGetAppWindows().length&&(m="drag"),addTooltip(t,"click"===m?"Click to pick a color from anywhere in Pinegrow window.":c+"<b>Drag the picker icon</b> over Pinegrow windows to pick the color."),addTooltip(i,"Click to open system color picker.");"click"!==m&&t.on("click",function(e){e.preventDefault(),pinegrow.showQuickError(c+"Drag the picker icon over Pinegrow windows to pick the color.")}),t.on("click"===m?"click":"dragstart",function(e){var o;u=!u,pinegrow.showMode("Pick a color from the screen",u),u?(t.addClass("active"),(o=document.createElement("img")).src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",t.closest("body").append(o),g=o,e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.setDragImage(o,0,0),pgGetAppWindows().forEach(function(i){$(i.window).on("click"===m?"mousemove":"dragover",s),pinegrow.takePhotoOfUI(function(e,o,n){var t;u&&(t=r.siblings(".sp-replacer"),l||0!=t.length&&t.hasClass("sp-active"))&&(t=e.getContext("2d"),p.set(i.window,t),(t=$('<div class="color-picker-overlay close"></div>')).appendTo(i.window.document.body),t.removeClass("close"),t.data("selected-jq-element",r))},!0,i)}),$(t.get(0).ownerDocument).one("click"===m?"click":"dragend",d)):(v(),t.removeClass("active"))})}else t.removeClass("active")}),function(){pgGetAppWindows().forEach(function(e){$(e.window.document.body).find(".color-picker-overlay").remove()}),g&&($(g).remove(),g=null)});r.on("hide.spectrum",function(e,o){v(),pgGetAppWindows().forEach(function(e){$(e.window).off("click"===m?"mousemove":"dragover",s)})}),this.remove=function(){e&&0<e.length&&(e.off("click",n),e.remove()),n=null}};