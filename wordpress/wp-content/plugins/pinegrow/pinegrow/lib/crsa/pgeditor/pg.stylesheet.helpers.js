window.PgStylesheetHelper=function(){function u(e,t,r,n,o){var l=setInterval(function(){if(e.styleSheets.length>t)try{clearInterval(l),clearTimeout(s),r?r()&&o&&o(!0):o&&o(!0)}catch(e){}},10),s=setTimeout(function(){clearInterval(l),clearTimeout(s),n&&n(),o&&o(!1)},1e4)}var t=null;$.getJSON("scss-prop.json",function(e){t=e});return{getStylesheetFromNode:function(e){return pinegrow.pgPostCSSHelper.getRootNodeFor(e).pgStylesheet},getNormalizedSelectorForStylesheetRule:function(e){return e.selectorText?(e.crsaNormalizedSelector||(e.crsaNormalizedSelector=normalizeSelector(e.selectorText)),e.crsaNormalizedSelector):null},loadStyleSheet:function(e,t,r,n,o){var l,s,a=e.getDocument(),i=e.sourceNode.findOne("head");return i?(l=pgCreateNodeFromHtml('<link href="'+t+'" rel="stylesheet" type="text/css">'),s=a.styleSheets.length-1,u(a,s,function(){return l},function(){l.remove()},function(e){r(e?l:null)}),n?n.replaceWith(l):(a=null,(a=o?i.findOne('link[rel="stylesheet"]'):a)?l.insertBefore(a):i.append(l)),l):null},loadInlineStylesheet:function(e,t,r){var n,o,l,s=e.sourceNode.findOne("head");return s?(n=pgCreate("<style></style>"),l=(o=e.activeView.getDocument()).styleSheets.length,u(o,l,null,null,function(e){n.getDOMElement();t(e?n:null)}),r?r.replaceWith(n):s.append(n),n):null},getAllStylesheetsFor:function(e){function n(e){if(!e.ignore||e.sourceStylesheet&&!e.sourceStylesheet.ignore){e.sourceStylesheet&&(e=e.sourceStylesheet),o.push(e);for(var t=e.importedFiles,r=0;r<t.length;r++)n(t[r])}}var o=[];return n(e),o},getSCSSAutocomleteProps:function(){return t},getParentStylesheetBySelector:function(e,t){for(var r=e.selectors,n=0;n<r.length;n++){var o=r[n].text.match(/pg-main-(.*)/);if(o&&0<o.length)return o=o[1],pinegrow.stylesheets.findCrsaStylesheetForUniqueName(o).getMainParnetStylesheetFor(t)}return null},getImportedStylesheetBySelector:function(e,t){var r=t.text.match(/pg-file-(.*)/);return r&&-1<r.length?e.getImportedStylesheetsByUniqueName(r[1]):null}}},window.PgPostCSSHelper=function(){function u(e,t){var r={raws:{}};return e&&e.raws&&"root"!==e.type?(r.raws.before=e.raws.before,e.nodes&&0==e.nodes.length&&(r.raws.before=r.raws.before.replace(/\n\n/,"\n"),r.raws.before+="  ")):r.raws.before="\n",t&&t.setNodeNeedFormatting(r,!0,!1),r}var e=require("postcss"),d=e.postcss,r=e.postcssSafeParser;return{getNodePositionInSource:function(e){var t={start:{ch:0,line:0},end:{ch:0,line:0}},r=pgcssh.getStylesheetForNode(e);if(e.parent){e.pg_highlight=!0;for(var n,r=r.getSourceForRules(),o=(delete e.pg_highlight,"/*PG_START*/"),l="/*PG_END*/",s=!1,a=r.split("\n"),i=0;i<a.length;i++)if(s||0<=(n=a[i].indexOf(o))&&(t.start.ch=n+1,t.start.line=i+1,s=!0),s&&0<=(n=a[i].indexOf(l))){t.end.line=i+1,t.end.ch=t.start.line===i+1?n-o.length:n+1;break}}return t},getSource:function(e,t,r){return e.toString(t)},wrapNodeWithRoot:function(e){return d.root({nodes:e})},parsedCSSSourceFromText:function(e,n){var t=d().process(e,{parser:r});t.then(function(e){var t=e.css,r=e.root;n&&n(null,t,r)}),t.error&&(t=t.error.reason+":"+t.error.line,n)&&n(t)},isCommented:function(e){return"comment"==e.type||e.ignore},getSelector:function(e){return(e=e).selector?(e.crsaNormalizedSelector||(e.crsaNormalizedSelector=normalizeSelector(e.selector)),e.crsaNormalizedSelector):""},forAllNodes:function(e,n){var o;n&&(n(e),o=function(e){for(var t=0;t<e.length;t++){var r=e[t];n(r),r.nodes&&0<r.nodes.length&&o(r.nodes)}},e.nodes)&&o(e.nodes)},getNodeFromText:function(e,t,r,n){var o,l,s,a,i;return e&&0!=e.length?(o=u(t,n),e=e.trim(),a=t&&"root"==t.type,s=-1<e.indexOf("(")&&e.indexOf("(")<e.indexOf(":"),a=-1<e.indexOf(".")&&e.indexOf(":")<0||"{"==e[e.length-1]||a&&"$"!=e[0]&&"@"!=e[0],i="/*"==e.substr(0,2)||"*/"==e.substr(e.length-2,e.length),"@"==e[0]&&(e.indexOf(":")<0||s)||"atrule"==r?(r&&"@"!=e[0]||(e=e.substr(1,e.length).trim()),o.name=e,o.params="",o.raws.afterName=" ",o.raws.after="\n",l=d.atRule(o)):i||"comment"==r?l=d.comment({text:e.substr(2,e.length-4).trim()}):a||"rule"==r?("{"==e[e.length-1]&&(e=e.substr(0,e.length-1).trim()),o.selector=e,o.raws.between=" ",o.raws.after=o.raws.before.replace(/\n\n/,"\n"),o.nodes=[],l=d.rule(o)):(s=!1,-1==e.indexOf(":")&&t&&("rule"==t.type&&0<t.nodes.length||"decl"!=t.type&&"root"!=t.type&&(a=(i=t.parent.nodes).indexOf(t),i=i[a+1])&&"rule"==i.type)&&(l=pinegrow.pgPostCSSHelper.createNode("rule",e,null,t,n),s=!0),s||(":"==(o.prop=e)[e.length-1]&&pgcssh.setNodeProperty(o,"prop",e.substr(0,e.length-1).trim()),pgcssh.setNodeProperty(o,"value",""),o.raws.after="\n",o.raws.between=": ",l=d.decl(o))),l):null},copyNodeRawsTo:function(e,t){return e.raws.before=t.raws.before,e},getNodeIndices:function(e){if(!e)return null;for(var t=[],r=e;"root"!=r.type&&r.parent;)t.unshift(r.parent.nodes.indexOf(r)),r=r.parent;return t},getNodeByIndices:function(e,t){for(var r=e,n=0;n<t.length&&r;n++){if(!r||!r.nodes){r=null;break}r=r.nodes[parseInt(t[n])]}return r},getNodeLevel:function(e){for(var t=0,r=e;r.parent&&"root"!=r.parent.type;)t++,r=r.parent;return t},getNodeLevelFromIndices:function(e){var t=e.length-1;return t<0?null:t},getLastDeclIndex:function(e){for(var t=e.nodes,r=-1,r=t.length-1;0<=r;r--){var n=t[r];if(pgcssh.isVariable(n)||"decl"==n.type)break}return r=r<0?-1:r},replaceNodeWith:function(e,t){var r=e.parent.nodes.indexOf(e);return t.parent=e.parent,(e.parent.nodes[r]=t).pg_old_values=e.pg_old_values||{},t},replaceNodeWithAndUpdatePgId:function(e,t){return(t=pinegrow.pgPostCSSHelper.replaceNodeWith(e,t))["pg-node-id"]=e["pg-node-id"],t.pg_old_values=e.pg_old_values||{},t},insertNodeAt:function(e,t,r){return(e.parent=t).nodes.splice(r,0,e),e},insertNodesAt:function(e,t,r){for(var n=0;n<e.length;n++)pinegrow.pgPostCSSHelper.insertNodeAt(e[n],t,r),r++},insertNodeBefore:function(e,t){e.parent=t.parent;var r=e.parent.nodes.indexOf(t);return e.parent.nodes.splice(r,0,e),e},insertNodeAfter:function(e,t){e.parent=t.parent;var r=e.parent.nodes.indexOf(t);return e.parent.nodes.splice(r+1,0,e),e},insertNodeInside:function(e,t){return(e.parent=t).nodes||(t.nodes=[]),t.nodes[t.nodes.length]=e},insertNodesInside:function(e,t){for(var r=0;r<e.length;r++)pinegrow.pgPostCSSHelper.insertNodeInside(e[r],t)},isNodeEqualOrChildOf:function(e,t){if(!e||!t)return!1;var r=pgStylesheetHelper.getStylesheetFromNode(e),n=pgStylesheetHelper.getStylesheetFromNode(t),o=!1;if(r&&n&&r.getUniqueName()==n.getUniqueName()){var l={pgStylesheet:n,node:t},s=(l["nodeIndices"]=pinegrow.pgPostCSSHelper.getNodeIndices(l.node),l["level"]=pinegrow.pgPostCSSHelper.getNodeLevelFromIndices(l["nodeIndices"]),l["currLevelIndex"]=parseInt(l.nodeIndices[l.level])||0,l["currParentLevelIndex"]=parseInt(l.nodeIndices[l.level-1])||0,{pgStylesheet:r,node:e,nodeIndices:pinegrow.pgPostCSSHelper.getNodeIndices(e)});if(s["level"]=pinegrow.pgPostCSSHelper.getNodeLevelFromIndices(s["nodeIndices"]),s["currLevelIndex"]=parseInt(s.nodeIndices[l.level])||0,s["currParentLevelIndex"]=parseInt(s.nodeIndices[l.level-1])||0,s.level<=l.level)for(var o=!0,a=0;a<s.level+1;a++)if(s.nodeIndices[a]!=l.nodeIndices[a]){o=!1;break}}return o},getNodesWithRegex:function(e,t,r,n){var o=[],l=0,s=n.nodes;s&&(l=s.length);for(var a=0;a<l;a++){var i,u=s[a];u.type==e&&u[t]&&(i=u[t].match(r))&&1<i.length&&i[1]==u[t]&&o.push(u)}return o},removeNodeFrom:function(e,t){var r;if(e)return r=(t=t||e.parent).nodes.indexOf(e),t.nodes.splice(r,1),e.is_removed=!0,e},removeNodeWidthRegexFrom:function(e,t,r,n){for(var o=n.nodes,l=0;l<o.length;l++){var s,a=o[l];a.type==e&&a[t]&&(s=a[t].match(r))&&1<s.length&&s[1]==a[t]&&(pinegrow.pgPostCSSHelper.removeNodeFrom(a),l--)}},copyNode:function(e){var t=pgcssh.getStylesheetForNode(e);return"comment"==e.type?PgPostCSSHelper().createNode(e.type,e.text,null,e,t):"decl"==e.type?PgPostCSSHelper().createNode(e.type,e.prop,e.value,e,t):"rule"==e.type?PgPostCSSHelper().createNode(e.type,e.selector,null,e,t):"atrule"==e.type?PgPostCSSHelper().createNode(e.type,e.name,e.params,e,t):void 0},createNode:function(e,t,r,n,o){var l,s=u(n,o);return"comment"==e&&(s.text=t,(l=d.comment(s)).raws={begin:"/*",content:"/* "+t+" */"}),"decl"==e?(s.prop=t,s.value=r,s.raws.between=": ",l=d.decl(s)):"rule"==e?(s.selector=t,s.raws.between=" ",s.raws.after=s.raws.before.replace(/\n\n/,"\n"),s.nodes=[],l=d.rule(s)):"atrule"==e&&(s.name=t,s.params=r,s.raws.between=" ",s.raws.afterName=" ",s.raws.after="\n",l=d.atRule(s)),l},renameRuleSelector:function(e,t){return!("rule"!=e.type||!e.selector||(e.selector=t,0))},closestNode:function(e,t){for(var r=e.parent;r&&r.type!=t;)r=r.parent;return r},getNodeType:function(e){return"atrule"==e.type&&"import"==e.name?"import":e.type},getRootNodeFor:function(e){for(var t=e;"root"!=t.type&&t.parent;)t=t.parent;return t},getTopLevelNodeFor:function(e){for(var t=e;"root"!=t.parent.type&&t.parent;)t=t.parent;return t},getStylesheetForNode:function(e){return this.getRootNodeFor(e).pgStylesheet||null},getChildrenDeclWithPropName:function(e,t){for(var r=[],n=0;n<e.nodes.length;n++){var o=e.nodes[n];o&&"decl"==o.type&&o.prop==t&&r.push(o)}return r},addPgIdToSelector:function(e){function r(e){for(var t=0;t<e.length;t++)"rule"==e[t].type&&(e[t]["selector"]=e[t]["selector"].replace(/\,\s\.pg-node-id-[0-9]*/g,""),e[t]["pg-node-id"])&&(e[t]["selector"]+=", .pg-node-id-"+e[t]["pg-node-id"]),e[t].nodes&&0<e[t].nodes.length&&r(e[t].nodes)}r(e)},shouldAddPlaceholder:function(e){var t=!0,r=e.nodes;if(r){for(var n=0;n<r.length;n++)if("decl"==r[n].type){t=!1;break}}else t=!1;return t},addEmptyPlaceholderForEmptyRule:function(e,t){var r;return e=t&&-1<(r=e.indexOf("{"))?e.substr(0,r+1)+"--pg-empty-placeholder:0px;"+e.substr(r+1,e.length):e},getMediaNode:function(e){if(e.parent)for(var t=e.parent;t;){if("atrule"===t.type&&"media"===t.name)return t;t=t.parent||null}return null},getSupportsAtruleNode:function(e){if(e.parent)for(var t=e.parent;t;){if("atrule"===t.type&&"supports"===t.name)return t;t=t.parent||null}return null},getAtRuleValue:function(e){return e&&"atrule"==e.type?e.params:null},getRuleForNode:function(e){var t=e;return"root"==(t="rule"!=t.type&&"root"!=t.type?t.parent:t).type?null:"rule"==t.type?t:void 0},setNodeProperty:function(e,t,r){e.pg_old_values=e.pg_old_values||{},t in e.pg_old_values||(e.pg_old_values[t]=e[t]||null),e[t]=r},getNodeOldValues:function(e){return null},getValuesFromNode:function(e){return"decl"==e.type?{prop:e.prop,value:e.value}:"rule"==e.type?{selector:e.selector}:"atrule"==e.type||"import"==e.type?{name:e.name,param:name.param}:"comment"==e.type?{text:e.text}:void 0},copyOldValuesToNode:function(r,e){e&&$.each(e,function(e,t){r[e]=t})},getSelectorWithoutPgId:function(e){return e.replace(/,\s?\.pg\-node\-id\-[0-9]+/,"")},getNodeDisplayName:function(e){var t,r;return e?(r="",(t=this.getRuleForNode(e))?t.selector?r=this.getSelectorWithoutPgId(t.selector):t.raw&&(r=t.raw):"comment"==e.type?r=e.text:"atrule"==e.type&&(r=e.name+" "+e.params),r=shortenString(r,10),t!=e&&"decl"==e.type&&(r+=" "+e.prop),r):"node"},getRuleDisplayName:function(e){for(var t=e,r="";t.parent&&"root"!==t.type;)"rule"===t.type?r=this.getSelectorWithoutPgId(t.selector)+(r.length?" ":"")+r:"atrule"!==t.type||"media"!==t.name&&"supports"!==t.name||(r=t.params+(r.length?" ":"")+r),t=t.parent;return r},filterStylesheetsList:function(e,t){t=$.extend({loaded:!0,ignored:!0,imported:!0,inline:!0,locked:!0,remote:!0},t||{});var r=[];return e.forEach(function(e){!e.loaded&&!t.loaded||e.ignore&&!t.ignored||e.isImported()&&!t.imported||e.inline&&!t.inline||e.locked&&!t.locked||!t.remote&&e.isRemote()||r.push(e)}),r},getClassesFromSelector:function(e){var t=/([a-z0-9])(:[a-z:\-]+)/,r=/[\.\\]/g,n=[],o=e.match(/\.(\\3[0-9]+\s[a-z0-9\\\:\-]+|[a-z0-9\\\:\-]+)/g);if(o)for(var l,s=0;s<o.length;s++)o[s].startsWith(".pg-state-")||o[s].startsWith(".pg-node-")||o[s].startsWith(".pg-main-cs-")||(l=(l=(l=o[s].replace(/\\3([0-9]+)\s?/,"$1")).replace(t,"$1")).replace(r,""),n.push(l));return n},getUrlOfStylesheetForOverrides:function(e,t){function r(e){var t=pinegrow.getSelectedPage();return e=t&&!t.hasAttachedStylesheetWithUrl(e)?"":e}var n=null,o=null,l="urlOfStylesheetForOverrides"+(t=t||"");if(e){if(e[l])return r(e[l]);o=e.url,n=e.getProjectInfo()}else{var s=pinegrow.getCurrentProject();if(s){if(s[l])return r(s[l]);n=s.getProjectInfo(),o=s.getUrl()+"/"}}return r(n?s=(s=n.getSetting("cs-for-overrides"+t)||"").length&&o?crsaGetAbsoluteUrlForRelativeUrlAndParentUrl(s,o):s:this[l]||"")},setUrlOfStylesheetForOverrides:function(e,t,r){var n,o,l=null,s=null,a="urlOfStylesheetForOverrides"+(r=r||"");t?(l=t.getProjectInfo(),t[a]=e,s=t.url):(n=pinegrow.getCurrentProject())&&(l=n.getProjectInfo(),n[a]=e,s=n.getUrl()),l&&(s&&(o=crsaMakeLinkRelativeTo(e,s)),l.setSetting("cs-for-overrides"+r,o),l.save()),this[a]=e},getGlobalNodeId:function(e){var t=this.getStylesheetForNode(e);return{csurl:t?t.url:null,indices:this.getNodeIndices(e)}},getNodeFromGlobalId:function(e){if(e&&e.csurl&&e.indices){var t=pinegrow.stylesheets.getByUrl(e.csurl);if(t&&t.getRootNode())return this.getNodeByIndices(t.getRootNode(),e.indices)}},findNodeInside:function(e,t,r,n,o){var l=n.nodes;o=o||l.length;for(var s=0;s<o;s++){var a=l[s];if(a.type==e&&a[t]==r)return a}return null},searchInNode:function(e,t,r){function n(e){return e&&e.match(t)}if("comment"==e.type){if(!n(e.text))return!1}else if("decl"==e.type){if(!n(e.prop)&&!n(e.value))return!1}else if("atrule"==e.type){if(!n(e.name)&&!n(e.params))return!1}else if("rule"==e.type){var o=e.selector,l=r.filter(e);if("update"==l.haveTo&&(o=l.newValue),"delete"==l.haveTo||!n(o))return!1}return!0},searchInNodeAndSubnodes:function(e,t,r){if(this.searchInNode(e,t,r))return!0;if(e.nodes)for(var n=0;n<e.nodes.length;n++)if(this.searchInNode(e.nodes[n],t,r))return!0;return!1},isMedia:function(e){return"atrule"==e.type&&"media"==e.name},isVariable:function(e){var t="decl"==e.type&&e.prop&&e.prop.startsWith("$"),r="atrule"==e.type&&e.variable;return t||r},getVariableProp:function(e){return"decl"==e.type?e.prop:"atrule"==e.type?e.name:null}}};