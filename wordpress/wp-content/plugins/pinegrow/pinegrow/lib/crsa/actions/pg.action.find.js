class PgActionFind extends PgAction{static key="find";static action_name="Find Elements";static description="Find elements by tags, classes, attributes, text, and CSS selectors.";static accepts_subactions=!0;static subactions_label="What to do with elements?";static add_subaction_button_label="Add action";constructor(e){super(e);const t=this;this.addFieldToSection("tag_names","Tag Names","select","Select tag names to find",{placeholder:"Select tag names",multiple:!0,is_filter:!0,can_add_items:!0,options:function(){var t=new Set,e=pinegrow.getSelectedPage();return e&&e.sourceNode.walk(function(e){return e.isElement&&t.add(e.tagName.toLowerCase()),!0}),Array.from(t).sort().map(e=>({key:e,name:e}))}}),this.addFieldToSection("classes","Classes","select","Select classes to find",{placeholder:"Select classes",multiple:!0,is_filter:!0,can_add_items:!0,options:function(){var t=new Set,e=pinegrow.getSelectedPage();return e&&e.sourceNode.walk(function(e){return e.isElement&&e.getClasses().forEach(e=>{t.add(e)}),!0}),Array.from(t).sort().map(e=>({key:e,name:e}))}}),this.addFieldToSection("attribute_names","Attribute Names","select","Select attributes to find",{placeholder:"Select attribute names",multiple:!0,is_filter:!0,can_add_items:!0,options:function(){var t=new Set,e=pinegrow.getSelectedPage();return e&&e.sourceNode.walk(function(e){return e.isElement&&e.getAttrList().forEach(e=>{t.add(e.name)}),!0}),Array.from(t).sort().map(e=>({key:e,name:e}))}}),this.addFieldToSection("text_content","Text Content","text","Specify text content to find (use code editor to search in scripts)",{placeholder:"Text to find",is_filter:!0}),this.addFieldToSection("css_selector","CSS Selector","text","Specify CSS selector to find elements",{placeholder:"e.g., #main .item > a",is_filter:!0}),this.addFieldToSection("case_sensitive","Case sensitive","checkbox","Case sensitive matching.",{value:"1",is_filter:!0,show_if:function(){return t.getArg("text_content")||t.getArg("classes")||t.getArg("tag_names")||t.getArg("attribute_names")}}),pinegrow.stats.using("action.find")}findIsCaseSensitive(){return this.getArg("case_sensitive")}findGetFilterTags(){var e=this.getArg("tag_names");return e?e.split(",").map(e=>e.trim()).filter(e=>!!e):null}findGetFilterClasses(){var e=this.getArg("classes");return e?e.split(",").map(e=>e.trim()).filter(e=>!!e):null}findGetFilterText(){return this.getArg("text_content")}willActionBeDoneOnPgel(e){var t=!1,i=this.getArg("case_sensitive"),n=this.getArg("tag_names");if(n&&0<n.trim().length){n=n.split(",").map(e=>e.trim());if(0<n.length&&(t=!0,-1===n.indexOf(i?e.tagNameOriginal:e.tagName)))return!1}n=this.findGetFilterClasses();if(n&&0<n.length){var s=n;if(0<s.length){var t=!0,a=e.getClasses();i||(a=a.map(e=>e.toLowerCase()));for(var r=0;r<s.length;r++)if(!a.includes(i?s[r]:s[r].toLowerCase()))return!1}}n=this.getArg("attribute_names");if(n&&0<n.trim().length){var o=n.split(",").map(e=>e.trim());if(0<o.length){t=!0;var l=e.getAttrList().map(e=>e.name);i||(l=l.map(e=>e.toLowerCase()));for(r=0;r<o.length;r++){var c=i?o[r]:o[r].toLowerCase();if(!l.includes(c))return!1}}}n=this.getArg("text_content");if(n&&0<n.trim().length){var g=(t=!0)||"style"!==e.tagName&&"script"!==e.tagName?e.text(void 0,!0):e.content;if(-1===(g=i?g:g.toLowerCase()).indexOf(i?n:n.toLowerCase()))return!1}g=this.getArg("css_selector");return!(g&&0<g.trim().length&&(t=!0,!e.is(g))||!t)&&(!this.hasSubActions()||this.willAnySubActionBeDoneOnPgel(e))}async doActionOnPgel(e){return!!this.hasSubActions()&&this.doSubActionsOnPgel(e)}hasActionToRun(){return super.hasSubActions()}resetRefs(){super.resetRefs(),pinegrow.getAllPageViews().forEach(function(e){e.resetHighlights()})}onRefDisplayed(e){super.onRefDisplayed(e);const t=this.getArg("text_content");t&&e.page&&e.page.openedInEditor&&e.pgel.get$DOMElements(e.page).forEach(function(e){e.pgPageView.highlightTextInDOMElement(e.get(0),t)})}}class PgActionDeleteElement extends PgAction{static key="delete";static action_name="Delete element";static description="Delete the matched element";static allowed_parents=[PgActionFind];constructor(e,t){super(e,t)}willActionBeDoneOnPgel(e){return!0}async doActionOnPgel(e){return e.remove(),!0}}withPinegrow(function(){pinegrow.addEventHandler("on_register_actions",function(e,t){t.registerAction(PgActionFind),t.registerAction(PgActionDeleteElement)})});