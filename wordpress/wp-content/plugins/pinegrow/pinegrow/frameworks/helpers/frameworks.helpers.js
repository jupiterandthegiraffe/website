var PgFrameworkHelpers=function(r,p,s,e,a){function l(e){var i=e.url.startsWith("https://");return S===i}var n,t,i,g,u=this,c=(p.showGridInMenu=void 0===p.showGridInMenu||null===p.showGridInMenu||p.showGridInMenu,p.showColumnInMenu=void 0===p.showColumnInMenu||null===p.showColumnInMenu||p.showColumnInMenu,this.options=p,this.framework=s,this.version=e,void 0===p.createDisplayHelpers||p.createDisplayHelpers),o=(this.onFrameworkActivatedOnPage=function(e){e.getPageViews().forEach(function(e){e.updatePgStyles(),u.show(e),o(e)})},pinegrow.addEventHandler("on_show_display_helpers_changed",function(){c&&pinegrow.getAllPages().forEach(function(e){e.hasFramework(s)&&e.getPageViews().forEach(function(e){m(e),h(e)})})}),pinegrow.addEventHandler("on_page_view_header",function(e,i){e.hasFramework(s)&&o(i)}),function(e){var i;c&&!e.data.bsShowGridToolbarItem&&(i=new PgButtonToolbarItem("<span>Grid</span>","Toggle grid helper overlays in "+r+" containers."),e.addHeaderToolbarItem(p.prefix,i),i.setActive(n),i.onClick=function(){e.data.bsShowGrid=!this.getActive(),this.setActive(e.data.bsShowGrid),h(e),pinegrow.showMode("Grid overlays in "+r+" containers",e.data.bsShowGrid),e.data.bsShowGrid&&!pinegrow.getShowDisplayHelpers()&&pinegrow.showQuickMessage("Note, Display helpers are OFF.")},e.data.bsShowGridToolbarItem=i,i=new PgButtonToolbarItem("<span>Cols</span>","Toggle "+r+" column helper overlays."),e.addHeaderToolbarItem(p.prefix,i),i.setActive(t),i.onClick=function(){e.data.bsShowColumns=!this.getActive(),this.setActive(e.data.bsShowColumns),m(e),pinegrow.showMode(r+" column overlays",e.data.bsShowColumns),e.data.bsShowColumns&&!pinegrow.getShowDisplayHelpers()&&pinegrow.showQuickMessage("Note, Display helpers are OFF.")},e.data.bsShowColumnsToolbarItem=i)}),h=(this.getDeviceSizesForPageViewMenu=function(e,i){var r=p.sizes,n=p.sizes_breakpoints,t=p.sizes_view_sizes,o=p.sizes_icons,a=p.sizes_names;i.splice(0,i.length);for(var s=0;s<r.length;s++){var l=s+1<r.length?n[s+1]:n[s]+1;i.push({name:r[s].toUpperCase()+'<span style="opacity:0.7;"> / '+a[s]+" ["+n[s]+"px"+(s!=r.length-1?"..."+(l-1)+"px":" and up")+"]</span>",name_short:r[s].toUpperCase(),w:t[s],w_range:[n[s],s+1<r.length?l-1:9999],icon:o[s],size:r[s],slug:r[s]==p.size_for_all?"":"-"+r[s]})}},this.updateHelpersAfterChange=function(i,e,r){c&&i&&r&&(1||e&&e.source&&e.source instanceof PgCodeEditView)&&(i.data.bsHelpersUpdateCol||(i.data.bsHelpersUpdateCol=new PgCollection),i.data.bsHelpersUpdateCol.add(r),i.delayedTasks.run(p.prefix+"updateHelpers",function(){var e=new CrsaProfile;i.data.bsHelpersUpdateCol&&(i.data.bsHelpersUpdateCol.normalize(),i.data.bsHelpersUpdateCol.forEachElement(function(e){e.isDeleted||u.updateHelpers(e)}),i.data.bsHelpersUpdateCol=new PgCollection),e.show("BS4 on_page_changes_done delayed")},1e3))},p.showGridInMenu&&(i=p.prefix+"grid-helper-"+this.version,n="1"==pinegrow.getSetting(i,"0"),(i=new PgPageViewHelper(r+" "+this.version+" grid",i,"pg-internal-page-view-bootstrap-grid",null,null,"1",s)).onGetCurrentValue=function(){return n},i.onChange=function(i){n=i,pinegrow.getAllPages().forEach(function(e){e.hasFramework(s)&&e.getPageViews().forEach(function(e){e.data.bsShowGridToolbarItem&&(e.data.bsShowGridToolbarItem.setActive(i),delete e.data.bsShowGrid),h(e)})})}),function(e){var i;c&&((i=f(e))?u.updateGridHelperIn$El(e.get$Body(),i):u.removeGridHelperIn$El(e.get$Body()))}),f=function(e){var i;if(c)return i=pinegrow.getShowDisplayHelpers(),"bsShowGrid"in e.data?e.data.bsShowGrid&&i:n&&i},m=(this.removeGridHelperIn$El=function(e){e.find(".pghelper-"+p.framework_prefix+"-grid").remove()},this.updateGridSizes=function(e){var n;c&&f(e)&&(n=40*this.options.num_columns,e.get$Body().find(".pghelper-"+p.framework_prefix+"-grid").each(function(e,i){var r=$(i);r.parent().innerWidth()<n?r.addClass("pghelper-"+p.framework_prefix+"-grid-narrow"):r.removeClass("pghelper-"+p.framework_prefix+"-grid-narrow")}))},this.updateGridHelperIn$El=function(e,i){var s,l;(i=void 0===i?n:i)&&e&&(e.closest('[contenteditable="true"]').length||(s=this.getCodeForLarge(),this.getCodeForSmall(),l=40*this.options.num_columns,e.find(".pghelper-"+p.framework_prefix+"-grid").addClass("pghelper-"+p.framework_prefix+"-grid-old"),_(e,p.container_selector).each(function(e,i){var r=$(i);if(!r.is("pgdiv"))if((a=r.find(">.pghelper-"+p.framework_prefix+"-grid")).length)a.removeClass("pghelper-"+p.framework_prefix+"-grid-old");else{var n,t=!0;if("static"==r.css("position")&&(n=!1,r.children().each(function(e,i){if("absolute"==$(i).css("position"))return n=!0,!1}),n?t=!1:r.addClass("pghelper-"+p.framework_prefix+"-grid-parent-relative")),t){var t=r.innerWidth(),o='<pgdiv class="'+p.grid_container_selector+" pinegrow-ui-helper pghelper-"+p.framework_prefix+"-grid";t<l&&(o+=" pghelper-"+p.framework_prefix+"-grid-narrow"),o+='">';for(e=0;e<p.num_columns;e++)o+=s;o+="</pgdiv>";var a=$(o);r.prepend(a)}t=getElementPgNode(r);t&&t.setData("bshelperHasGridHelper",!0)}}),e.find(".pghelper-"+p.framework_prefix+"-grid-old").remove()))},this.updateGridHelper=function(e){e.get$DOMElements().forEach(function(e){u.updateGridHelperIn$El(e)})},this.removeGridHelper=function(e){e.setData("bshelperHasGridHelper",!1),e.get$DOMElements().forEach(function(e){u.removeGridHelperIn$El(e)})},p.showColumnInMenu&&(i=p.prefix+"column-helper-"+this.version,t="1"==pinegrow.getSetting(i,"0"),(i=new PgPageViewHelper(r+" "+this.version+" columns",i,"pg-internal-page-view-bootstrap-columns",null,null,"1",s)).onGetCurrentValue=function(){return t},i.onChange=function(i){t=i,pinegrow.getAllPages().forEach(function(e){e.hasFramework(s)&&e.getPageViews().forEach(function(e){e.data.bsShowColumnsToolbarItem&&(e.data.bsShowColumnsToolbarItem.setActive(i),delete e.data.bsShowColumns),m(e)})})}),function(e){var i=w(e);i?u.updateColumnHelperIn$El(e.get$Body(),i):u.removeColumnHelperIn$El(e.get$Body())}),w=function(e){var i=pinegrow.getShowDisplayHelpers();return"bsShowColumns"in e.data?e.data.bsShowColumns&&i:t&&i},v=(this.removeColumnHelperIn$El=function(e){e.find(".pghelper-"+p.framework_prefix+"-column").remove()},this.updateColumnHelperIn$El=function(e,i){(i=void 0===i?t:i)&&e&&(e.closest('[contenteditable="true"]').length||(this.removeColumnHelperIn$El(e),_(e,C).not(".pinegrow-ui-helper").each(function(e,i){var r=$(i),n=u.getColumnSizes(i),t="";p.sizes.forEach(function(e){e in n&&(t+="<pgspan>"+e+u.getColumnSizeAsShortString(n[e]," ")+"</pgspan>")}),v(r,t)})))},this.updateColumnOverlay=function(t){var o,e;c&&(o=null,e=t.getPage())&&e.getPageViews().forEach(function(e){var i,r,n;w(e)&&(null===o&&(i=u.getColumnSizes(t),o="",p.sizes.forEach(function(e){e in i&&(o+="<pgspan>"+e+u.getColumnSizeAsShortString(i[e]," ")+"</pgspan>")})),r=t.get$DOMElement(e.get$Html()))&&(o.length?0===(n=r.find(">.pghelper-"+p.framework_prefix+"-column")).length?v(r,o,t):n.find(">.pghelper-"+p.framework_prefix+"-column-inner").html(o):r.find(">.pghelper-"+p.framework_prefix+"-column").remove())})},this.removeColumnOverlay=function(e){e.get$DOMElements().forEach(function(e){e.find(">.pghelper-"+p.framework_prefix+"-column").remove()})},function(e,i,r){var n,t='<pgdiv class="pinegrow-ui-helper pghelper-'+p.framework_prefix+'-column"><pgdiv class="pghelper-'+p.framework_prefix+'-column-inner">'+i+"</pgdiv></pgdiv>",t=$(t),o=!0;return"static"==e.css("position")&&(n=!1,e.children().each(function(e,i){if("absolute"==$(i).css("position"))return n=!0,!1}),n?o=!1:e.addClass("pghelper-"+p.framework_prefix+"-grid-parent-relative")),o?(e.append(t),r=r||getElementPgNode(e),t):null}),b=(this.updateHelpersIn$El=function(e,i){c&&(this.updateGridHelperIn$El(e,i?f(i):void 0),this.updateColumnHelperIn$El(e,i?w(i):void 0))},this.show=this.updateHelpersOnPageView=function(e){c&&this.updateHelpersIn$El(e.get$Body(),e)},this.updateHelpers=function(e){var i=e.getPage();i&&this.updateHelpersOnPage(i)},this.updateHelpersOnPage=function(e){e.getPageViews().forEach(function(e){u.updateHelpersOnPageView(e)})},this.getColumnSizeAsShortString=function(e,i){void 0===i&&(i="");var r="";switch(e){case"":break;case"auto":r=" A";break;default:r=" "+e}return r=r.length?i+r:r},this.getViewCss=function(){return c?"        pgdiv { display:block;}        .pghelper-"+p.framework_prefix+"-grid {            position:absolute;            top:0;            width: 100%;            height: 100%;            z-index:1;            pointer-events:none;            outline: none !important;            overflow: hidden;        }        .pghelper-"+p.framework_prefix+"-grid > pgdiv {            height:100%;            outline: none !important;            border-left: 1px solid rgba(0,0,0,0.07);        }        .pghelper-"+p.framework_prefix+"-grid > pgdiv:first-child {            border-left:none;        }        .pghelper-"+p.framework_prefix+"-grid.pghelper-"+p.framework_prefix+"-grid-narrow > pgdiv {            padding:0;        }        .pghelper-"+p.framework_prefix+"-grid > pgdiv > pgdiv {            background:rgba(0,0,0,0.03);            height:100%;            outline: none !important;        }        .pghelper-"+p.framework_prefix+"-grid-parent-relative {            position:relative;        }        .pghelper-"+p.framework_prefix+"-column {            position:absolute;            left:0;            right:0;            top:0;            bottom:0;            background:rgba(51, 173, 214, 0.06);            padding: 5px 5px;            pointer-events:none;            border: 1px solid #b5d9e4;        }        .pghelper-"+p.framework_prefix+"-column-inner {            background: rgba(51, 173, 214, 0.12);            height: 100%;            pointer-events:none;            text-align: right;            padding: 0px 6px;        }        .pghelper-"+p.framework_prefix+"-column-inner pgspan {            font-size:13px;            text-transform:uppercase;            font-family: sans-serif;            color: #319ec3;            display: inline-block;            margin-left: 10px;        }        "+p.style:""},this.onPageViewResized=function(e,i){this.updateMenuPointsAfterViewResize(e,i),this.updateGridSizes(i)},this.addPrefixToSectionsAndFields=function(e,n,t){var o={};return $.each(e,function(e,i){var r;i.fields&&(r={},$.each(i.fields,function(e,i){r[p.prefix+e]=i,t&&t(i)}),i.fields=r),o[p.prefix+e]=i,n&&n(i)}),o},this.getMenuPoints=function(e,i,r,n){var t,o;this.options.isColumn(i)&&(t=a("right",r,!1,!1,this),n.push(t),o=a("right",r,this.getCurrentPageViewSize(r.pageView),t,this),n.push(o),(t.hidePointInDrag=o).hidePointInDrag=t)},this.updateMenuPointsAfterViewResize=function(e,i){var r=this.getCurrentPageViewSize(i),n=[];pinegrow.selectedElements.getMenuPoints(i).forEach(function(e){e instanceof a&&(e.forceSize&&(e.forceSize=r),e.update(),n.push(e))}),n.forEach(function(e){d,e.update()})},s.getBaseUrl()+"/pagelib"),_=(isApp()&&(g=path.join(crsaMakeFileFromUrl(s.getBaseUrl()),"pagelib")),this.getPageLibs=function(e){var i=[];return e.forEach(function(e){i.push({name:e.name,url:b+"/"+e.url,selector:".pg-lib-item",framework:s,removeClasses:["pg-lib-item","pg-lib-item-skip-replace-images"]})}),i},this.addBuildPageLibsFeature=function(d,u){var e=$('<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><span>BS Dev</span></a>                <ul class="dropdown-menu with-checkboxes">                    <li><a href="#" class="bs-build-pagelibs">Build Page Libs</a></li>                </ul>            </li>');pinegrow.addPluginControlToTopbar(s,e),e.find(".bs-build-pagelibs").on("click",function(e){var n,t,p,o;n=require("path"),t=g,p=new PgPluginBuilder(s),(o=p.readFile("pagelib/master.html")).withoutEvents(function(){var i=o.clone(!0),a=i.findOne("main"),r=-1,s=function(e,i){var r,n;e.help&&(r=pgCreate('<div class="pg-lib-help"><a href="'+e.help.link+'" class="external">'+e.help.label+"</a></div>"),n=i.findOne(".pg-lib-section-content"),r.insertBefore(n))},l=function(){var o,e;r++,u.length>r?(o=u[r],pinegrow.showQuickMessage("Doing "+o.url+"..."),o.import?(e=(e=p.readFile(crsaMakeUrlFromFile(n.join(t,o.import)))).findOne(".pg-lib-section"),a.append(e),s(o,e),l()):p.getSourceNode(d+o.url,function(n){var e=n.findOne(".bd-title"),i=n.findOne(".bd-lead"),e=pgCreate('<div class="pg-lib-section"><div class="pg-lib-section-info"><h2 class="pg-lib-section-title">'+e.html()+'</h2><div class="pg-lib-section-desc">'+i.html()+'</div></div><div class="pg-lib-section-content"></div></div>'),t=(a.append(e),e.findOne(".pg-lib-section-content"));n.find(".bd-example").forEach(function(i){var r;o.filter&&!o.filter(i)||(r=pgCreate('<div class="pg-lib-group"></div>'),t.append(r),i.children.forEach(function(e){e.isElement&&(e.removeAttribute("style"),e.addClass("pg-lib-item"),o.skip_replace_images?e.addClass("pg-lib-item-skip-replace-images"):p.replaceHolderImages(e),r.append(e),o.after)&&o.after(e,i,n,a,t)}),o.after_group&&o.after_group(r))}),s(o,e),l()})):(e=n.join(t,"index.html"),require("fs").writeFileSync(e,i.toStringOriginal(!0),{encoding:"utf8"}),pinegrow.showQuickMessage("Done!"))};l()})})},this.isSizeVisible=function(e,i){return(e instanceof PgPageView?e:e.activeView).deviceWidth>=p.sizes_breakpoints_map[i]},this.getCurrentPageViewSizeCached=function(e){},this.getCurrentPageViewSize=function(e){for(var i=p.size_for_all,r=p.sizes,n=0;n<r.length&&this.isSizeVisible(e,r[n]);n++)i=r[n];return i},function(e,i){var r=e.find(i);return r=e.is(i)?r.add(e):r}),C=[],S=(this.init=function(){p.col_prefix_class&&C.push("."+p.col_prefix_class),p.sizes.forEach(function(e){for(var i=1;i<=p.num_columns;i++)C.push("."+u.getClassForSize(e,p.col_prefix_class,i))}),C=C.join(",")},!0);s.resources_name=p.version_name||s.name,s.customResourceNamespace="",p.no_include_local_question||(s.on_add_resources=function(e,i){pinegrow.showAlert(`<p>${s.name} can be included to the page in two different ways:</p><ul><li>From  <b>remote CDN server</b>. This is the simplest option but it requires internet connection.</li><li>With <b>local files in your project</b>. All required ${s.name} files will be copied to your project.</li></ul><p>How would you like to include ${s.name}?</p>`,"Use CDN or local files?","Cancel","Add with CDN",null,function(){i(S=!0)},"Add with local files",function(){S=!1,i(!0)})}),s.resources.description=`Include <b>${s.resources_name}</b> CSS and JS files. Updating resources will add (or update to) the latest version of ${s.name} CSS and JS to the page.`,this.addResource=function(e,i,r,n,t){var o=null,a=null;return crsaIsAbsoluteUrl(e)||(o=e,a=e=s.getResourceUrl("template/"+e)),(res=new PgComponentTypeResource(e,null,n)).relative_url=o,res.source=a,res.detect=i,res.replace=!0,res.footer=void 0!==t?t:"application/javascript"===res.type,r||(res.on_add_resource_filter=l),s.resources.add(res),res}};