class PgDmDesignSkillBootstrapOptions extends PgDmDesignSkill{constructor(s){super("bootstrap","Bootstrap options"),this.reset(),this.version=s,this.addControl("sizer",{name:"Text size",type:"range",range_min:-5,range_max:5,magic_range_min:-2,magic_range_max:2,dm_locked:!0,default_value:0,helptext:`<p>Set the size of text and margin / padding spacers.</p>`}),this.addControl("gutter",{name:"Grid spacing",type:"range",range_min:-5,range_max:5,range_marks:!0,dm_locked:!0,default_value:0,helptext:`<p>Set the amount of space between columns and column padding.</p>`}),this.addControl("roundness",{name:"Roundness",type:"range",range_min:0,range_max:4,range_marks:!0,helptext:`<p>Set the roundness of cards, input fields, pills...</p>`}),this.addControl("buttonRoundness",{name:"Button roundness",type:"range",range_min:0,range_max:4,range_marks:!0,helptext:`<p>Set the button roundness.</p>`}),this.addControl("shadows",{name:"Shadows",type:"range",range_min:0,range_max:4,range_marks:!0,helptext:`<p>Set shadows for cards, navbars...</p>`}),this.addControl("contrast",{name:"Contrast",type:"range",range_min:0,range_max:2,range_marks:!0,dm_no_lock:"placeholder",helptext:`<p>Minimum contrast for calculating light/dark color combinations, for example the color of button labels. Values range is 3, 4.5 and 7 (acceptable values for WCAG 2.0).</p>`}),this.addControl("gradients",{name:"Gradients",type:"checkbox",value:"1",helptext:`<p>Enable gradients on buttons, alerts...</p>`}),"4"===this.version&&this.addControl("responsive_fonts",{name:"Responsive font sizes",type:"checkbox",value:"1",helptext:`<p>Enable responsive font sizes to scale font sizes across viewport sizes.</p>`})}reset(){this.adjust_button_padding=!0,this.radius_from=.25,this.radius_from_lg=.3,this.radius_from_sm=.2}populateDefaultParams(){this.setParam("contrast","0",!0)}onSurpriseMe(s){this.isLocked("gradients")||this.setParam("gradients",Math.random()<.3?"1":""),this.isLocked("responsive_fonts")||this.setParam("responsive_fonts",Math.random()<.5?"1":""),this.surpriseMeForRangeControls(s)}onGetCSS(s){function t(s,t,e,r){var o=n.getParam(e||"roundness");return null===o&&(o=r||1),Math.round(100*(1<o?s+s/.333*(o-1):s*o))/100+t}var n=this,e="",r={adjust_button_padding:this.adjust_button_padding,radius_from:this.radius_from,radius_from_lg:this.radius_from_lg,radius_from_sm:this.radius_from_sm,button_radius_from:this.radius_from,button_radius_from_lg:this.radius_from_lg,button_radius_from_sm:this.radius_from_sm,part:s,skill:this,extra_code:""};pinegrow.dispatchEvent("on_bootstrap_design_panel_get_options_skill_params",pinegrow.getSelectedPage(),r);switch(s){case"init":var o=this.getParam("sizer"),o=(1!==o&&(e+="\n"+this.setVar("font-size-base",1+.05*o+"rem")),e=(e=(e=(e=(e=(e=(e=(e+="\n"+this.setVar("grid-gutter-width",30+6*this.getParam("gutter")+"px"))+this.setVar("border-radius",t(r.radius_from,"rem",null,2)))+this.setVar("border-radius-lg",t(r.radius_from_lg,"rem",null,2)))+this.setVar("border-radius-sm",t(r.radius_from_sm,"rem",null,2)))+this.setVar("dropdown-border-radius",".25rem !default"))+this.setVar("btn-border-radius",t(r.button_radius_from,"rem","buttonRoundness")))+this.setVar("btn-border-radius-lg",t(r.button_radius_from_lg,"rem","buttonRoundness")))+this.setVar("btn-border-radius-sm",t(r.button_radius_from_sm,"rem","buttonRoundness")),2<=this.getParam("buttonRoundness")&&r.adjust_button_padding&&(e=(e=(e+=this.setVar("btn-padding-x","1rem"))+this.setVar("btn-padding-x-sm","0.75rem"))+this.setVar("btn-padding-x-lg","1.25rem")),e+=this.setVar("enable-shadows",this.getParam("shadows")?"true":"false"),"4"===this.version?e+=this.setVar("enable-responsive-font-sizes",this.getParam("responsive_fonts")?"true":"false"):"5"===this.version&&(e+=this.setVar("enable-negative-margins","true")),[3,4.5,7]),e=(e+=this.setVar("enable-gradients",this.getParam("gradients")?"true":"false"))+this.setVar("min-contrast-ratio",o[parseInt(this.getParam("contrast")||1)]);this.getParam("colorful")&&(e+=this.setVar("headings-color","$color1"));break;case"rules":this.getParam("shadows")&&(e+=".navbar, .card { box-shadow: 0 "+(.25+.25/4*((o=this.getParam("shadows"))-1))+"rem "+(.75+.75/4*(o-1))+"rem rgba(0, 0, 0, "+(.05+.2/4*(o-1))+"); }\r\n"),e+=`
.carousel-indicators > li[data-bs-target]::marker { font-size:0; }

`}return e+r.extra_code}}class PgDmDesignSkillColorsForBootstrap extends PgDmDesignSkillColors{constructor(s,t){super("bs"+s+".colors",t,function(){var e="";return t.forEachColor(function(s,t){e+=`$${s}: ${t};
`}),e}),this.version=s}populateDefaultParams(s){s||this.colors.clear(),"4"===this.version?(this.colors.add("primary","#007bff"),this.colors.add("secondary","#6c757d"),this.colors.add("info","#17a2b8",!1),this.colors.add("success","#28a745",!0),this.colors.add("warning","#ffc107",!0),this.colors.add("danger","#dc3545",!0),this.colors.add("white","white",!0),this.colors.add("light","#f8f9fa",!0),this.colors.add("dark","#343a40",!0)):(this.colors.add("primary","#0d6efd"),this.colors.add("secondary","#6c757d"),this.colors.add("info","#0dcaf0",!1),this.colors.add("success","#198754",!0),this.colors.add("warning","#ffc107",!0),this.colors.add("danger","#dc3545",!0),this.colors.add("white","white",!0),this.colors.add("light","#f8f9fa",!0),this.colors.add("dark","#212529",!0)),super.populateDefaultParams()}}class PgDmDesignProviderForBootstrap extends PgDmDesignProvider{constructor(s,t){super("bs"+t,"Bootstrap "+t+" Design"),this.framework=s,this.prefix="bs"+t,this.version=t;var e=this;this.on_engine_ready_funcs=[],this.colors=new PgDmDesignColors,this.addSkills(),pinegrow.addEventHandler("on_bootstrap_theme_setup_done",function(){e.destroyEngine(),pgDmStore.isDesignEnabled()&&pgDmStore.update()})}addSkills(){var s=new PgDmDesignSkillColorsForBootstrap(this.version,this.colors);this.addSkill(s),this.fonts_skill_main=new PgDmDesignSkillFonts(!1,s),this.addSkill(this.fonts_skill_main),this.fonts_skill_headings=new PgDmDesignSkillFonts(!0,s),this.addSkill(this.fonts_skill_headings),this.addSkill(new PgDmDesignSkillBackground(s,"BS")),this.options_skill=new PgDmDesignSkillBootstrapOptions(this.version),this.addSkill(this.options_skill)}getActiveFonts(){var s=[];return this.fonts_skill_main.getActiveFonts(s),this.fonts_skill_headings.getActiveFonts(s),s}activate(){super.activate(),this.options_skill.reset()}getEngine(s){var e=this;this.engine?this.engine.isReady()?s(this.engine):e.on_engine_ready_funcs.push(s):this.engine=new PgDmEngineForBootstrap(function(t){e.on_engine_ready_funcs.forEach(function(s){s(t)}),e.on_engine_ready_funcs=[],s&&s(t)},this.framework)}destroyEngine(){this.engine&&this.engine.destroy(),this.engine=null}}class PgDmDesignProviderForBootstrap4 extends PgDmDesignProviderForBootstrap{constructor(s){super(s,"4")}}class PgDmDesignProviderForBootstrap5 extends PgDmDesignProviderForBootstrap{constructor(s){super(s,"5")}}class PgDmEngineForBootstrap extends PgDmEngine{constructor(s,t){super(s);function e(){i.is_ready=!0,i.with_outcs_func_list.forEach(function(s){s()}),i.with_outcs_func_list=[],s&&s(i),i.update()}var r,o,n,i=this,a=(this.css_mode="generate",require("path"),pinegrow.getCurrentProject()),l=(this.custom_cs_url=null,this.out_url=null,{source_scss_url:t.getResourceUrl("bootstrap_theme/custom.scss"),output_name:"bootstrap_theme/bootstrap.css"});pinegrow.dispatchEvent("on_bootstrap_design_panel_init",pinegrow.getSelectedPage(),l),this.output_css_relative_url=l.output_name,r=a?(r=isApp()?a.getAbsolutePath("bootstrap_theme/custom.scss"):null,isApp()&&crsaIsFileExist(r)?(this.css_mode="inject",this.custom_cs_url=crsaMakeUrlFromFile(r),a.getAbsoluteUrl("bootstrap/css/bootstrap.min.css")):a.getAbsoluteUrl(l.output_name)):(r=pinegrow.getSelectedPage(),require("url").resolve(r.url,l.output_name)),this.out_url=r,this.customCs=null,this.busy=!1,this.update_after_busy=!1,this.with_outcs_func_list=[];"generate"===this.css_mode?((o=this.outcs=PgCSSStylesheet()).fast=!1,o.loaded=!0,o.ignoreInSave=!0,o.usedByDesignPanel=!0,pinegrow.stylesheets.addCrsaStylesheet(o),o.setUrl(r),!crsaIsFileUrl(o.url)&&isApp()||(o.localFile=crsaMakeFileFromUrl(o.url),isApp()||!a||a.hasContentForUrl(r)||a.setContentOfUrl(r,""),o.load(o.url,function(){},!1,!0,!0)),(a=this.dummy_outcs=PgCSSStylesheet()).ignoreInSave=!0,a.usedByDesignPanel=!0,(n=this.cs=PgSCSSStylesheet()).includeSourceMap=!1,n.dontAddIds=!0,n.ignoreInSave=!0,n.usedByDesignPanel=!0,n.load(l.source_scss_url,function(){i.customCs=n,e.call(i)},null,null,a),isApp()&&!crsaIsRemoteUrl(l.source_scss_url)||(n.onMapImportRelativeUrl=function(s){return s="bootstrap/scss/_bootstrap.scss"===(s="bootstrap/_bootstrap.scss"===s?"bootstrap/bootstrap.scss":s)?"bootstrap/scss/bootstrap.scss":s}),n.outFile=o.localFile):setTimeout(function(){e&&e()},10)}getStylesheetUrl(){return this.out_url}onGetCSS(s){var t,e="";return"init"!=s&&"import"!=s||(t={css:"",cs_url:this.out_url},pinegrow.dispatchEvent("on_dm_get_css",null,s,t),e+=t.css),"rules"==s&&(t={css:"",cs_url:this.out_url},pinegrow.dispatchEvent("on_dm_get_css",null,s,t),e+=t.css),e}whenOutCSIsAvailable(s){this.outcs?s():this.with_outcs_func_list.push(s)}activateOnPage(s,t){var r=this;"generate"===this.css_mode?this.whenOutCSIsAvailable(function(){var e=null;!s.sourceNode||s.stylesheets.has(r.outcs)?t&&t():(s.sourceNode.withoutEvents(function(){s.sourceNode.find("link").forEach(function(s){var t;e||"stylesheet"!==s.getAttribute("rel")||!(t=s.getAttribute("href"))||!t.match(/bootstrap(\.min|)\.css/i)&&t!==r.output_css_relative_url||(e=s)}),s.stylesheets.attachTo(r.outcs,null,function(){pinegrow.changeManager.didChange(null,"Add generated stylesheet",null,s),$("body").trigger("crsa-stylesheets-changed"),s.refresh(),t&&t()},e)}),s.setPageChanged(!0))}):t&&t()}update(e){var s,t,r,o,n,i,a=this;pinegrow.getSelectedPage()&&(this.customCs||"generate"!==this.css_mode)&&(this.busy?a.update_after_busy=!0:(t="",n=this.onGetCSS("import"),s=this.onGetCSS("init"),t="generate"===this.css_mode?(r={bootstrap_code:`
#CODE_IMPORT

#CODE_INIT

@import "bootstrap/bootstrap";`},pinegrow.dispatchEvent("on_bootstrap_design_panel_generate",pinegrow.getSelectedPage(),r),(t=(t=r.bootstrap_code).replace("#CODE_IMPORT",n)).replace("#CODE_INIT",s)):n+s,r=this.onGetCSS("rules")||"","inject"!==this.css_mode&&(t+=r),o=null,"inject"===this.css_mode?(a.customCs=pinegrow.stylesheets.getByUrl(this.custom_cs_url,!1),a.customCs?(a.update_after_busy=!1,a.busy=!0,n=a.customCs.getSource(),n=pgUpdateGeneratedSectionContent(n,"Theme Init",t,"prepend"),n=pgUpdateGeneratedSectionContent(n,"Additional Rules",r,"append"),a.customCs.includeSourceMap=!1,(o=a.customCs.compiledStylesheets[0]).ignore_imports_in_apply=!0,a.customCs.setSource(n,function(){pinegrow.dispatchEvent("on_css_source_changed",null,{list:[a.customCs],ignore_in_undo:!0}),pinegrow.dispatchEvent("on_css_stylesheet_changed",null,o),a.busy=!1,a.update_after_busy?a.update(e):(pinegrow.refreshPageChangedStatusForAllPages(!0),e&&e())}),i=pgDmStore.design.fonts.getFontUrls(),a.addFontsToPageViews(o,i)):pinegrow.showQuickError(a.custom_cs_url+` is not loaded.`)):(a.update_after_busy=!1,a.busy=!0,o=this.outcs,a.customCs.setSource(t,function(){a.cs.regenerateCssFromCompilableSource(function(s,t){s?(console.log(s),a.busy=!1,a.update_after_busy?a.update(e):e&&e()):(o.resetError(),a.outcs.ignore_imports_in_apply=!0,a.outcs.setSource(t.css,function(){a.busy=!1,a.update_after_busy?a.update(e):(pinegrow.refreshPageChangedStatusForAllPages(!0),pinegrow.dispatchEvent("on_css_stylesheet_changed",null,o),e&&e())},null,null,!0))})},!1,!0),i=pgDmStore.design.fonts.getFontUrls(),a.addFontsToPageViews(o,i))))}saveCSS(){var s=crsaMakeFileFromUrl(this.out_url);"generate"===this.css_mode&&s&&(this.outcs.save(s),this.outcs.setChanged(!1))}destroy(){"generate"===this.css_mode&&(this.outcs.usedByDesignPanel=!1,this.outcs.remove(),pinegrow.stylesheets.removeStylesheetByKey(this.outcs.url),this.cs.usedByDesignPanel=!1,this.cs.remove(),pinegrow.stylesheets.removeStylesheetByKey(this.cs.url),this.dummy_outcs.usedByDesignPanel=!1,this.dummy_outcs.remove(),pinegrow.stylesheets.removeStylesheetByKey(this.dummy_outcs.url))}}