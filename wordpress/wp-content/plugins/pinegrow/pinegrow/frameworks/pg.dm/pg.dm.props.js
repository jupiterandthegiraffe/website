var PgDmStyleView=function(){function e(){pinegrow.getSelectedPage()&&a.show(s)}function t(e,t,n,o){o||a.show(s,n)}function n(e,t){v()}function o(e,t,n){}var i=$('<div class="crsa-panel crsa-properties"></div>'),r=(c&&i.addClass("crsa-properties-compact"),new PgUIView(i,"dmprop")),a=(this.view=r,this.just_obj=!1,r.tabIcon="icon-Pin15",this),s=null,l=new PgShowProperties(i),c=!1,d=!1,g=new PgDmStylesControl,m=new PgDmDeviceSizesControl,p=new PgDmStatesControl,u=[{sections:pgDmStore.getPropSections()}],v=(l.onlySections=c,l.forceDefinitions=u,l.view.get$Element().appendTo(i),d&&(l.showName=!1,show_general)&&(show_general.showName=!1),this.show=function(e,t){var n;r.whenVisible(function(){t||(e&&pinegrow.dispatchEvent("on_before_dm_properties_shown",e.getPage()),l.show(e)),l.view.get$Element().prepend(m.$element),e&&m.show(e),l.view.get$Element().prepend(p.$element),e&&p.show(e),l.view.get$Element().prepend(g.$element),e&&g.show(e)}),s=e,this.quickWin&&this.setQuickWinTitle&&(e?(n=(n=e.getPage())?n.getMainType(null,e):null,this.quickWin.setTitle("Properties for "+pinegrow.selectedElements.getName({short:!0,def:n,num_classes:-1}))):this.quickWin.setTitle("Element properties"))},d||this.show(null),function(e){var t=pinegrow.selectedElements.getLastSelected();a.show(t)});r.onAddedToLayout=function(e){},r.onResize=function(){l.updateLayout()},$("body").on("crsa-frameworks-changed",e),pinegrow.addEventHandler("on_selected_elements_changed",v),pinegrow.addEventHandler("on_dm_current_style_changed",t),pinegrow.addEventHandler("on_dm_design_structure_changed",n);pinegrow.addEventHandler("on_element_classes_changed",o),r.onDestroy=function(){l.show(null),pinegrow.removeEventHandler("on_selected_elements_changed",v),pinegrow.removeEventHandler("on_element_classes_changed",o),pinegrow.removeEventHandler("on_dm_current_style_changed",t),pinegrow.removeEventHandler("on_dm_design_structure_changed",n),$("body").off("crsa-frameworks-changed",e)}},PgQuickDmProperties=function(){var e=pinegrow.getSelectedPage(),e=(pgDmStore.setSASSEngine(new PgDmSASSEngine(e)),Math.floor(.75*$("body").height())),t=new PgDmStyleView,e=this.win=new PgQuickWindow("Quick Magic Properties",t,"quickDmProperties",400,e,!1);e.noRightEdge(),e.showFor$El($("body")),t.quickWin=e,t.show(pinegrow.selectedElements.getLastSelected()),e.onDestroy=function(){}},PgDmStylesControl=function(){this.$element=$('<div class="pg-dm-style-control"></div>');var o=$('<div class="pg-dm-style-control-pills"></div>').appendTo(this.$element),i=[];o.on("click",".pg-dm-style-pill",function(e){e.preventDefault();var t=$(this),t=pgDmStore.findStyleByName(t.attr("data-id"));pgDmStore.setCurrentStyle(t),pgDmStore.rememberSelectedStyleForSelectedElements(t)}),o.on("click",".pg-dm-style-control-new",function(e){e.preventDefault();var n=$(this).find("span");if("true"==n.attr("contentEditable"))return!1;n.attr("contentEditable","true"),n.focus(),$(this).find("button").on("click",function(e){n.attr("contentEditable","");var t=n.text();t&&setTimeout(function(){var e=new PgDmStyle(t);pgDmStore.addStyle(e),pgDmStore.assignStyleToSelectedElements(e),pgDmStore.setCurrentStyle(e),pgDmStore.rememberSelectedStyleForSelectedElements(e)},1)})}),this.show=function(e){i=[],o.empty();var n=pgDmStore.getCurrentStyle();pgDmStore.getStylesForPgel(e).forEach(function(e){var t=new PgDmStylePill(e);i.push(t),o.append(t.$element),e===n&&t.setActive(!0)}),$('<div class="pg-dm-style-control-new"><span>New name</span><button class="pg-button">Ok</button></div>').appendTo(o)}},PgDmStatesControl=function(){this.$element=$('<div class="pg-dm-states-control"></div>');var i=[{name:"None",key:"none"},{name:"Hover",key:"hover"},{name:"Active",key:"active"},{name:"Focus",key:"focus"}],r=(i.map(function(e){return".pg-state-"+e.key}).join(","),$("<ul></ul>").appendTo(this.$element));r.on("click","li",function(e){e.preventDefault();var t=$(this).attr("data-state");pgDmStore.setCurrentState(t),pgDmStore.stateManager.setState(t)}),this.show=function(e){r.empty();var n=pgDmStore.getCurrentState(),t=pgDmStore.getCurrentStyle(),o=t?t.getStates():{};i.forEach(function(e){var t=$(`<li data-state="${e.key}">${e.name}</li>`);r.append(t),n===e.key&&t.addClass("active"),o[e.key]&&t.append('<i class="icon icon-check"></i>')})}},PgDmDeviceSizesControl=function(){var u=this;this.$element=$('<div class="pg-dm-sizes-control"></div>'),this.show=function(){for(var e=pinegrow.getSelectedPage(),t=pgDmStore.design.getDeviceSizes(),e=e.activeView,n=pgDmStore.getCurrentStyle(),o=pgDmStore.getCurrentSize(),i=pgDmStore.design.getDeviceSizeDef(o),r=(this.$element.empty(),this.$element),a=new PgButtonToolbar,s=(r.prepend(a.$element.addClass("pg-tabs-toolbar")),new PgToolbarTabButtons(a,"tabs")),l=0;l<t.length;l++){var c=t[l],d=!1;if(n)for(var g=n.getItemsForSize(c.size),m=0;m<g.length;m++)if(g[m].isSet()){d=!0;break}var p=o===c.size,c=s.addTab(c.name_short,null,c,p).setClosable(!1);d&&c.$element.append('<i class="icon icon-check"></i>')}s.onTabSelected=function(e){var t=e.data,n=(pgDmStore.setCurrentSize(t.size),pinegrow.getSelectedPage());u.onDeviceSizeChanged&&u.onDeviceSizeChanged(n,t)},e.isDeviceSizeVisible(i)||this.$element.append(`<div class="pg-dm-sizes-control-notice">${i.name_short} is not visible on the active page view.</div>`)}},PgDmColorPicker=function(n,o,e){function s(e){r.css("background-color",e)}function l(){c&&(d.destroy(),c.remove(),c=null)}function t(e,t,n){g&&g.base==t&&s(pgDmStore.design.getColorShade(chroma(n),g.shade).css())}function i(e){!c||$(e.target).closest(c).length||l()}var c,d,r=$('<div class="pg-dm-color-picker-field"></div>').insertAfter(n),a=new PgUIView(r),g=null;r.on("click",function(e){var t,i,r,a;c?l():(c=$('<div class="pg-dm-color-picker"></div>').appendTo($("body")),t=$('<div class="pg-dm-color-picker-grid"></div>').appendTo(c),i=2,r={"-2":"darker","-1":"dark",0:"base",1:"light",2:"lighter"},a="","function"==typeof o&&o(),pgDmStore.design.getColors().forEach(function(e){for(var t=-i;t<=i;t++){var n=pgDmStore.design.getColorShade(e.color,t).css(),o=(e.name,t.toString(),e.name+`-`+r[t.toString()]);a+=`<div class="pg-dm-color-picker-c" data-base="${e.name}" data-val="${o}" data-color="${n}" data-shade="${t}"><div style="background-color:${n};"></div></div>`}}),a+='<button class="pg-button">No color</button>',t.html(a),t.on("click","button",function(e){g=null,s(""),n.val(""),l(),n.trigger("change")}),t.on("click",".pg-dm-color-picker-c",function(e){var t=$(this);n.val(t.attr("data-val")),l(),n.trigger("change"),g={base:t.attr("data-base"),variable:t.attr("data-val"),color:t.attr("data-color"),shade:t.attr("data-shade")},s(t.attr("data-color"))}),d=new PgPositionNextTo$El(c,n,null,0,"down"))}),pinegrow.addEventHandler("on_dm_color_changed",t);document.addEventListener("mousedown",i,!0),a.onDestroy=function(){document.removeEventListener("mousedown",i),pinegrow.removeEventHandler("on_dm_color_changed",t)}};