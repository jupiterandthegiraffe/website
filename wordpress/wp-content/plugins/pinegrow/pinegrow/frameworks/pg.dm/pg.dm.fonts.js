class PgFontType{constructor(e,t){this.type="abstract",this.family=t,this.weights=[],this.styles=[],this.category=null,this.error=null,this.url=null,this.can_refresh=!1,this.usage="all",this.fallback=null,e&&this.fromNode(e)}getTypeLabel(){return this.type}isUsedFor(e){return!(e="h2"===e?"h1":e)||!this.usage||"all"===this.usage||"headings"===this.usage&&"h1"===e||this.usage===e}addStyle(e){this.styles.indexOf(e)<0&&this.styles.push(e)}addWeight(e){this.weights.indexOf(e)<0&&this.weights.push(e)}describeStyles(){return this.weights.join(" ")}getRandomWeight(e){if(this.weights.length)return pgGetRandomItem(this.weights)}getPreview(e){return`<span style="font-family:${this.family}">${e||this.family}</span>`}getCode(){return{import:null,import_url:null,css:null,js:null}}getFamilyWithFallback(){var e=this.family;return e.indexOf('"')<0&&e.indexOf("'")<0&&e.indexOf(",")<0&&(e=`'${e}'`),this.fallback?e+", "+this.fallback:e}addToPageView(e){var t,a,o,s=e.find("head"),n=this.getCode();n.url&&(a=pinegrow.getCurrentProject(),n.url=a.getAbsoluteUrl(n.url),a=this.family,0===s.find(`link[data-pg-temp-font="${a}"]`).length)&&(t=crsaIsRemoteUrl(n.url)?n.url:pinegrow.getProxyUrl(n.url),0===s.find(`link[href="${t}"]`).length)&&s.append(o=`<link href="${t}" rel="stylesheet" data-pg-temp-font="${a}"/>`),n.css&&(a=this.family,s.find(`style[data-pg-temp-font="${a}"]`).remove(),o=`<style data-pg-temp-font="${a}">${n.css}</style>`,s.append($(o)))}activateInProject(e){this.addToPageView($("html"))}deactivateInProject(e){}toNode(e){e.type=this.type,e.family=this.family,e.weights=this.weights,e.styles=this.styles,e.category=this.category,e.url=this.url,e.usage=this.usage,e.fallback=this.fallback}fromNode(e){this.family=e.family,this.weights=e.weights||[],this.styles=e.styles||[],this.category=e.category,this.url=e.url,this.usage=e.usage||"all",this.fallback=e.fallback}getWPFontFamilyDeclaration(){return{fontFamily:this.getFamilyWithFallback(),name:this.family,slug:pgMakeSlug(this.family,!1,"-")}}}class PgFontTypeSystem extends PgFontType{constructor(e,t){super(e,t),this.type="system"}}class PgFontTypeUploadedWebfont extends PgFontType{constructor(e,t){super(e,t),this.type="uploaded",this.max_variants=10,e||(this.variants=[],this.is_variable=!1)}getTypeLabel(){return"self-hosted"}fromNode(e){var t=this;this.family=e.family,this.node=e,this.weights=[],this.styles=[],this.is_variable=e.is_variable||!1,e.variants.forEach(function(e){t.weights.indexOf(e.weight)<0&&t.weights.push(e.weight),t.styles.indexOf(e.style)<0&&t.styles.push(e.style)}),this.variants=e.variants||[],this.category=null,this.url=null,this.usage=e.usage||"all",this.fallback=e.fallback}toNode(e){e.type=this.type,e.family=this.family,e.fallback=this.fallback,e.usage=this.usage,e.variants=this.variants,e.is_variable=this.is_variable}edit(n){var i=this,e={family:this.family,fallback:this.fallback},t=this.max_variants,a=0,l=new PgDialog("Add or edit a self-hosted web font");l.sections={name:{name:"Font family name",is_closable:!1,fields:{family:{name:"Font family name",type:"text",placeholder:"for example, My Cool Font",helptext:"The font family name is used to reference the font in CSS rules.",validate:function(e,t,a,o,s,n){return a?null:pinegrow.getValidationError(o.name,"req")}},fallback:{name:"Fallback font family",type:"text",helptext:"Set the font that will be used if for some reason the web font is not available",placeholder:"for example, sans-serif"}}}};for(var o=1;o<=t;o++){var s=a<this.variants.length?this.variants[a]:null,r={};e["weight_"+o]=s?s.weight:null,e["style_"+o]=s?s.style:null,e["file_woff2_"+o]=s?s.woff2:null,e["file_woff_"+o]=s?s.woff:null,e["file_ttf_"+o]=s?s.ttf:null,e["variable_"+o]=s?s.variable:null,e["extras_"+o]=s?s.extras:null,r["weight_"+o]={name:"Weight",type:"select",options:[{key:"normal",name:"normal"},{key:"100",name:"100 (Thin)"},{key:"200",name:"200 (Extra Light)"},{key:"300",name:"300 (Light)"},{key:"400",name:"400 (Normal)"},{key:"500",name:"500 (Medium)"},{key:"600",name:"600 (Semi Bold)"},{key:"700",name:"700 (Bold)"},{key:"800",name:"800 (Extra Bold)"},{key:"900",name:"900 (Black)"}],helptext:"The font weight for which this font variant should be used."},r["style_"+o]={name:"Style",type:"select",options:[{key:"normal",name:"normal"},{key:"italic",name:"italic"}],helptext:"The font style for which this font variant should be used."},r["file_woff2_"+o]={name:"WOFF2 file url",type:"text",helptext:`<p>Enter the URL of the .woff2 file that is uploaded to the Media library. It is best to use relative URLs.</p>`,placeholder:"WOFF2 is supported by all modern browsers and offers better compression than woff."},r["file_woff_"+o]={name:"WOFF file url",type:"text",helptext:`<p>Enter the URL of the .woff file that is uploaded to the Media library. It is best to use relative URLs.</p>`,placeholder:"WOFF is supported by all modern browsers."},r["file_ttf_"+o]={name:"TTF file url",type:"text",helptext:`<p>Enter the URL of the .ttf file that is uploaded to the Media library. It is best to use relative URLs.</p>`,placeholder:"Optionally, add TTF as a fallback for older browsers."},l.sections["variant_"+o]={name:"Font variant "+o,is_closable:!0,closed:!s,fields:r},a++}l.values=e,l.okButtonLabel="Save",l.cancelButtonLabel="Cancel",l.validate_on_submit=!0,l.before=`<p>Add a web font that is hosted on your site. Enter the font family name and then add up to ten font variants for different weights and styles.</p><p>Each font variant has a font file in one or more font formats, that <b>needs to be uploaded into the Media library beforehand</b>.</p><p><a href="https://css-tricks.com/understanding-web-fonts-getting/" class="external">Learn more about different font formats.</a></p>`,l.onOK=function(){for(var t=l.values,e={family:t.family,fallback:t.fallback,variants:[]},a=["woff2","woff","ttf"],o=1;o<=i.max_variants;o++){var s=!1;a.forEach(function(e){t["file_"+e+"_"+o]&&(s=!0)}),s&&e.variants.push({weight:t["weight_"+o]||"normal",style:t["style_"+o]||"normal",ttf:t["file_ttf_"+o]||null,woff:t["file_woff_"+o]||null,woff2:t["file_woff2_"+o]||null})}i.fromNode(e),n&&n()},l.show()}getWPFontFamilyDeclaration(){var a=this,o=super.getWPFontFamilyDeclaration();return o.fontFace=[],this.variants.forEach(function(e){var t={fontFamily:a.family,fontStretch:"normal",fontStyle:e.style,fontWeight:e.weight,src:[]};e.woff2&&t.src.push(e.woff2),e.woff&&t.src.push(e.woff),e.ttf&&t.src.push(e.ttf),o.fontFace.push(t)}),o}getCode(){var a="",o=this.node;return this.variants.forEach(function(e){var t=[];e.woff2&&t.push(`url('${e.woff2}') format('woff2')`),e.woff&&t.push(`url('${e.woff}') format('woff')`),e.ttf&&t.push(`url('${e.ttf}') format('truetype')`),a+=`
@font-face {
    font-family: '${o.family}';
    src: ${t.join(", ")};
    font-weight: ${e.weight};
    font-style: ${e.style};
}`}),{import:null,url:null,css:a,js:null}}}class PgFontTypeRemote extends PgFontType{constructor(e,t,a){var o;super(e),this.type="remote",this.can_refresh=!0,e||((o=pinegrow.getCurrentProject())&&(t=o.getRelativeUrl(t)),this.url=t,this.family=a)}getCode(){var e=this.url,t=pinegrow.getCurrentProject();return{import:`@import url('${e=t?t.getAbsoluteUrl(this.url):e}');`,url:e,css:null,js:null}}}class PgFontTypeLocal extends PgFontTypeRemote{constructor(e,t,a){super(e,t,a),this.type="local"}copyToProjectIfNeeded(){if(isApp()){var e=pinegrow.getCurrentProject(),t=e.getAbsoluteUrl(this.url);if(!e.isUrlInProject(t)){var a=require("path"),o=require("fs"),s=e.getAbsolutePath("fonts/"+this.family),n=crsaGetNameFromUrl(t),n=e.getAbsoluteUrl("fonts/"+encodeURIComponent(this.family)+"/"+encodeURIComponent(n));try{return crsaCreateDirs(s,o),crsaCopyFolderSync(a.dirname(crsaMakeFileFromUrl(t)),s),this.url=e.getRelativeUrl(n),pinegrow.fontLibrary.save(),pinegrow.refreshCurrentProjectDelayed(!0),!0}catch(e){pinegrow.showQuickError("Could not copy local fonts to the project folder."),console.error(e)}}}}getUrl(){return this.copyToProjectIfNeeded(),pinegrow.getCurrentProject().getAbsoluteUrl(this.url)}}class PgFontTypeAdobe extends PgFontTypeRemote{constructor(e,t,a){super(e,t,a),this.type="adobe"}}class PgFontTypeGoogle extends PgFontType{constructor(e,t){super(e),this.type="google";var a,o={regular:"400",thin:"100",bold:"700"};switch(e||(this.family=t.name,this.category=t.category,(a=this).styles=[],this.weights=[],(t.wanted_styles||[]).forEach(function(e){var t=(e=o[e]||e).match(/^([0-9]+)/),t=t?t[1]:(e="400"+e,"400");a.styles.push({weight:t,italic:0<=e.indexOf("italic")}),a.weights.indexOf(t)<0&&a.weights.push(t)}),a.styles.sort(function(e,t){return e.weight.localeCompare(t.weight)})),this.category){case"sans":this.fallback="sans-serif";break;case"serif":this.fallback="serif";break;default:this.fallback="sans-serif"}this.url=this.url||`https://fonts.googleapis.com/css?family=`+this.getGoogleFontUrlToken()}getGoogleFontUrlToken(){var e=this.family.replace(/ /g,"+");return e=this.styles.length?(e+=":")+this.styles.map(function(e){return e.weight+(e.italic?"italic":"")}).join(","):e}describeStyles(){return this.styles.map(function(e){return e.weight+(e.italic?"i":"")}).join(" ")}getCode(){return{import:`@import url('${this.url}');`,import_url:this.url,url:this.url,css:null,js:null}}}var PgFontTypeLibrary=function(){var n=this,i=[],a={};this.init=function(){},this.addFont=function(e,t){a[e.family]&&this.removeFont(e.family),a[e.family]=e,i.push(e),e.addToPageView($("html"))},this.getFontByFamily=function(e){return a[e]||null},this.removeFont=function(e){var t=a[e]||null;t&&(0<=(t=i.indexOf(t))&&i.splice(t,1),delete a[e])},this.forEachFont=function(e){i.forEach(e)},this.getSelectOptions=function(t){var a=[];return this.forEachFont(function(e){e.isUsedFor(t)&&a.push({key:e.family,name:e.family,html:e.getPreview(e.family)})}),a.push({key:"font-manager",name:"Manage fonts...",action:function(){n.showLibrary()}}),a},this.getSelectOptionsForWeight=function(e){var t=[{key:"normal",name:"Normal"},{key:"bold",name:"Bold"},{key:"lighter",name:"Lighter"},{key:"bolder",name:"Bolder"},{key:"100",name:"100"},{key:"200",name:"200"},{key:"300",name:"300"},{key:"400",name:"400"},{key:"500",name:"500"},{key:"600",name:"600"},{key:"700",name:"700"},{key:"800",name:"800"},{key:"900",name:"900"},{key:"inherit",name:"Inherit"}],a={normal:"400",bold:"700"},o=this.getFontByFamily(e);return o?t.filter(function(e){var t;return"lighter"===e.key||"bolder"===e.key||(t=a[e.key]||e.key,0<=o.weights.indexOf(t))}):t},this.showLibrary=function(){var e=new PgFontTypeLibraryView;pinegrow.showViewInDialog("Font library","",e.view),e.show()},this.clear=function(){i=[],a={}},this.save=function(){var e=pinegrow.getCurrentProjectInfo(),a={activated:[]};this.forEachFont(function(e){var t={};e.toNode(t),a.activated.push(t)}),e.saveFile("fonts.json",JSON.stringify(a))},this.getFontClassForType=function(e){var t=PgFontType;switch(e){case"local":t=PgFontTypeLocal;break;case"remote":t=PgFontTypeRemote;break;case"adobe":t=PgFontTypeAdobe;break;case"google":t=PgFontTypeGoogle;break;case"system":t=PgFontTypeSystem;break;case"uploaded":t=PgFontTypeUploadedWebfont}return t},this.load=function(){this.clear();var e=pinegrow.getCurrentProjectInfo().loadFile("fonts.json");e?(e=JSON.parse(e)).activated&&e.activated.forEach(function(e){var t=n.getFontClassForType(e.type);t&&(t=new t(e)).family&&(n.addFont(t),t.activateInProject())}):this.restoreDefaultFonts()},this.restoreDefaultFonts=function(){[{type:"system",family:"Arial, Helvetica, sans-serif",usage:"all",category:"sans"},{type:"system",family:'"Arial Black", Gadget, sans-serif',usage:"headings",category:"sans"},{type:"system",family:"Impact, Charcoal, sans-serif",usage:"headings",category:"sans"},{type:"system",family:'"Lucida Sans Unicode", "Lucida Grande", sans-serif',usage:"all",category:"sans"},{type:"system",family:"Tahoma, Geneva, sans-serif",usage:"all",category:"sans"},{type:"system",family:"Verdana, Geneva, sans-serif",usage:"all",category:"sans"},{type:"system",family:'"Times New Roman", Times, serif',usage:"all",category:"serif"},{type:"system",family:'"Palatino Linotype", "Book Antiqua", Palatino, serif',usage:"all",category:"serif"},{type:"system",family:"Georgia, serif",usage:"all",category:"serif"},{type:"system",family:'"Courier New", Courier, monospace',usage:"all",category:"mono"},{type:"system",family:'"Lucida Console", Monaco, monospace',usage:"all",category:"mono"},{type:"google",family:"Abril Fatface",usage:"h1",category:"display"},{type:"google",family:"Alegreya",usage:"all",category:"serif",w:"400, 500, 600, 700, 800, 900"},{type:"google",family:"Arima Madurai",usage:"headings",category:"display",w:"100, 200, 300, 400, 500, 700, 800, 900"},{type:"google",family:"Arvo",usage:"h1",category:"serif",w:"400, 700"},{type:"google",family:"Asap",usage:"all",category:"sans",w:"400, 500, 600, 700"},{type:"google",family:"BioRhyme",usage:"all",category:"serif",w:"200, 300, 400, 700, 800"},{type:"google",family:"Cabin",usage:"all",category:"sans",w:"400, 500, 600, 700"},{type:"google",family:"Catamaran",usage:"headings",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Caveat",usage:"all",category:"display",w:"400, 500, 600, 700"},{type:"google",family:"Caveat Brush",usage:"all",category:"display"},{type:"google",family:"Cormorant Garamond",usage:"h1",category:"serif",w:"300, 400, 500, 600, 700"},{type:"google",family:"Dancing Script",usage:"headings",category:"display",w:"400, 500, 600, 700"},{type:"google",family:"DM Sans",usage:"all",category:"sans",w:"400, 500, 700"},{type:"google",family:"Dosis",usage:"all",category:"sans",w:"200, 300, 400, 500, 600, 700, 800"},{type:"google",family:"Expletus Sans",usage:"headings",category:"display",w:"400, 500, 600, 700"},{type:"google",family:"Fira Sans",usage:"all",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Fraunces",usage:"all",category:"serif",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"IBM Plex Serif",usage:"all",category:"serif",w:"100, 200, 300, 400, 500, 600, 700"},{type:"google",family:"Inter",usage:"all",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Josefin Sans",usage:"headings",category:"sans",w:"200, 300, 400, 500, 600, 700"},{type:"google",family:"Jost",usage:"headings",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Lato",usage:"all",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Libre Baskerville",usage:"headings",category:"serif",w:"400, 700"},{type:"google",family:"Lora",usage:"h1",category:"serif",w:"400, 500, 600, 700"},{type:"google",family:"Kalam",usage:"all",category:"display",w:"300, 400, 700"},{type:"google",family:"Kufam",usage:"headings",category:"display",w:"400, 500, 600, 700, 800, 900"},{type:"google",family:"Mali",usage:"all",category:"display",w:"200, 300, 400, 500, 600, 700"},{type:"google",family:"Martel",usage:"headings",category:"serif",w:"200, 300, 400, 600, 700, 800, 900"},{type:"google",family:"Maven Pro",usage:"all",category:"sans",w:"400, 500, 600, 700, 800, 900"},{type:"google",family:"Montserrat",usage:"headings",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Mulish",usage:"all",category:"sans",w:"200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Nunito Sans",usage:"text",category:"sans",w:"200, 300, 400, 600, 700, 800, 900"},{type:"google",family:"Open Sans",usage:"all",category:"sans",w:"300, 400, 600, 700, 800"},{type:"google",family:"Oswald",usage:"headings",category:"sans",w:"200, 300, 400, 500, 600, 700"},{type:"google",family:"Overlock",usage:"all",category:"display",w:"400, 700, 900"},{type:"google",family:"Oxanium",usage:"headings",category:"display",w:"200, 300, 400, 500, 600, 700, 800"},{type:"google",family:"Permanent Marker",usage:"h1",category:"display",w:"400"},{type:"google",family:"Playfair Display",usage:"headings",category:"sans",w:"400, 500, 600, 700, 800, 900"},{type:"google",family:"Poppins",usage:"headings",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Prompt",usage:"headings",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Proza Libre",usage:"all",category:"sans",w:"400, 500, 600, 700, 800"},{type:"google",family:"Quicksand",usage:"all",category:"sans",w:"300, 400, 500, 600, 700"},{type:"google",family:"Rakkas",usage:"h1",category:"display",w:"400"},{type:"google",family:"Raleway",usage:"all",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Rokkitt",usage:"h1",category:"serif",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Ruda",usage:"all",category:"sans",w:"400, 500, 600, 700, 800, 900"},{type:"google",family:"Sansita",usage:"headings",category:"serif",w:"400, 700, 800, 900"},{type:"google",family:"Sansita Swashed",usage:"h1",category:"display",w:"300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Sora",usage:"all",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800"},{type:"google",family:"Space Grotesk",usage:"all",category:"sans",w:"300, 400, 500, 600, 700"},{type:"google",family:"Spectral",usage:"headings",category:"serif",w:"200, 300, 400, 500, 600, 700, 800"},{type:"google",family:"Tillana",usage:"headings",category:"display",w:"400, 500, 600, 700, 800"},{type:"google",family:"Titillium Web",usage:"all",category:"sans",w:"200, 300, 400, 600, 700, 900"},{type:"google",family:"Trirong",usage:"h1",category:"serif",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Ubuntu",usage:"all",category:"sans",w:"300, 400, 500, 700"},{type:"google",family:"Work Sans",usage:"headings",category:"sans",w:"100, 200, 300, 400, 500, 600, 700, 800, 900"},{type:"google",family:"Zilla Slab",usage:"all",category:"serif",w:"300, 400, 500, 600, 700"}].forEach(function(e){var t;n.getFontByFamily(e.family)||(t=n.getFontClassForType(e.type))&&(e.w&&(e.styles=e.w.split(/,\s?/).map(function(e){return{weight:e}}),e.weights=e.w.split(/,\s?/)),t=new t(e),n.addFont(t),t.activateInProject())}),this.save()},this.removeAll=function(){this.clear(),this.save()},this.refreshFontsFromUrl=function(t,e){var a=null,o=-1;i.slice(0).forEach(function(e){e.url===t&&(o<0&&(o=i.indexOf(e)),n.removeFont(e.family),a=a||e.constructor)});require("nw.gui").App.clearCache();var s=pinegrow.getCurrentProject();t=s.getAbsoluteUrl(t),this.extractRemoteFontsFromUrl(t,function(){e&&e()},a,o)},this.extractRemoteFontsFromUrl=function(f,t,g,c){void 0===c&&(c=-1),g=g||PgFontTypeRemote;function a(i){var l=[],r={};i.split("@font-face").forEach(function(e){var t,a,o,s,n=e.match(/font\-family:\s*['"](.*)['"]/m);n&&(t=n[1],(n=e.match(/font\-style:\s*([^;]*);/m))&&(a=n[1]),(n=e.match(/font\-weight:\s*([^;]*);/m))&&(o=n[1]),r[t]||(r[t]=new g(null,f,t),l.push(r[t]),s=new RegExp("font\\-family\\:\\s*['\"]?"+pgParserEscapeRegExp(t)+"['\"]?,\\s*(.*)\\;"),(n=i.match(s))&&(r[t].fallback=n[1]),pinegrow.fontLibrary.addFont(r[t],0<=c?c++:void 0)),a&&r[t].addStyle(a),o)&&r[t].addWeight(o)}),l.forEach(function(e){e.activateInProject()})}if(crsaIsFileUrl(f))try{var o=crsaMakeFileFromUrl(f),e=require("fs").readFileSync(o,{encoding:"utf8"});a(e),t()}catch(e){pinegrow.showQuickError("Could not read file "+o),t()}else fetch(f).then(function(e){e.text().then(function(e){a(e),t()})})},this.getRandomFont=function(t){var e=i.filter(function(e){return e.isUsedFor(t)});return e.length?e[Math.round(Math.random()*(e.length-1))]:null},this.init(),pinegrow.addEventHandler("on_project_loaded",function(){n.load()}),pinegrow.addEventHandler("on_project_closed",function(){n.clear()})},PgFontTypeLibraryView=function(){var n=pinegrow.fontLibrary,s=this,e=$(`<div class="pg-font-lib-view">
<p>The fonts on this list are used in the Design panel. Only the fonts that are actually used in the active design are imported in the generated CSS stylesheet.</p>

<table class="table table-striped table-hover activated-fonts"></table>
<p>
<button class="add-font pg-button on-white-bck">Add font...</button>
</p>
</div>`),a=e.find(".activated-fonts"),t=(e.on("click",".remove-font",function(e){var t=$(this.closest("tr")),a=pgDecodeAttribute(t.attr("data-family"));n.removeFont(a),n.save(),t.remove(),pinegrow.showQuickMessage(a+` was removed.`)}),e.on("click",".edit-font",function(e){e.preventDefault();var t=$(this.closest("tr")),t=pgDecodeAttribute(t.attr("data-family")),a=n.getFontByFamily(t),o=a.family;a.edit(function(){o!==a.family&&(n.removeFont(o),n.addFont(a),a.activateInProject()),n.save(),s.show()})}),e.on("click",".refresh-font",function(e){var t=$(this.closest("tr")),a=pgDecodeAttribute(t.attr("data-family")),a=n.getFontByFamily(a);pinegrow.showQuickMessage(`Refreshing fonts from ${a.url}...`),t.find("td").html("&nbsp;").first().html("Refreshing... Please wait."),n.refreshFontsFromUrl(a.url,function(){n.save(),s.show(),pinegrow.showQuickMessage("Done.")})}),e.on("click",".set-usage",function(e){function t(e){o.usage=e,n.save(),s.html("h1"===e?"h1, h2":e)}var a=$(this.closest("tr")),a=pgDecodeAttribute(a.attr("data-family")),o=n.getFontByFamily(a),s=$(this),a=[{label:"all",check:"all"===o.usage,action:function(){t("all")}},{label:"text",check:"text"===o.usage,action:function(){t("text")}},{label:"headings",check:"headings"===o.usage,action:function(){t("headings")}},{label:i("h1"),check:"h1"===o.usage,action:function(){t("h1")}}],a=new CrsaContextMenu(a,s);return a.in_dialog=!0,a.showForElement(s),!1}),e.on("click",".add-font",function(e){var t=[{label:"System font...",action:function(){pinegrow.showPrompt(`<p>Enter the name(s) of the system font.</p>`,"Add a system font","",'"Times New Roman", Times, serif',null,function(e){var t;e&&(t=new PgFontTypeSystem(null,e),n.addFont(t),t.activateInProject(),n.save(),s.show())})}},{label:"Google Fonts...",action:function(){pinegrow.pgGoogleFontManager.show(function(e){console.log(e),e.forEach(function(e){var t=new PgFontTypeGoogle(null,e);n.addFont(t),t.activateInProject()}),n.save(),s.show()})}},{label:isApp()?"Local web font...":"Self-hosted web font...",action:function(){var e;isApp()?pinegrow.showQuickDialog("Add a local web font",`Stylesheet`,`<p>Select the local CSS file that contains <code>@font-face</code> declaration of the web font bundle.</p><p>Note, you can use a service such as <a href="https://www.fontsquirrel.com/tools/webfont-generator" class="external">Font Squirrel</a> to upload font files and generate the web font bundle.</p>`,{url:{name:"Local font CSS file",type:"text",file_picker_use_project_as_parent:!0,file_picker:!0,file_picker_no_proxy:!0,file_picker_no_copy_to_folder:!0,helptext:`<p>Select the CSS file located in the local font bundle.</p>`,validate:function(e,t,a){if(!a)return"Please select the CSS file."}}},"Cancel","Add",null,function(e){n.extractRemoteFontsFromUrl(pinegrow.getCurrentProject().getAbsoluteUrl(e.url),function(){n.save(),s.show()},PgFontTypeLocal)}):(e=new PgFontTypeUploadedWebfont(null,"")).edit(function(){n.addFont(e),e.activateInProject(),n.save(),s.show()})}},{label:"Adobe fonts (TypeKit)...",action:function(){pinegrow.showPrompt(`<p>Enter the <b>Project ID</b>. Projects ID are in the form <code>abc8efg</code>.</p>`,"Add Adobe Fonts project","","abc8efg",null,function(e){e&&n.extractRemoteFontsFromUrl(`https://use.typekit.net/${e}.css`,function(){n.save(),s.show()},PgFontTypeAdobe)})}},{label:"Import from URL...",action:function(){pinegrow.showPrompt(`<p>Enter the URL of the CSS stylesheet that contains @font-face declarations.</p>`+(isApp()?"":`<p>If the URL is located on a remote domain, the URL needs to be cross-origin accessible.</p>`),"Import from URL","","https://example.com/fonts/style.css",null,function(e){n.extractRemoteFontsFromUrl(e,function(){n.save(),s.show()})})}},{type:"divider"},{label:"Add default fonts",action:function(){n.restoreDefaultFonts(),s.show()}},{type:"divider"},{label:"Remove all...",action:function(){pinegrow.showAlert(`<p>Are you sure you want to remove all fonts from the list?</p>`,"Are you sure?","Cancel","Yes, remove all fonts",null,function(){n.removeAll(),s.show()})}}],a=$(this),t=new CrsaContextMenu(t,a);return t.in_dialog=!0,t.showForElement(a),!1}),this.view=new PgUIView(e,"font_library")),o={h1:"h1, h2"},i=function(e){return o[e]||e||"all"};this.show=function(){t.whenVisible(function(){var t=`<thead>
<tr>
<td>Family name</td>
<td>Use for</td>
<td>Source</td>
<td>Styles</td>
<td style="text-align:center;">Refresh</td>
<td style="text-align:center;">Remove</td>
</tr>
</thead><tbody>`;n.forEachFont(function(e){t+=`<tr data-family="${pgEncodeAttribute(e.family)}">
    <td>${e.getPreview()}${e.edit?' <a href="#" class="edit-font">edit</a>':""}</td>
    <td><a href="#" class="set-usage">${i(e.usage)}</a></td>
    <td>${e.getTypeLabel()}</td>
    <td>${e.describeStyles()}</td>
    <td style="text-align:center;">${e.can_refresh?'<i class="icon icon-refresh refresh-font" title="Reload '+e.url+' and refresh fonts."></i>':"&nbsp;"}</td>
    <td style="text-align:center;"><i class="icon icon-close remove-font"></i></td>
</tr>`}),t+="</tbody>",a.html(t),addTooltip(a.find(".refresh-font"),"title",{use_title_attr:!0}),addTooltip(a.find(".remove-font"),"Remove the font from the list."),addTooltip(a.find(".set-usage"),"Click to select where this font should be used.")},"show")}},PgDmFontLibrary=function(){function e(e){e.forEach(function(e){e.name,e})}var t=[{name:"Lato"},{name:"Montserrat"},{name:"Playfair Display"},{name:"Open Sans"},{name:"Merriweather"},{name:"Georgia",system:!0}],a=[{name:"Faster One",w:400,s:"2px"},{name:"Chonburi"},{name:"Tulpen One",w:400},{name:"Oswald"},{name:"Open Sans",w:700},{name:"Montserrat",w:400,s:"2px",t:"u"},{name:"Playfair Display"},{name:"Indie Flower"},{name:"Georgia",system:!0,style:"italic"}];e(t),e(a);this.getRandomFont=function(e){return e[Math.round(Math.random()*(e.length-1))]},this.getRandomTextFont=function(){return this.getRandomFont(t)},this.getRandomHeadingFont=function(){return this.getRandomFont(a)},font_sample_text="AaBbCcDdEeFfGgHhIiJjKk",this.getFontOptions=function(e){return e.map(function(e){return{key:e.name,name:e.name,html:'<span style="'+(a=!0,(n={})["font-family"]="'"+(t=e).name+"'",t.style&&(n["font-style"]=t.style),t.w&&(n["font-weight"]=t.w),t.s&&(n["letter-spacing"]=t.s),t.t&&(n["text-transform"]="u"==t.t?"uppercase":"lowercase"),a?(s="",$.each(n,function(e,t){if(o&&o.indexOf(e)<0)return!0;s+=e+":"+t+";"}),s):n)+'">'+e.name+"</span>"};var t,a,o,s,n})},this.getTextFontOptions=function(){return this.getFontOptions(t)},this.getHeadingFontOptions=function(){return this.getFontOptions(a)},this.getTextFontByKey=function(e){return t[e-1]},this.getHeadingFontByKey=function(e){return a[e-1]},this.getTextFontKey=function(e){return t.indexOf(e)+1},this.getHeadingFontKey=function(e){return a.indexOf(e)+1}};